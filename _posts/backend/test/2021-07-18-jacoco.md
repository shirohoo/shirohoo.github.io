---
layout: post
category:
    - backend
    - test
title: jacocoë¡œ í…ŒìŠ¤íŠ¸ ì»¤ë²„ë¦¬ì§€ ê´€ë¦¬í•˜ê¸°
description: >
  ëª¨ë“  `í…ŒìŠ¤íŠ¸ ê²°ê³¼`ë¥¼ `ì‹œê°í™”`í•˜ì—¬ `í…ŒìŠ¤íŠ¸ ì»¤ë²„ë¦¬ì§€`ë¥¼ ì„¸ë°€í•˜ê²Œ ê´€ë¦¬í•´ë´…ì‹œë‹¤
image: /assets/img/backend/test-logo.png
related_posts:
  - _posts/backend/test/2021-07-17-swagger-rest-docs.md
  - _posts/backend/test/2021-07-17-spring-rest-docs.md
---

* toc
{:toc}
  
<br />

# ğŸ“• ì°¸ê³ 

---

- [jacoco docs](https://www.jacoco.org/jacoco/trunk/doc/)
- [jacoco plugin](https://docs.gradle.org/current/userguide/jacoco_plugin.html)

<br />

# ğŸ¤” jacoco 

---

`jacoco`ëŠ” ê·¸ëƒ¥ ì•„ì£¼ ê°„ë‹¨í•˜ê²Œ ìƒê°í•˜ë©´ ëœë‹¤.

í…ŒìŠ¤íŠ¸ ê²°ê³¼ë¥¼ ë¬¸ì„œë¡œ ì‹œê°í™”í•´ì£¼ëŠ” íˆ´ì´ë‹¤.

ë¶€ê°€ì ìœ¼ë¡œ í…ŒìŠ¤íŠ¸ê²°ê³¼ì— ëŒ€í•œ ì¶”ê°€ì ì¸ ê²€ì¦ë„ ê°€ëŠ¥í•˜ë‹¤.

`gradle`ì„ ì‚¬ìš©ì¤‘ì´ë¼ë©´ ì´ë¯¸ gradleì— `jacoco í”ŒëŸ¬ê·¸ì¸`ì´ ê¸°ë³¸ì ìœ¼ë¡œ ë‚´ì¥ë¼ìˆê¸° ë•Œë¬¸ì— ì‚¬ìš©ë„ ë§¤ìš° ê°„ë‹¨í•˜ë‹¤.

<br />

```groovy
// file: 'build.gradle'
plugins {
    id 'jacoco'
}
```

<br />

ì´ë ‡ê²Œ `Plugin DSL`ì— ë”± í•œì¤„ë§Œ ì¶”ê°€í•´ì£¼ë©´ ì ìš©ì´ ëë‚œë‹¤.

ì •ë§ ì´ê²Œ ëì¸ì§€ ì˜ë¬¸ìŠ¤ëŸ¬ìš¸ ìˆ˜ ìˆë‹¤. 

ì •ë§ ì´ê²Œ ëì´ë‹¤.

<br />

# ğŸ“• jacoco task

---

í”ŒëŸ¬ê·¸ì¸ì„ ì ìš©í•´ì£¼ë©´ ë‘ê°œì˜ jacoco íƒœìŠ¤í¬ê°€ ìƒˆë¡œ ìƒì„±ëœë‹¤.

<br />

```shell
$ gradle tasks

> Task :tasks
------------------------------------------------------------
Tasks runnable from root project 'spring-rest-docs'
------------------------------------------------------------

...


Verification tasks
------------------
check - Runs all checks.
jacocoTestCoverageVerification - Verifies code coverage metrics based on specified rules for the test task.
jacocoTestReport - Generates code coverage report for the test task.
test - Runs the unit tests.


...

To see all tasks and more detail, run gradle tasks --all

To see more detail about a task, run gradle help --task <task>

BUILD SUCCESSFUL in 773ms
1 actionable task: 1 executed
```

<br />

jacoco íƒœìŠ¤í¬ëŠ” ìˆœì„œê°€ ì •í•´ì ¸ìˆë‹¤.

`test` -> `jacocoTestReport` -> `jacocoTestCoverageVerification` ìˆœìœ¼ë¡œ ì‹¤í–‰ë˜ëŠ”ê²Œ ê°€ì¥ ë°”ëŒì§í•˜ë‹¤.

ê° íƒœìŠ¤í¬ì— ëŒ€í•´ ì•Œì•„ë³´ì.

<br />

## ğŸ“œ jacocoTestReport

---

í…ŒìŠ¤íŠ¸ ê²°ê³¼ì— ëŒ€í•œ ë¶„ì„ì„ ë¬¸ì„œë¡œ ì‘ì„±í•´ì£¼ëŠ” íƒœìŠ¤í¬ë‹¤.

jacocoë¥¼ í†µí•´ ë‹¤ìŒ ì˜ˆì‹œì™€ ê°™ì€ ë¬¸ì„œê°€ ë§Œë“¤ì–´ì§„ë‹¤.

<br />

> [ğŸ“œ jacoco test report](/assets/docs/jacoco/index.html){:target="_blank"}

<br />

![image](https://user-images.githubusercontent.com/71188307/126055053-97d1509f-9a14-4779-a4cf-2e710f3c4564.png)

<br />

ìƒì„±ëœ ë¬¸ì„œë¥¼ ë³´ë©´ ë¼ì¸ì— `ì´ˆë¡ìƒ‰`, `ë¹¨ê°„ìƒ‰`, `ë…¸ë€ìƒ‰`ì´ ì¹ í•´ì ¸ ìˆë‹¤.

ì´ê²ƒì€ ë¼ì¸ ì»¤ë²„ë¼ê³  ë¶ˆë¦¬ë©° ì˜ë¯¸ëŠ” ë‹¤ìŒê³¼ ê°™ë‹¤.

<br />

- `ì´ˆë¡`: í…ŒìŠ¤íŠ¸ ì½”ë“œì—ì„œ í˜¸ì¶œë˜ì—ˆìœ¼ë©° ì¶©ë¶„íˆ ê²€ì¦ë˜ì—ˆìŒ
- `ë¹¨ê°•`: í…ŒìŠ¤íŠ¸ ì½”ë“œë¡œ ê²€ì¦ë˜ì§€ ì•Šì•˜ìŒ
- `ë…¸ë‘`: í…ŒìŠ¤íŠ¸ ì½”ë“œì—ì„œ ë¼ì¸ì˜ ì¼ë¶€ë§Œ í˜¸ì¶œ ë° ê²€ì¦ë˜ì—ˆìŒ (ì£¼ë¡œ ë©”ì„œë“œ ì²´ì´ë‹ìœ¼ë¡œ ì¸í•´ ë°œìƒ)

<br />

jacoco íƒœìŠ¤í¬ëŠ” ì¼ë‹¨ ë³„ë„ì˜ ìˆ˜ì • ì—†ì´ ê·¸ëƒ¥ ì‚¬ìš©í•´ë„ ë¬´ë°©í•˜ì§€ë§Œ í•„ìëŠ” jacoco íƒœìŠ¤í¬ë¥¼ ì…ë§›ëŒ€ë¡œ ì‚¬ìš©í•˜ê¸° ìœ„í•´ ì•½ê°„ì˜ ì»¤ìŠ¤í„°ë§ˆì´ì§•ì„ ì‹œë„í–ˆë‹¤.

<br />

```groovy
// file: 'build.gradle'
ext {
    set('staticsDir', file('src/main/resources/static')) // ë¬¸ì„œê°€ ì €ì¥ë  ìœ„ì¹˜ë³€ìˆ˜

    // jacoco í•„í„°ë§ ëª©ë¡
    excludeFilter = [ 
            '**/model/**', // ë‹¨ìˆœ ì…ì¶œë ¥ìš© í´ë˜ìŠ¤
            '**/*Application.*', // ë©”ì¸ í´ë˜ìŠ¤
            '**/Q*.class', // Querydsl í´ë˜ìŠ¤
            '**/test/**', // í…ŒìŠ¤íŠ¸ í´ë˜ìŠ¤
    ]
}

jacocoTestReport {
    reports {
        html.enabled true // ë¬¸ì„œë¥¼ htmlë¡œ ìƒì„±í•  ê²ƒ
        xml.enabled false // ë¬¸ì„œë¥¼ xmlë¡œ ìƒì„±í•˜ì§€ ì•Šì„ ê²ƒ
        csv.enabled false // ë¬¸ì„œë¥¼ csvë¡œ ìƒì„±í•˜ì§€ ì•Šì„ ê²ƒ

        html.destination file("$staticsDir/coverage") // ì¶œë ¥ 
    }

    afterEvaluate {
        classDirectories.setFrom(files(classDirectories.files.collect {
            fileTree(dir: it, exclude: excludeFilter) // ë¬¸ì„œì— ì¶œë ¥í•˜ê³  ì‹¶ì§€ ì•Šì€ íŒŒì¼ë“¤ì— ëŒ€í•œ ëª©ë¡
        }))
    }
}
```

<br />

## ğŸ“œ jacocoTestCoverageVerification

---

`í…ŒìŠ¤íŠ¸ ì»¤ë²„ë¦¬ì§€ì— ëŒ€í•œ ê²€ì¦ íƒœìŠ¤í¬`ë‹¤.

ì´ íƒœìŠ¤í¬ì—ì„œ ì •ë§ ë§ì€ê²ƒì„ í•  ìˆ˜ ìˆë‹¤.

jacocoë¥¼ ì‚¬ìš©í•˜ë©´ì„œ ìœ ë‚œíˆ ì†ì´ ì¢€ ê°€ëŠ” íƒœìŠ¤í¬ì´ê¸´ í•œ ê²ƒ ê°™ë‹¤.

ì—­ì‹œ ë¹Œë“œ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ë³´ëŠ”ê²Œ ë¹ ë¥´ë‹¤.

<br />

```groovy
// file: 'build.gradle'
ext {
    set('staticsDir', file('src/main/resources/static')) // ë¬¸ì„œê°€ ì €ì¥ë  ìœ„ì¹˜ë³€ìˆ˜

    // jacoco í•„í„°ë§ ëª©ë¡
    excludeFilter = [
            '**/model/**', // ë‹¨ìˆœ ì…ì¶œë ¥ìš© í´ë˜ìŠ¤
            '**/*Application.*', // ë©”ì¸ í´ë˜ìŠ¤
            '**/Q*.class', // Querydsl í´ë˜ìŠ¤
            '**/test/**', // í…ŒìŠ¤íŠ¸ í´ë˜ìŠ¤
    ]
}

jacocoTestCoverageVerification {
    // ê²€ì¦ ë£° ì„ ì–¸
    violationRules { 
        rule {
            enabled = true // í•´ë‹¹ ë£°ì„ ì‚¬ìš©í•  ê²ƒ

            element = 'CLASS' // í´ë˜ìŠ¤ íŒŒì¼ì„ ëŒ€ìƒìœ¼ë¡œ

            limit { // ì œí•œí•œë‹¤
                counter = 'LINE' // í´ë˜ìŠ¤ì˜ ë¼ì¸ì„ ëŒ€ìƒìœ¼ë¡œ
                value = 'COVEREDRATIO' // ë¼ì¸ ì»¤ë²„ë¦¬ì§€ë¥¼ ê²€ì¦í•œë‹¤
                minimum = 0.50 // ê° í´ë˜ìŠ¤ì˜ ë¼ì¸ ì»¤ë²„ë¦¬ì§€ê°€ 50%ê°€ ë„˜ì§€ ì•Šìœ¼ë©´ ë¹Œë“œ ì‹¤íŒ¨
            }

            limit { // ì œí•œí•œë‹¤
                counter = 'LINE' // í´ë˜ìŠ¤ì˜ ë¼ì¸ì„ ëŒ€ìƒìœ¼ë¡œ
                value = 'TOTALCOUNT' // ê° í´ë˜ìŠ¤ì˜ ë¼ì¸ìˆ˜ë¥¼ ê²€ì¦í•œë‹¤
                maximum = 250 // ê° í´ë˜ìŠ¤ì˜ ë¼ì¸ìˆ˜ê°€ 250ì¤„ì´ ë„˜ì–´ê°€ë©´ ë¹Œë“œ ì‹¤íŒ¨
            }
            excludes = excludeFilter // í…ŒìŠ¤íŠ¸ ê²°ê³¼ë¥¼ ê²€ì¦í•˜ì§€ ì•Šì„ íŒŒì¼ë“¤ì— ëŒ€í•œ ëª©ë¡
        }
    }
}
```

<br />

ì´ëŸ°ì‹ìœ¼ë¡œ `í´ë˜ìŠ¤`, `íŒ¨í‚¤ì§€`, `ë¼ì¸`ë“±ì„ íƒ€ê²Ÿìœ¼ë¡œ `ì‹œìŠ¤í…œì  ì œì•½`ì„ ê±¸ ìˆ˜ ìˆë‹¤.

ì´ë ‡ê²Œ í…ŒìŠ¤íŠ¸ ê²°ê³¼ë¥¼ ë‹¤ì‹œ ê²€ì¦í•˜ë©° ì´ `ë£°`ì´ ìœ„ë°˜ë˜ì—ˆì„ ê²½ìš° ë¹Œë“œë¥¼ ì‹¤íŒ¨ì‹œí‚¨ë‹¤.

<br />

## ğŸ“œ jacoco(custom task)

---

ì´ì •ë„ë§Œ ì„¤ì •í•˜ê²Œ ë˜ë©´ ê°œë°œìê°€ ë§¤ë²ˆ íƒœìŠ¤í¬ë¥¼ ìˆ˜ë™ìœ¼ë¡œ ì‹¤í–‰ì‹œì¼œì¤˜ì•¼í•˜ëŠ” ë¶ˆí¸í•¨ì´ ìˆê¸° ë•Œë¬¸ì—, `build` íƒœìŠ¤í¬ê°€ ì‹¤í–‰ë˜ë©´ ëª¨ë“  ì‘ì—…ì´ ìë™í™”ë˜ê²Œ ë§Œë“¤ ê²ƒì´ë‹¤.

```groovy
// file: 'build.gradle'
task jacoco(type: Test) { // ì»¤ìŠ¤í…€ íƒœìŠ¤í¬
    group 'verification' // verificationê·¸ë£¹ì— ì†í•œë‹¤
    description 'Runs the unit tests and verify coverage using jacoco' // íƒœìŠ¤í¬ê°€ ì‹¤í–‰ë˜ë©´ ì¶œë ¥ë  ë©”ì‹œì§€

    // ì´ íƒœìŠ¤í¬ê°€ ì‹¤í–‰ë˜ë©´ ë‹¤ìŒì˜ ë‘ íƒœìŠ¤í¬ê°€ ë¨¼ì € ì‹¤í–‰ë˜ê²Œ í•œë‹¤
    dependsOn(
            ':jacocoTestReport',
            ':jacocoTestCoverageVerification'
    )

    // jacocoTestCoverageVerificationëŠ” ë°˜ë“œì‹œ jacocoTestReportê°€ ì‹¤í–‰ëœ í›„ì— ì‹¤í–‰ë  ê²ƒì´ë‹¤
    tasks['jacocoTestCoverageVerification'].mustRunAfter(tasks['jacocoTestReport'])
}

bootJar {
    dependsOn(':jacoco') // boorJar íƒœìŠ¤í¬ê°€ ì‹¤í–‰ë˜ê¸° ì „(íŒ¨í‚¤ì§•ë‹¨ê³„)ì— jacoco íƒœìŠ¤í¬ê°€ ì‹¤í–‰ë˜ë„ë¡ í•œë‹¤
}
```

<br />

ì´ë ‡ê²Œ ì„¤ì •í•˜ê³  `gradle clean build`ë¥¼ ì‹¤í–‰í•˜ë©´...

<br />

```shell
$ gradle clean build

Starting Gradle Daemon...
Gradle Daemon started in 2 s 336 ms

> Task :compileJava
> Task :processResources
> Task :classes
> Task :bootJarMainClassName
> Task :compileTestJava
> Task :processTestResources NO-SOURCE
> Task :testClasses

> Task :test // í…ŒìŠ¤íŠ¸ ì‹¤í–‰ 
> Task :jacocoTestReport // í…ŒìŠ¤íŠ¸ ë¦¬í¬íŠ¸ ì‘ì„± 
> Task :jacocoTestCoverageVerification // í…ŒìŠ¤íŠ¸ ê²°ê³¼ ê²€ì¦
> Task :jacoco // jacoco íƒœìŠ¤í¬ ì‹¤í–‰(ì•ì˜ ë‘ íƒœìŠ¤í¬ë¥¼ ìœ ë°œí•˜ëŠ” ê²ƒ ì™¸ì— ì•„ë¬´ ê¸°ëŠ¥ ì—†ìŒ)
> Task :check
> Task :bootJar // íŒ¨í‚¤ì§•

> Task :jar
> Task :assemble
> Task :build

BUILD SUCCESSFUL in 19s
11 actionable tasks: 11 executed
ì˜¤í›„ 1:06:09: Task execution finished 'build'.
```

<br />

