---
layout: post
category:
    - debugging
title: ìŠ¤í”„ë§ë¶€íŠ¸ 2.5+, Hibernate ì‚¬ìš©ì‹œ DB ì´ˆê¸°í™” ì´ìŠˆ
description: >
    ìŠ¤í”„ë§ë¶€íŠ¸ ë²„ì „ì—…ì— ì˜í•œ ì´ìŠˆ ì •ë¦¬
image: /assets/img/debugging/debugging.jpg
accent_image:
    background: url('/assets/img/debugging/debugging.jpg') center/cover
related_posts:
    -
---

* toc
{:toc}
  
<br />

# ğŸš¨ ë¬¸ì œ

---

í•™ìŠµ í”„ë¡œì íŠ¸ ì§„í–‰ ì¤‘ ë°œê²¬í•œ ì´ìŠˆì´ë‹¤.

<br />

1. `Hiberate`ë¥¼ ì‚¬ìš©í•˜ê³  ìˆì—ˆìŒ
2. ìŠ¤í”„ë§ë¶€íŠ¸ ë²„ì „ 2.4 ëŒ€ì—ì„œ 2.5+ ì´ìƒìœ¼ë¡œ ë²„ì „ì—…
3. `data.sql`ì´ ì•„ë˜ì™€ ê°™ì€ ë©”ì‹œì§€ì™€ í•¨ê»˜ ì •ìƒë™ì‘í•˜ì§€ ì•ŠìŒ  

<br />

![image](https://user-images.githubusercontent.com/71188307/145991708-69ab51e3-f041-4111-a09e-abec1f06c793.png)

<br />

# ğŸš§ ì›ì¸

---

ìŠ¤í”„ë§ë¶€íŠ¸ [ğŸ“œ ë¦´ë¦¬ì¦ˆë…¸íŠ¸](https://github.com/spring-projects/spring-boot/wiki/Spring-Boot-2.5-Release-Notes#hibernate-and-datasql){:target="_blank"} ì—ì„œ ì°¾ì•˜ë‹¤.

<br />

```markdown
- Hibernate and data.sql

By default, data.sql scripts are now run before Hibernate is initialized. 

This aligns the behavior of basic script-based initialization with that of Flyway and Liquibase. 

If you want to use data.sql to populate a schema created by Hibernate, set spring.jpa.defer-datasource-initialization to true. 

While mixing database initialization technologies is not recommended, this will also allow you to use a schema.sql script to build upon a Hibernate-created schema before itâ€™s populated via data.sql.
```

<br />

ëŒ€ëµ ìŠ¤í”„ë§ë¶€íŠ¸ 2.5ë¶€í„°ëŠ” `data.sql`ì´ `Hibernate`ê°€ ì‹¤í–‰í•˜ëŠ” `ddl-auto` ë³´ë‹¤ ë¨¼ì € ì‹¤í–‰ëœë‹¤ëŠ” ê²ƒ ê°™ë‹¤.

ë”°ë¼ì„œ ê¸°ì¡´ê³¼ ê°™ì´ ì‚¬ìš©í•˜ê³  ì‹¶ë‹¤ë©´ `spring.jpa.defer-datasource-initialization=true` ì˜µì…˜ì„ ì¶”ê°€í•˜ë¼ê³  í•œë‹¤.

<br />

ì‹¤ì œë¡œ ì´ê²ƒì´ ë¬¸ì œì¸ê²Œ ë§ëŠ”ì§€ ìš°ì„  ë²„ì „ì„ ë³€ê²½í•´ í…ŒìŠ¤íŠ¸í•´ë³´ì•˜ë‹¤.

<br />

ìš°ì„  ë°ëª¨ í”„ë¡œì íŠ¸ë¥¼ `2.4.3` ë²„ì „ìœ¼ë¡œ ìƒì„±í–ˆë‹¤.

ì˜ì¡´ì„±ì€ ì•„ì£¼ ê°„ë‹¨í•˜ê²Œ `web`, `data-jpa`, `h2`ë§Œ ì¶”ê°€í–ˆë‹¤.

<br />

![ë²„ì „2 4 3](https://user-images.githubusercontent.com/71188307/145993522-307c22d5-801a-4bd7-b7b6-b1d6fa8457eb.JPG)

<br />

ê·¸ë¦¬ê³  `application.yaml` íŒŒì¼ì„ ë‹¤ìŒê³¼ ê°™ì´ ì„¤ì •í–ˆë‹¤.

<br />

```yaml
# file: 'application.yaml'
spring:
  h2:
    console:
      enabled: true
      settings:
        web-allow-others: true

  datasource:
    url: jdbc:h2:mem:testdb
    username: sa
    password:

  jpa:
    properties:
      hibernate:
        format_sql: true
    hibernate:
      ddl-auto: create-drop
```

<br />

ê·¸ë¦¬ê³  `Hibernate`ê°€ í…Œì´ë¸”ì„ ìƒì„±í•˜ë„ë¡ ë‹¤ìŒê³¼ ê°™ì´ ê°„ë‹¨í•œ ì—”í‹°í‹° í´ë˜ìŠ¤ë¥¼ ì‘ì„±í–ˆë‹¤.

<br />

```java
@Entity
public class Member implements Serializable {

    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;

    private String name;

    private int age;

}
```

<br />

ë§ˆì§€ë§‰ìœ¼ë¡œ `Hibernate`ê°€ ìƒì„±í•œ í…Œì´ë¸”ì— ì‚½ì…ë  ë°ì´í„°ë¥¼ `resources/data.sql`ì— ì¶”ê°€í–ˆë‹¤.

```sql
-- file: 'resources/data.sql'
insert into member (name, age)
values ('name1', 10);

insert into member (name, age)
values ('name2', 10);
```

<br />

ê·¸ë¦¬ê³  í”„ë¡œì íŠ¸ë¥¼ ì‹¤í–‰í•˜ê³  `localhost:8080/h2-console`ë¡œ ì ‘ê·¼í•˜ì—¬ í…Œì´ë¸”ì´ ì •ìƒì ìœ¼ë¡œ ìƒì„±ë˜ì—ˆëŠ”ì§€, ë°ì´í„°ê°€ ì •ìƒì ìœ¼ë¡œ ì‚½ì…ë˜ì—ˆëŠ”ì§€ë¥¼ í™•ì¸í–ˆë‹¤.

<br />

![image](https://user-images.githubusercontent.com/71188307/145994305-22216928-048e-4806-98ad-06e4a2061e38.png)

<br />

ë²„ì „ì„ ë‚´ë ¤ì„œ ì§„í–‰í•˜ë‹ˆ ì •ìƒì ìœ¼ë¡œ ë™ì‘í•¨ì„ í™•ì¸í–ˆë‹¤.

<br />

# âœ… í•´ê²°

---

<u>2.4ëŒ€ì—ì„œ 2.5+ì´ìƒì˜ ë²„ì „ìœ¼ë¡œ ë³€ê²½ í•  ê²½ìš° ì˜µì…˜ì„ ì¤˜ì•¼í•œë‹¤</u>ê³  í•˜ë‹ˆ ë°ëª¨ í”„ë¡œì íŠ¸ì˜ ìŠ¤í”„ë§ë¶€íŠ¸ ë²„ì „ì„ `2.6.1`ë¡œ ë³€ê²½í•˜ê³ , `application.yaml`ì— ì˜µì…˜ì„ ì¶”ê°€í–ˆë‹¤.

<br />

![image](https://user-images.githubusercontent.com/71188307/145994514-722a9149-ab44-45f8-8354-3f6ef88892ef.png)

<br />

```yaml
# file: 'application.yaml'
spring:
  h2:
    console:
      enabled: true
      settings:
        web-allow-others: true
  datasource:
      url: jdbc:h2:mem:testdb
      username: sa
      password:
  jpa:
    defer-datasource-initialization: true # ì¶”ê°€ !
    properties:
      hibernate:
        format_sql: true
    hibernate:
      ddl-auto: create-drop
```

<br />

ë§ˆì°¬ê°€ì§€ë¡œ í”„ë¡œì íŠ¸ë¥¼ ì‹¤í–‰í•˜ê³  `localhost:8080/h2-console`ë¡œ ì ‘ê·¼í•˜ì—¬ í…Œì´ë¸”ì´ ì •ìƒì ìœ¼ë¡œ ìƒì„±ë˜ì—ˆëŠ”ì§€, ë°ì´í„°ê°€ ì •ìƒì ìœ¼ë¡œ ì‚½ì…ë˜ì—ˆëŠ”ì§€ë¥¼ í™•ì¸í–ˆë‹¤.

<br />

![image](https://user-images.githubusercontent.com/71188307/145994709-636b32d9-1128-4511-b54a-2d8aabbb4c2e.png)

<br />

ì•„ë¬´ëŸ° ë¬¸ì œ ì—†ì´ ì •ìƒì ìœ¼ë¡œ ë™ì‘í•¨ì„ í™•ì¸í–ˆë‹¤.

<br />
