---
layout: post
category:
    - debugging
title: Could not extract response\: no suitable HttpMessageConverter found for response type \[...\] and content type \[text/html\] with root cause
description: >
    <u>SpringMVC</u>, <u>OpenFeign</u> ì‚¬ìš© ì¤‘ ë°œìƒ
image: /assets/img/debugging/debugging.jpg
accent_image:
    background: url('/assets/img/debugging/debugging.jpg') center/cover
related_posts:
    -
---

* toc
{:toc}
  
<br />

# ğŸš¨ ë¬¸ì œ

---

íšŒì‚¬ ì„œë¹„ìŠ¤ë¥¼ í™•ì¥í•˜ë˜ ì¤‘ ë°œìƒí•œ ì´ìŠˆì´ë‹¤.

íƒ€ íšŒì‚¬ì˜ APIì— ìš°ë¦¬ ì„œë¹„ìŠ¤ë¥¼ ì—°ë™í•´ì•¼ í•˜ëŠ” ìƒí™©ì´ì—ˆë‹¤.

ì§‘ì— ì˜¤ìë§ˆì ë°ëª¨ í”„ë¡œì íŠ¸ë¥¼ ë‘ê°œ ë§Œë“¤ì–´ í•´ë‹¹ ìƒí™©ì„ ì¬í˜„í•´ë´¤ëŠ”ë°, ì¬í˜„ì´ ì•„ì£¼ ì˜ ëœë‹¤.

<br />

```shell
2021-12-20 19:39:25.637 ERROR 3936 --- [nio-8080-exec-1] o.a.c.c.C.[.[.[/].[dispatcherServlet]    : Servlet.service() for servlet [dispatcherServlet] in context with path [] threw exception [Request processing failed; nested exception is feign.codec.DecodeException: Could not extract response: no suitable HttpMessageConverter found for response type [class io.github.shirohoo.client.api.ApiController$Response] and content type [text/html]] with root cause

org.springframework.web.client.UnknownContentTypeException: Could not extract response: no suitable HttpMessageConverter found for response type [class io.github.shirohoo.client.api.ApiController$Response] and content type [text/html]
	at org.springframework.web.client.HttpMessageConverterExtractor.extractData(HttpMessageConverterExtractor.java:126) 
```

<br />

# ğŸš§ ì›ì¸

---

- `SpringMVC`, `OpenFeign` ì‚¬ìš© ì¤‘ ë°œìƒ
- ì›ì¸: API ì„œë²„ì—ì„œ ì‘ë‹µí•˜ëŠ” ì‹¤ ë°ì´í„°ëŠ” `application/json`
    - í•˜ì§€ë§Œ `Content-Type`ì€ `text/html` ğŸ˜’
    - <u>ì¦‰, ì›¹ í‘œì¤€ì„ ì§€í‚¤ì§€ ì•ŠëŠ” ì‘ë‹µìœ¼ë¡œ ì¸í•œ ë¬¸ì œ</u>

<br />

# ğŸš§ ì¬í˜„

---

ì¬í˜„ìš© ë°ëª¨ í”„ë¡œì íŠ¸ë¥¼ ë‘ê°œ ë§Œë“¤ì—ˆë‹¤.

ì‘ë‹µ ì„œë²„ì—ì„œëŠ” ê°ì²´ë¥¼ `JSON`ìœ¼ë¡œ ì§ë ¬í™”í•´ ì‘ë‹µí•˜ë©´ì„œ `Content-Type=text/html` ìœ¼ë¡œ í—¤ë”ë¥¼ ì„¤ì •í•´ë³¼ ê²ƒì´ë‹¤.

- `Spring MVC`, `OpenFeign` í”„ë¡œì íŠ¸ = ìš”ì²­ ì„œë²„
- `Spring MVC` í”„ë¡œì íŠ¸ = ì‘ë‹µ ì„œë²„

<br />

ìš°ì„  í‘œì¤€ì„ ì œëŒ€ë¡œ ì§€í‚¤ì§€ ì•ŠëŠ” ì‘ë‹µì„œë²„ë¥¼ ê°„ë‹¨í•˜ê²Œ í•˜ë‚˜ êµ¬í˜„í•œë‹¤.

<br />

```java
@Slf4j
@RestController
public class FakeResponseController {

    @PostMapping
    public ResponseEntity<Response> post(@RequestBody Request request) {
        log.info("request={}", request);
        HttpHeaders httpHeaders = new HttpHeaders();
        httpHeaders.setContentType(MediaType.TEXT_HTML);
        Response httpBody = Response.builder()
                .responseCode(HttpStatus.OK.value())
                .responseMessage(HttpStatus.OK.getReasonPhrase())
                .body(request)
                .build();
        log.info("httpBody={}", httpBody);

        return ResponseEntity.status(HttpStatus.OK)
                .headers(httpHeaders)
                .body(httpBody);
    }

    @Data
    @Builder
    @NoArgsConstructor
    @AllArgsConstructor
    public static class Request {

        private String phoneNumber;

        private long amount;

    }

    @Data
    @Builder
    @NoArgsConstructor
    @AllArgsConstructor
    public static class Response<T> {

        private int responseCode;

        private String responseMessage;

        private T body;

    }

}

```

<br />

ê·¸ë¦¬ê³  `OpenFeign`ì„ ì´ìš©í•´ ì‘ë‹µì„œë²„ì— HTTP ìš”ì²­ì„ ë³´ë‚´ì•¼ í•˜ë¯€ë¡œ ì´ë¥¼ êµ¬í˜„í•œë‹¤.

<br />

```java
@Slf4j
@RestController
@RequiredArgsConstructor
public class RequestController {

    private final ApiServerClient client;

    @GetMapping
    public Response get() {
        Request request = new Request("010-1234-5678", 50_000);
        Response response = client.post(request);
        log.info("response={}", response);
        return response;
    }

    @Data
    @Builder
    @NoArgsConstructor
    @AllArgsConstructor
    public static class Request {

        private String phoneNumber;

        private long amount;

    }

    @Data
    @Builder
    @NoArgsConstructor
    @AllArgsConstructor
    public static class Response {

        private int responseCode;

        private String responseMessage;

        private Request body;

    }

}
```

<br />

ê·¸ë¦¬ê³  ë‘ ì„œë²„ë¥¼ ëª¨ë‘ ê¸°ë™í•˜ê³  ìš”ì²­ì„ ë³´ëƒˆë‹¤.

<br />

![image](https://user-images.githubusercontent.com/71188307/146756147-0d036fee-86d2-4981-9d15-876e7d8ecfd0.png)

<br />

ë²„ê·¸ ìƒí™©ì´ ì¬í˜„ëœ ëª¨ìŠµ

<br />

# âœ… í•´ê²°

---

`stack trace`ë§Œ ë³´ìë©´ `Content-Type=text/html`ì„ ì²˜ë¦¬í•´ì£¼ëŠ” `HttpMessageConverter`ê°€ ì—†ëŠ” ê²ƒ ê°™ë‹¤.

ì´ë¥¼ ì§ì ‘ êµ¬í˜„í• ê¹Œ ê³ ë¯¼í•˜ë‹¤, ì•ìœ¼ë¡œ ìˆ˜ì‹­ê°œ ë²¤ë”ì˜ APIë¥¼ ë‹¤ ì—°ë™í•´ì•¼ í•˜ëŠ”ë°, ë³„ë³„ ìƒí™©ì´ ë” ë‚˜ì˜¬ ê²ƒ ê°™ì•„ `gson` ì˜ì¡´ì„±ì„ ì¶”ê°€í•´ì„œ í•´ê²°í•´ë³´ê¸°ë¡œ ê²°ì •í–ˆë‹¤.

`gson`ì„ í”„ë¡œì íŠ¸ì— ì¶”ê°€í•˜ê³  `Content-Type=text/html` ì´ì—¬ë„ ì²˜ë¦¬í•˜ë„ë¡ í™•ì¥í•´ì¤„ ê²ƒì´ë‹¤.

<br />

```groovy
// file: 'build.gradle'
dependencies {
    ...
    implementation 'com.google.code.gson:gson:2.8.9' // í˜„ ì‹œì  ìµœì‹  ë²„ì „ì„ ì¶”ê°€
    ...
}
```

<br />

```java
@Component
public static class ExpandGsonHttpMessageConverter extends GsonHttpMessageConverter {

    public ExpandGsonHttpMessageConverter() {
        List<MediaType> types = Arrays.asList(
                new MediaType(MediaType.TEXT_HTML, DEFAULT_CHARSET),
                new MediaType(MediaType.TEXT_PLAIN, DEFAULT_CHARSET),
                new MediaType(MediaType.TEXT_XML, DEFAULT_CHARSET)
        );
        super.setSupportedMediaTypes(types);
    }

}
```

<br />

ê·¸ë¦¬ê³  ë‘ ì„œë²„ë¥¼ ëª¨ë‘ ì¬ê¸°ë™í•œ í›„ ë‹¤ì‹œ ìš”ì²­ì„ ë³´ë‚´ë³´ì•˜ë‹¤.

ì‘ë‹µ ì„œë²„ì˜ ë¡œê·¸

<br />

```shell
2021-12-20 20:02:55.853  INFO 30796 --- [nio-8081-exec-1] i.g.s.api.api.FakeResponseController     : request=FakeResponseController.Request(phoneNumber=010-1234-5678, amount=50000)
2021-12-20 20:02:55.854  INFO 30796 --- [nio-8081-exec-1] i.g.s.api.api.FakeResponseController     : httpBody=FakeResponseController.Response(responseCode=200, responseMessage=OK, body=FakeResponseController.Request(phoneNumber=010-1234-5678, amount=50000))
```

<br />

ìš”ì²­ ì„œë²„ì˜ ë¡œê·¸

<br />

```shell
2021-12-20 20:02:55.870  INFO 9108 --- [nio-8080-exec-1] i.g.s.client.api.RequestController       : response=RequestController.Response(responseCode=200, responseMessage=OK, body=RequestController.Request(phoneNumber=010-1234-5678, amount=50000))
```

<br />

ë¬¸ì œì—†ì´ ì•„ì£¼ ì˜ ëœë‹¤.

ë‚´ì¼ ì¶œê·¼í•˜ë©´ ì ìš©í•´ì•¼ê² ë‹¤.

<br />
