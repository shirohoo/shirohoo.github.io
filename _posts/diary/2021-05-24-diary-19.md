---
layout: post
category:
    - diary
date: 2021-05-24 20:59
title: ë°±ì˜¤í”¼ìŠ¤ íŠœë‹ê¸° 2
description: >
    ê°œë°œì¼ê¸°
image: /assets/img/debugging/debugging.jpg
accent_image:
    background: url('/assets/img/debugging/debugging.jpg') center/cover
related_posts:
    - _posts/diary/2021-05-20-diary-18.md
    - _posts/diary/2021-05-25-diary-20.md
---

* toc
{:toc}

&nbsp;

ìµœê·¼ íšŒì‚¬ì—ì„œ ë°±ì˜¤í”¼ìŠ¤ ë¦¬íŒ©í† ë§ì— ì „ë ¥ì„ ê¸°ìš¸ì´ê³  ìˆë‹¤. 

~~(ë„ˆë¬´ ëŠë ¤ì„œ -ã……-.. ì—¬ìœ ë„ ë§ì´ ìˆì–´ì„œ..)~~

ë‹¹ì¥ ëˆˆì—ë³´ì´ëŠ” ë¬¸ì œë“¤ì„ ëª¨ë‘ ê±·ì–´ë‚´ê³  ë³´ë‹ˆ 

APMì—ì„œ ì˜ë¬¸ì„ ëª¨ë¥´ê²Œ ë³‘ëª©ì´ ìƒê¸°ëŠ” êµ¬ê°„ë“¤ì´ ë°œê²¬ëë‹¤.

&nbsp;  

![](https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2FSCGG2%2Fbtq5FWrW7Hc%2Fk386wZ4cRxDaY17BiL0L4K%2Fimg.png)

&nbsp;  

ì •ë§ ë‹¨ìˆœí•œ ë¡œì§ì´ê³  ì„œë²„ë‹¨ì—ì„œ ì´ˆìŠ¤í”¼ë“œë¡œ ëª¨ë“  ì²˜ë¦¬ê°€ ëë‚¬ìœ¼ë‚˜

`HttpResponse`ê°€ ì•ˆ ë‚ ì•„ê°€ê³  ë³‘ëª©ì´ ìƒê¸°ëŠ” ê²ƒì´ì—ˆë‹¤.

ì •ë§ `HttpResponse` ë¬¸ì œì¸ì§€ í™•ì¸í•´ë³´ê¸° ìœ„í•´ í•œ ê°€ì§€ë¥¼ ë” ì ê²€í•´ë´¤ë‹¤.

&nbsp;  

![](https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2FM7bXb%2Fbtq5G3jPfjb%2FaJaU8BSyJnd4VgO6dH7NZ0%2Fimg.png)

&nbsp;  

`TTFB(Time to first byte)`ëŠ” í´ë¼ì´ì–¸íŠ¸ê°€ ì„œë²„ì— ìš”ì²­(Request)ì„ ë³´ë‚´ê³ 

ì‘ë‹µ(Response)ì„ ë°›ê¸°ê¹Œì§€ ê±¸ë¦¬ëŠ” ì‹œê°„ì„ ë§í•˜ëŠ”ë°, 

ì„œë²„ ëª¨ë‹ˆí„°ë§ì—ì„œ ë³‘ëª©ì´ ìƒê¸°ëŠ” ë¶€ë¶„ê³¼ ë”œë ˆì´ê°€ ì•„ì£¼ í¡ì‚¬í–ˆë‹¤.

&nbsp;  

ë°œê²¬í•œ ìˆ˜ìƒí•œ ì ë“¤ì„ ì •ë¦¬í•˜ìë©´

&nbsp;  

- **ë¬¸ì œê°€ ë°œìƒí•˜ëŠ” ìš”ì²­ì„ ì²˜ë¦¬í•  ë•Œ ì„œë²„ì˜ CPU ì‚¬ìš©ëŸ‰ì´ í­ì¦í•˜ëŠ” í˜„ìƒ ë°œìƒ**
- **ì„œë²„ì˜ HttpResponse ì²˜ë¦¬ ì‹œê°„ í­ì¦**
- **í´ë¼ì´ì–¸íŠ¸ TTFB í­ì¦**
- **ìœ„ì˜ ë¬¸ì œë“¤ë¡œ ì¸í•´ ì‚¬ìš©ì ì…ì¥~~(ìš°ë¦¬ íšŒì‚¬ ì§ì›ë“¤ê³¼ ë‚˜....ğŸ˜­)~~ì—ì„œ ì¦ì€ ë¹ˆë„ë¡œ ì•½ 2~4ì´ˆì˜ ë¡œë”© ë°œìƒ**

&nbsp;  

ì¦‰, ì„œë²„ëŠ” ìš”ì²­ì„ ì¦‰ì‹œ ë°›ì•„ ëª¨ë“  ì²˜ë¦¬ë¥¼ ê´‘ì†ìœ¼ë¡œ ëëƒˆìœ¼ë‚˜, 

ëª¨ì¢…ì˜ ì´ìœ ë¡œ í´ë¼ì´ì–¸íŠ¸ì— ì‘ë‹µì„ ë³´ë‚´ëŠ”ë° ë§ì€ ì‹œê°„ì´ ê±¸ë¦°ë‹¤ëŠ” ê²Œ ê²°ë¡ ì´ì—ˆë‹¤.

<u>ë¬¸ì œê°€ ìˆë‹¤ëŠ” ê±¸ ëª°ëìœ¼ë©´ ëª¨ë¥´ë˜, ì•Œê³ ë„ ë„˜ê¸¸ ìˆ˜ëŠ” ì—†ë‹¤.</u>

&nbsp;  

ì´ ë¬¸ì œë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ í•˜ë£¨ ë™ì•ˆ ëª¨ë“  ì½œìŠ¤íƒì„ ì‚´í´ë³´ë‹ˆ ì˜ì‹¬ë˜ëŠ” ì¡°ê±´ì´ ì„¸ ê°€ì§€ ìˆì—ˆë‹¤.

&nbsp;  

1. `RestControllerê°€` ì•„ë‹Œ `Controller`ì—ì„œ `DispatcherServlet`ì´ `ViewResolver`ì—` ModelAndView`ë¥¼ ë„˜ê¸°ê³  ë°›ëŠ” ê³¼ì •
2. `Spring Boot-JSP`ì˜ ì¡°í•©ìœ¼ë¡œ ì¸í•œ í˜¸í™˜ì„± ë¬¸ì œ
3. `org.apache.catalina.webresources.JarWarResourceSet.getArchiveEntries()`ê°€ ë§¤ìš° ìì£¼ ë³´ì„

&nbsp;  

ë°±ì˜¤í”¼ìŠ¤ëŠ” ë ˆê±°ì‹œë¼ `Spring-JSP`ë¥¼ ì‚¬ìš©í•˜ê³  ìˆì—ˆëŠ”ë°,

ìµœê·¼ Springì—ì„œ Spring-Bootìœ¼ë¡œ ë§ˆì´ê·¸ë ˆì´ì…˜í–ˆë‹¤.

ì˜¤í”¼ì…œì— ë”°ë¥´ë©´ Spring-Bootì€ ê¸°ë³¸ì ìœ¼ë¡œ ë‹¨ì¼ ì‹¤í–‰íŒŒì¼(bootJar)ë¡œ

ë¹Œë“œí•´ ë‚´ì¥ í†°ìº£ì„ ì‚¬ìš©í•˜ê¸° ë•Œë¬¸ì—

ì„œë¸”ë¦¿ì˜ ì¼ì¢…ì¸ JSPì™€ ê¶í•©ì´ ì¢‹ì§€ ì•Šì•„ JSPë¥¼ ê³µì‹ì ìœ¼ë¡œ ì§€ì›í•˜ì§€ ì•Šìœ¼ë©° 

ê°€ê¸‰ì  `Thymeleaf` ë‚˜ `Freemarker` ë“±ì˜ í…œí”Œë¦¿ ì—”ì§„ì„ ì‚¬ìš©í•´ 

bootJarë¡œ ë¹Œë“œí•œ í›„ ë‚´ì¥ í†°ìº£ìœ¼ë¡œ êµ¬ë™í•˜ë¼ê³  ê¶Œê³ í•˜ê³  ìˆë‹¤.

&nbsp;  

í•˜ì§€ë§Œ JSPë¥¼ ë‹¹ì¥ì— í…œí”Œë¦¿ ì—”ì§„ìœ¼ë¡œ ë°”ê¾¸ìë‹ˆ ê³µìˆ˜ê°€ ë„ˆë¬´ ë§ì´ ë“¤ì–´

ìš°ì„  Spring-Bootê³¼ JSPì¡°í•©ì„ ì‚¬ìš©í•˜ì˜€ê³ , ì´ë¥¼ Spring-Bootì´ ê³µì‹ì ìœ¼ë¡œ ì§€ì›í•˜ì§€ ì•Šì•„

bootJarë¡œ íŒ¨í‚¤ì§• í•˜ëŠ”ë° ì• ë¡œì‚¬í•­ì´ ìˆì–´ warë¡œ íŒ¨í‚¤ì§•í•˜ì—¬ ë‚´ì¥ í†°ìº£ì„ ì‚¬ìš©í•˜ê³  ìˆì—ˆë‹¤.

&nbsp;  

![](https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2Ft0DCh%2Fbtq5GZVWzqP%2F9Jp3amEp4FbvQEzJfOz4O0%2Fimg.png)

&nbsp;  

ê·¸ë¦¬ê³  `org.apache.catalina.webresources.JarWarResourceSet.getArchiveEntries()`ëŠ” ì°¾ì•„ë³´ë‹ˆ

war ë‚´ë¶€ì˜ jar íŒŒì¼ë“¤ì„ ìŠ¤ìº”í•˜ëŠ” ë‚´ì¥ í†°ìº£ì˜ ì¼ë¶€ ë¡œì§ì´ì—ˆë‹¤.

&nbsp;  

```java
@Override
protected Map<String,JarEntry> getArchiveEntries(boolean single) {
    synchronized (archiveLock) {
        if (archiveEntries == null) {
            JarFile warFile = null;
            InputStream jarFileIs = null;
            archiveEntries = new HashMap<>();
            boolean multiRelease = false;
            try {
                warFile = openJarFile();
                JarEntry jarFileInWar = warFile.getJarEntry(archivePath);
                jarFileIs = warFile.getInputStream(jarFileInWar);

                try (TomcatJarInputStream jarIs = new TomcatJarInputStream(jarFileIs)) {
                    JarEntry entry = jarIs.getNextJarEntry();
                    while (entry != null) {
                        archiveEntries.put(entry.getName(), entry);
                        entry = jarIs.getNextJarEntry();
                    }
                    Manifest m = jarIs.getManifest();
                    setManifest(m);
                    if (m != null && JreCompat.isJre9Available()) {
                        String value = m.getMainAttributes().getValue("Multi-Release");
                        if (value != null) {
                            multiRelease = Boolean.parseBoolean(value);
                        }
                    }
                        // Hack to work-around JarInputStream swallowing these
                        // entries. TomcatJarInputStream is used above which
                        // extends JarInputStream and the method that creates
                        // the entries over-ridden so we can a) tell if the
                        // entries are present and b) cache them so we can
                        // access them here.
                    entry = jarIs.getMetaInfEntry();
                    if (entry != null) {
                        archiveEntries.put(entry.getName(), entry);
                    }
                    entry = jarIs.getManifestEntry();
                    if (entry != null) {
                        archiveEntries.put(entry.getName(), entry);
                    }
                }
                if (multiRelease) {
                    processArchivesEntriesForMultiRelease();
                }
            } catch (IOException ioe) {
                // Should never happen
                archiveEntries = null;
                throw new IllegalStateException(ioe);
            } finally {
                if (warFile != null) {
                    closeJarFile();
                }
                if (jarFileIs != null) {
                    try {
                        jarFileIs.close();
                    } catch (IOException e) {
                        // Ignore
                    }
                }
            }
        }
        return archiveEntries;
    }
}
```

&nbsp;  

ìœ„ì˜ ëª¨ë“  ì¡°ê±´ì„ ì¢…í•©í•˜ê³  ìƒí™©ì„ ë³´ë‹ˆ ëŸ°íƒ€ì„ì— JSPì— ê´€ë ¨ëœ ì‘ì—…ì´ ì²˜ë¦¬ë˜ê¸° ì‹œì‘í•˜ë©´

ìœ„ì˜ ë¡œì§ì´ í˜¸ì¶œë˜ê³  <u>ë‚´ì¥ í†°ìº£ì€ war ë‚´ë¶€ì˜ jarë¥¼ í’€ìŠ¤ìº” ë•Œë¦¬ê¸° ì‹œì‘í•˜ë©° ë™ì‹œì— CPU ì‚¬ìš©ë¥ ì´ í­ì¦í•˜ëŠ” í˜„ìƒì´ ë°œìƒí•œë‹¤ëŠ” ê°€ì •ì´ ë‚˜ì™”ë‹¤.</u>

ê·¸ë¦¬ê³  ìœ„ì˜ ê°€ì •ì„ í‚¤ì›Œë“œë¡œ ë‹¤ì‹œ ê²€ìƒ‰ì„ ì‹œì‘í–ˆë‹¤.

&nbsp;  

[ğŸ“œ Performance - Spring Boot - Server Response Time](https://stackoverflow.com/questions/52648831/performance-spring-boot-server-response-time)

&nbsp;  

[ğŸ“œ Provide fat jar aware implementations of Tomcat's Resource and ResourceSet to speed up resource loading from executable wars](https://github.com/spring-projects/spring-boot/issues/16471)

&nbsp;  

ë˜í•œ `Spring-Boot repository issue`ë¥¼ ì‚´í´ë³´ë‹ˆ ë¹„ìŠ·í•œ ë¬¸ì œì œê¸°ê°€ ìˆì—ˆê³ , 

Spring-Bootì˜ ëŒ€ë¹µ(?) ê°œë°œìì¸ `Andy Wilkinson`ì— ë”°ë¥´ë©´ ì´ ë¬¸ì œëŠ” ë‘ ê°€ì§€ ì •ë„ì˜ í•´ê²°ë°©ë²•ì´ ìˆë‹¤ê³  í•˜ëŠ” ê²ƒ ê°™ì•˜ë‹¤.

ë˜í•œ íšŒí”¼ì±…ì´ ì¡´ì¬í•˜ë¯€ë¡œ ìš°ì„ ìˆœìœ„ê°€ ë†’ì§€ ì•Šë‹¤ê³  íŒë‹¨í•´ í•´ë‹¹ ë¬¸ì œëŠ” Spring-Boot 2.x.xëŒ€ì— í•´ê²°í•  ê³„íšì´ ì—†ë‹¤ê³  ë°í˜”ë‹¤.

&nbsp;  

1. **JSP+WARë¥¼ ì‚¬ìš©í•˜ì§€ ë§ê³  í…œí”Œë¦¿ ì—”ì§„+JARë¥¼ ì‚¬ìš©í•  ê²ƒ**
2. **JSP+WARë¥¼ ì‚¬ìš©í•˜ê² ë‹¤ë©´ ë‚´ì¥ í†°ìº£ì„ ì‚¬ìš©í•˜ì§€ ë§ê³  ì™¸ì¥ í†°ìº£ì„ ì‚¬ìš© í•  ê²ƒ**

&nbsp;  

ìš°ì„  ì´ ì •ë„ê¹Œì§€ íŒŒì•…ì„ ë§ˆì³¤ê³ , ë‹¹ì¥ì— í…œí”Œë¦¿ ì—”ì§„ìœ¼ë¡œ ë§ˆì´ê·¸ë ˆì´ì…˜ í•  ìˆ˜ëŠ” ì—†ëŠ” ìƒí™©ì´ë‹ˆ

ìš°ì„  ì™¸ì¥ í†°ìº£ì„ ì´ìš©í•´ ë³´ê¸°ë¡œ ê²°ì •í–ˆë‹¤.

ì¼ë‹¨ ë¬¸ì œëŠ” ë¬¸ì œê³  í‡´ê·¼ì‹œê°„ ëìœ¼ë©´ í‡´ê·¼ì€ í•´ì•¼ì§€... ~~(ì—¬ìœ ê°€ ì—†ëŠ” ê²ƒë„ ì•„ë‹ˆê³  ğŸ˜™)~~

&nbsp;  
