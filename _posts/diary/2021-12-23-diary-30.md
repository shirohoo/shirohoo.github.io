---
layout: post
category:
  - diary
title: ê²°ì œ ì„œë¹„ìŠ¤ ê°œë°œê¸°
description: |
  ê·¸ë™ì•ˆ ë°°ìš´ ì§€ì‹ì„ ì´ ë™ì›í–ˆë˜ í”„ë¡œì íŠ¸
image: /assets/img/debugging/debugging.jpg
accent_image:
  background: url('/assets/img/debugging/debugging.jpg') center/cover
related_posts:
  - null
published: true
---

* toc
{:toc}
  
<br />

ì´ í¬ìŠ¤íŒ…ì—ì„œ ë‚˜ì˜¨ ì½”ë“œì˜ ì´ë¦„ë“¤ì€ ì œê°€ ì‹¤ë¬´ì—ì„œ ì‚¬ìš©í•œ ì´ë¦„ê³¼ ë‹¤ë¦…ë‹ˆë‹¤.
{:.note}

<br />

# ğŸ™„ ë¬´ì—‡ì„ ê°œë°œí•´ì•¼ í–ˆëŠ”ê°€?

---

ì¡°ê¸ˆ ë” ìˆìœ¼ë©´ ê°œë°œìë¡œì„œ ë§Œ 1ë…„ì°¨ê°€ ë˜ëŠ”ë°, ìµœê·¼ì— ì§„í–‰í–ˆë˜ ì¬ë¯¸ìˆëŠ” í”„ë¡œì íŠ¸ì— ëŒ€í•´ ê¸°ë¡í•˜ë ¤ê³  í•œë‹¤.

ì•„ì£¼ ê°„ë‹¨í•˜ê²Œ í‘œí˜„í•˜ìë©´ ìš°ë¦¬ íšŒì‚¬ ì•±ì—ì„œ ë‚´ê°€ ë§Œë“¤ì–´ì•¼ í•  ì„œë¹„ìŠ¤ì— ê²°ì œ ìš”ì²­ì„ ë³´ë‚´ë©´ ì´ë¥¼ ì²˜ë¦¬í•˜ê³  ì ì ˆí•œ ì‘ë‹µì„ ë°˜í™˜í•´ì•¼ í–ˆë‹¤.

ì¡°ê¸ˆ ë¨¸ë¦¬ê°€ ì•„íŒ ë˜ ë¶€ë¶„ì€ ìˆ˜ ë§ì€ ê²°ì œ ë²¤ë”ì‚¬ë¥¼ ì—°ë™í•´ì•¼í•˜ëŠ” ë¶€ë¶„ì´ì—ˆë‹¤.

ê²°ì œ íŠ¸ëœì­ì…˜ì€ ë‹¤ìŒê³¼ ê°™ì•˜ë‹¤.

<br />

1. ê³ ê°ì´ ì™¸ë¶€ ë²¤ë”ì‚¬ì— ê°€ì…ë˜ì–´ìˆëŠ”ì§€ ì•Œì•„ì•¼í•œë‹¤
2. ì—°ë™ëœ ëª¨ë“  ë²¤ë”ì‚¬ë¥¼ ìˆœíšŒí•˜ë©° ê°€ì…ëœ ë²¤ë”ì‚¬ê°€ ìˆëŠ”ì§€ ì¡°íšŒí•œë‹¤
3. ê°€ì…ëœ ë²¤ë”ì‚¬ê°€ ì—†ë‹¤ë©´ íˆìŠ¤í† ë¦¬ë¥¼ ë‚¨ê¸°ê³  ê²°ì œ íŠ¸ëœì­ì…˜ì„ ì¢…ë£Œí•œë‹¤
4. ê°€ì…ëœ ë²¤ë”ì‚¬ê°€ ìˆë‹¤ë©´ ê²°ì œ ìš”ì²­ì„ ë³´ë‚¸ë‹¤
5. ê²°ì œ ìš”ì²­ì— ëŒ€í•œ ê²°ê³¼ë¥¼ íˆìŠ¤í† ë¦¬ë¡œ ë‚¨ê¸°ê³  ê²°ì œ íŠ¸ëœì­ì…˜ì„ ì¢…ë£Œí•œë‹¤

<br />

# âœ¨ ê°œë°œ í¬ì¸íŠ¸ ?

---

ë‚´ê°€ ìƒê°í•˜ê¸°ì— ì£¼ìš” í¬ì¸íŠ¸ëŠ” ë‹¤ìŒê³¼ ê°™ì•˜ë‹¤.

<br />

- ê²°ì œ íŠ¸ëœì­ì…˜ì´ ì¢…ë£Œë˜ëŠ” ì‹œë‚˜ë¦¬ì˜¤ëŠ” ì´ 3ê°œë‹¤
  - `ì¡°íšŒ ì‹¤íŒ¨`, `ê²°ì œ ì‹¤íŒ¨`, `ê²°ì œ ì„±ê³µ`

- <u>ë©€ì§€ ì•Šì€ ë¯¸ë˜ì— ì™¸ë¶€ ë²¤ë”ì‚¬ê°€ ìˆ˜ì‹­~ìˆ˜ë°±ê°œê°€ ë ìˆ˜ë„ ìˆë‹¤</u>
  - ë‹¤í˜•ì„±ì„ ìµœëŒ€í•œ í™œìš©í•˜ë©´ ì¢‹ì€ êµ¬ì¡°ë¥¼ ë§Œë“¤ ìˆ˜ ìˆë‹¤

- <u>ê° ë²¤ë”ì‚¬ë³„ë¡œ ìš”ì²­ & ì‘ë‹µ íŒŒë¼ë¯¸í„°ê°€ ì²œì°¨ë§Œë³„ì´ë‹¤</u>

- ê° ë²¤ë”ì‚¬ë³„ë¡œ í”„ë¡œì„¸ìŠ¤ê°€ ëª¨ë‘ ë‹¤ë¥´ë‹¤
  - <u>ëŸ¬í”„í•˜ê²Œ ë´¤ì„ ë•Œ ì¡°íšŒ, ê²°ì œëŠ” ëª¨ë‘ ë™ì¼í•˜ë‚˜ ì„¸ì„¸í•œ í”„ë¡œì„¸ìŠ¤ê°€ ë‹¤ë¥´ë‹¤</u>
  - ì˜ˆë¥¼ ë“¤ë©´ ì–´ë–¤ ë²¤ë”ì‚¬ëŠ” ì¡°íšŒ ìš”ì²­ì„ ë³´ë‚´ê¸° ì „ ì¸ì¦ í† í°ì„ ë¨¼ì € ë°œê¸‰ë°›ì•„ì•¼ ëœë‹¤ë˜ê°€ ğŸ™„

- ê° ë²¤ë”ì‚¬ì— ìš”ì²­ì„ ë³´ë‚¼ë•Œ ìš”ê¸ˆì´ ë°œìƒí•˜ë©° ì´ëŠ” ê° ë²¤ë”ì‚¬ë§ˆë‹¤ ë‹¤ë¥´ë‹¤
  - <u>ë”°ë¼ì„œ ìˆ˜ìˆ˜ë£Œê°€ ì‹¼ ìˆœì„œëŒ€ë¡œ ì¡°íšŒë¥¼ í•´ì•¼í•œë‹¤</u>

- ê°€ì¥ ìµœê·¼ì— ê²°ì œì— ì„±ê³µí•œ ì´ë ¥ì´ ìˆë‹¤ë©´ ì–´ë–¤ ë²¤ë”ì‚¬ì— ê°€ì…ë˜ì—ˆëŠ”ì§€ ì¼ì¼ì´ ì¡°íšŒí•´ë³´ì§€ ì•Šì•„ë„ ë  ìˆ˜ë„ ìˆë‹¤
  - ì¡°íšŒë¥¼ ìŠ¤í‚µí•˜ê³  ê°€ì¥ ë§ˆì§€ë§‰ì— ê²°ì œì— ì„±ê³µí–ˆë˜ ë²¤ë”ì‚¬ë¡œ ê²°ì œ ìš”ì²­ì„ ë°”ë¡œ ë³´ë‚´ì„œ ì„±ê³µí•˜ë©´ ê²°ê³¼ì ìœ¼ë¡œ ì¡°íšŒë¥¼ ìœ„í•œ ìˆœíšŒ ìŠ¤í‚µí• ìˆ˜ ìˆë‹¤
  - <u>ì´ëŠ” ë¹„ìš© ì ˆê°ìœ¼ë¡œ ì´ì–´ì§„ë‹¤ !</u>

- `JPA`ë¥¼ ì‚¬ìš©í•˜ë˜, <u>ë„¤ì´í‹°ë¸Œ ì¿¼ë¦¬ë¥¼ ì™„ë²½í•˜ê²Œ ë°°ì œí•˜ë©´ DB ë²¤ë”ì— ì¢…ì†ë˜ì§€ ì•Šì„ ìˆ˜ ìˆë‹¤</u>

- <u>ì˜ì†ì„±(Persistence) ì¸í„°í˜ì´ìŠ¤ë¥¼ ì •ì˜í•˜ê³  ì´ë¥¼ êµ¬í˜„í•œ ì½˜í¬ë¦¬íŠ¸ í´ë˜ìŠ¤ê°€ JpaRepositoryë¥¼ ì˜ì¡´í•œë‹¤ë©´ íŠ¹ì • ì™¸ë¶€ ì €ì¥ì†Œì— ì¢…ì†ë˜ì§€ ì•Šì„ ìˆ˜ ìˆë‹¤</u>
  - ì¦‰, ë¯¸ë˜ì— `íŒŒì¼`ë¡œ ì €ì¥í•˜ë“ , `RDBMS`ì— ì €ì¥í•˜ë“ , `NoSQL`ì— ì €ì¥í•˜ë“ , `ë¯¸ë˜ì— ìƒê¸¸ ì•Œì§€ëª»í•  ì™¸ë¶€ ì €ì¥ì†Œ`ì— ì €ì¥í•˜ë“  ì–¼ë§ˆë“ ì§€ ì‰½ê²Œì‰½ê²Œ ë°”ê¿€ ìˆ˜ ìˆê²Œ ëœë‹¤
  - ì´ëŠ” `Mybatis`ì—ì„œ `JPA`ë¡œ ë§ˆì´ê·¸ë ˆì´ì…˜í•˜ë©° ëŠê¼ˆë˜ ì§€ì˜¥ê°™ì€ ê³ í†µì—ì„œ í•´ë°©ë¨ì„ ì˜ë¯¸í•œë‹¤ !

<br />

## ğŸ“œ ì‹œë‚˜ë¦¬ì˜¤

---

ê²°ì œ íŠ¸ëœì­ì…˜ì´ ì¢…ë£Œë˜ëŠ” ì‹œë‚˜ë¦¬ì˜¤ëŠ” ì´ 3ê°€ì§€ê³ , ì´ê²Œ ê°€ì¥ ì¤‘ìš”í–ˆë‹¤.

<br />

### âŒ ì¡°íšŒ ì‹¤íŒ¨

---

<br />

![image](https://user-images.githubusercontent.com/78329064/147228130-3edffce0-7cb3-46fd-9727-fc4401d025b5.png)

<br />

### âŒ ê²°ì œ ì‹¤íŒ¨

---

<br />

![image](https://user-images.githubusercontent.com/78329064/147228149-1489b87c-fd38-4a2c-8869-1db924be314d.png)

<br />

### âœ… ê²°ì œ ì„±ê³µ

---

<br />

![image](https://user-images.githubusercontent.com/78329064/147228159-0e3d44ac-0584-428c-8ea2-c3753cf8981f.png)

<br />

# ğŸ¤” ì–´ë–»ê²Œ ê°œë°œí• ê¹Œ?

---

ì£¼ìš” í¬ì¸íŠ¸ë¥¼ ì­‰ ë½‘ì•„ë³´ë‹ˆ ì–´ë–¤ êµ¬ì¡°ë¡œ ë§Œë“¤ì–´ì•¼ í•  ì§€ ëŒ€ëµ ê°ì´ ì¡í˜”ë‹¤.

ì´ëŠ” í›„ìˆ í•˜ë„ë¡ í•˜ê³ ,

<br />

<u>ìš°ì„  ìµœì´ˆ ê²°ì œ ìš”ì²­ì´ ë“¤ì–´ì™”ì„ ë•Œ ìœ íš¨í•œ ê±°ë˜ ê°ì²´ë¥¼ ë§Œë“¤ì–´ë‚´ì•¼ë§Œ í•œë‹¤.</u>

ì´í›„ ì´ ê±°ë˜ ê°ì²´ì˜ ìƒíƒœë¥¼ ë³€ê²½í•´ê°€ë©° í”„ë¡œì„¸ìŠ¤ë¥¼ ì§„í–‰í•œë‹¤.

ì´ë•Œ, ê±°ë˜ ê°ì²´ì˜ ìƒíƒœê°€ ë³€ê²½ë˜ëŠ” ì‹œì ë§ˆë‹¤ `ê¹Šì€ ë³µì‚¬`ë¥¼ í†µí•´ ìƒˆë¡œìš´ ê°ì²´ë¥¼ ë°˜í™˜í•˜ë„ë¡ êµ¬ì„±í•´ ê±°ë˜ ê°ì²´ê°€ `ë¶ˆë³€`í•˜ë„ë¡ ë§Œë“¤ì—ˆë‹¤.

ê·¸ë¦¬ê³  ì´ ê°ì²´ëŠ” `ì£¼ì†Œ ì°¸ì¡°`ë¥¼ í†µí•´ ê° ë©”ì„œë“œë“¤ì´ ê³µìœ í•  ìˆ˜ ìˆë„ë¡ í•˜ì˜€ë‹¤.

ì´ ê±°ë˜ ê°ì²´ì˜ ì´ë¦„ì€ `Transaction`ì´ë¼ê³  ê°€ì •í•˜ì.

ì´ ê°ì²´ì˜ ì±…ì„ì€ <u>ê±°ë˜ ìƒíƒœì™€ ì¤‘ìš” ë°ì´í„°ë“¤ì„ ê´€ë¦¬í•˜ê³  ê¸°ë¡í•˜ëŠ” ê²ƒ</u>ì¸ë°, ë°ì´í„°ì˜ ê°œìˆ˜ê°€ ë„ˆë¬´ ë§ì•˜ë‹¤.

ì´ë¥¼ ë‹¤ `Transaction`ì— ëª°ì•„ë„£ì–´ ë§Œë“¤ê³  ë³´ë‹ˆ ê²°ê³¼ì ìœ¼ë¡œ í´ë˜ìŠ¤ ë©¤ë²„ì˜ ìˆ˜ê°€ ë„ˆë¬´ ë§ì•„ ë³µì¡ë„ê°€ í¬ê²Œ ì˜¬ë¼ê°€ê³ , ë– ëŒì´ ë°ì´í„°ê°€ ë§ì•„ì§€ëŠ” ê²°ê³¼ê°€ ë‚˜ì™”ë‹¤.

<br />

í•œì°¸ì„ ê³ ë¯¼í•˜ë‹¤ ë„ë©”ì¸ ê°ì²´ì™€ ìë£Œêµ¬ì¡°ì˜ ê²½ê³„ë¥¼ ëª…í™•í•˜ê²Œ êµ¬ë¶„í•˜ê¸°ë¡œ ê²°ì •í–ˆë‹¤.

ì´ëŠ” `ìŠ¤í”„ë§ ë°°ì¹˜ì˜ ë„ë©”ì¸`ì—ì„œ ì˜ê°ì„ ì–»ì–´ ì°¨ìš©í–ˆë‹¤.

ë„ë©”ì¸ ê°ì²´ëŠ” `Transaction`ì´ë©°, ì´ ê°ì²´ëŠ” `TransactionContributes`ë¼ëŠ” ê°ì²´ë¥¼ ì˜ì¡´í•˜ë„ë¡ ë§Œë“¤ì—ˆë‹¤.

ê·¸ë¦¬ê³  ì¡´ì¬í•˜ëŠ” ëª¨ë“  ë°ì´í„°ëŠ” `TransactionContributes`ê°€ ê´€ë¦¬í•˜ë„ë¡ í•˜ì˜€ë‹¤.

ê²°ê³¼ì ìœ¼ë¡œ `Transaction`ì€ ìì‹ ì˜ ìƒíƒœì™€ ë°ì´í„°ë² ì´ìŠ¤ì— ê¸°ë¡ë˜ì–´ì•¼ë§Œ í•˜ëŠ” ì •ë§ ì¤‘ìš”í•œ ë°ì´í„°ë“¤ë§Œì„ ì§‘ì¤‘ì ìœ¼ë¡œ ê´€ë¦¬í•˜ë©´ ë˜ê²Œ ë˜ì—ˆë‹¤.

ê·¸ë¦¬ê³  ì´ ì¤‘ìš”í•œ ë°ì´í„°ë“¤ì€ ëª¨ë‘ ê°ì²´ë¡œ í¬ì¥í•˜ê³  ê°ì¢… ìœ íš¨ì„± ê²€ì‚¬ì™€ ì—…ë¬´ ê·œì¹™ì„ ì²˜ë¦¬í•˜ë„ë¡ í•´ì£¼ì—ˆë‹¤.

<br />

ë§ˆì§€ë§‰ìœ¼ë¡œ ê²°ì œ íŠ¸ëœì­ì…˜ì´ ì¢…ë£Œë˜ëŠ” 3ê°€ì§€ ì‹œë‚˜ë¦¬ì˜¤ì— ëŒ€í•´ `Transaction`ê³¼ `TransactionContributes`ì˜ ëª¨ë“  ë°ì´í„°ë¥¼ `TransactionEntity`ë¡œ ì»¨ë²„íŒ…í•˜ì—¬ ë°ì´í„°ë² ì´ìŠ¤ì— íˆìŠ¤í† ë¦¬ë¥¼ ë‚¨ê¸´ í›„ íŠ¸ëœì­ì…˜ì„ ì¢…ë£Œí•˜ë„ë¡ ìµœì¢… êµ¬ì„±í–ˆë‹¤.

<br />

## ğŸ‘ ë‹¤í˜•ì„±ì„ ì´ìš©í•˜ì

---

ìš°ì„  ê° ë²¤ë”ì‚¬ì—ì„œ ì‘ë‹µí•˜ëŠ” ë°ì´í„°ê°€ ì²œì°¨ë§Œë³„ì´ë¼, ì´ ëª¨ë“  ê²½ìš°ì˜ ìˆ˜ë¥¼ ë”°ì ¸ ë‚´ê°€ í•„ìš”í•œ ë°ì´í„°ë“¤ì„ ê³¨ë¼ë‚´ì•¼ë§Œ í–ˆë‹¤.

ì´ ë•Œ, ë²¤ë”ì‚¬ì—ì„œ ìš”êµ¬í•˜ëŠ” ë°ì´í„°ë„ ì²œì°¨ë§Œë³„ì´ì—ˆì§€ë§Œ, ì´ëŠ” ê²°êµ­ ì¶”ìƒí™”í•  ìˆ˜ ì—†ì–´ `Trasnaction` ì˜ ë„ì›€ì„ ë°›ì•„ ë§¤ë²ˆ ì ì ˆí•œ ìš”ì²­ ê°ì²´ë¥¼ ë§Œë“¤ì–´ì•¼ë§Œ í–ˆê³ , ì´ ì‘ì—…ì€ ì •ë§ ì§€ë£¨í–ˆì§€ë§Œ ë”±íˆ ì¢‹ì€ ë°©ë²•ì´ ìƒê°ë‚˜ì§ˆ ì•Šì•˜ë‹¤.

ë‹¤í–‰ìŠ¤ëŸ½ê²Œë„ ì‘ë‹µ ê°ì²´ë§Œí¼ì€ ì¶”ìƒí™”ë¥¼ í•  ìˆ˜ ìˆì–´ì„œ ì´ë¥¼ `SearchResponse`ë¼ëŠ” ì¸í„°í˜ì´ìŠ¤ë¡œ ì •ì˜í•˜ê³  í•„ìš”í•œ ë°ì´í„°ë“¤ì„ ë°˜í™˜í•˜ë„ë¡ ì¶”ìƒë©”ì„œë“œë¥¼ ì„ ì–¸í–ˆë‹¤.

<br />

```java
// file: 'src/main/java/payment/application/domain/command/response/SearchResponse.java'
public interface SearchResponse {
    
    boolean isFound();

    String getA();
    
    String getB();

    BigDecimal getC();
    
    LocalDateTime getD();
    
    // ...

}
```

<br />

ê²°ì œ ìš”ì²­ì— ëŒ€í•œ ì‘ë‹µì¸ `PaymentResponse`ë¼ëŠ” ì¸í„°í˜ì´ìŠ¤ë„ ì •ì˜í•´ì£¼ì—ˆë‹¤.

<br />

```java
// file: 'src/main/java/payment/application/domain/command/response/PaymentResponse.java'
public interface PaymentResponse {
    
    boolean isSuccess();

    String getA();
    
    String getB();

    BigDecimal getC();
    
    LocalDateTime getD();
    
    // ...

}
```

<br />

## ğŸ”— ì»¤ë§¨ë“œ íŒ¨í„´

---

ê° ë²¤ë”ì‚¬ë³„ë¡œ ë¯¸ë¬˜í•˜ê²Œ í”„ë¡œì„¸ìŠ¤ê°€ ë‹¤ë¥´ì§€ë§Œ, ëŸ¬í”„í•˜ê²Œ ë³´ë©´ `ì¡°íšŒ`ì™€ `ê²°ì œ`ë¼ëŠ” í”„ë¡œì„¸ìŠ¤ëŠ” ëª¨ë‘ ë™ì¼í–ˆë‹¤.

ì˜ˆë¥¼ ë“¤ë©´ ì´ë ‡ë‹¤.

<br />

- Aì‚¬ëŠ” ì¡°íšŒë¥¼ ë°”ë¡œí•˜ë©´ ëœë‹¤
- Bì‚¬ëŠ” ì¸ì¦í† í°ì„ ë°œê¸‰ë°›ì€ í›„ ì¡°íšŒë¥¼ í•´ì•¼ í•œë‹¤

<br />

ì´ ë¶€ë¶„ì€ `ì»¤ë§¨ë“œ íŒ¨í„´`ì„ ì´ìš©í•˜ë©´ ë”± ì¢‹ì„ ê²ƒ ê°™ì•˜ë‹¤.

ìš°ì„  ê°„ëµí•˜ê²Œ `SearchCommand`ë¼ëŠ” ì¸í„°í˜ì´ìŠ¤ë¥¼ í•˜ë‚˜ ì •ì˜í–ˆë‹¤ê³  ê°€ì •í•˜ì.

<br />

```java
// file: 'src/main/java/payment/application/domain/command/SearchCommand.java'
public interface SearchCommand {

    SearchResponse execute(Transaction transaction);

}
```

<br />

`ì¡°íšŒ`ì— ëŒ€í•œ ë‘ê°€ì§€ ì»¤ë§¨ë“œ ê°ì²´ë¥¼ ìƒì„±í•œë‹¤.

<br />

```java
// file: 'src/main/java/payment/application/domain/command/ASearchCommand.java'
@RequiredArgsConstructor
public class ASearchCommand {
    
    private final AClient client;
    
    // ë³„ë„ì˜ ì²˜ë¦¬ ì—†ì´ ë°”ë¡œ ì¡°íšŒ
    @Override
    public SearchResponse execute(Transaction transaction){
        ASearchRequest searchRequest = createSearchRequest(transaction);
        return client.search(searchRequest);
    }
    
    private ASearchRequest createSearchRequest(Transaction transaction){
        // do something...
        return request;
    }

}
```

<br />

```java
// file: 'src/main/java/payment/application/domain/command/BSearchCommand.java'
@RequiredArgsConstructor
public class BSearchCommand {
    
    private final BClient client;
    
    // ë¨¼ì € ì¸ì¦ í† í°ì„ ë°œê¸‰ë°›ì€ í›„ ì¡°íšŒ
    @Override
    public SearchResponse execute(Transaction transaction){
        BTokenRequest tokenRequest = createTokenRequest();
        String token = client.getToken(tokenRequest);
        
        BSearchRequest searchRequest = createSearchRequest(transaction);
        return client.search(token, searchRequest);
    }
    
    private BTokenRequest createTokenRequest(){
        // do something...
        return request;
    }

    private BSearchRequest createSearchRequest(Transaction transaction){
      // do something...
      return request;
    }

}
```

<br />

ê²°ì œ ìš”ì²­ë„ ìœ„ì™€ ë¹„ìŠ·í•œ ë°©ì‹ìœ¼ë¡œ êµ¬ì„±í•˜ì˜€ë‹¤. 

ì´ë ‡ê²Œ í•˜ë‹ˆ ëª¨ë“  ë²¤ë”ì‚¬ë“¤ì„ ë‚˜ë¦„ ê¹”ë”í•˜ê²Œ ì»¤ë²„í•  ìˆ˜ ìˆëŠ” êµ¬ì¡°ê°€ ë§Œë“¤ì–´ì¡Œë‹¤.

<br />

## ğŸ— ë„ìš°ë¯¸ í´ë˜ìŠ¤

---

ì£¼ìš” ì²˜ë¦¬ë¥¼ ìœ ì¦ˆì¼€ì´ìŠ¤ í´ë˜ìŠ¤ì—ì„œ ì²˜ë¦¬í•˜ë©´ ì½”ë“œê°€ ë„ˆë¬´ ì¥í™©í•´ì§€ê³ , ì˜ì¡´ëŒ€ìƒì´ ë„ˆë¬´ ëŠ˜ì–´ë‚˜ê¸° ë•Œë¬¸ì— ìš°ì„  ì´ë¥¼ ë¶„ë¦¬í–ˆë‹¤.

ìš°ì„  ì¡°íšŒì— ì„±ê³µí•˜ë©´ í•´ë‹¹ ë²¤ë”ì‚¬ë¥¼ í†µí•´ ê²°ì œ ì»¤ë§¨ë“œë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ìˆê²Œë” `ë™ì‹œì„± ì¼ê¸‰ ì»¬ë ‰ì…˜`ì„ ë§Œë“¤ì—ˆë‹¤.

<br />

```java
// file: 'src/main/java/payment/application/usecase/PaymentCommandConcurrentMap.java'
@Component
public class PaymentCommandConcurrentMap {

    private static final Map<Vendor, PaymentCommand> commandMap = new ConcurrentHashMap<>();
  
    @Autowired
    public PaymentCommandConcurrentMap(
            APaymentCommand aCommand, 
            BPaymentCommand bCommand
    ) {
        commandMap.put(Vendor.A, aCommand);
        commandMap.put(Vendor.B, bCommand);
    }
  
    public PaymentCommand findByVendor(Vendor vendor) {
        if (commandMap.containsKey(vendor)) {
          return commandMap.get(vendor);
        }
        throw new IllegalArgumentException("Could not find command for " + vendor);
    }

}
```

<br />

ë˜í•œ, ì—¬ê¸°ì„œ ê° ë²¤ë”ì‚¬ì˜ API ìš”ê¸ˆì— ë”°ë¼ APIê°€ í˜¸ì¶œë˜ëŠ” ìˆœì„œë¥¼ ê²°ì •í•  ìˆ˜ ìˆê²Œí•´ì¤¬ë‹¤.

<br />

```java
// file: 'src/main/java/payment/application/usecase/VendorAdapterComposite.java'
@Component
public class VendorAdapterComposite {

    private final List<SearchCommand> searchCommandList;
    private final PaymentCommandConcurrentMap paymentConcurrentMap;

    @Autowired
    public VendorAdapterComposite(
            PaymentCommandConcurrentMap paymentConcurrentMap,
            ASearchCommand aCommand, 
            BSearchCommand bCommand
    ) {
        this.paymentConcurrentMap = paymentConcurrentMap;
        
        // API í˜¸ì¶œ ìš”ê¸ˆì´ ì €ë ´í•œ ìˆœì„œëŒ€ë¡œ ë¦¬ìŠ¤íŠ¸ì— ì‚½ì…í•œë‹¤
        this.searchCommandList = new ArrayList<>();
        searchCommandList.add(aCommand);
        searchCommandList.add(bCommand);
    }

    public SearchResponse search(Transaction transaction) throws NotFoundVendorException {
        for (SearchCommand command : searchCommandList){
            SearchResponse response = command.execute(transaction);
            if(response.isFound()){
                return response;
            }
        }
        throw new NotFoundVendorException();
    }

    public PaymentResponse payment(Transaction transaction) {
        TransactionContributes contributes = transaction.getContribute();
        Vendor vendor = contributes.getVendor();
        return paymentConcurrentMap.findByVendor(vendor)
                .execute(transaction);
    }

}
```

<br />

## ğŸ” ìœ ì¦ˆì¼€ì´ìŠ¤

---

ëª¨ë“  ë²¤ë”ì‚¬ì— ëŒ€í•œ ì²˜ë¦¬ë¥¼ í…ŒìŠ¤íŠ¸ì½”ë“œì™€ í•¨ê»˜ êµ¬í˜„í•˜ê³  ë³´ë‹ˆ ì´í›„ ì‘ì—…ì€ ìƒê°ë³´ë‹¤ ì‰¬ì› ë‹¤.

`ì¡°íšŒ` -> `ê²°ì œ`ìˆœìœ¼ë¡œ ì²˜ë¦¬í•˜ë˜ íŠ¸ëœì­ì…˜ì´ ì¢…ë£Œë˜ì–´ì•¼ë§Œ í•˜ëŠ” 3ê°€ì§€ ì¼€ì´ìŠ¤ì— ì§‘ì¤‘í•˜ê³ , ëª‡ê°€ì§€ ì˜ˆì™¸ì²˜ë¦¬ë¥¼ í•´ì£¼ë©´ ë˜ì—ˆë‹¤.

<br />

```java
// file: 'src/main/java/payment/application/usecase/PaymentUseCaseImpl.java'
@Slf4j
@UseCase
@RequiredArgsConstructor
public class PaymentUseCaseImpl implements PaymentUseCase {
    
    private final VendorAdapterComposite adapter;
    private final TransactionRepository transactionRepository;

    @Override
    public Transaction paymentUseCase(Transaction transaction) {
        info(log, "Create new transaction!", transaction.getContribute());
        transaction = search(transactionRepository.save(transaction));
        
        if(transaction.isNotFound()){
            return transaction;
        }
        
        return payment(transaction);
    }

    private Transaction search(Transaction transaction) {
        try {
            SearchResponse response = adapter.search(transaction);
            return transaction.setFoundVendor(response);
        } catch (NotFoundVendorException e) {
            transaction = transaction.setNotFoundVendor();
            TransactionContributes contribute = transaction.getContribute();
            error(log, contribute.getStatusMessage(), contribute);
            return transactionRepository.update(transaction);
        }
    }

    private Transaction payment(Transaction transaction) {
        PaymentResponse response = adapterComposite.payment(transaction);
        
        if (response.isSuccess()) {
            transaction = transaction.setPaymentSuccess(response);
            TransactionContributes contribute = transaction.getContribute();
            info(log, contribute.getStatusMessage(), contribute);
            return transactionRepository.update(transaction);
        }

        transaction = transaction.setPaymentFail();
        TransactionContributes contribute = transaction.getContribute();
        error(log, contribute.getStatusMessage(), contribute);
        return transactionRepository.update(transaction);
    }

}
```

<br />

# ğŸš€ ì›¹ ì–´ëŒ‘í„°

---

ë§ˆì§€ë§‰ìœ¼ë¡œ ì›¹ ì–´ëŒ‘í„°ë¥¼ ì‘ì„±í–ˆë‹¤.

ì´ ê°ì²´ëŠ” ì™¸ë¶€ì˜ ìš”ì²­ì„ ë°›ì•„ ë„ë©”ì¸ ê°ì²´ë¥¼ ë§Œë“¤ì–´ë‚¸ í›„ ìœ ì¦ˆì¼€ì´ìŠ¤ í´ë˜ìŠ¤ì— ì²˜ë¦¬ë¥¼ ìœ„ì„í•œë‹¤.

ê·¸ë¦¬ê³  ìœ ì¦ˆì¼€ì´ìŠ¤ í´ë˜ìŠ¤ê°€ ë°˜í™˜í•œ ë„ë©”ì¸ ê°ì²´ë¥¼ ë°›ì•„ ì™¸ë¶€ì— ì ì ˆí•œ ì‘ë‹µì„ í•´ì¤€ë‹¤.

<br />

```java
// file: 'src/main/java/payment/adapter/http/PaymentApiController.java'
@RestController
@RequiredArgsConstructor
public class PaymentApiController {
    
    private final PaymentUseCase useCase;
    
    @PostMapping
    public ResponseEntity<Data<?>> payment(@RequestBody PaymentRequest request){
        transaction = useCase.paymentUseCase(TransactionFactory.convert(request));
        
        if(transaction.isNotFound()){
            return ResponseEntity.status(HttpStatus.NOT_FOUND)
                .body(Data.of(HttpStatus.NOT_FOUND, transaction.exposure()));
        }

        if(transaction.isPaymentFail()){
          return ResponseEntity.status(HttpStatus.INTERNAL_SERVER_ERROR)
                  .body(Data.of(HttpStatus.INTERNAL_SERVER_ERROR, transaction.exposure()));
        }
  
        return ResponseEntity.status(HttpStatus.OK)
                .body(Data.of(HttpStatus.OK, transaction.exposure()));
    }  
    
    @Value
    @JsonInclude(Include.NON_NULL)
    private static class Data<T> {
        int code;
        String message;
        T data;

        private static <T> Data<T> of(HttpStatus httpStatus, T data) {
          return Data.of(httpStatus.value(), httpStatus.getReasonPhrase(), data);
        }
  
        private static <T> Data<T> of(int code, String message, T data) {
          return new Data<>(code, message, data);
        }
    }
  
}
```

<br />

# ğŸ˜Š í›„ê¸°

---

ì´ë²ˆ ì‹ ê·œ ê°œë°œê±´ì€ ê·¸ë™ì•ˆ ê³µë¶€í•œ ê°ì²´ì§€í–¥ê³¼ ë””ìì¸ íŒ¨í„´ì— ëŒ€í•´ ì‹¬ë„ê¹Šê²Œ ê³ ë¯¼í•´ë³´ê³  ì‹¤ë¬´ì— ì ìš©í•´ë³¼ ìˆ˜ ìˆëŠ” ì•„ì£¼ ì¢‹ì€ ê¸°íšŒì˜€ë‹¤ê³  ìƒê°í•œë‹¤.

ìµœê·¼ [ğŸ“• í´ë¦° ì•„í‚¤í…ì²˜](http://www.kyobobook.co.kr/product/detailViewKor.laf?mallGb=KOR&ejkGb=KOR&barcode=9788966262472){:target="_blank"} ì™€ [ğŸ“• ë§Œë“¤ë©´ì„œ ë°°ìš°ëŠ” í´ë¦° ì•„í‚¤í…ì²˜](http://www.yes24.com/Product/Goods/105138479){:target="_blank"} ë‘ ì±…ì„ ê°ëª…ê¹Šê²Œ ì½ì—ˆëŠ”ë°, ì´ ì±…ë“¤ì—ì„œ ë³¸ ë‚´ìš©ë“¤ì„ ì‹¤ë¬´ì— ì ìš©í•´ë³´ê³  ë§ì€ ë¶€ë¶„ì„ ê¹¨ë‹«ê³  ì²´í™”ì‹œí‚¬ ìˆ˜ ìˆì—ˆì–´ì„œ ì •ë§ ì¢‹ì•˜ë‹¤.

í™•ì‹¤íˆ ì£¼ë¨¹êµ¬êµ¬ì‹ìœ¼ë¡œ, ì ˆì°¨ì§€í–¥ì ìœ¼ë¡œ ì½”ë“œë¥¼ ì‘ì„±í•˜ë˜ ëª‡ë‹¬ì „ê³¼ ë‹¬ë¦¬ ìƒëŒ€ì ìœ¼ë¡œ êµ¬ì¡°ê°€ ê¹”ë”í•˜ê²Œ ì¡íˆëŠ” ê²ƒì´ ë§¤ìš° í¡ì¡±í–ˆë‹¤.

ìµœëŒ€í•œ ì¸í„°í˜ì´ìŠ¤ì— ëŒ€ê³  ì½”ë”©í•˜ë„ë¡ í•˜ê³ , ê° í´ë˜ìŠ¤ë³„ë¡œ ì˜ì¡´ì„±ì„ ìµœëŒ€í•œ ì ê²Œ ê°€ì ¸ê°€ë ¤ê³  ë…¸ë ¥í•˜ì˜€ëŠ”ë°, ì´ë ‡ê²Œ í•˜ê³  ë³´ë‹ˆ í…ŒìŠ¤íŠ¸ ì½”ë“œë¥¼ ì‘ì„±í•˜ëŠ”ê²ƒì´ ë§¤ìš° ìˆ˜ì›”í•´ì§ì„ ëŠë‚„ ìˆ˜ ìˆì—ˆë‹¤.

í…ŒìŠ¤íŠ¸ì½”ë“œë¥¼ ì‘ì„±í•˜ëŠ”ê²Œ ìˆ˜ì›”í•´ì§€ë‹ˆ ê³¼ê°í•œ ë¦¬íŒ©í† ë§ë„ ê³„ì† ì‹œë„í•´ë³¼ ìˆ˜ ìˆì—ˆê³ , ê°ˆìˆ˜ë¡ ì½”ë“œì—ì„œ ë‚˜ìœ ëƒ„ìƒˆë“¤ì´ ì—†ì–´ì§€ëŠ” ê¸ì •ì ì¸ ì—°ì‡„íš¨ê³¼ê°€ ì¼ì–´ë‚¬ë‹¤.

ì‹¤ì œ ì½”ë“œëŠ” í›¨ì”¬ ë” ë³µì¡í•˜ê³  ë¶„ëŸ‰ì´ ë§ì§€ë§Œ, ì´ë ‡ê²Œë‚˜ë§ˆ ìš”ì•½í•´ì„œ ì •ë¦¬í•  ìˆ˜ ìˆë‹¤ëŠ” ìƒê°ì´ ë“œëŠ”ê²ƒì„ ë³´ë‹ˆ ì •ë§ êµ¬ì¡°ê°€ ë‚˜ì˜ì§€ ì•Šë‹¤ëŠ” ìƒê°ì´ ë“œëŠ” ê²ƒ ê°™ë‹¤.

<br />


