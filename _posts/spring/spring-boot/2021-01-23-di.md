---
layout: post
category:
    - spring
    - spring-boot
date: 2021-01-23 17:38
title: Dependency Injection, DI
description: >
    `ì˜ì¡´ê´€ê³„ ì„¤ì •(Dependency Injection, DI)`ì˜ 3ê°€ì§€ ë°©ë²•
image: /assets/img/spring/spring-boot/spring-boot-logo.png
related_posts:
    - 
---

* toc
{:toc}
  
&nbsp;  

{: style="text-align: right" }
[ğŸ“œ ì°¸ê³  ë„ì„œ - í† ë¹„ì˜ ìŠ¤í”„ë§ 3.1](http://www.yes24.com/Product/Goods/7516911)

&nbsp;  

# Spring DI

---

`Spring DI`ì—ëŠ” 3ê°€ì§€ ë°©ë²•ì´ ìˆë‹¤.

1. **í•„ë“œ ì£¼ì…(Field Injection)**

2. **ìˆ˜ì •ì ì£¼ì… (Setter Injection)**

3. **ìƒì„±ì ì£¼ì… (Constructor Injection)**

ê·¸ë¦¬ê³  <u>Springì—ì„œëŠ” ìƒì„±ìë¥¼ ì‚¬ìš©í•œ ì„¤ì •ì„ ê¶Œì¥</u>í•œë‹¤.

ê·¸ ì´ìœ ì— ëŒ€í•´ ì•Œì•„ë³´ì.

&nbsp;  

## í•„ë“œ ì£¼ì… (Field Injection)

---

```java
@Controller
public class TestController {
    @Autowired
    private TestService testService;
}
```

ë‚´ê°€ ê°€ì¥ ë§ì´ ë³¸ ì‘ì„±ë²•ì´ë‹¤.

ì œì¼ ì½”ë“œë¥¼ ì ê²Œ ì¹˜ë¯€ë¡œ í¸í•˜ê¸´ í•˜ë‹¤.

&nbsp;  

## ìˆ˜ì •ì ì£¼ì… (Setter Injection)

---

```java
@Controller
public class TestController {
    private TestService testService;

    @Autowired
    public void setTestService(TestService testService) {
        this.testService = testService;
    }
}

```

ìë°”ì˜ ì•”ë¬µì ì¸ ì•½ì†ì„ êµ³ì´ ì§€í‚¤ì§€ ì•Šë”ë¼ë„(propertyëŠ” set~ or get~),

ê°™ì€ ê¸°ëŠ¥ì„ í•˜ëŠ” ë©”ì„œë“œì´ê¸°ë§Œ í•˜ë©´ ìƒê´€ì—†ë‹¤.

ê·¸ë˜ë„ ì‘ì„±ìë§Œ ì•Œì•„ë³´ê¸° í¸í•œ ì½”ë“œ ì‘ì„±ì€ ì§€ì–‘í•´ì•¼ í•˜ê¸°ì— í•­ìƒ ëª…í™•í•œ ë„¤ì´ë° íŒ¨í„´ì„ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ì¢‹ì§€ ì•Šì„ê¹Œ?

&nbsp;  

## ìƒì„±ì ì£¼ì… (Constructor Injection)

---

```java
@Controller
public class TestController {
    private TestService testService;

    @Autowired
    public TestController(TestService testService) {
        this.testService = testService;
    }
}

```

ë‘ ë²ˆì§¸ë¡œ ë§ì´ ë³¸ ì‘ì„±ë²•ì´ë‹¤.

ì²˜ìŒì—ëŠ” "í•„ë“œ ì£¼ì…í•˜ë©´ ë˜ì§€ ì™œ ê·€ì°®ê²Œ ì´ëŸ° ê¸´ ì½”ë“œë¥¼ ì‘ì„±í• ê¹Œ?"ë¼ëŠ” ì˜ë¬¸ì´ ë“¤ì—ˆë‹¤.

ê·¸ ì´ìœ ê°€ ìˆë‹¤.

ê·¸ë¦¬ê³  Springì—ì„œëŠ” ì´ ìƒì„±ìë¥¼ ì´ìš©í•œ ì„¤ì •ì„ ë§¤ìš° ê¶Œì¥í•˜ê³  ìˆë‹¤.

> ì°¸ê³ ë¡œ ë‹¨ì¼ ìƒì„±ìì¸ ê²½ìš° Spring 4.3 ë²„ì „ë¶€í„°ëŠ” @`Autowired`ë¥¼ ìƒëµí•  ìˆ˜ ìˆë‹¤.  
> ë‹¤ë§Œ, ìƒì„±ìê°€ ë‘ ê°œ ì´ìƒì¸ ê²½ìš°ì—” 4.3 ì´ìƒì˜ ë²„ì „ì´ë”ë¼ë„ `@Autowired`ë¥¼ ëª…ì‹œì ìœ¼ë¡œ ì„ ì–¸í•´ì¤˜ì•¼ë§Œ í•œë‹¤.

&nbsp;  

# ìƒì„±ì ì„¤ì •ì„ ê¶Œì¥í•˜ëŠ” ì´ìœ 

---

Springì˜ êµ¬ì¡°ì— ëŒ€í•œ ì´í•´ê°€ í•„ìš”í•˜ë‹¤.

ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ì‹¤í–‰í•˜ë©´ WASê°€ ê¸°ë™í•˜ë©° `ë¹ˆ íŒ©í† ë¦¬(BeanFactory)`ê°€ ì´ˆê¸°í™”ë˜ëŠ”ë°,

ì´ë•Œ `ì»´í¬ë„ŒíŠ¸ ìŠ¤ìº”(Component Scan)`ì„ ì§„í–‰í•˜ë©° Beanì„ ë“±ë¡í•œë‹¤.

ì—¬ê¸°ì„œ ìƒì„±ì ì£¼ì…ê³¼ í•„ë“œ & ìˆ˜ì •ì ì£¼ì…ì˜ ì°¨ì´ê°€ ìƒê¸°ëŠ”ë°

<u>í•„ë“œ & ìˆ˜ì •ì ì£¼ì…ì€ ì´ë•Œ ê°™ì´ Beanì„ ì£¼ì…</u>ë°›ê³ 

ìƒì„±ì ì£¼ì…ì€ ì´ˆê¸°í™” ê³¼ì •ì— Beanì„ ì£¼ì…ë°›ì§€ ì•Šê³  í•´ë‹¹ ê°ì²´ê°€ ì‹¤ì œë¡œ ì‚¬ìš©ë˜ëŠ” ì‹œì ì—ì„œì•¼ Beanì„ ì£¼ì…ë°›ëŠ”ë‹¤.

ê·¸ëŸ¬ë¯€ë¡œ ìƒì„±ì ì£¼ì…ì„ í•œë‹¤ë©´ í´ë˜ìŠ¤ ìì²´ê°€ í•„ë“œ & ìˆ˜ì •ì ì£¼ì…ë³´ë‹¤ ë” ë…ë¦½ì ìœ¼ë¡œ ë³€í•˜ê²Œ ëœë‹¤.

ê·¸ë ‡ë‹¤ë©´ ì–´ë–¤ ì¥ì ì´ ìˆì„ê¹Œ?

&nbsp;  

## í…ŒìŠ¤íŠ¸ ì½”ë“œ ì‘ì„±ì´ í¸ë¦¬í•˜ë‹¤

---

IoC Containerì— ëŒ€í•´ ë…ë¦½ì ì¸ ì½”ë“œë¥¼ ì‘ì„±í•  ìˆ˜ ìˆì–´ì§„ë‹¤.

í…ŒìŠ¤íŠ¸ëŠ” ë¹ ë¥¸ í”¼ë“œë°±ê³¼ ì •í™•ì„±ì„ ìœ„í•´ í•­ìƒ ê°€ë³ê³  ë…ë¦½ì ìœ¼ë¡œ ì‘ì„±í•˜ëŠ” ê²Œ ì˜¬ë°”ë¥¸ ì‘ì„±ë²•ì´ë‹¤.

ë§Œì•½ DIë¥¼ ìƒì„±ìì— ê±¸ì–´ë‘ì—ˆë‹¤ë©´ í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ ë‚´ì—ì„œ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ì§ì ‘ ë§Œë“¤ì–´ ì‚¬ìš©í•˜ê¸°ê°€ ìš©ì´í•´ì§„ë‹¤.

ì™œëƒí•˜ë©´ ìƒì„±ì ì£¼ì…ì€ ë…ë¦½ì ìœ¼ë¡œ ì¸ìŠ¤í„´ìŠ¤í™”ê°€ ê°€ëŠ¥í•´ì§€ëŠ” POJOì˜ í˜•íƒœë¥¼ ê°–ê¸° ë•Œë¬¸ì´ë‹¤.

DIë¥¼ ìƒì„±ìì— ê±¸ì§€ ì•Šì•˜ë‹¤ë©´ ì–´ë–»ê²Œ ë ê¹Œ?

ì•„ë§ˆ í…ŒìŠ¤íŠ¸ ì½”ë“œë¥¼ ì‘ì„±í•  ë•Œ IoC Containerë¥¼ ë¶ˆëŸ¬ì˜¤ê±°ë‚˜ Mockê°ì²´ë¥¼ ì´ìš©í•´ì•¼ í•˜ëŠ” ë¹ˆë„ê°€ ëŠ˜ì–´ë‚  ê²ƒì´ë‹¤.

ê²°ê³¼ ìì²´ì•¼ ê°™ê² ì§€ë§Œ í…ŒìŠ¤íŠ¸ ì½”ë“œê°€ ë” ë¬´ê±°ì›Œì§€ê³  ê²°í•©ë„ê°€ ì˜¬ë¼ê°„ë‹¤ëŠ” ë‹¨ì ì´ ìˆëŠ”ë°

ë” ì¢‹ì€ ë°©ë²•ì„ ì‚¬ìš©í•˜ì§€ ì•Šì„ ì´ìœ ê°€ ì—†ë‹¤.

&nbsp;  

## ì¸ìŠ¤í„´ìŠ¤ ë³€ìˆ˜ê°€ ë¶ˆë³€ì„±ì„ ê°€ì§ˆ ìˆ˜ ìˆë‹¤

---

ë³´í†µ MVC íŒ¨í„´ì—ì„œ DIê°€ ì„¤ì •ë˜ëŠ” ì¸ìŠ¤í„´ìŠ¤ ë³€ìˆ˜ëŠ” ë¶ˆë³€ì ìœ¼ë¡œ ì‚¬ìš©ë˜ëŠ” ê²½ìš°ê°€ ë§ê¸°ì—,

ê°€ëŠ¥í•˜ë‹¤ë©´ `final`ë¡œ ì„ ì–¸í•´ì£¼ëŠ” ê²ƒì´ í˜¹ì‹œ ëª¨ë¥¼ ë²„ê·¸ë¥¼ ë¯¸ì—°ì— ë°©ì§€í•  ìˆ˜ ìˆëŠ” í•œ ë°©ë²•ì´ ë  ìˆ˜ ìˆë‹¤.

ì°¸ê³ ë¡œ <u>í•„ë“œ & ìˆ˜ì •ì ì£¼ì…ì€ ì¸ìŠ¤í„´ìŠ¤ ë³€ìˆ˜ë¥¼ finalë¡œ ì„ ì–¸í•  ìˆ˜ ì—†ë‹¤.</u>

&nbsp;  

## ë²„ê·¸ë¥¼ ë” í™•ì‹¤í•˜ê²Œ ì°¾ì•„ë‚¼ ìˆ˜ ìˆë‹¤.

---

í•„ë“œ & ìˆ˜ì •ì ì£¼ì…ì˜ ê²½ìš° ì–¼ë ëš±ë•… ì£¼ì…ì´ ë˜ê³  ë„˜ì–´ê°€ì„œ ë‚˜ì¤‘ì—ì„œì•¼ ì—ëŸ¬ê°€ ë°œìƒí•˜ëŠ” ê²½ìš°ê°€ ë§ë‹¤.

í•˜ì§€ë§Œ ìƒì„±ì ì£¼ì…ì˜ ê²½ìš° Bean ì„¤ì •ì´ ì˜ ëª» ë˜ì–´ìˆì„ ê²½ìš° ì•„ì˜ˆ ì‹¤í–‰ ì—ëŸ¬ê°€ ë‚˜ë²„ë¦°ë‹¤.

ì—ëŸ¬ê°€ ìˆ¨ê²¨ì§„ ì±„ë¡œ ì• í”Œë¦¬ì¼€ì´ì…˜ì´ ë™ì‘í•˜ëŠ” ìƒí™©ì´ ì•„ì˜ˆ ì‹¤í–‰ì´ ì•ˆ ë˜ëŠ” ìƒí™©ë³´ë‹¤ ë” ë¬´ì„­ë‹¤ëŠ” ê²ƒì„ ì•Œì•„ì•¼ í•œë‹¤.

ì´ì™€ ë¹„ìŠ·í•œ ì˜ˆë¡œ `ìˆœí™˜ ì°¸ì¡°(Circular Reference)`ë¼ëŠ” ê²Œ ìˆëŠ”ë°, Aê°€ Bë¥¼ ì°¸ì¡°í•˜ê³  Bê°€ Aë¥¼ ì°¸ì¡°í•˜ëŠ” ìƒí™©ì„ ë§í•œë‹¤.

```java
@Service
public class TestService {
    @Autowired
    private TestService2 testService2;

    public void circularReference(){
        testService2.circularReference2();
    }
}

```

```java
@Service
public class TestService2 {
    @Autowired
    private TestService testService;

    public void circularReference2(){
        testService.circularReference();
    }
}

```

```java
public class CircularReferenceTest extends SpringbootApplicationTests {
    @Autowired
    private TestService testService;

    @Autowired
    private TestService2 testService2;

    @Test
    public void runTest(){
        testService.circularReference();
        testService2.circularReference2();
    }
}
```

&nbsp;  

ì´ëŸ° ë§ë„ ì•ˆ ë˜ëŠ” ì½”ë“œê°€ ì‹¤ì œë¡œ ì‹¤í–‰ì´ ê°€ëŠ¥í•˜ë‹¤..!

&nbsp;  

```text
  .                           
 /\\ / '   ()     \ \ \ \
( ( )\ | ' | '| | ' \/ ` | \ \ \ \
 \\/  )| |)| | | | | || (| |  ) ) ) )
  '  || .|| ||| |\, | / / / /
 =========||==============|/=////
 :: Spring Boot ::                (v2.4.1)

2021-01-23 17:23:08.718  INFO 10780 &nbsp;   [    Test worker] c.s.service.CircularReferenceTest        : Starting CircularReferenceTest using Java 11.0.8 on Changhoon-Han with PID 10780 (started by Han in D:\Project\springboot)
2021-01-23 17:23:08.721  INFO 10780 &nbsp;   [    Test worker] c.s.service.CircularReferenceTest        : No active profile set, falling back to default profiles: default
2021-01-23 17:23:09.646  INFO 10780 &nbsp;   [    Test worker] o.s.s.concurrent.ThreadPoolTaskExecutor  : Initializing ExecutorService 'applicationTaskExecutor'
2021-01-23 17:23:09.916  INFO 10780 &nbsp;   [    Test worker] c.s.service.CircularReferenceTest        : Started CircularReferenceTest in 1.399 seconds (JVM running for 2.37)

java.lang.StackOverflowError
	at com.springboot.service.TestService2.circularReference2(TestService2.java:13)
	at com.springboot.service.TestService.circularReference(TestService.java:13)
```

ì–´ì²˜êµ¬ë‹ˆì—†ê²Œë„ ì‹¤í–‰ì´ ë˜ë©´ì„œ `StackOverflowError`ê°€ ë°œìƒí–ˆë‹¤.

ë¬´í•œ ë£¨í”„ê°€ ë°œìƒí•˜ë‹ˆ ê³„ì†í•´ì„œ ì‹¤í–‰ì´ ë˜ë‹¤ê°€ ìŠ¤íƒì´ ê°€ë“ ì°¨ ë²„ë¦° ê²ƒì´ë‹¤.

ì €ë ‡ê²Œ ë§¤ë³µí•œ ë²„ê·¸ëŠ” ë°œê²¬í•˜ê¸°ê°€ ë§¤ìš° ê·€ì°®ê±°ë‚˜ ì–´ë µê¸° ë•Œë¬¸ì— ëŸ°íƒ€ì„ì—ì„œ ê°‘ìê¸° ë‚˜íƒ€ë‚  ê²½ìš° í° í”¼í•´ê°€ ë°œìƒí•  ìˆ˜ë„ ìˆë‹¤.

ê·¸ë˜ì„œ ì•„ì˜ˆ ì—ëŸ¬ê°€ ëœ¨ë©´ì„œ ì‹¤í–‰ì´ ì•ˆ ë¼ë²„ë¦¬ëŠ” ê²Œ ë” ì¢‹ë‹¤ê³  ì´ì•¼ê¸°í•˜ëŠ” ê²ƒì´ë‹¤.

&nbsp;  

ê·¸ë ‡ë‹¤ë©´ ìƒì„±ì ì£¼ì…ìœ¼ë¡œ ì„¤ì • í•œë‹¤ë©´ ì–´ë–»ê²Œ ë ê¹Œ?

```java
@Service
public class TestService {
    private final TestService2 testService2;

    @Autowired
    public TestService(TestService2 testService2) {
        this.testService2 = testService2;
    }

    public void circularReference() {
        testService2.circularReference2();
    }
}

```

```java
@Service
public class TestService2 {
    private fianl TestService testService;

    @Autowired
    public TestService2(TestService testService) {
        this.testService = testService;
    }

    public void circularReference2() {
        testService.circularReference();
    }
}

```

```java
public class CircularReferenceTest extends SpringbootApplicationTests {
    @Autowired
    private TestService testService;

    @Autowired
    private TestService2 testService2;

    @Test
    public void runTest(){
        testService.circularReference();
        testService2.circularReference2();
    }
}

```

```text
The dependencies of some of the beans in the application context form a cycle:

   testController defined in file [D:\Project\springboot\build\classes\java\main\com\springboot\controller\TestController.class]
â”Œâ”€â”€â”€â”€â”€â”
|  testService defined in file [D:\Project\springboot\build\classes\java\main\com\springboot\service\TestService.class]
â†‘     â†“
|  testService2 defined in file [D:\Project\springboot\build\classes\java\main\com\springboot\service\TestService2.class]
â””â”€â”€â”€â”€â”€â”˜
```

ë³´ë‹¤ì‹œí”¼ ìˆœí™˜ ì°¸ì¡°ê°€ ë°œìƒí–ˆë‹¤ëŠ” ê²½ê³ ë¬¸ì´ ë°œìƒí•˜ë©° ì‹¤í–‰ ìì²´ê°€ ì•ˆëœë‹¤.

ì´ëŸ¬ë©´ ê°œë°œìëŠ” í•´ë‹¹ ë²„ê·¸ë¥¼ ì‰½ê²Œ ì°¾ì•„ë‚´ì–´ ê³ ì¹˜ê³  ì¶”í›„ì— ë°œìƒí•  í”¼í•´ë¥¼ ë¯¸ì—°ì— ë°©ì§€í•  ìˆ˜ ìˆë‹¤.

ê·¸ëŸ¬ë‹ˆê¹Œ ê°€ê¸‰ì ì´ë©´ ìƒì„±ì ì„¤ì •ì„ ì• ìš©í•´ì•¼ê² ë‹¤.

&nbsp;  
