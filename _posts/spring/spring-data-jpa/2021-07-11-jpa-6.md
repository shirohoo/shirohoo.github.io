---
layout: post
category:
  - spring
  - spring-data-jpa
title: JPA ê¸°ì´ˆ 6 - í”„ë¡ì‹œ
description: |
  ì§€ì—°ë¡œë”©ì˜ í•µì‹¬ì¸ `í”„ë¡ì‹œ`ì— ëŒ€í•´ í•™ìŠµí•©ë‹ˆë‹¤
image: /assets/img/spring/spring-data-jpa/hibernate.jpg
related_posts:
    - _posts/spring/spring-data-jpa/2021-06-30-jpa-5.md
    - _posts/spring/spring-data-jpa/2021-07-12-jpa-7.md
---

* toc
{:toc}
  
&nbsp;  

# ğŸ“• í”„ë¡ì‹œ(Proxy)

---

`í”„ë¡ì‹œ`ëŠ” í•œê¸€ë¡œ ëŒ€ë¦¬ì, ëŒ€ë¦¬ì¸ì´ë¼ëŠ” ëœ»ì„ ê°–ëŠ”ë‹¤.

í”„ë¡œê·¸ë˜ë°ì—ëŠ” `ì¸ë””ë ‰ì…˜(Indirection)`ì´ë¼ëŠ” ê°œë…ì´ ìˆë‹¤.

&nbsp;  

> ğŸ“œ Dennis DeBruler
> > ì»´í“¨í„° ê³¼í•™ì€ ì¸ë””ë ‰ì…˜ ê³„ì¸µì„ í•œ ë‹¨ê³„ ë” ë§Œë“¤ë©´ ëª¨ë“  ë¬¸ì œë¥¼ í’€ ìˆ˜ ìˆë‹¤ê³  ë¯¿ëŠ” í•™ë¬¸ì´ë‹¤. 

&nbsp;  

ìœ„í‚¤ë°±ê³¼ë“±ì—ì„œ ì¸ë””ë ‰ì…˜ì— ëŒ€í•œ ë‚´ìš©ì„ ì°¸ê³ í•´ë³´ë©´ ë‘ ê³„ì¸µì‚¬ì´ì— ì–´ë–¤ ë¬¸ì œê°€ ë°œìƒí–ˆì„ ë•Œ ë‘ ê³„ì¸µ ì‚¬ì´ì— ë³„ë„ì˜ ê³„ì¸µì„ í•˜ë‚˜ ì¶”ê°€í•˜ë©´ í•´ë‹¹ ë¬¸ì œê°€ ê¹”ë”í•˜ê²Œ í•´ê²°ë˜ëŠ” ê²½ìš°ê°€ ë§ë‹¤ëŠ” ê²ƒì´ë‹¤.

&nbsp;  

ì´ë¥¼ í”„ë¡œê·¸ë˜ë° ìš©ì–´ë¡œ `ê°„ì ‘ì°¸ì¡°` í˜¹ì€ `ì¶”ìƒí™”`ë¡œ ìš”ì•½í•  ìˆ˜ ìˆì„ ê²ƒ ê°™ë‹¤.

&nbsp;  

`í”„ë¡ì‹œ`ëŠ” ì´ ì¸ë””ë ‰ì…˜ê³¼ ê¶¤ë¥¼ ê°™ì´í•˜ë©° í”„ë¡ì‹œ íŒ¨í„´ì€ SOLIDì¤‘ `ê°œë°©íì‡„ì›ì¹™(OCP)`ê³¼ `ì˜ì¡´ì—­ì „ì›ì¹™(DIP)`ì„ ì¶©ì‹¤íˆ ë”°ë¥¸ë‹¤.

&nbsp;  

ê·¸ë ‡ë‹¤ë©´ í”„ë¡ì‹œê°€ ë­˜ê¹Œ?

&nbsp;  

<u>í”„ë¡ì‹œëŠ” íŠ¹ì • ê°œì²´ì˜ ì‚¬ì´ì— ìœ„ì¹˜í•œ ì§„ì§œì¸ ì²™ì„ í•˜ëŠ” ê°€ì§œ ê°œì²´ë‹¤.</u>

ì—¬ê¸°ì„œ í”„ë¡ì‹œê°€ ëª©í‘œë¡œ í•˜ëŠ” ê²ƒì€ ë³¸ì—°ì˜ ë¡œì§ì—ëŠ” ì „í˜€ ì˜í–¥ì„ ì£¼ì§€ ì•Šìœ¼ë©´ì„œ `íë¦„ì„ ì œì–´ í•˜ëŠ” ê²ƒ`ì´ë‹¤.

ê·¸ë˜ì„œ ë‘ ê°œì²´ëŠ” ì‚¬ì´ì— í”„ë¡ì‹œë¼ëŠ” ê°€ì§œ ê°œì²´ê°€ ìˆëŠ”ì§€ ì „í˜€ ëª¨ë¥´ë©° ì„œë¡œë¥¼ ì§„ì§œë¼ê³  ì‹ ë¢°í•˜ê³  í†µì‹ ì„ ì§„í–‰í•˜ê²Œ ëœë‹¤.

ì½”ë“œë¥¼ í†µí•´ ë³´ì.

&nbsp;  

![image](https://user-images.githubusercontent.com/71188307/125183114-d42d5800-e24e-11eb-927c-62399c15aaab.png)

&nbsp;  

í†µìƒì ì¸ í”„ë¡ì‹œ íŒ¨í„´ì˜ í´ë˜ìŠ¤ ë‹¤ì´ì–´ê·¸ë¨ì´ë‹¤.

ì´ë¥¼ ì½”ë“œë¡œ í’€ì–´ë‚´ë©´ ë‹¤ìŒê³¼ ê°™ë‹¤.

&nbsp;  

```java
// file: 'Client.java'
public class Client {
    Interface anInterface;

    public Client(Interface anInterface) {
        this.anInterface = anInterface;
    }

    public void callOperation(){
        anInterface.operation();
    }
}
```

&nbsp;

```java
// file: 'Interface.java'
public interface Interface {
    void operation();
}
```

&nbsp;

```java
// file: 'Real.java'
public class Real implements Interface{
    @Override public void operation() {
        System.out.println("Real Operation");
    }
}
```

&nbsp;

```java
// file: 'Proxy.java'
public class Proxy implements Interface {
    Interface real = new Real();

    @Override public void operation() {
        System.out.println("Proxy Operation");
        real.operation();
    }
}
```

&nbsp;

```java
// file: 'ClientTest.java'
class ClientTest {
    @Test
    void proxy() {
        Client client = new Client(new Proxy());

        client.callOperation();
    }
}

/*------------ì¶œë ¥------------
        Proxy Operation
        Real Operation
 ----------------------------*/
```

&nbsp;  

ì¤‘ê°„ì— `Proxy`ì˜ ë¡œì§ì´ ì¶”ê°€ë  ìˆ˜ ìˆìœ¼ë©´ì„œ

ì‹¤ì œ ê²°ê³¼ëŠ” `Real`ì˜ ì—°ì‚°ê²°ê³¼ê°€ ë‚˜ì˜´ì„ ë³¼ ìˆ˜ ìˆë‹¤.

&nbsp;  

## ğŸ¤” í”„ë¡ì‹œë¥¼ ì‚¬ìš©í•˜ëŠ” ì´ìœ  ?

---

í”„ë¡ì‹œê°€ ëŒ€ì¶© ë­”ì§€ ì•Œì•˜ë‹¤ë©´ í”„ë¡ì‹œë¥¼ ì‚¬ìš©í•˜ëŠ” ì´ìœ ì— ëŒ€í•œ ë‚©ë“ì´ í•„ìš”í•˜ë‹¤.

í”„ë¡ì‹œëŠ” ëŒ€í‘œì ìœ¼ë¡œ ë‹¤ìŒê³¼ ê°™ì€ ì—­í• ë“¤ì„ ìˆ˜í–‰í•  ìˆ˜ ìˆë‹¤.

&nbsp;  

1. <u>íë¦„ì œì–´</u>
2. <u>ìºì‹±</u>
3. <u>ì§€ì—°ì—°ì‚°</u>

&nbsp;  

### ğŸ’¡ íë¦„ì œì–´

---

ì„œë¬¸ì˜ ì˜ˆì‹œì½”ë“œì™€ ê°™ë‹¤. 

ì˜ˆì‹œì½”ë“œì—ì„œëŠ” ë‹¨ìˆœíˆ

&nbsp;  

```java
System.out.println("Proxy Operation");
```

&nbsp;  

í•œì¤„ë§Œì„ ì¶”ê°€í–ˆì§€ë§Œ, ì´ê³³ì— ê°œë°œìê°€ ì„ì˜ì˜ ì½”ë“œë¥¼ ì¶”ê°€í•  ìˆ˜ë„ ìˆë‹¤.

ë³´í†µ ì¡°ê±´ë¬¸ì„ ì‚¬ìš©í•˜ì—¬ íë¦„ì„ ì œì–´í•˜ê²Œ ëœë‹¤.

ì´ë¥¼ ê·¹ëŒ€í™”ì‹œì¼œì„œ ì‚¬ìš©í•˜ëŠ” ì˜ˆë¡œ `í¬ì›Œë“œ í”„ë¡ì‹œ`, `ë¦¬ë²„ìŠ¤ í”„ë¡ì‹œ` ë“±ì´ ìˆë‹¤.

ìŠ¤í”„ë§ì—ì„œëŠ” ì´ë¥¼ í™œìš©í•´ `AOP` ê¸°ìˆ ì„ êµ¬í˜„í•˜ê³  ìˆìœ¼ë©° `AOP` ê¸°ìˆ ì„ í†µí•´ êµ¬í˜„ë˜ëŠ” ëŒ€í‘œì ì¸ ê¸°ìˆ ë¡œ `@Transactional`ì´ ìˆë‹¤.

&nbsp;  

### ğŸ’¡ ìºì‹±

---

> ğŸ“œ ì‹œë‚˜ë¦¬ì˜¤
> 
> íŠ¹ì •í•œ í…ìŠ¤íŠ¸ë¥¼ ì½ì–´ ë³µí˜¸í™”í•˜ì—¬ ë°˜í™˜í•´ì£¼ëŠ” ê¸°ëŠ¥ì´ ìˆë‹¤.
> 
> ë§¤ë²ˆ ìƒˆë¡œìš´ í…ìŠ¤íŠ¸ë¥¼ ë°˜í™˜í•˜ë‹ˆ ë¦¬ì†ŒìŠ¤ì˜ ë‚­ë¹„ê°€ ì‹¬í•´ ì´ë¥¼ ìºì‹œí•˜ê³ ì í•œë‹¤.

&nbsp;  

```java
// file: 'TextFileReader.java'
public interface TextFileReader {
    SecretText read();
}
```

&nbsp;  

```java
// file: 'RealTextFileReader.java'
public class RealTextFileReader implements TextFileReader {
    private String plainText;

    public RealTextFileReader(String plainText) {
        this.plainText = SecretUtil.decode(plainText);
    }

    @Override
    public SecretText read() {
        System.out.println("RealTextFileReader reading text from : " + plainText);
        return new SecretText(plainText);
    }
}
```

&nbsp;  

```java
// file: 'TextFileReaderTest.java'
class TextFileReaderTest {
    @Test
    void noCache() {
        TextFileReader reader = new RealTextFileReader("text");
        reader.read();
        reader.read();
        reader.read();
        reader.read();
        reader.read();
    }
}
```

&nbsp;  

ì¶œë ¥ì€ ë‹¤ìŒê³¼ ê°™ë‹¤.

&nbsp;  

```text
RealTextFileReader reading text from : text
RealTextFileReader reading text from : text
RealTextFileReader reading text from : text
RealTextFileReader reading text from : text
RealTextFileReader reading text from : text
```

&nbsp;  

ì´ë¥¼ í”„ë¡ì‹œ íŒ¨í„´ì„ í™œìš©í•´ ìºì‹œí•´ë³´ì

&nbsp;  

```java
// file: 'ProxyTextFileReader.java'
public class ProxyTextFileReader implements TextFileReader {
    private String plainText;
    private SecretText secretText;

    public ProxyTextFileReader(String plainText) {
        this.plainText = SecretUtil.decode(plainText);
    }

    @Override
    public SecretText read() {
        // ê°€ì§€ê³  ìˆëŠ” íŒŒì¼ì´ ì—†ê±°ë‚˜, ê°€ì§€ê³  ìˆëŠ” íŒŒì¼ê³¼ ìš”ì²­ë°›ì€ íŒŒì¼ì´ ë‹¤ë¥¸ ê²½ìš° ìƒˆë¡œìš´ íŒŒì¼ì„ ìƒì„±í•˜ì—¬ ìºì‹œ
        if(secretText == null || !secretText.getPlainText().equals(plainText)) {
            System.out.println("RealTextFileReader reading text from : " + plainText);
            this.secretText = new SecretText(plainText);
            return this.secretText;
        }

        System.out.println("RealTextFileReader use cache");
        return new SecretText(plainText);
    }
}
```

&nbsp;  

ìƒì„±ìë¥¼ í†µí•´ `ProxyTextFileReader`ê°€ ì´ˆê¸°í™”ë˜ë©´ ë‚´ë¶€ì— ë³µí˜¸í™” í•œ íŒŒì¼ì„ ìºì‹œí•´ë‘ê³  ì´í›„ í˜¸ì¶œë˜ë©´ ìºì‹œí•´ë‘” íŒŒì¼ì„ ì¦‰ì‹œ ë¦¬í„´í•˜ëŠ” ë¡œì§ì´ë‹¤.

&nbsp;  

```java
// file: 'TextFileReaderTest.java'
class TextFileReaderTest {
    @Test
    void useCache() {
        TextFileReader reader = new ProxyTextFileReader("text");
        reader.read();
        reader.read();
        reader.read();
        reader.read();
        reader.read();
    }
}
```

&nbsp;  

```text
RealTextFileReader reading text from : text
RealTextFileReader use cache
RealTextFileReader use cache
RealTextFileReader use cache
RealTextFileReader use cache
```

&nbsp;  

ì´ì²˜ëŸ¼ í”„ë¡ì‹œë¥¼ ì‚¬ìš©í•˜ì—¬ ê¸°ì¡´ì˜ ì•„í‚¤í…ì²˜ì— ì˜í–¥ì„ ì£¼ì§€ ì•ŠëŠ” ì„ ì—ì„œ ìºì‹œ ê¸°ëŠ¥ì„ ê°„ë‹¨í•˜ê²Œ ì¶”ê°€í•  ìˆ˜ ìˆë‹¤.

&nbsp;  

### ğŸ’¡ ì§€ì—°ì—°ì‚°

---

ì§€ì—°ì—°ì‚°ì´ë¼ëŠ” ê²ƒì€ ì–´ë–¤ ì—°ì‚°ì´ ì •ë§ë¡œ ì‹¤í–‰ë˜ì–´ì•¼ í•˜ê¸° ì „ê¹Œì§€ í•´ë‹¹ ì—°ì‚°ì˜ ì‹¤í–‰ì„ ìœ ì˜ˆí•˜ëŠ” ê²ƒì´ë‹¤.

ì´ë ‡ê²Œ í•¨ìœ¼ë¡œì¨ í•„ìš”í•˜ì§€ ì•Šì€ ì—°ì‚°ì„ ìµœì†Œí™”í•˜ì—¬ ì„±ëŠ¥ì„ ê·¹ëŒ€í™”ì‹œí‚¬ ìˆ˜ ìˆë‹¤.

&nbsp;  

êµ¬í˜„ì€ ê°„ë‹¨í•˜ë‹¤.

ì§„ì§œ ê°ì²´ë¥¼ í”„ë¡ì‹œë¡œ í•œë²ˆ ë˜í•‘í•˜ë©´ ëœë‹¤.

&nbsp;  

```java
// file: 'LazyTextFileReader.java'
public class LazyTextFileReader implements TextFileReader{
    private String plainText;
    private TextFileReader reader;

    public LazyTextFileReader(String plainText) {
        this.plainText = plainText;
    }

    @Override
    public SecretText read() {
        if(reader == null){
            reader = new RealTextFileReader(plainText);
        }
        System.out.println("lazy initialisation");
        return reader.read();
    }
}
```

&nbsp;  

```java
// file: 'TextFileReaderTest.java'
class TextFileReaderTest {
    @Test
    void lazy() {
        TextFileReader reader = new LazyTextFileReader("text");
        reader.read();
        reader.read();
        reader.read();
        reader.read();
        reader.read();
    }
}
```

&nbsp;

```text
lazy initialisation
RealTextFileReader reading text from : text
lazy initialisation
RealTextFileReader reading text from : text
lazy initialisation
RealTextFileReader reading text from : text
lazy initialisation
RealTextFileReader reading text from : text
lazy initialisation
RealTextFileReader reading text from : text
```

&nbsp;  

ì´ë ‡ê²Œ í•˜ë©´ `read()`ê°€ ì •ë§ë¡œ ì‹¤í–‰ë˜ì•¼ í•  ìˆœê°„ì´ ì˜¤ë©´ ê·¸ì œì•¼ ì§„ì§œ ê°ì²´ë¥¼ í˜¸ì¶œí•˜ì—¬ ì—°ì‚°ì„ ì‹œì‘í•œë‹¤.

&nbsp;  

## ğŸ¤” JPAì—ì„œì˜ í”„ë¡ì‹œ ?

---

JPAì—ëŠ” ì—°ê´€ê´€ê³„ ë§¤í•‘ í˜¹ì€ ì—”í‹°í‹° ë§¤í•‘ì´ë¼ê³  ë¶€ë¥´ëŠ” ê¸°ë²•ì´ ìˆë‹¤.

ë°ì´í„°ë² ì´ìŠ¤ì˜ í…Œì´ë¸”ê³¼ ìë°”ì˜ í´ë˜ìŠ¤ë¥¼ ë§¤í•‘í•˜ì—¬ ì¿¼ë¦¬ ì‘ì„±ì˜ ë¶€ë‹´ì„ ì¤„ì´ê¸° ìœ„í•œ ëª©ì ì„ ê°–ëŠ”ë‹¤.

ì¦‰, ì´ ë°©ë²•ì„ ì‚¬ìš©í•˜ê²Œ ë˜ë©´ ë°ì´í„°ë² ì´ìŠ¤ì˜ ì™¸ë˜í‚¤ë¥¼ ìë°” ì½”ë“œë¡œ êµ¬í˜„í•  ë•Œ ìë°”ì˜ ê°ì²´ ê·¸ë˜í”„ í˜•ì‹ìœ¼ë¡œ ë³€í™˜ëœë‹¤. (ì°¸ì¡°, ì°¸ì¡°, ì°¸ì¡°)

&nbsp;  

```java
// file: 'Member.java'
@Entity
public class Member {
    @Id
    private Long id;
    
    private String name;
    
    @ManyToOne
    private Team team;
    
    public Team getTeam(){
        return this.team;
    }
    
    public String getName(){
        return this.name;
    }
}
```

&nbsp;  

```java
// file: 'Team.java'
@Entity
public class Team {
    @Id
    private Long id;
    
    private String name;
    
    public String getName(){
        return this.name;
    }
}
```

&nbsp;  

```java
public void printMemberAndTeam(String memberId){
    Member member = memberRepository.findById(memberId); // left outer join ë°œìƒ
    System.out.println("íšŒì› ì´ë¦„ : " + member.getName());
    System.out.println("ì†Œì† íŒ€ ì´ë¦„ : " + member.getTeam().getName());
}
```

&nbsp;  

ì´ëŸ° ì½”ë“œê°€ ìˆë‹¤.

ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ `Member`ë¥¼ ê°€ì ¸ì˜¤ë©´ `@ManyToOne`ìœ¼ë¡œ ì¸í•´ `Team`ë„ ê°™ì´ ê°€ì ¸ì™€ì§„ë‹¤.

ì´ë•Œ ë°œìƒí•˜ëŠ” ì¿¼ë¦¬ëŠ” ë‹¤ìŒê³¼ ê°™ë‹¤.

&nbsp;  

```sql
select
        member0_.id as id1_1_0_,
        member0_.name as name2_1_0_,
        member0_.team_id as team_id3_1_0_,
        team1_.id as id1_2_1_,
        team1_.name as name2_2_1_ 
    from
        Member member0_ 
    left outer join
        Team team1_ 
            on member0_.team_id=team1_.id 
    where
        member0_.id=?
```

&nbsp;  

ê·¸ë¦¬ê³  `Member`ì™€ `Team`ì˜ ë°ì´í„°ë¥¼ ëª¨ë‘ `ì¶œë ¥(ì‚¬ìš©)`í•˜ê³  ìˆìœ¼ë¯€ë¡œ ì´ ê²½ìš°ì—ëŠ” ë³„ë‹¤ë¥¸ ë¬¸ì œê°€ ì—†ë‹¤.

&nbsp;  

<u>í•˜ì§€ë§Œ ë‹¤ìŒê³¼ ê°™ì€ ê²½ìš°ì—” ì–´ë–¨ê¹Œ?</u>

&nbsp;  

```java
public void printMemberAndTeam(String memberId){
    Member member = memberRepository.findById(memberId);
    System.out.println("íšŒì› ì´ë¦„ : " + member.getName());
}
```

&nbsp;  

`Member`ì™€ `Team`ì˜ ë°ì´í„°ë¥¼ `join`í•˜ì—¬ ëª¨ë‘ ê°€ì ¸ì˜¨ê²Œ ë¶„ëª…í•˜ì§€ë§Œ ì‹¤ì œë¡œëŠ” `Member`ì˜ ë°ì´í„°ë§Œì„ ì‚¬ìš©í•˜ê³  ìˆë‹¤.

ì´ëŸ´ ê²½ìš°ì—ëŠ” `Team`ì„ êµ³ì´ ê°€ì ¸ì˜¬ í•„ìš”ê°€ ì—†ìœ¼ë©°, ì˜¤íˆë ¤ ê°€ì ¸ì˜¤ëŠ” ê²ƒì´ ë¦¬ì†ŒìŠ¤ì˜ ë‚­ë¹„ì´ë‹¤.

ì´ëŸ´ ë•Œ í”„ë¡ì‹œë¥¼ í™œìš©í•œ ì§€ì—°ë¡œë”©ì„ ì‚¬ìš©í•˜ê²Œ ëœë‹¤.

&nbsp;  

```java
// file: 'Member.java'
@ManyToOne(fetch = FetchType.LAZY)
private Team team;
```

&nbsp;  

ì´ë ‡ê²Œ ì—°ê´€ê´€ê³„ ë§¤í•‘ì— `ì§€ì—°ë¡œë”©(LAZY)`ë¥¼ ì‚¬ìš©í•˜ê² ë‹¤ê³  ì„ ì–¸í•˜ë©´ ì‹¤ì œ ì¿¼ë¦¬ì˜ ë°œìƒìˆœì„œëŠ” ë‹¤ìŒê³¼ ê°™ë‹¤.

&nbsp;  

```java
public void printMemberAndTeam(String memberId){
    Member member = memberRepository.findById(memberId); // Select Member ì¿¼ë¦¬ ë°œìƒ, ë‹¤ë§Œ Memberë¥¼ ê°€ì ¸ì˜¤ë˜ Teamì€ í”„ë¡ì‹œë¡œ ê°€ì ¸ì˜´
    System.out.println("íšŒì› ì´ë¦„ : " + member.getName()); // ì¿¼ë¦¬ ë°œìƒí•˜ì§€ ì•ŠìŒ
    System.out.println("ì†Œì† íŒ€ ì´ë¦„ : " + member.getTeam().getName()); // Teamì´ ì‹¤ì œë¡œ ì‚¬ìš©ë˜ë¯€ë¡œ Select Team ì¿¼ë¦¬ê°€ ë°œìƒ
}
```

&nbsp;  

ìœ„ì˜ ì˜ˆì‹œê°€ ë°”ë¡œ `ì§€ì—°ë¡œë”©(fetch = LAZY)`ì˜ ì „ë¶€ë‹¤.

ì´ ì§€ì—°ë¡œë”©ì„ ì‚¬ìš©í•˜ëŠ” ì´ìœ ëŠ” ìœ„ í”„ë¡ì‹œì˜ ì§€ì—°ì—°ì‚° ì˜ˆì‹œì™€ ê°™ì´ 

<u>ê¼­ í•„ìš”í•œ ì—°ì‚°ë§Œ í–‰í•´ì„œ ì„±ëŠ¥ì˜ ê·¹ëŒ€í™”ë¥¼ ê¾€í•œë‹¤.</u>

ë¼ê³  ë³¼ ìˆ˜ ìˆë‹¤.

&nbsp;  

ê·¸ë¦¬ê³  JPAë¥¼ ë” ê³µë¶€í•˜ë©´ ì•Œê²Œë  `N+1 ë¬¸ì œ`ë¥¼ ë°”ë¡œ ì´ ì§€ì—°ë¡œë”©ì„ í†µí•´ íšŒí”¼í•œë‹¤.

&nbsp;  

<u>ê·¸ë ‡ë‹¤ë©´ í•­ìƒ ì§€ì—°ë¡œë”©ì´ ì˜³ì€ê²ƒì¼ê¹Œ?</u>

&nbsp;  

ê·¸ê±´ ë˜ ì•„ë‹ˆë‹¤.

&nbsp;  

ë°”ë¡œ ìœ„ì˜ ì˜ˆì‹œì—ì„œ ë³´ë‹¤ì‹œí”¼,`Member`ì™€ `Team`ì„ ëª¨ë‘ ì‚¬ìš©í•˜ê¸° ìœ„í•œ ëª©ì ìœ¼ë¡œ `Member`ë¥¼ ì¡°íšŒí•´ì™”ìŒì—ë„ ì§€ì—°ë¡œë”©ìœ¼ë¡œ ì¸í•´ `select` ì¿¼ë¦¬ê°€ ë‘ë²ˆ ë°œìƒí–ˆë‹¤.

ì• ì´ˆì— ì´ë¥¼ `join`ì„ ì‚¬ìš©í•´ `select` ì¿¼ë¦¬í–ˆë‹¤ë©´ í•œë²ˆì˜ `select` ì¿¼ë¦¬ë¡œ í•´ê²°í•  ìˆ˜ ìˆì—ˆì„ ê²ƒì´ë‹¤.

&nbsp;  

ì´ë¥¼ `ì¦‰ì‹œë¡œë”©(fetch = EAGER)`ì´ë¼ê³  í•˜ë©° ì´ì²˜ëŸ¼ ì¦‰ì‹œë¡œë”©ì´ ë” íš¨ìœ¨ì ì¸ ê²½ìš°ë„ ë§¤ìš° ë§ë‹¤.

JPAë¥¼ ë” ê³µë¶€í•˜ê²Œ ë˜ë©´ ë‚˜ì¤‘ì— `fetch join`ì´ë¼ëŠ” ê²ƒì„ ë°°ìš°ê²Œ ë  ê²ƒì¸ë°, ì´ê²ƒì´ ë°”ë¡œ ì¦‰ì‹œë¡œë”©ì„ í™œìš©í•œ ì˜ˆë¼ê³  ë³¼ ìˆ˜ ìˆë‹¤.

&nbsp;  

## ğŸ¤” ë¡œë”© ì „ëµì€ ì–´ë–»ê²Œ ?

---

`fetch`ì˜ ê¸°ë³¸ ì„¤ì •ì€ ë‹¤ìŒê³¼ ê°™ë‹¤.

&nbsp;  

> ğŸ’¡ `@~ToOne` (@OneToOne, @OneToMany) - ì¦‰ì‹œë¡œë”©(FetchType.EAGER)
>
> ğŸ’¡ `@~ToMany` (@ManyToOne, @ManyToMany) - ì§€ì—°ë¡œë”©(FetchType.LAZY)

&nbsp;   

JPAì˜ ê¸°ë³¸ ë¡œë”© ì „ëµì€ ì—°ê´€ëœ ì—”í‹°í‹°ê°€ `í•œê°œ(~ToOne)`ë©´ ì¦‰ì‹œ ë¡œë”©ì„,`ì»¬ë ‰ì…˜(~ToMany)`ì´ë©´ ì§€ì—° ë¡œë”©ì„ ì‚¬ìš©í•œë‹¤. 

ì»¬ë ‰ì…˜ì„ ë¡œë”©í•˜ëŠ” ê²ƒì€ ë¹„ìš©ì´ ë§ì´ ë“¤ê³  ì˜ëª»í•˜ë©´ ë„ˆë¬´ ë§ì€ ë°ì´í„°ë¥¼ ë©”ëª¨ë¦¬ì— í¼ì˜¬ë¦´ ìˆ˜ ìˆê¸° ë•Œë¬¸ì´ë‹¤.

ì˜ˆë¥¼ ë“¤ì–´ íŠ¹ì • íšŒì›ì´ ì—°ê´€ëœ ì»¬ë ‰ì…˜ì— ë°ì´í„°ë¥¼ ìˆ˜ì²œë§Œê±´ ë“±ë¡í–ˆëŠ”ë° ì´ë¥¼ ì¦‰ì‹œ ë¡œë”©ìœ¼ë¡œ ì„¤ì •í•´ë‘” ê²½ìš° í•´ë‹¹ íšŒì›ì„ ë¡œë”©í•˜ëŠ” ìˆœê°„ ë©”ëª¨ë¦¬ì— ìˆ˜ì²œë§Œê±´ì˜ ë°ì´í„°ë„ í•¨ê»˜ í¼ì˜¬ë ¤ì§„ë‹¤.

ë§Œì•½ì— ë©€í‹°ìŠ¤ë ˆë“œ í™˜ê²½ì—ì„œ ì´ëŸ° ì¼ì´ ë°œìƒí•œë‹¤ë©´ ì• í”Œë¦¬ì¼€ì´ì…˜ì€ ê·¸ ì¦‰ì‹œ `OutOfMemory`ë¥¼ ë„ìš°ë©° ë»—ì–´ë²„ë¦´ê²ƒì´ë‹¤.

&nbsp;  

<u>ê¶Œì¥í•˜ëŠ” ë°©ë²•ì€ ëª¨ë“  ìƒí™©ì— ëŒ€í•´ ì§€ì—° ë¡œë”©ì„ ì‚¬ìš©í•˜ê³ , ìƒí™©ì„ ë³´ë©´ì„œ í•„ìš”í•œ ë¶€ë¶„ì— ì¦‰ì‹œë¡œë”©(fetch join)ì„ ì‚¬ìš©í•˜ì—¬ ìµœì í™”í•˜ëŠ” ê²ƒì´ë‹¤.</u>

&nbsp;  

## ğŸ’¥ ì»¬ë ‰ì…˜ ë¡œë”© ì „ëµ ì£¼ì˜ì 

---

ì»¬ë ‰ì…˜ì— `FetchType.EAGER`ë¥¼ ì‚¬ìš©í•  ê²½ìš° ì£¼ì˜ì ì€ ë‹¤ìŒê³¼ ê°™ë‹¤.

&nbsp;  

- **`ì»¬ë ‰ì…˜`ì„ í•˜ë‚˜ ì´ìƒ `ì¦‰ì‹œ ë¡œë”©`í•˜ëŠ” ê²ƒì€ ê¶Œì¥í•˜ì§€ ì•ŠëŠ”ë‹¤**
  
ì»¬ë ‰ì…˜ê³¼ ì¡°ì¸í•œë‹¤ëŠ” ê²ƒ(~ToMany)ì€ ë°ì´í„°ë² ì´ìŠ¤ í…Œì´ë¸”ë¡œ ë³´ë©´ ì¼ëŒ€ë‹¤ ì¡°ì¸ì´ë‹¤.

ì¼ëŒ€ë‹¤ ì¡°ì¸ì€ ê²°ê³¼ ë°ì´í„°ê°€ ë‹¤ìª½ì— ìˆëŠ” ìˆ˜ë§Œí¼ ì¦ê°€í•˜ê²Œ ëœë‹¤. 

ë¬¸ì œëŠ” ì„œë¡œ ë‹¤ë¥¸ ì»¬ë ‰ì…˜ì„ ë‘ê°œì´ìƒ ì¡°ì¸í•  ë•Œ ë°œìƒí•˜ëŠ”ë°, ì´ë¥¼ SQLìš©ì–´ë¡œ `ì¹´í‹°ì…˜ ê³±`ì´ë¼ê³  í•œë‹¤.

&nbsp;  

ì—¬ëŸ¬ê°œì˜ í…Œì´ë¸”ì„ ì¡°ì¸í–ˆì„ ë•Œ `ë°œìƒ ê°€ëŠ¥í•œ ëª¨ë“  ê²½ìš°ì˜ ìˆ˜`ê°€ ì¶œë ¥ë˜ëŠ” ìƒí™©ì„ ë§í•˜ë©°,

`Nê°œì˜ í–‰ì„ ê°€ì§„ í…Œì´ë¸”`ê³¼ `Mê°œì˜ í–‰ì„ ê°€ì§„ í…Œì´ë¸”`ì„ ì¡°ì¸í–ˆì„ ê²½ìš° `NMì˜ ê²°ê³¼ê°€ ì¶œë ¥`ëœë‹¤.

&nbsp;  

<u>ì´ ë¬¸ì œê°€ ë°œìƒí•˜ê²Œ ë˜ë©´ ì‹œìŠ¤í…œì— ë§‰ëŒ€í•œ ë¶€í•˜ë¥¼ ë°œìƒì‹œí‚¤ë¯€ë¡œ ë°˜ë“œì‹œ í”¼í•´ì•¼ í•˜ëŠ” ë¬¸ì œì´ë‹¤.</u>

&nbsp;  

---

&nbsp;  

- **`ì»¬ë ‰ì…˜` ì¦‰ì‹œ ë¡œë”©ì€ í•­ìƒ `ì™¸ë¶€ì¡°ì¸(OUTER JOIN)`ì„ ì‚¬ìš©í•œë‹¤**

ì˜ˆë¥¼ ë“¤ì–´ ë‹¤ëŒ€ì¼ ê´€ê³„ì¸ `íšŒì› í…Œì´ë¸”`ê³¼ `íŒ€ í…Œì´ë¸”`ì„ ì¡°ì¸í•  ë•Œ íšŒì› í…Œì´ë¸”ì˜ ì™¸ë˜í‚¤ì—

`not null` ì œì•½ì¡°ê±´ì„ ê±¸ì–´ë‘ë©´ ëª¨ë“  íšŒì›ì€ ë°˜ë“œì‹œ ì–´ë–¤ íŒ€ì— ì†Œì†ë˜ì•¼ í•˜ë¯€ë¡œ

ì´ ê²½ìš° `ë‚´ë¶€ì¡°ì¸(INNER JOIN)`ì„ ì‚¬ìš©í•´ë„ ì˜¬ë°”ë¥¸ ë°ì´í„°ê°€ ì¶œë ¥ëœë‹¤.

&nbsp;  

ë°˜ëŒ€ë¡œ ì–‘ë°©í–¥ ë§¤í•‘ì„ ê±¸ì–´ íŒ€ í…Œì´ë¸”ì—ì„œ íšŒì› í…Œì´ë¸”ë¡œ ì¼ëŒ€ë‹¤ ì¡°ì¸ì„ ì‹œë„í•  ë•Œ

<u>íšŒì›ì´ í•œëª…ë„ ì—†ëŠ” íŒ€ì„ ë‚´ë¶€ ì¡°ì¸í•˜ë©´ íŒ€ê¹Œì§€ ì¡°íšŒë˜ì§€ ì•ŠëŠ” ìƒí™©ì´ ë°œìƒ</u>í•œë‹¤.

<u>ë°ì´í„°ë² ì´ìŠ¤ ì‹œìŠ¤í…œìœ¼ë¡œëŠ” ì´ëŸ° ìƒí™©ì„ ë¯¸ì—°ì— ë°©ì§€í•  ìˆ˜ ì—†ìœ¼ë¯€ë¡œ</u>

ì• ì´ˆì— ì–‘ë°©í–¥ ë§¤í•‘ì„ ì‚¬ìš©í•˜ì§€ ì•Šê±°ë‚˜, ë°˜ë“œì‹œ `ì™¸ë¶€ì¡°ì¸(OUTER JOIN)`ì„ ì‚¬ìš©í•´ì•¼ í•œë‹¤.

&nbsp;  

`FetchType.EAGER` ì„¤ì •ê³¼ ì¡°ì¸ ì „ëµì€ ë‹¤ìŒê³¼ ê°™ë‹¤.

&nbsp;  

- **`@ManyToOne`, `@OneToOne`**
    - (optional = false): ë‚´ë¶€ì¡°ì¸
    - (optional = true): ì™¸ë¶€ì¡°ì¸    

&nbsp;  

- **`@OneToMany`, `@ManyToMany`**
    - (optional = false): ì™¸ë¶€ì¡°ì¸
    - (optional = true): ì™¸ë¶€ì¡°ì¸
    
&nbsp;
