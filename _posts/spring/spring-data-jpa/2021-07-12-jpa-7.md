---
layout: post
category:
  - spring
  - spring-data-jpa
title: JPA ê¸°ì´ˆ 7 - ê°’ íƒ€ì…
description: |
  ê°ì²´ì§€í–¥ì  ê¸°ë²•ì¸ `ê°’ íƒ€ì…`ì— ëŒ€í•´ í•™ìŠµí•©ë‹ˆë‹¤
image: /assets/img/spring/spring-data-jpa/hibernate.jpg
related_posts:
  - _posts/spring/spring-data-jpa/2021-07-11-jpa-6.md
published: true
---

* toc
{:toc}
  
&nbsp;  

# ğŸ“• ê°’ íƒ€ì…

---

`ê°’ íƒ€ì…`ì€ ì—”í‹°í‹° í´ë˜ìŠ¤ì˜ í•„ë“œë¥¼ ì¶”ìƒí™”í•˜ëŠ” ê¸°ë²•ì´ë‹¤.

ë¨¼ì € ê°’ íƒ€ì…ì— ëŒ€í•´ ì•Œì•„ë³´ê¸° ì „ì— ê°’ íƒ€ì…ì„ ì“°ëŠ” ì´ìœ ë¥¼ ë¨¼ì € ì•Œì•„ë³´ì.

ì •ë³´ì²˜ë¦¬ê¸°ì‚¬ ë°ì´í„°ë² ì´ìŠ¤ ê³¼ëª©ì—ì„œ `ì •ê·œí™”`ëŠ” êµ‰ì¥íˆ ë¹„ì¤‘ìˆê²Œ ë‚˜ì˜¤ëŠ” ë‚´ìš©ì´ì§€ë§Œ, ì‹¤ì œ í˜„ì—…ì—ì„œëŠ” ì¼ë°˜ì ìœ¼ë¡œ ì •ê·œí™”ë¥¼ ì˜ í•˜ì§€ ì•ŠëŠ”ë‹¤.

&nbsp;  

ì´ìœ ê°€ ë­˜ê¹Œ?

&nbsp;  

ì •ê·œí™”ë¥¼ í•˜ëŠ” ê°€ì¥ ëª©ì ì€ ì´ìƒí˜„ìƒì„ ìµœì†Œí™”í•˜ëŠ” ê²ƒì¼ ê²ƒì´ë‹¤.

ê·¸ë¦¬ê³  ë¶€ê°€ì ì¸ ì¥ì ìœ¼ë¡œ í…Œì´ë¸”ì˜ ìš©ëŸ‰ì´ ìµœì í™”ëœë‹¤ëŠ” ì ì´ ìˆë‹¤.

&nbsp;  

í•˜ì§€ë§Œ ì •ê·œí™”ë¥¼ í•˜ê²Œë˜ë©´ ìƒê¸°ëŠ” ë‹¨ì ì´ ë„ˆë¬´ í¬ë‹¤. 

í…Œì´ë¸”ì´ ì˜ê²Œ ìª¼ê°œì§€ëŠ” ë§Œí¼ `ì¡°ì¸(join)`ì„ í•´ì•¼í•˜ë©°, ë§ì€ ì¡°ì¸ì€ ë°ì´í„°ë² ì´ìŠ¤ì— ë¶€í•˜ë¥¼ ë°œìƒì‹œí‚¨ë‹¤.

ë˜í•œ, ì¡°ì¸ìœ¼ë¡œ ì¸í•´ íŠ¸ëœì­ì…˜ì˜ `ë¡œí‚¹ ë‹¨ìœ„`ê°€ ì»¤ì§€ê²Œ ë˜ê³ , ì´ëŠ” ë°ì´í„°ë² ì´ìŠ¤ì˜ ê³µìœ ë„ë¥¼ ê°ì†Œì‹œì¼œ `ë™ì‹œì„± ì„±ëŠ¥`ì´ ë–¨ì–´ì§€ê²Œ ë§Œë“ ë‹¤.

ê²°ê³¼ì ìœ¼ë¡œ ì´ëŠ” `ì§ˆì˜(query)`ì— ëŒ€í•œ ì‘ë‹µì†ë„ê°€ ëŠë ¤ì§ì„ ëœ»í•˜ë©°, ê³ ê°ì´ ëŠë¼ëŠ” ì‘ë‹µì‹œê°„ì´ ëŠ˜ì–´ë‚¨ì„ ëœ»í•˜ê¸°ë„ í•œë‹¤.

&nbsp;  

ì •ë¦¬í•˜ìë©´, ì •ê·œí™” ì‹œí–‰í–ˆì„ ë•Œ ê¸°ëŒ€ë˜ëŠ” ì´ë“ì€ `ì €ì¥ìš©ëŸ‰ì˜ ìµœì í™”`ì™€ `ì´ìƒí˜„ìƒì˜ ìµœì†Œí™”`ë¼ê³  ë³¼ ìˆ˜ ìˆê³ , ì´ëŸ¬í•œ ì´ë“ì„ ì–»ê¸° ìœ„í•´ `ë™ì‹œì„±`ì„ í¬ê¸°í•´ì•¼ë§Œ í•œë‹¤. ì´ëŠ” ê³§ `ì‹œê°„ì ì¸ ì†ì‹¤`ì„ ì˜ë¯¸í•œë‹¤.

&nbsp;  

ì•Œê³ ë¦¬ì¦˜ê³¼ ìë£Œêµ¬ì¡°ì— ëŒ€í•œ ê³µë¶€ë¥¼ í•˜ë‹¤ë³´ë©´ `ì‹œê°„ë³µì¡ë„`ì™€ `ê³µê°„ë³µì¡ë„`ë¼ëŠ” ê°œë…ì´ ë‚˜ì˜¨ë‹¤. 

í•˜ì§€ë§Œ í˜„ëŒ€ì— ë“¤ì–´ í•˜ë“œì›¨ì–´ì˜ ì—„ì²­ë‚œ ë°œë‹¬ê³¼ í•¨ê»˜ <u>ê³µê°„ë³µì¡ë„ì˜ ì¤‘ìš”ì„±ì´ ë¯¸ë¯¸í•´ì§„ ë°˜ë©´, ì‹œê°„ë³µì¡ë„ì˜ ì¤‘ìš”ì„±ì€ ì—¬ì „í•˜ë‹¤.</u> 

ì™œëƒí•˜ë©´ ì´ì œëŠ” ë©”ëª¨ë¦¬ì˜ ë¶€ì¡±ì„ ëŠë‚„ ìƒí™© ìì²´ê°€ ë§¤ìš° í¬ë°•í•˜ê¸° ë•Œë¬¸ì´ë‹¤.

ë˜í•œ `ì‹œê°„`ì€ ìš°ì£¼ì ì¸ ê´€ì ì—ì„œ ë´ë„ `ì ˆëŒ€ì ì¸ ê°€ì¹˜`ë¡œ, ì‹œê°„ì€ ê·¸ ì–´ë–¤ê²ƒì„ ì£¼ê³ ë„ ì‚´ ìˆ˜ ì—†ì§€ë§Œ, ë©”ëª¨ë¦¬ëŠ” ëˆì£¼ê³  ì‚¬ì„œ ì¦ì„¤í•  ìˆ˜ ìˆë‹¤.

&nbsp;  

ê²°êµ­ ì„œë¹„ìŠ¤ë¥¼ ìš´ì˜í•˜ëŠ” íšŒì‚¬ ì…ì¥ì—ì„œ ê³ ê°ì´ ëŠë¼ëŠ” ì‘ë‹µì†ë„ì˜ ì €í•˜ëŠ” êµ‰ì¥íˆ ì»¤ë‹¤ë€ ì´ìŠˆì„ê³¼ ë™ì‹œì—,

<u>ìš´ì˜ ë°ì´í„°ë² ì´ìŠ¤ì— ë§ì€ ë¶€í•˜ê°€ ê±¸ë¦°ë‹¤ëŠ” ê²ƒì€ ì „ì²´ ì„œë¹„ìŠ¤ì˜ ë‹¤ìš´ì´ë¼ëŠ” ìµœì•…ì˜ ìƒí™©ì„ ì´ˆë˜í• ìˆ˜ë„ ìˆê¸° ë•Œë¬¸ì— ê²°ê³¼ì ìœ¼ë¡œ ì •ê·œí™”ë¥¼ í•˜ì§€ ì•ŠëŠ” ìª½ìœ¼ë¡œ ê°€ëŠ” ê²ƒ ê°™ë‹¤.</u>

&nbsp;  

**"ê·¸ë˜ì„œ ê°’ íƒ€ì… ì´ì•¼ê¸° í•˜ë‹¤ ë§ê³  ëœ¬ê¸ˆì—†ì´ ì™œ ì •ê·œí™” íƒ€ë ¹ì´ëƒ?"** ë¼ëŠ” ìƒê°ì´ ë“¤ìˆ˜ë„ ìˆë‹¤.

&nbsp;  

ìœ„ì˜ ì´ìœ ë¡œ ì¸í•´ <u>í…Œì´ë¸” ì •ê·œí™”ë¥¼ í•˜ì§€ ì•ŠìŒìœ¼ë¡œì„œ ì‹¤ë¬´ì—ì„œ ë³´ëŠ” í…Œì´ë¸”ë“¤ì€ ì»¬ëŸ¼ì´ ìˆ˜ì‹­ê°œ ì´ìƒì¸ ê²½ìš°ê°€ êµ‰ì¥íˆ ë§ë‹¤.</u>

ì´ë¥¼ ì—”í‹°í‹° í´ë˜ìŠ¤ì™€ ë§¤í•‘í•˜ê²Œ ë˜ë©´ í…Œì´ë¸”ì˜ ì»¬ëŸ¼ê³¼ ì—”í‹°í‹° í´ë˜ìŠ¤ì˜ í•„ë“œëŠ” ì¼ëŒ€ì¼ë¡œ ë§¤í•‘ë˜ë¯€ë¡œ

ì—”í‹°í‹° í´ë˜ìŠ¤ì˜ í•„ë“œë„ ìˆ˜ì‹­ê°œ ì´ìƒì´ ë˜ëŠ” ê²½ìš°ê°€ êµ‰ì¥íˆ í”í•˜ë‹¤.

&nbsp;

ë¬¸ì œëŠ” `ORM`ì„ ì‹¤ìš©ì ìœ¼ë¡œ ì‚¬ìš©í•  ê²½ìš° ORM íŠ¹ì„±ìƒ ì—”í‹°í‹° í´ë˜ìŠ¤ê°€ `PM(Persistence Model)`ê³¼ `DM(Domain Model)`ì˜ ì—­í• ì„ ê°™ì´í•˜ê²Œ ëœë‹¤ëŠ” ê²ƒì—ì„œ ë°œìƒí•œë‹¤.

&nbsp;  

`JPA`ë¥¼ `ORM`ë‹µê²Œ ì‚¬ìš©í•  ê²½ìš° `ì„œë¹„ìŠ¤ ë ˆì´ì–´(Service Layer)`ì—ëŠ” ì½”ë“œê°€ ë³„ë¡œ ì—†ê³ , `ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§`ì´ ì—”í‹°í‹° í´ë˜ìŠ¤ì•ˆì— ë“¤ì–´ìˆê¸° ë•Œë¬¸ì— ì„œë¹„ìŠ¤ í´ë˜ìŠ¤ëŠ” ì¼ì¢…ì˜ `í¼ì‚¬ë“œ(Facade)`ì²˜ëŸ¼ ë³€í•˜ê²Œ ëœë‹¤.

ì´ê²Œ ë¬´ìŠ¨ ë§ì´ëƒë©´, ì¤‘ìš”í•œ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ë“¤ì„ ê°ê°ì˜ ì—”í‹°í‹° í´ë˜ìŠ¤ê°€ ê°–ê³ ìˆëŠ” ìƒíƒœì—ì„œ ì„œë¹„ìŠ¤ í´ë˜ìŠ¤ëŠ” ì—”í‹°í‹°ë“¤ì„ í•œë° ëª¨ì•„ í•˜ë‚˜ì˜ `íŠ¸ëœì­ì…˜(Transaction)`ìœ¼ë¡œ ë¬¶ì–´ì¤Œê³¼ ë™ì‹œì— `íë¦„ì œì–´`ë¥¼ í•˜ëŠ” ì—­í• ì„ ë§¡ê²Œë¨ì„ ë§í•œë‹¤.

&nbsp;  

> ì´ì— ëŒ€í•œ ìì„¸í•œ ì˜ˆì œê°€ ê¶ê¸ˆí•˜ë‹¤ë©´ [ê¹ƒí—ˆë¸Œ](https://github.com/shirohoo/jpa)ë¥¼ ì°¸ê³ í•˜ì‹œê¸° ë°”ëë‹ˆë‹¤.

&nbsp;  

ì´ëŸ¬í•œ ì´ìœ ë¡œ ì•ˆê·¸ë˜ë„ ì—”í‹°í‹° í´ë˜ìŠ¤ì—ëŠ” êµ‰ì¥íˆ ë§ì€ ì½”ë“œê°€ ë“¤ì–´ìˆëŠ”ë°, í•„ë“œë§ˆì € ìˆ˜ì‹­ê°œë¼ë©´ ì—”í‹°í‹° í´ë˜ìŠ¤ ë‚´ë¶€ì˜ ë³µì¡ë„ëŠ” ìƒìƒì„ ì´ˆì›”í•˜ê²Œ ì»¤ì§ˆìˆ˜ ìˆë‹¤.

ê·¸ë˜ì„œ ì´ ê²½ìš° ì—”í‹°í‹° ë‚´ë¶€ í•„ë“œë“¤ì˜ ê³µí†µì ì„ ì°¾ì•„ ë³„ë„ì˜ í´ë˜ìŠ¤ë¡œ ë½‘ì•„ë‚´ëŠ” ì‘ì—…ì„ í•˜ê²Œëœë‹¤.

ì´ ë•Œ `ê°’ íƒ€ì…`ì„ ì‚¬ìš©í•˜ê²Œ ëœë‹¤ê³  ì´í•´í•˜ë©´ ë  ê²ƒ ê°™ë‹¤.

&nbsp;  

ì‚¬ìš© ë°©ë²•ì€ ë§¤ìš° ê°„ë‹¨í•˜ë‹¤.

&nbsp;  

```java
// file: 'Customer.java'
@Entity
@Getter
@ToString(callSuper = true)
@NoArgsConstructor(access = AccessLevel.PROTECTED)
@RequiredArgsConstructor(access = AccessLevel.PRIVATE)
public class Customer extends BaseEntity {
    @NonNull
    private String firstName;

    @NonNull
    private String lastName;

    @NonNull
    private String phoneNumber;

    @NonNull
    private String city;

    @NonNull
    private String street;

    @NonNull
    private String zipcode;

    @Builder
    public static Customer of(@NonNull String firstName,
                              @NonNull String lastName,
                              @NonNull String phoneNumber,
                              @NonNull String city,
                              @NonNull String street,
                              @NonNull String zipcode) {
        return new Customer(firstName, lastName, phoneNumber, city, street, zipcode);
    }

    public String getName() {
        return firstName + " " + lastName;
    }

    public String getAddress() {
        return city + " " + street + " " + zipcode;
    }
}
```

&nbsp;  

ì»¤ë¨¸ìŠ¤ ì‚¬ì´íŠ¸ì—ì„œ ì‚¬ìš©í• ë§Œí•œ ì˜ˆì œ í´ë˜ìŠ¤ë¥¼ ì‘ì„±í–ˆë‹¤.

ê³ ê°ì— ëŒ€í•œ í•„ìˆ˜ ì •ë³´ë¼ê³  í• ë§Œí•œ ê²ƒë“¤ë§Œ ë„£ì—ˆìŒì—ë„ ë²Œì¨ ì½”ë“œê°€ ê½¤ ê¸¸ì–´ì ¸ìˆë‹¤.

ë‹¨ìˆœ ì˜ˆì œì¡°ì°¨ ì´ì •ë„ì˜ ê¸¸ì´ì¸ë°, ì‹¤ë¬´ì—ì„œëŠ” ì–¼ë§ˆë‚˜ ë” ê¸¸ì§€ ìƒìƒí•´ë³´ë©´ ë  ê²ƒ ê°™ë‹¤.

ê·¸ëŸ¼ ì´ì œ `Customer`ë¥¼ ê°’ íƒ€ì…ì„ ì´ìš©í•´ì„œ ë¦¬íŒ©í† ë§í•´ë³´ê² ë‹¤.

&nbsp;  

```java
// file: 'Customer.java'
@Entity
@Getter
@ToString(callSuper = true)
@NoArgsConstructor(access = AccessLevel.PROTECTED)
@RequiredArgsConstructor(access = AccessLevel.PRIVATE)
public class Customer extends BaseEntity {
    @NonNull
    private Name name;

    @NonNull
    private String phoneNumber;

    @NonNull
    private Address address;

    @Builder
    public static Customer of(@NonNull Name name, @NonNull String phoneNumber, @NonNull Address address) {
        return new Customer(name, phoneNumber, address);
    }

    public void changeAddress(String address) {
        this.address.changeAddress(address);
    }
}
```

&nbsp;  

```java
// file: 'Address.java'
@Getter
@ToString
@Embeddable
@EqualsAndHashCode
@Access(AccessType.FIELD)
@NoArgsConstructor(access = AccessLevel.PROTECTED)
@RequiredArgsConstructor(access = AccessLevel.PRIVATE)
public class Address {
    @NonNull
    private String city;

    @NonNull
    private String street;

    @NonNull
    private String zipcode;

    @Builder
    public static Address of(@NonNull String city, @NonNull String street, @NonNull String zipcode) {
        return new Address(city, street, zipcode);
    }

    public String getAddress() {
        return city + " " + street + " " + zipcode;
    }

    public void changeAddress(String address) {
        String[] s = address.split(" ");
        if(s.length != 3) {
            throw new IllegalArgumentException("ì…ë ¥ ì£¼ì†Œê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.");
        }
        this.city = s[0];
        this.street = s[1];
        this.zipcode = s[2];
    }
}
```

&nbsp;  

```java
// file: 'Name.java'
@Getter
@ToString
@Embeddable // ê°’ íƒ€ì…ì„ì„ ì„ ì–¸
@EqualsAndHashCode
@Access(AccessType.FIELD) // JPAê°€ ì ‘ê·¼ì ë§¤í•‘ìœ¼ë¡œ ì˜¤í•´í•˜ë¯€ë¡œ í•„ë“œ ë§¤í•‘ì„ì„ ëª…ì‹œí•˜ì—¬ ì»´íŒŒì¼ ì—ëŸ¬ ë°©ì§€
@NoArgsConstructor(access = AccessLevel.PROTECTED)
@RequiredArgsConstructor(access = AccessLevel.PRIVATE)
public class Name {
    @NonNull
    private String firstName;

    @NonNull
    private String lastName;

    @Builder
    public static Name of(@NonNull String firstName, @NonNull String lastName) {
        return new Name(firstName, lastName);
    }

    public String getName() {
        return firstName + " " + lastName;
    }
}
```

&nbsp;  

ì´ë ‡ê²Œ ê°’ íƒ€ì…ìœ¼ë¡œ ì‚¬ìš©í•  í´ë˜ìŠ¤ì— `@Embeddable`ì„ ì„ ì–¸í•˜ì—¬ JPAì— ê°’ íƒ€ì…ì„ì„ ì•Œë ¤ì£¼ê³ , ì´ í´ë˜ìŠ¤ë¥¼ ì—”í‹°í‹° í´ë˜ìŠ¤ì— í¬í•¨ì‹œì¼œ ì‚¬ìš©í•˜ë©´ ëœë‹¤.

ì±…ì—ì„œëŠ” ì—”í‹°í‹° í´ë˜ìŠ¤ì—ì„œ ê°’ íƒ€ì…ì„ ì‚¬ìš©í•  ë•Œ `@Embedded`ë¥¼ ì„ ì–¸í•˜ë„ë¡ ì í˜€ìˆì§€ë§Œ ì´ëŠ” ìƒëµí•´ë„ ì •ìƒì ìœ¼ë¡œ ì‘ë™í•˜ê¸° ë•Œë¬¸ì— ì‘ì„±í•˜ì§€ ì•Šì•˜ë‹¤.

ì´ë ‡ê²Œ ì‚¬ìš©í•¨ìœ¼ë¡œì¨ ì–»ëŠ” í•œê°€ì§€ ë” í° ì´ì ì€, <u>ê°’ íƒ€ì…ì€ í”„ë¡œì íŠ¸ ì „ì²´ ì—”í‹°í‹°ì—ì„œ ì¬ì‚¬ìš© í•  ìˆ˜ ìˆë‹¤ëŠ” ì ì´ë‹¤.</u>

`@MappedSuperclass`ì™€ `@Embeddable`ì„ ì ì ˆí•˜ê²Œ ì‚¬ìš©í•˜ë©´ êµ‰ì¥íˆ ë§ì€ ë¶€ë¶„ì„ ì¶”ìƒí™”í•˜ì—¬ ì¬ì‚¬ìš©í•˜ë„ë¡ ë³€ê²½í•  ìˆ˜ ìˆë‹¤.

ì´ëŠ” <u>ëª…ë°±íˆ ê°ì²´ì§€í–¥ì ì¸ ì ‘ê·¼ ë°©ë²•ì´ê¸°ë„ í•˜ê¸° ë•Œë¬¸ì— ORMì„ ì‚¬ìš©í•˜ëŠ” ê´€ì ì—ì„œ ë§¤ìš° ê¶Œì¥í• ë§Œí•œ ë°©ë²•ì´ë¼ê³  ë³¼ ìˆ˜ ìˆë‹¤ê³  ìƒê°</u>í•œë‹¤.

&nbsp;  

## ğŸ’¥ ì£¼ì˜ì 

---

ì–´ë–»ê²Œ ë³´ë©´ êµ‰ì¥íˆ ì–´ì´ì—†ëŠ” ì£¼ì˜ì ì¼ìˆ˜ë„ ìˆë‹¤.

ì™œëƒí•˜ë©´ ìë°”ë¥¼ ì‚¬ìš©í•˜ëŠ” ì…ì¥ì—ì„œ ë§¤ìš° ë‹¹ì—°í•œ ì¼ì´ê¸° ë•Œë¬¸ì´ë‹¤.

`ê°’ íƒ€ì…`ì€ ì˜¤ë¸Œì íŠ¸ì´ê¸° ë•Œë¬¸ì— `ì£¼ì†Œì°¸ì¡°`ë¥¼ í•˜ê²Œëœë‹¤.

&nbsp;  

`Call By Reference`, `Call By Value`

í˜¹ì€

`ì–•ì€ë³µì‚¬`, `ê¹Šì€ë³µì‚¬` ë¼ê³  ë¶ˆë¦¬ëŠ” ê°œë…ë“¤ì— ëŒ€í•œ ì´ì•¼ê¸°ë‹¤.

&nbsp;  

```java
// file: 'CustomerTest.java'
@DataJpaTest
class CustomerTest {
    @Autowired
    CustomerRepository repository;

    @Test
    void customer(){
        Name name = Name.of("firstName", "lastName");
        Address address = Address.of("city", "street", "zipcode");

        Customer customer1 = Customer.of(name, "01000000001", address);
        Customer customer2 = Customer.of(name, "01000000002", address);

        Customer saveCustomer1 = repository.save(customer1); // insert ì¿¼ë¦¬ ì‘ì„±(ì“°ê¸°ì§€ì—°)
        Customer saveCustomer2 = repository.save(customer2); // insert ì¿¼ë¦¬ ì‘ì„±(ì“°ê¸°ì§€ì—°)
        repository.flush(); // insert ì¿¼ë¦¬ ë‘ë²ˆ ë°œìƒ

        System.out.println("saveCustomer1 = " + saveCustomer1);
        System.out.println("saveCustomer2 = " + saveCustomer2);

        customer1.changeAddress("changeCity changeStreet changeZipcode"); // update ì¿¼ë¦¬ ë‘ë²ˆ ì‘ì„±(ì“°ê¸°ì§€ì—°)
        repository.flush(); // update ì¿¼ë¦¬ ë‘ë²ˆ ë°œìƒ

        System.out.println("changeCustomer1 = " + saveCustomer1);
        System.out.println("changeCustomer2 = " + saveCustomer2);
    }
}
```

&nbsp;  

ê°„ë‹¨í•˜ê³  ì§ê´€ì ì¸ í…ŒìŠ¤íŠ¸ ì½”ë“œë¥¼ ì‘ì„±í–ˆë‹¤.

`address`ë¥¼ ì¤‘ê°„ì— í•œë²ˆ ë³€ê²½í•˜ê²Œ ë˜ëŠ”ë°, ì´ ê²½ìš°ì— `address`ì˜ ì£¼ì†Œë¥¼ `customer1`ê³¼ `customer2`ê°€ ê³µìœ  ì°¸ì¡°í•˜ê³  ìˆìœ¼ë¯€ë¡œ ê°’ì´ í•¨ê»˜ ë³€í•œë‹¤.

&nbsp;  

ì‹¤í–‰ ê²°ê³¼ë¥¼ ë³´ì.

&nbsp;  

```shell
Hibernate: 
    insert 
    into
        customer
        (id, create_at, update_at, city, street, zipcode, first_name, last_name, phone_number) 
    values
        (null, ?, ?, ?, ?, ?, ?, ?, ?)
Hibernate: 
    insert 
    into
        customer
        (id, create_at, update_at, city, street, zipcode, first_name, last_name, phone_number) 
    values
        (null, ?, ?, ?, ?, ?, ?, ?, ?)
        
saveCustomer1 = Customer(super=BaseEntity(id=1, createAt=2021-07-12T22:31:06.759843, updateAt=2021-07-12T22:31:06.759843), name=Name(firstName=firstName, lastName=lastName), phoneNumber=01000000001, address=Address(city=city, street=street, zipcode=zipcode))
saveCustomer2 = Customer(super=BaseEntity(id=2, createAt=2021-07-12T22:31:06.798738400, updateAt=2021-07-12T22:31:06.798738400), name=Name(firstName=firstName, lastName=lastName), phoneNumber=01000000002, address=Address(city=city, street=street, zipcode=zipcode))

Hibernate: 
    update
        customer 
    set
        create_at=?,
        update_at=?,
        city=?,
        street=?,
        zipcode=?,
        first_name=?,
        last_name=?,
        phone_number=? 
    where
        id=?
Hibernate: 
    update
        customer 
    set
        create_at=?,
        update_at=?,
        city=?,
        street=?,
        zipcode=?,
        first_name=?,
        last_name=?,
        phone_number=? 
    where
        id=?
        
changeCustomer1 = Customer(super=BaseEntity(id=1, createAt=2021-07-12T22:31:06.759843, updateAt=2021-07-12T22:31:06.825667500), name=Name(firstName=firstName, lastName=lastName), phoneNumber=01000000001, address=Address(city=changeCity, street=changeStreet, zipcode=changeZipcode))
changeCustomer2 = Customer(super=BaseEntity(id=2, createAt=2021-07-12T22:31:06.798738400, updateAt=2021-07-12T22:31:06.826664100), name=Name(firstName=firstName, lastName=lastName), phoneNumber=01000000002, address=Address(city=changeCity, street=changeStreet, zipcode=changeZipcode))
```

&nbsp;  

`address`ë¥¼ í•œë²ˆë§Œ ë°”ê¿¨ì„ ë¿ì¸ë° ì´ë¥¼ ì°¸ì¡°í•˜ê³  ìˆëŠ” `customer1`ê³¼ `customer2`ì˜ `address` ê°’ì´ ë™ì‹œì— ë°”ë€Œì—ˆìŒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.

&nbsp;  

ì´ì™€ ê°™ì€ ìƒí™©ì„ `ì–•ì€ ë³µì‚¬`ë¼ê³  ë¶€ë¥¸ë‹¤.

ì‚¬ì‹¤ ìë°”ë¥¼ ê³µë¶€í•˜ê³  ìˆë‹¤ë©´ êµ‰ì¥íˆ ê¸°ì´ˆì ì¸ ë‚´ìš©ì´ê¸´ í•œë°, ë³µì¡í•œ ì‹¤ë¬´ìƒí™©ì—ì„œ ì´ëŸ° ë¬¸ì œê°€ ë°œìƒí•˜ë©´ ë””ë²„ê¹…ì´ ë§¤ìš°ë§¤ìš°ë§¤ìš°ë§¤ìš° ì–´ë µë‹¤.

`ê°’ íƒ€ì…`ì€ ê·¸ëƒ¥ JPAê´€ë ¨ ì–´ë…¸í…Œì´ì…˜ì´ ë¶™ì—ˆë‹¤ ë¿ì´ì§€, ë‹¨ìˆœíˆ ì˜¤ë¸Œì íŠ¸ íƒ€ì…ì˜ í•„ë“œì´ê¸° ë•Œë¬¸ì— ìœ„ì™€ ê°™ì€ ìë°”ì˜ ë¬¸ì œì ì´ ê·¸ëŒ€ë¡œ ì ìš©ëœë‹¤.

&nbsp;  

ì–´ë–»ê²Œ í•´ê²°í• ê¹Œ?

&nbsp;  

`ê¹Šì€ ë³µì‚¬`ë¥¼ ì‚¬ìš©í•˜ë©´ ëœë‹¤.

ë­ ì‹¤ì œë¡œ ì´ë ‡ê²Œ ê°’ íƒ€ì…ì„ ì‚¬ìš©í•˜ë©´ì„œ ê°’ì„ ë³µì‚¬í•´ì„œ ì“°ëŠ” ê²½ìš°ê°€ ì–¼ë§ˆë‚˜ ìˆì„ì§€ëŠ” ë‚˜ë„ ì˜ ëª¨ë¥´ê² ì§€ë§Œ, ì¼ë‹¨ ì•Œì•„ë‘ë©´ ë„ì›€ì´ ë  ê²ƒ ê°™ë‹¤.

ë‚˜ê°™ì€ ê²½ìš°ì—” `ë³µì‚¬ìš© ë©”ì„œë“œ`ë¥¼ ìƒì„±í•´ì„œ ì‚¬ìš©í•œë‹¤.

&nbsp;  

```java
// file: 'Address.java'
public Address newInstance() {
    return Address.builder()
                  .city(this.city)
                  .street(this.street)
                  .zipcode(this.zipcode)
                  .build();
}
```

&nbsp;  

```java
// file: 'CustomerTest.java'
@DataJpaTest
class CustomerTest {
    @Autowired
    CustomerRepository repository;

    @Test
    void customer(){
        Name name = Name.of("firstName", "lastName");
        Address address = Address.of("city", "street", "zipcode");

        Customer customer1 = Customer.of(name, "01000000001", address);
        Customer customer2 = Customer.of(name, "01000000002", address.newInstance()); // ê¹Šì€ ë³µì‚¬

        Customer saveCustomer1 = repository.save(customer1); // insert ì¿¼ë¦¬ ì‘ì„±(ì“°ê¸°ì§€ì—°)
        Customer saveCustomer2 = repository.save(customer2); // insert ì¿¼ë¦¬ ì‘ì„±(ì“°ê¸°ì§€ì—°)
        repository.flush(); // insert ì¿¼ë¦¬ ë‘ë²ˆ ë°œìƒ

        System.out.println("saveCustomer1 = " + saveCustomer1);
        System.out.println("saveCustomer2 = " + saveCustomer2);

        customer1.changeAddress("changeCity changeStreet changeZipcode"); // update ì¿¼ë¦¬ í•œë²ˆ ì‘ì„±(ì“°ê¸°ì§€ì—°)
        repository.flush(); // update ì¿¼ë¦¬ í•œë²ˆ ë°œìƒ

        System.out.println("changeCustomer1 = " + saveCustomer1);
        System.out.println("changeCustomer2 = " + saveCustomer2);
    }
}
```

&nbsp;  

ê²°ê³¼ë¥¼ í™•ì¸í•œë‹¤.

&nbsp;  

```shell
Hibernate: 
    insert 
    into
        customer
        (id, create_at, update_at, city, street, zipcode, first_name, last_name, phone_number) 
    values
        (null, ?, ?, ?, ?, ?, ?, ?, ?)
Hibernate: 
    insert 
    into
        customer
        (id, create_at, update_at, city, street, zipcode, first_name, last_name, phone_number) 
    values
        (null, ?, ?, ?, ?, ?, ?, ?, ?)
        
saveCustomer1 = Customer(super=BaseEntity(id=1, createAt=2021-07-12T22:45:36.286366900, updateAt=2021-07-12T22:45:36.286366900), name=Name(firstName=firstName, lastName=lastName), phoneNumber=01000000001, address=Address(city=city, street=street, zipcode=zipcode))
saveCustomer2 = Customer(super=BaseEntity(id=2, createAt=2021-07-12T22:45:36.335236400, updateAt=2021-07-12T22:45:36.335236400), name=Name(firstName=firstName, lastName=lastName), phoneNumber=01000000002, address=Address(city=city, street=street, zipcode=zipcode))

Hibernate: 
    update
        customer 
    set
        create_at=?,
        update_at=?,
        city=?,
        street=?,
        zipcode=?,
        first_name=?,
        last_name=?,
        phone_number=? 
    where
        id=?
        
changeCustomer1 = Customer(super=BaseEntity(id=1, createAt=2021-07-12T22:45:36.286366900, updateAt=2021-07-12T22:45:36.367150), name=Name(firstName=firstName, lastName=lastName), phoneNumber=01000000001, address=Address(city=changeCity, street=changeStreet, zipcode=changeZipcode))
changeCustomer2 = Customer(super=BaseEntity(id=2, createAt=2021-07-12T22:45:36.335236400, updateAt=2021-07-12T22:45:36.335236400), name=Name(firstName=firstName, lastName=lastName), phoneNumber=01000000002, address=Address(city=city, street=street, zipcode=zipcode))
```

&nbsp;  

`customer1` ì˜ ê°’ë§Œ ì•ˆì „í•˜ê²Œ ë³€ê²½ë˜ê³ , `update` ì¿¼ë¦¬ ë˜í•œ í•œë²ˆë§Œ ë°œìƒí•œ ê²ƒì„ í™•ì¸ í•  ìˆ˜ ìˆë‹¤.

&nbsp;
