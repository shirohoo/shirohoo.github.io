---
layout: post
category:
  - spring
  - spring-data-jpa
title: JPA ì¤‘ê¸‰ 1 - Querydsl
description: |
  `Querydsl`ì€ `JPQL` ë¹Œë”ì…ë‹ˆë‹¤.
image: /assets/img/spring/spring-data-jpa/hibernate.jpg
related_posts:
  - _posts/spring/spring-data-jpa/2021-07-22-jpa-8.md
published: true
---

* toc
{:toc}
  
<br />

> ì´ í¬ìŠ¤íŒ…ì˜ ëŒ€ë¶€ë¶„ ë‚´ìš©ì€ `ê¹€ì˜í•œ`ë‹˜ì˜ [ì‹¤ì „! Querydsl](https://www.inflearn.com/course/Querydsl-%EC%8B%A4%EC%A0%84/){:target="_blank"}ì„ ì°¸ê³ í•˜ì—¬ ì‘ì„±ëìœ¼ë©°, ê°„ë‹¨í•œ ì‚¬ìš©ë²•ì— ëŒ€í•œ ì˜ˆì œì¼ ë¿ì´ë‹ˆ ë” ê¹Šì€ ë‚´ìš©ì´ ê¶ê¸ˆí•˜ì‹ ë¶„ì€ ê°•ì˜ë¥¼ ë³´ì„¸ìš”.

# ğŸ“• Querydsl

---

`Querydsl`ì€ `JPQL ë¹Œë”` ì—­í• ì„ í•˜ëŠ” ë¹„í‘œì¤€ ì˜¤í”ˆì†ŒìŠ¤ í”„ë¡œì íŠ¸ì´ë‹¤.

JPA í‘œì¤€ ë¹Œë”ëŠ” `JPA Criteria`ì¸ë°, ì´ê²ƒì€ ë„ˆë¬´ ì¥í™©í•˜ê³  ê°€ë…ì„±ì´ ì¢‹ì§€ ì•Šê¸° ë•Œë¬¸ì— ë¹„ë¡ í‘œì¤€ì€ ì•„ë‹ˆì§€ë§Œ `Querydsl`ì„ ì‚¬ìš©í•œë‹¤.

`Querydsl`ì´ ë„ˆë¬´ í›Œë¥­í•˜ê¸° ë•Œë¬¸ì— `spring-data` í”„ë¡œì íŠ¸ì—ì„œë„ ë§ì€ ì§€ì›ì´ ë˜ê³  ìˆëŠ”ë°, ê·¼ì‹œì¼ë‚´ì— í‘œì¤€ìœ¼ë¡œ ìë¦¬ì¡ì§€ ì•Šì„ê¹Œ ì¡°ì‹¬ìŠ¤ë ˆ ì˜ˆìƒí•´ë³¸ë‹¤.

<br />

`Querydsl`ì„ ì™œ ì‚¬ìš©í• ê¹Œ? 

<br />

JPQLì„ ì§ì ‘ ì‚¬ìš©í•˜ê²Œ ë˜ë©´ ë¬¸ìì—´ì„ ì§ì ‘ íƒ€ì´í•‘í•´ì•¼ í•œë‹¤ëŠ” í° ë‹¨ì ì´ ì¡´ì¬í•œë‹¤. 

`Ibatis`ë‚˜ `Mybatis`ë¥¼ ì‚¬ìš©í•´ë³´ì‹ ë¶„ì€ ì•Œê² ì§€ë§Œ, ì¿¼ë¦¬ë¥¼ ì§ì ‘ íƒ€ì´í•‘í•œë‹¤ëŠ” ê²ƒì€ êµ‰ì¥íˆ ì•ˆì •ì„±ì´ ë–¨ì–´ì§€ëŠ” ì‘ì—…ì´ë¼ê³  ë³¼ ìˆ˜ ìˆë‹¤.

ë‹¤ìŒ JPQLì„ ë³´ì.

<br />

```java
String query = "    select \n" +
               "        m.id\n" +
               "        t.id\n" +
               "        m.create_at\n" +
               "        m.update_at\n" +
               "        m.age\n" +
               "        m.name\n" +
               "        m.team_id\n" +
               "        t.create_at\n" +
               "        t.update_at\n" +
               "        t.name\n" +
               "    from\n" +
               "        member m \n" +
               "    inner join\n" +
               "        team t \n" +
               "            on m.team_id=t.id";
```

<br />

ëˆˆì°ë¯¸ê°€ ì¢‹ìœ¼ì‹ ë¶„ì€ ì•Œì•„ì°¨ë¦¬ì…¨ì„ìˆ˜ë„ ìˆê² ì§€ë§Œ, ìœ„ JPQLì—ëŠ” ë²„ê·¸ê°€ìˆë‹¤.

ë­˜ê¹Œ?

<br />

```java
String query = "    select \n" + // <-- select ë’¤ì— ë„ì–´ì“°ê¸°ê°€ ìˆìŒ
               "        m.id\n" +
               "        t.id\n" +
               "        m.create_at\n" +
               "        m.update_at\n" +
               "        m.age\n" +
               "        m.name\n" +
               "        m.team_id\n" +
               "        t.create_at\n" +
               "        t.update_at\n" +
               "        t.name\n" +
               "    from\n" +
               "        member m \n" +
               "    inner join\n" +
               "        team t \n" +
               "            on m.team_id=t.id";
```

<br />

ìœ„ì²˜ëŸ¼ JPQLì— ë²„ê·¸ê°€ ì¡´ì¬í•˜ëŠ” ìƒíƒœë¡œ ì–´í”Œë¦¬ì¼€ì´ì…˜ì´ ì‹¤í–‰ì´ ëœë‹¤ëŠ”ê²Œ ê°€ì¥ í° ë¬¸ì œì ì´ë‹¤. (ì»´íŒŒì¼ íƒ€ì„ì— ì—ëŸ¬ê°€ ì¡íˆì§ˆ ì•ŠëŠ”ë‹¤ ! ğŸ˜±)

ì¦‰, ë°°í¬ê°€ ì™„ë£Œëœ í›„ ì‚¬ìš©ìê°€ ì–´ë–¤ ê¸°ëŠ¥ì„ ì‚¬ìš©í•˜ì—¬ í•´ë‹¹ JPQLì´ í¬í•¨ëœ ë©”ì„œë“œê°€ ëŸ°íƒ€ì„ì— í˜¸ì¶œë˜ê³  ë‚˜ì„œì•¼ ë²„ê·¸ê°€ ì¡´ì¬í•¨ì„ ì•Œ ìˆ˜ ìˆë‹¤ëŠ” ê²ƒì´ë‹¤.

ì‹¤ë¬´ì—ì„œ ì´ëŸ° ìƒí™©ì€ ì¦‰ì‹œ ëŒ€ì²˜ì— ë“¤ì–´ê°€ì•¼í•˜ëŠ” í•«í”½ìŠ¤ ì‘ì—…ì´ë©°, ì„œë¹„ìŠ¤ì— ëŒ€í•œ ì‚¬ìš©ìì˜ ì‹ ë¢°ì„±ì´ ë–¨ì–´ì§€ëŠ” ê²°ê³¼ê¹Œì§€ë„ ì•¼ê¸°í•  ìˆ˜ ìˆë‹¤.

ì‹¬ì§€ì–´ ì›ì¸ì´ ì˜¤íƒ€ë¼ëŠ”, ëˆ„êµ¬ë‚˜ ì‰½ê²Œ ì €ì§€ë¥¼ ìˆ˜ ìˆëŠ” ì‹¤ìˆ˜ì´ê³  ë””ë²„ê¹… ë˜í•œ êµ‰ì¥íˆ í˜ë“¤ê¸° ë•Œë¬¸ì— êµ‰ì¥íˆ ì§ˆì´ ì¢‹ì§€ ì•Šì€ ë²„ê·¸ë¼ê³  ë³¼ ìˆ˜ ìˆì„ ê²ƒ ê°™ë‹¤.

<br />

ë˜í•œ, ìœ„ì™€ ë¹„ìŠ·í•˜ì§€ë§Œ ì½”ë“œë¥¼ ì‘ì„±í•˜ëŠ” ê°œë°œì ê´€ì ì—ì„œ ë´¤ì„ ë•Œ ìë°” ì»´íŒŒì¼ëŸ¬ì™€ IDEì˜ ë„ì›€ì„ ë°›ì„ ìˆ˜ ì—†ë‹¤ëŠ” ë¬¸ì œë„ ìˆë‹¤.

ì¦‰, ì½”ë“œë¥¼ ì‘ì„±í•˜ë‹¤ ì˜ ê¸°ì–µì´ ë‚˜ì§€ ì•ŠëŠ”ë‹¤ë©´ ê´€ë ¨ ë¬¸ì„œë¥¼ ê³„ì†í•´ì„œ ì°¾ì•„ì•¼ë§Œ í•œë‹¤. ì‹¤ìˆ˜ê°€ ë‚˜ì˜¬ ê°€ëŠ¥ì„±ë„ ë§¤ìš° ë†’ë‹¤.

ê·¸ë¦¬ê³  ê°€ë…ì„±ì´ ë§¤ìš° ë–¨ì–´ì§„ë‹¤ëŠ” ë¬¸ì œë„ ìˆë‹¤.

ìë°” 13ì´í›„ë¡œ ë¬¸ìì—´ ë¸”ë¡ì´ë¼ëŠ” ê¸°ëŠ¥ì´ ìƒê²¨ì„œ ë‹¤ìŒê³¼ ê°™ì€ ì½”ë“œ ì‘ì„±ì´ ê°€ëŠ¥í•˜ê¸´ í•œë°, ì•„ì§ì€ ìë°”8ì´ ê°€ì¥ ë§ì´ ì‚¬ìš©ë˜ê³  ìˆê³  ì´ì œì•¼ ìë°” 11ë¡œ ë„˜ì–´ê°€ê³  ìˆëŠ” ì¶”ì„¸ì´ê¸° ë•Œë¬¸ì— ë¨¼ ì´ì•¼ê¸°ë‹¤.

<br />

```java
String query = """
                select
                    m.id
                    t.id
                    m.create_at
                    m.update_at
                    m.age
                    m.name
                    m.team_id
                    t.create_at
                    t.update_at
                    t.name
                from
                    member m
                inner join
                    team t
                        on m.team_id=t.id";
               """;
```

<br />

`Querydsl`ì€ ì´ëŸ¬í•œ ë‹¨ì ì„ ëª¨ë‘ ë³´ì™„í•´ì¤€ë‹¤.

ì¼ë‹¨ ìœ„ì˜ JPQLì„ Querydslë¡œ ì‘ì„±í•œ ì˜ˆë¥¼ ë³´ì.

<br />

```java
queryFactory
        .selectFrom(member)
        .join(member.team, team)
        .fetch();
```

<br />

ë³´ë‹¤ì‹œí”¼ ì–´ë–¤ ì¿¼ë¦¬ê°€ ë°œìƒí• ì§€ í•œëˆˆì— íŒŒì•…í•  ìˆ˜ ìˆë‹¤. 

êµ‰ì¥íˆ ê°€ë…ì„±ì´ ì¢‹ìœ¼ë©°, ë¬¸ìì—´ ì‚¬ìš©ì„ ìµœì†Œí™”ê³  ë¹Œë” íŒ¨í„´ìœ¼ë¡œ ì‘ì„±ë˜ê¸° ë•Œë¬¸ì— ìë°” ì»´íŒŒì¼ëŸ¬ì™€ IDEì˜ ë„ì›€ì„ ëª¨ë‘ ë°›ì„ ìˆ˜ ìˆë‹¤.

ì¦‰, ì¿¼ë¦¬ì— ë¬¸ì œê°€ ìˆë‹¤ë©´ ì•„ì˜ˆ ì»´íŒŒì¼ ì—ëŸ¬ê°€ ë°œìƒí•˜ì—¬ ì‹¤í–‰ìì²´ê°€ ì•ˆë¨ê³¼ ë™ì‹œì— ì–´ë””ì— ì–´ë–¤ ë¬¸ì œê°€ ìˆëŠ”ì§€ ì—ëŸ¬ ë©”ì‹œì§€ë¥¼ ë°›ì•„ë³¼ ìˆ˜ ìˆìœ¼ë©°, ë‹¤ìŒê³¼ ê°™ì´ IDE ìë™ì™„ì„±ì˜ ì´ì ë„ ëª¨ë‘ ëˆ„ë¦´ ìˆ˜ ìˆë‹¤.

<br />

![image](https://user-images.githubusercontent.com/71188307/127761702-5673aea9-5eb6-48f9-a426-1b40d2466c70.png)

<br />

ì´ì¯¤í•˜ë©´ ì™œ `Querydsl`ì„ ì‚¬ìš©í•˜ëŠ”ì§€ì— ëŒ€í•œ ë‚©ë“ì´ ë˜ì—ˆì„ ê²ƒ ê°™ë‹¤.

í•˜ì§€ë§Œ `Querydsl`ì€ ë‹¨ìˆœíˆ `JPQL ë¹Œë”`ì´ê¸° ë•Œë¬¸ì—, JPQLë¡œ ì•ˆë˜ëŠ” ê²ƒì€ Querydslì—ì„œë„ ì•ˆëœë‹¤.

`Querydsl`ì€ ì ˆëŒ€ ë§ŒëŠ¥ì´ ì•„ë‹ˆë©°, ìš©ë¹¼ëŠ” ì¬ì£¼ê°€ ìˆëŠ”ê²Œ ì•„ë‹ˆë‹¤.

`Querydsl`ì€ ë‹¨ìˆœíˆ `JPQL ë¹Œë”`ë¼ëŠ” ê²ƒì„ ëª…ì‹¬í•´ì•¼ í•œë‹¤. 

<br />

# ğŸš€ í™˜ê²½ì„¤ì •

---

ë¹Œë“œ ìŠ¤í¬ë¦½íŠ¸ì— ëŒ€í•œ ì„¸ë¶€ì ì¸ ë‚´ìš©ì´ ê¶ê¸ˆí•˜ì‹  ë¶„ì€ í•˜ê¸° í¬ìŠ¤íŒ…ì„ ì°¸ê³ í•´ì£¼ì„¸ìš”.

> [ğŸ“œ ê·¸ë ˆì´ë“¤ Annotation processor ì™€ Querydsl](http://honeymon.io/tech/2020/07/09/gradle-annotation-processor-with-querydsl.html)

<br />

<u>ìš°ì„  ì´ ì„¸íŒ…ì€ 2021.07.31 í˜„ì¬ Querydsl ìµœì‹  ë²„ì „ì„ ê¸°ì¤€ìœ¼ë¡œ í•˜ì—¬ ì‘ì„±ë¨ì„ ë§ì”€ë“œë¦°ë‹¤.</u> 

í”„ë¡œì íŠ¸ì— ì ìš©ëœ `Querydsl ë²„ì „`ì€ `4.4.0`ì´ë©°, `gradle ë²„ì „`ì€ `6.8.3`ì´ë‹¤.

<br />

<u>ë²„ì „ì„ ë¨¼ì € ì–¸ê¸‰í•˜ëŠ” ì´ìœ ê°€ ìˆëŠ”ë°, Querydsl 3.xëŒ€ ë²„ì „ê³¼ 4.xëŒ€ ë²„ì „ ì‚¬ì´ì— ìƒë‹¹í•œ ì°¨ì´ê°€ ìˆê¸° ë•Œë¬¸</u>ì´ë‹¤.

<br />

ë˜í•œ, `Querydsl`ì„ ì‚¬ìš©í•˜ê¸° ìœ„í•´ì„œëŠ” `JPA Entity`ë¥¼ `QClass`ë¼ëŠ” ê²ƒìœ¼ë¡œ ì»´íŒŒì¼ í•´ì•¼ í•˜ëŠ”ë°, ì—¬ê¸°ì„œ `annotationProcessor`ì™€ `gradle`ì˜ ë„ì›€ì´ í•„ìš”í•˜ê¸° ë•Œë¬¸ì´ë‹¤.

<br />

í•„ìˆ˜ì ì¸ ì„¤ì •ì€ ë‹¤ìŒê³¼ ê°™ë‹¤.

<br />

```groovy
ext {
    querydslDir = "$buildDir/generated/querydsl"
}

dependencies {
  annotationProcessor(
          'org.springframework.boot:spring-boot-configuration-processor',
          'jakarta.persistence:jakarta.persistence-api',
          'jakarta.annotation:jakarta.annotation-api',
          "com.querydsl:querydsl-apt:${dependencyManagement.importedProperties['querydsl.version']}:jpa",
  )

  implementation(
          'com.querydsl:querydsl-jpa',
  )
}
```

<br />

ì´ í¬ìŠ¤íŒ…ì„ ì‘ì„±í•˜ê¸° ìœ„í•´ êµ¬ì„±í•œ í”„ë¡œì íŠ¸ì˜ ì „ì²´ì ì¸ ë¹Œë“œ ìŠ¤í¬ë¦½íŠ¸ëŠ” ë‹¤ìŒê³¼ ê°™ë‹¤.

<br />

```groovy
plugins {
    id 'java'
    id 'org.springframework.boot' version '2.5.2'
    id 'io.spring.dependency-management' version '1.0.11.RELEASE'
}

ext {
    querydslDir = "$buildDir/generated/querydsl"
}

group = 'learn.jpa'
version = ''
sourceCompatibility = '11'

repositories {
    mavenCentral()
}

configurations {
    developmentOnly
    runtimeClasspath {
        extendsFrom developmentOnly
    }
}

dependencies {
    annotationProcessor(
            'org.projectlombok:lombok',
            'org.springframework.boot:spring-boot-configuration-processor',
            'jakarta.persistence:jakarta.persistence-api',
            'jakarta.annotation:jakarta.annotation-api',
            "com.querydsl:querydsl-apt:${dependencyManagement.importedProperties['querydsl.version']}:jpa",
    )

    implementation(
            'org.springframework.boot:spring-boot-starter-web',
            'org.springframework.boot:spring-boot-starter-data-jpa',
            'org.springframework.boot:spring-boot-starter-validation',
            'com.querydsl:querydsl-jpa',
    )

    testImplementation(
            'org.springframework.boot:spring-boot-starter-test',
    )

    testImplementation("org.springframework.boot:spring-boot-starter-test") {
        exclude group: "junit", module: "junit"
    }

    compileOnly(
            'org.projectlombok:lombok'
    )

    runtimeOnly(
            'com.h2database:h2'
    )
}

test {
    useJUnitPlatform()
}

clean {
    delete file('src/main/generated')
}

task cleanGeneatedDir(type: Delete) {
    delete file('src/main/generated')
}
```

<br />

ìœ„ ì½”ë“œê°€ ë­”ì§€ ëª°ë¼ë„ ì¼ë‹¨ í•„ìˆ˜ ì„¤ì •ë§Œ ë˜‘ê°™ì´ ì‘ì„±í•˜ë©´ `Querydsl`ì„ ì‚¬ìš©í•˜ëŠ”ë° í° ë¬¸ì œëŠ” ì—†ì„ ê²ƒ ê°™ë‹¤.

ë§Œì•½ ìœ„ ì½”ë“œê°€ ë” ê¶ê¸ˆí•˜ë‹¤ë©´ `groovy`ì™€ `gradle`ì— ëŒ€í•œ ê³µë¶€ê°€ í•„ìš”í•  ê²ƒì´ë‹¤.

<br />

ê·¸ë¦¬ê³  Querydsl 4.xì—ì„œ `JPAQueryFactory`ê°€ í•µì‹¬ì ì¸ ì—­í• ì„ í•˜ëŠ”ë°, ì´ í´ë˜ìŠ¤ë¥¼ ìŠ¤í”„ë§ ë¹ˆìœ¼ë¡œ ë§Œë“¤ê¸° ìœ„í•´ ë‹¤ìŒê³¼ ê°™ì€ ì„¤ì •íŒŒì¼ì„ ì‘ì„±í•œë‹¤.  

í•„ìëŠ” Querydslì´ JPA ë„ë©”ì¸ì— í¬í•¨ëœë‹¤ê³  íŒë‹¨í•˜ì—¬ JPA ì„¤ì •íŒŒì¼ì— ì´ ì„¤ì •ì„ ì§‘ì–´ë„£ëŠ”ë‹¤.

<br />

```java
@Configuration
@EnableJpaAuditing
public class JpaConfig {
    @PersistenceContext
    private EntityManager entityManager;

    @Bean
    public JPAQueryFactory jpaQueryFactory() {
        return new JPAQueryFactory(entityManager);
    }
}
```

<br />

ì°¸ê³ ë¡œ ì´ë ‡ê²Œ ì„¤ì •íŒŒì¼ì„ ì‘ì„±í•˜ëŠ” ì´ìœ ê°€ ë‘ê°€ì§€ ì¡´ì¬í•œë‹¤.

<br />

- `Querydsl`ì€ ë¹„í‘œì¤€ì´ê¸° ë•Œë¬¸ì— `@DataJpaTest`ì˜ ë„ì›€ì„ ë°›ì§€ ëª»í•œë‹¤
   - `@DataJpaTest`ëŠ” ìŠ¬ë¼ì´ì‹± í…ŒìŠ¤íŠ¸ë¥¼ ì§„í–‰í•  ë•Œ JPAê´€ë ¨ ìŠ¤í”„ë§ ë¹ˆì„ ì£¼ì…í•´ì£¼ëŠ”ë°, `JPAQueryFactory`ë¹ˆì„ ì£¼ì…í•´ì£¼ì§€ ì•Šê¸° ë•Œë¬¸ì— `Querydsl` í…ŒìŠ¤íŠ¸ë¥¼ í•˜ì§€ ëª»í•œë‹¤

- `JPAQueryFactory`ë¥¼ `ì‹±ê¸€í†¤`ìœ¼ë¡œ í™œìš©í•˜ê¸° ìœ„í•¨ì´ë‹¤

<br />

ì´í›„ ëª¨ë“  `Querydsl` í…ŒìŠ¤íŠ¸ë¥¼ ì§„í–‰í•  ë•Œ ë‹¤ìŒê³¼ ê°™ì´ ì§„í–‰í•˜ë©´ ëœë‹¤.

ì—¬ê¸°ì„œ `JUnit`ì€ `5ë²„ì „`ì´ë©°, ìƒì„±ì ì£¼ì…ì„ ë°›ê¸° ìœ„í•´ `src/test/resources/spring.properties` ë¥¼ ìƒì„±í•œ í›„ ë‹¤ìŒê³¼ ê°™ì€ ì„¤ì •ì„ ì¶”ê°€í•´ì•¼ í•œë‹¤.

<br />

```yaml
# file: 'src/test/resources/spring.properties'
spring.test.constructor.autowire.mode=ALL
```

<br />

```java
@DataJpaTest
@Import(JpaConfig.class)
class QueryRepositoryTest {
  private final JPAQueryFactory queryFactory;
  private final TestEntityManager entityManager;

  QueryRepositoryTest(JPAQueryFactory queryFactory, TestEntityManager entityManager) {
    this.queryFactory = queryFactory;
    this.entityManager = entityManager;
  }
  
  // test cases...
}
```

<br />

ì´ë ‡ê²Œ ì„¤ì •í•˜ë©´ `@SpringBootTest`ë¥¼ ì‚¬ìš©í•˜ì§€ ì•ŠëŠ” ìŠ¬ë¼ì´ì‹± í…ŒìŠ¤íŠ¸ë¥¼ ì§„í–‰í•˜ë”ë¼ë„ `Querydsl` í…ŒìŠ¤íŠ¸ë¥¼ ì§„í–‰í•  ìˆ˜ ìˆë‹¤.

ëª…ì‹¬í•´ì•¼ í•  ê²ƒì€, `Querydsl`ì„ ì‚¬ìš©í•˜ê¸° ìœ„í•´ì„œëŠ” `QClass`ê°€ ë°˜ë“œì‹œ í•„ìš”í•˜ë¯€ë¡œ í•­ìƒ `gradle`ì—ì„œ `build` íƒœìŠ¤í¬ë¥¼ ë¨¼ì € ì‹¤í–‰í•´ì¤˜ì•¼ `QClass`ê°€ ì»´íŒŒì¼ë˜ì–´ `Querydsl`ê°€ ì •ìƒì ìœ¼ë¡œ ë™ì‘í•˜ê²Œ ëœë‹¤.

<br />

# ğŸ“œ ì‚¬ìš©ë°©ë²•

---

ìš°ì„  ê²°ê³¼ë¥¼ ì¡°íšŒí•˜ëŠ” `fetch()` ê´€ë ¨ ë©”ì„œë“œì— ëŒ€í•´ ì•Œë©´ ì¢‹ì„ ê²ƒ ê°™ë‹¤.

ìì£¼ ì‚¬ìš©í•˜ëŠ” `fetch`ëŠ” ë‹¤ìŒê³¼ ê°™ë‹¤.

- fetch()
  - ê²€ìƒ‰ ê²°ê³¼ì— ëŒ€í•œ ëª¨ë“  ê°’ì„ `List`ì— ë‹´ì•„ ë°˜í™˜í•œë‹¤

- fetchCount()
  - ê²€ìƒ‰ê²°ê³¼ë¥¼ ì¹´ìš´íŠ¸ë¡œ ë°˜í™˜í•œë‹¤. ë°˜í™˜ íƒ€ì…ì€ `long`

- fetchOne()
  - í•œê°œì˜ ê²°ê³¼ë¥¼ ë°˜í™˜í•œë‹¤. ê²€ìƒ‰ ê²°ê³¼ê°€ ë°˜ë“œì‹œ í•œê°œì¸ ê²½ìš°ì—ë§Œ ì‚¬ìš©í•´ì•¼ í•œë‹¤
  - JPQLì˜ `getSingleResult`ì™€ ê°™ë‹¤
  - ê²°ê³¼ê°€ ë‘˜ ì´ìƒì¸ ê²½ìš° `NonUniqueResultException`ì„ ë˜ì§„ë‹¤

- fetchFirst()
  - `limit 1`ê³¼ ê°™ë‹¤.
  - ê²€ìƒ‰ ì¤‘ ì²˜ìŒìœ¼ë¡œ ë§¤ì¹˜ë˜ëŠ” ê²ƒ í•˜ë‚˜ë§Œ ë°˜í™˜í•˜ë©°, ì¦‰ì‹œ ì¿¼ë¦¬ê°€ ì¢…ë£Œëœë‹¤

- fetchResults()
  - `í˜ì´ì§• ì¿¼ë¦¬`ë¥¼ ì‘ì„±í•  ë•Œ ì‚¬ìš©ëœë‹¤
  - ì½˜í…ì¸ , í˜ì´ì§€ ê°œìˆ˜, í˜ì´ì§€ ì‚¬ì´ì¦ˆ, í† íƒˆ ì¹´ìš´íŠ¸ë¥¼ ë°˜í™˜í•œë‹¤
  - ì½˜í…ì¸ ë¥¼ ì°¾ëŠ” ì¿¼ë¦¬ì™€ ì¹´ìš´íŠ¸ë¥¼ ì°¾ëŠ” ì¿¼ë¦¬ê°€ ëª¨ë‘ ë°œìƒí•œë‹¤ (ì´ 2ë²ˆ)


<br />

## ê²€ìƒ‰

---

<br />

```java
List<Member> members = queryFactory
                        .select(QMember.member)
                        .from(QMember.member)
                        .fetch();

List<Member> members = queryFactory
                        .selectFrom(QMember.member) // selectì ˆì— memberë¥¼ ì „ì²´ ê°€ì ¸ì˜¬ ê²½ìš° selectFrom()ìœ¼ë¡œ ì¶•ì•½ ê°€ëŠ¥
                        .fetch();

List<Member> members = queryFactory
                        .selectFrom(member) // QMemberë¥¼ static importí•˜ë©´ ì´ë ‡ê²Œ ì¤„ì¼ ìˆ˜ ìˆë‹¤
                        .fetch();
```

<br />

## ì¡°ê±´ ê²€ìƒ‰

---

<br />

```java
List<Member> members = queryFactory
                        .selectFrom(member)
                        .where(
                                member.name.eq("siro"),
                                member.age.eq(10)
                              )
                        .fetch();
```

<br />

## ì •ë ¬

---

<br />

```java
List<Member> members = queryFactory
                      .selectFrom(member)
                      .orderBy(member.name.desc())
                      .fetch();
```

<br />

## í˜ì´ì§•

---

<br />

```java
QueryResults<Member> results = queryFactory
                                .selectFrom(member)
                                .orderBy(member.name.desc())
                                .offset(1)
                                .limit(2)
                                .fetchResults();

List<Member> content = results.getResults();
long totalCount = results.getTotal();
```

<br />

## ì§‘í•©

---

<br />

```java
// Tupleì€ com.querydsl.coreì— ì¡´ì¬í•˜ëŠ” í´ë˜ìŠ¤ë¡œ, ê²°ê³¼ê°€ í•˜ë‚˜ì˜ ì—”í‹°í‹°ê°€ ì•„ë‹Œ ì—¬ëŸ¬ê°€ì§€ íƒ€ì…ì¼ ê²½ìš°ë¥¼ ëœ»í•œë‹¤
List<Tuple> tuples = queryFactory
                      .select(
                              member.count(),
                              member.age.sum(),
                              member.age.avg(),
                              member.age.max(),
                              member.age.min()
                             )
                      .from(member)
                      .fetch();
```

<br />

## ë‚´ë¶€ì¡°ì¸

---

<br />

```java
List<Member> members = queryFactory
                        .selectFrom(member)
                        .join(member.team, team) // innerJoin()ê³¼ join()ì€ ê°™ë‹¤
                        .fetch();
```

<br />

## ì™¸ë¶€ì¡°ì¸

---

<br />

```java
List<Member> members = queryFactory
                        .selectFrom(member)
                        .leftJoin(member.team, team) // rightJoin()ë„ ì¡´ì¬í•œë‹¤
                        .fetch();
```

<br />

## ì„¸íƒ€ì¡°ì¸(=í¬ë¡œìŠ¤ì¡°ì¸)

---

<br />

```java
// ì„¸íƒ€ì¡°ì¸ì‹œ join ì¡°ê±´ì ˆ ì—­í• ì„ í•˜ëŠ” whereì´ ì—†ê±°ë‚˜ ì˜ëª»ëœ ê²½ìš° ì¹´í…Œì‹œì•ˆ ê³±ì´ ë°œìƒí•˜ë¯€ë¡œ ì£¼ì˜í•œë‹¤
List<Member> members = queryFactory
                        .select(member)
                        .from(member, team)
                        .where(member.name.eq(team.name)) 
                        .fetch();
```

<br />

## í˜ì¹˜ì¡°ì¸

---

í˜ì¹˜ì¡°ì¸ì€ `fetchJoin()`ë§Œ ì¶”ê°€í•˜ë©´ ë°”ë¡œ ì ìš©ëœë‹¤.

<br />

```java
List<Member> fetch = queryFactory
                      .selectFrom(member)
                      .join(member.team, team)
                      .fetchJoin()
                      .fetch();
```

<br />

## ìŠ¤ìœ„ì¹˜

---

<br />

```java
// ê°„ë‹¨í•œ ìŠ¤ìœ„ì¹˜
List<String> members = queryFactory
                        .select(member.age
                            .when(10).then("ì—´ì‚´")
                            .when(20).then("ìŠ¤ë¬´ì‚´")
                            .otherwise("ê¸°íƒ€")
                        )
                        .from(member)
                        .fetch();

// ë³µì¡í•œ ìŠ¤ìœ„ì¹˜
List<String> members = queryFactory
                        .select(new CaseBuilder() // ì¼€ì´ìŠ¤ë¹Œë” ì‚¬ìš©
                            .when(member.name.startsWith("ê¹€")).then("ê¹€ì”¨")
                            .when(member.name.startsWith("ì´")).then("ì´ì”¨")
                            .otherwise("ê¸°íƒ€"))
                        .from(member)
                        .fetch();
```

<br />

## ë¬¸ìì—´, ìƒìˆ˜ ì´ì–´ë¶™ì´ê¸°

---

<br />

```java
List<String> members = queryFactory
                        .select(member.name.concat("_").concat(member.age.stringValue())) // concatì‚¬ìš©
                        .from(member)
                        .where(member.name.eq("siro"))
                        .fetch();
```

<br />

## í”„ë¡œì ì…˜

---

í”„ë¡œì ì…˜ì„ ì‚¬ìš©í•  ê²½ìš° í•„ë“œëª…ì´ ë‹¤ë¥¸ ê²½ìš° `as`ë¥¼ ì‚¬ìš©í•´ í•„ë“œëª…ì„ ë§ì¶°ì£¼ë©´ ëœë‹¤. 

ì˜ˆë¥¼ ë“¤ìë©´, `Member` ì—”í‹°í‹°ì˜ ê°’ì„ ê¼­ `MemberDto`ì— ë„£ì–´ì•¼ë§Œ ë˜ëŠ” ê²ƒì´ ì•„ë‹ˆë©°, ë‹¤ì–‘í•œ DTOì— ë„£ì–´ì¤„ ìˆ˜ ìˆë‹¤.

ê¸°ë³¸ì ìœ¼ë¡œ ì•„ë˜ì˜ 3ê°€ì§€ ë°©ì‹ì„ ì§€ì›í•œë‹¤.

<br />

```java
// ìˆ˜ì •ì(setter) í”„ë¡œì ì…˜
List<MemberDto> memberDtos = queryFactory
                              .select(Projections.bean(MemberDto.class, member.name, member.age))
                              .from(member)
                              .fetch();

// í•„ë“œ í”„ë¡œì ì…˜
List<MemberDto> memberDtos = queryFactory
                              .select(Projections.fields(MemberDto.class, member.name, member.age))
                              .from(member)
                              .fetch();

// ìƒì„±ì í”„ë¡œì ì…˜
List<MemberDto> memberDtos = queryFactory
                              .select(Projections.constructor(MemberDto.class, member.name, member.age))
                              .from(member)
                              .fetch();
```

<br />

ì¶”ê°€ë¡œ `@QueryProjection`ì„ ìƒì„±ìì— ì¶”ê°€í•˜ë©´ `DTO`ë„ `QClass`ë¡œ ì»´íŒŒì¼ë˜ì–´ ë” ì‰½ê²Œ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.

<br />

```java
@Getter
public class MemberDto {
    private Long id;
    private String name;
    private Integer age;

    public MemberDto() {}

    @QueryProjection
    public MemberDto(Long id, String name) {
        this.id = id;
        this.name = name;
    }

    @QueryProjection
    public MemberDto(String name, Integer age) {
        this.name = name;
        this.age = age;
    }

    @QueryProjection
    public MemberDto(Long id, String name, Integer age) {
        this.id = id;
        this.name = name;
        this.age = age;
    }

    public static MemberDto createMemberDto(Long id, String name, Integer age) {
        return new MemberDto(id, name, age);
    }

    public static MemberDto createMemberDto(Long id, String name) {
        return new MemberDto(id, name);
    }

    public static MemberDto createMemberDto(String name, Integer age) {
        return new MemberDto(name, age);
    }
}
```

<br />

```java
// @QueryProjection í”„ë¡œì ì…˜
List<MemberDto> memberDtos = queryFactory
                              .select(new QMemberDto(member.name, member.age))
                              .from(member)
                              .fetch();
```

<br />

`@QueryProjection`ê³¼ `ìƒì„±ì í”„ë¡œì ì…˜`ì€ ì„œë¡œ ì¼ì¥ì¼ë‹¨ì´ ì¡´ì¬í•œë‹¤.

<br />

- @QueryProjection
  - ì¥ì  - í”„ë¡œì ì…˜ì‹œ ì—ëŸ¬ê°€ ë°œìƒí•˜ë©´ ì»´íŒŒì¼íƒ€ì„ì— ì¡ì•„ì¤„ ìˆ˜ ìˆë‹¤
  - ì¥ì  - ì½”ë“œê°€ ì•½ê°„ ë” ì§ê´€ì ì´ë‹¤
  - ë‹¨ì  - DTOì— Querydsl ë¡œì§ì´ ë“¤ì–´ê°„ë‹¤ (DTOê°€ Querydslì„ ì˜ì¡´í•œë‹¤)

- ìƒì„±ì í”„ë¡œì ì…˜
  - ì¥ì  - DTOê°€ Querydslì„ ì˜ì¡´í•˜ì§€ ì•ŠëŠ”ë‹¤
  - ë‹¨ì  - ëŸ°íƒ€ì„ ì—ëŸ¬ê°€ ë°œìƒí•  ìˆ˜ ìˆëŠ” ê°€ëŠ¥ì„±ì´ ì¡´ì¬í•œë‹¤
  
<br />

## ë™ì ì¿¼ë¦¬

---

`whereì ˆ`ì— `null`ì„ ë°˜í™˜í•˜ë©´ í•´ë‹¹ ê²€ìƒ‰ì¡°ê±´ì´ ë¬´ì‹œë˜ê¸° ë•Œë¬¸ì— ë™ì ì¿¼ë¦¬ë¥¼ ì‘ì„±í•˜ê¸°ê°€ í¸ë¦¬í•˜ë‹¤.

ì™¸ì— `BooleanBuilder`ë¥¼ ì‚¬ìš©í•œ ë°©ë²•ë„ ì¡´ì¬í•˜ëŠ”ë° ë³„ë¡œ ì„ í˜¸í•˜ì§€ ì•Šìœ¼ë¯€ë¡œ íŒ¨ìŠ¤.

<br />

```java
List<Member> members = queryFactory
                        .selectFrom(member)
                        .where(allEq("siro", null))
                        .fetch();

// ê³„ì†í•´ì„œ ì¬ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤ëŠ” í° ì¥ì ì´ ìˆë‹¤.
private BooleanExpression nameEq(String name) {
        return Objects.isNull(name) ? null : member.name.eq(name);
        }

private BooleanExpression ageEq(Integer age) {
        return Objects.isNull(age) ? null : member.age.eq(age);
        }

private BooleanExpression allEq(String name, Integer age) {
        return nameEq(name).and(ageEq(age));
        }
```

<br />

## ë²Œí¬ì—°ì‚°

---

ë²Œí¬ì—°ì‚°ì˜ ê²½ìš° ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ë¥¼ ë¬´ì‹œí•˜ê³  DBì— ì§ì ‘ ì¿¼ë¦¬í•˜ê¸° ë•Œë¬¸ì— ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì™€ ì‹¤ì œ DBì˜ ë°ì´í„° ì •í•©ì„±ì´ ê¹¨ì§ˆ ìˆ˜ ìˆë‹¤.

ë”°ë¼ì„œ ë²Œí¬ì—°ì‚°ì„ ê°€ì¥ ë¨¼ì € ì‹¤í–‰í•˜ê±°ë‚˜, í›„ìˆœìœ„ì— ì‹¤í–‰ëœë‹¤ë©´ ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ë¥¼ ê°œë°œìê°€ ì§ì ‘ ê´€ë¦¬í•´ì•¼í•œë‹¤.

ë²Œí¬ì—°ì‚°ì€ ì´ ì¿¼ë¦¬ì— ì˜í–¥ë°›ì€ `row ê°œìˆ˜`ë¥¼ `long`ìœ¼ë¡œ ë°˜í™˜í•œë‹¤.

<br />

```java
queryFactory
        .update(member)
        .set(member.age, 100)
        .where(member.age.lt(35))
        .execute();

queryFactory
        .delete(member)
        .where(member.age.eq(29))
        .execute();
```

<br />

## DB í•¨ìˆ˜ ì‚¬ìš©

---

`org.hibernate.dialect.Dialect` ì˜ DBë²¤ë” ë³„ í™•ì¥ í´ë˜ìŠ¤ë¥¼ ì°¾ì•„ì„œ (`H2Dialect`ê°™ì€ ê²ƒ) ì‚¬ìš©í•˜ê³ ì í•˜ëŠ” í•¨ìˆ˜ê°€ ë“±ë¡ë¼ìˆëŠ”ì§€ í™•ì¸í•˜ê³ , ì‚¬ìš©í•˜ë ¤ëŠ” í•¨ìˆ˜ê°€ ì—†ëŠ” ê²½ìš°(ì»¤ìŠ¤í…€ í•¨ìˆ˜ ë“±) í•´ë‹¹ í™•ì¥ í´ë˜ìŠ¤ë¥¼ í•œë²ˆ ë” í™•ì¥í•˜ì—¬ í•¨ìˆ˜ë¥¼ ë“±ë¡í•œ í›„ í™•ì¥í•œ í´ë˜ìŠ¤ë¥¼ ì„¤ì •íŒŒì¼ì— ë“±ë¡í•´ì•¼í•œë‹¤.

<br />

```java
queryFactory
        .select(Expressions.stringTemplate("function('replace', {0}, {1}, {2})", member.name, "s", "S"))
        .from(member)
        .fetch();
```

<br />

ëª¨ë“  DB ë²¤ë”ê°€ ì§€ì›í•˜ëŠ” ANSI í‘œì¤€ì— ìˆëŠ” ê¸°ë³¸ì ì¸ í•¨ìˆ˜ë“¤ì€ ì´ë¯¸ `Hibernate`ê°€ ì§€ì›í•˜ë¯€ë¡œ, `stringTemplate` ì„ ì§ì ‘ ì‚¬ìš©í•˜ì§€ ì•Šì•„ë„ ëœë‹¤.

<br />

```java
queryFactory
        .select(member.name)
        .from(member)
        .where(member.name.eq(member.name.lower()))
        .fetch();
```

<br />
