<!DOCTYPE html>
<html lang="ko"><head><title>CORS, HTTP Only | 돈 받고 일하면 프로</title><meta name="generator" content="Jekyll v4.2.1" /><meta property="og:title" content="CORS, HTTP Only" /><meta name="author" content="shirohoo" /><meta property="og:locale" content="ko_KR, en_US" /><meta name="description" content="HTTP, CORS 에 대한 이해 부족으로 발생한 문제" /><meta property="og:description" content="HTTP, CORS 에 대한 이해 부족으로 발생한 문제" /><meta property="og:site_name" content="돈 받고 일하면 프로" /><meta property="og:image" content="/assets/img/common/code1.png" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2021-09-28T00:00:00+00:00" /><meta name="twitter:card" content="summary_large_image" /><meta property="twitter:image" content="/assets/img/common/code1.png" /><meta property="twitter:title" content="CORS, HTTP Only" /><meta name="google-site-verification" content="google-site-verification=QP6xbvFbQ-RK1rEeDlge0lpDYvcCG0FdC5crTSd-aDs" /> <script type="application/ld+json"> {"author":{"@type":"Person","name":"shirohoo"},"description":"HTTP, CORS 에 대한 이해 부족으로 발생한 문제","url":"/backend/server-side/2021-09-28-cors/","@type":"BlogPosting","image":"/assets/img/common/code1.png","headline":"CORS, HTTP Only","dateModified":"2024-03-24T17:42:01+00:00","datePublished":"2021-09-28T00:00:00+00:00","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"/assets/img/me.gif"},"name":"shirohoo"},"mainEntityOfPage":{"@type":"WebPage","@id":"/backend/server-side/2021-09-28-cors/"},"@context":"https://schema.org"}</script><meta name="keywords" content="java,kotlin,python,spring,backend"><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"><meta http-equiv="x-ua-compatible" content="ie=edge"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="돈 받고 일하면 프로"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta name="application-name" content="돈 받고 일하면 프로"><meta name="theme-color" content="rgb(8,46,57)"><meta name="generator" content="Hydejack v9.1.5" /><link rel="alternate" href="/backend/server-side/2021-09-28-cors/" hreflang="ko-kr, en-us"><link type="application/atom+xml" rel="alternate" href="/feed.xml" title="돈 받고 일하면 프로" /><link rel="shortcut icon" href="/assets/icons/favicon.ico"><link rel="apple-touch-icon" href="/assets/icons/icon-192x192.png"><link rel="manifest" href="/assets/site.webmanifest"><link rel="dns-prefetch" href="https://fonts.googleapis.com"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preload" href="/assets/img/swipe.svg" as="image" id="_hrefSwipeSVG"><link rel="dns-prefetch" href="/assets/js/search-worker-9.1.5.js" as="worker" id="_hrefSearch"><link rel="dns-prefetch" href="/assets/bower_components/katex/dist/katex.min.css" id="_katexPreload"> <noscript><link rel="stylesheet" href="/assets/bower_components/katex/dist/katex.min.css"></noscript> <script>!function(r,c){"use strict";function a(e,t,n,o){e.addEventListener?e.addEventListener(t,n,o):e.attachEvent?e.attachEvent("on"+t,n):e["on"+t]=n}r.loadJS=function(e,t){var n=c.createElement("script");n.src=e,t&&a(n,"load",t,{once:!0});t=c.scripts[0];return t.parentNode.insertBefore(n,t),n},r._loaded=!1,r.loadJSDeferred=function(e,t){var n=c.createElement("script");function o(){r._loaded=!0,t&&a(n,"load",t,{once:!0});var e=c.scripts[0];e.parentNode.insertBefore(n,e)}return n.src=e,r._loaded?o():a(r,"load",o,{once:!0}),n},r.setRel=r.setRelStylesheet=function(e){a(c.getElementById(e),"load",function(){this.rel="stylesheet"},{once:!0})}}(window,document); !function(a){"use strict";var b=function(b,c,d){function e(a){return h.body?a():void setTimeout(function(){e(a)})}function f(){i.addEventListener&&i.removeEventListener("load",f),i.media=d||"all"}var g,h=a.document,i=h.createElement("link");if(c)g=c;else{var j=(h.body||h.getElementsByTagName("head")[0]).childNodes;g=j[j.length-1]}var k=h.styleSheets;i.rel="stylesheet",i.href=b,i.media="only x",e(function(){g.parentNode.insertBefore(i,c?g:g.nextSibling)});var l=function(a){for(var b=i.href,c=k.length;c--;)if(k[c].href===b)return a();setTimeout(function(){l(a)})};return i.addEventListener&&i.addEventListener("load",f),i.onloadcssdefined=l,l(f),i};"undefined"!=typeof exports?exports.loadCSS=b:a.loadCSS=b}("undefined"!=typeof global?global:this); !function(a){if(a.loadCSS){var b=loadCSS.relpreload={};if(b.support=function(){try{return a.document.createElement("link").relList.supports("preload")}catch(b){return!1}},b.poly=function(){for(var b=a.document.getElementsByTagName("link"),c=0;c<b.length;c++){var d=b[c];"preload"===d.rel&&"style"===d.getAttribute("as")&&(a.loadCSS(d.href,d,d.getAttribute("media")),d.rel=null)}},!b.support()){b.poly();var c=a.setInterval(b.poly,300);a.addEventListener&&a.addEventListener("load",function(){b.poly(),a.clearInterval(c)}),a.attachEvent&&a.attachEvent("onload",function(){a.clearInterval(c)})}}}(this); !function(w) { w._baseURL = '/'; w._publicPath = '/assets/js/'; w._noPushState = false; w._noDrawer = false; w._noNavbar = false; w._noToc = false; w._noSearch = false; w._advertise = false; w._search = { DATA_URL: '/assets/sitedata.json?no-cache', STORAGE_KEY: 'mini-search/', INDEX_KEY: 'index--2024-03-24T17:42:53+00:00', }; w._clapButton = false; }(window);</script> <!--[if gt IE 8]><!----><style id="_styleInline"> .clearfix,.sidebar-social::after{content:"";display:table;clear:both}.color-transition,.content .avatar,.nav-btn,.nav-btn-bar,.navbar,.message,.note-sm,#markdown-toc,.note,.hr-bottom,.hr-after::after,hr,.hr,p,body{transition:none}#_dark-mode{font-size:1.25rem}@media screen{body.light-mode{--body-color: #333;--body-bg: #fff;--border-color: #ebebeb;--gray: #777;--gray-bg: rgba(0,0,0,0.025);--gray-text: #666;--menu-text: #bbb;--inv-body-color: #ccc;--inv-body-bg: var(--dark-mode-body-bg)}body.light-mode .content{-webkit-font-smoothing:initial;-moz-osx-font-smoothing:initial}body.dark-mode{--body-color: #ccc;--body-bg: var(--dark-mode-body-bg);--border-color: var(--dark-mode-border-color);--gray: rgba(255,255,255,.5);--gray-bg: rgba(255,255,255,.033);--gray-text: rgba(255,255,255,.625);--menu-text: rgba(255,255,255,.25);--inv-body-color: #333;--inv-body-bg: #fff}body.dark-mode .content{-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}body.dark-mode p>code,body.dark-mode li>code,body.dark-mode table code{background-color:white;color:black;border-radius:5px;font-weight:bold}}@media screen and (prefers-color-scheme: dark){body{--body-color: #ccc;--body-bg: var(--dark-mode-body-bg);--border-color: var(--dark-mode-border-color);--gray: rgba(255,255,255,.5);--gray-bg: rgba(255,255,255,.033);--gray-text: rgba(255,255,255,.625);--menu-text: rgba(255,255,255,.25);--inv-body-color: #333;--inv-body-bg: #fff}body .content{-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}body p>code,body li>code,body table code{background-color:white;color:black;border-radius:5px;font-weight:bold}.tippy-content{-webkit-font-smoothing:initial;-moz-osx-font-smoothing:initial}}html{--font-family: Architects Daughter;--font-family-heading: Architects Daughter;--code-font-family: ui-monospace,Menlo,Monaco,Ligamonacop,Cascadia Mono,Segoe UI Mono,Roboto Mono,Oxygen Mono,Ubuntu Monospace,Source Code Pro,Fira Mono,Droid Sans Mono,Courier New,monospace;--body-color: #333;--body-bg: #fff;--border-color: #ebebeb;--gray: #777;--gray-bg: rgba(0,0,0,0.025);--gray-text: #666;--menu-text: #bbb;--inv-body-color: #ccc;--inv-body-bg: var(--dark-mode-body-bg);--root-font-size: 15px;--root-font-size-medium: 16px;--root-font-size-large: 17px;--root-font-size-print: 8pt;--root-line-height: 1.75;--font-weight: 400;--font-weight-bold: 700;--font-weight-heading: 700;--content-width-5: 54rem;--content-margin-5: 4rem;--sidebar-width: 21rem;--half-content: 31rem;--break-point-3: 64em;--break-point-5: 86em;--break-point-dynamic: 1664px}html .content{-webkit-font-smoothing:initial;-moz-osx-font-smoothing:initial}*{box-sizing:border-box}html,body{margin:0;padding:0}html{font-family:var(--font-family);font-size:var(--root-font-size);line-height:var(--root-line-height)}body{color:var(--body-color);background-color:var(--body-bg);font-weight:var(--font-weight);overflow-y:scroll}.content img,.img,.content video,.video{max-width:100%;height:auto}.lead{margin-left:-1rem;margin-right:-1rem;margin-bottom:1.5rem}img.lead,video.lead{display:block;max-width:calc(100% + 2rem);width:calc(100% + 2rem);height:auto}.heading,.f6,h6,.h6,.f5,h5,.h5,.f4,.sidebar-nav-item,h4,.h4,.post-date,.f3,h3,.h3,.f2,h2,.h2,.f1,h1,.h1{font-family:var(--font-family-heading);font-weight:var(--font-weight-heading)}.f1,h1,.h1{font-size:2rem;line-height:1.3}.f2,h2,.h2{font-size:1.5rem;line-height:1.4}.f3,h3,.h3{font-size:1.2em;line-height:1.5}.f4,.sidebar-nav-item,h4,.h4,.post-date{font-size:1.08rem;line-height:1.6}.f5,h5,.h5{font-size:1.04rem;line-height:1.7}.f6,h6,.h6{font-size:1rem}.content h1>a,.content .h1>a{text-decoration:none;border-bottom:none}@media screen and (max-width: 42em){.content h1,.content .h1{font-size:1.7rem;line-height:1.35}}@media screen and (min-width: 86em){.content h1,.content .h1{font-size:2.4rem;line-height:1.25}}@media screen and (min-width: 1664px){body:not(.no-large-headings) .content h1,body:not(.no-large-headings) .content .h1{width:calc(100% + 50vw - 32rem);font-size:3rem;line-height:1.2}}@media screen and (min-width: 124em){body:not(.no-large-headings) .content h1,body:not(.no-large-headings) .content .h1{font-size:3rem;line-height:1.1}}h1,h2,h3,.h1,.h2,.h3{margin:4rem 0 1rem}h4,h5,h6,.h4,.post-date,.h5,.h6{margin:3rem 0 .5rem}p{margin-top:0;margin-bottom:1rem}p.lead{font-size:1.2em;margin-top:1.5rem;margin-bottom:1.5rem;padding:0 1rem}ul,ol{padding-left:1.25rem}hr,.hr{border:0;margin:1rem 0;border-top:1px solid var(--border-color)}.hr-after::after{content:"";display:block;margin:1rem 0;border-top:1px solid var(--border-color)}.hr-bottom{border-bottom:1px solid var(--border-color);padding-bottom:.75rem;margin-bottom:1rem}.page{margin-bottom:3em}.page li+li{margin-top:.25rem}.page>header{position:relative;margin-bottom:1.5rem}@media screen and (min-width: 1664px){body:not(.no-third-column) .page>header>.lead+.note-sm,body:not(.no-third-column) .page>header>.lead+#markdown-toc,body:not(.no-third-column) .page>header>.lead+.note,body:not(.no-third-column) .page>header>a.no-hover+.note-sm,body:not(.no-third-column) .page>header>a.no-hover+#markdown-toc,body:not(.no-third-column) .page>header>a.no-hover+.note{position:absolute;right:-25rem;width:21rem;bottom:0;margin-bottom:0}}.page-title,.post-title{margin-top:0}.post-date{display:flex;justify-content:space-between;margin-top:-.6rem;height:2rem;margin-bottom:.85rem;color:var(--gray)}.post-date>.ellipsis,#breadcrumbs.post-date>ul{cursor:pointer}.post-date [class^="icon-"]{display:inline-block;font-size:smaller;margin-right:.25rem}.related-posts{padding-left:0;list-style:none;margin-bottom:2rem}.related-posts>li,.related-posts>li+li{margin-top:1rem}.message,.note-sm,#markdown-toc,.note{margin-bottom:1rem;padding:1rem;color:var(--gray-text);background-color:var(--gray-bg);margin-left:-1rem;margin-right:-1rem}.note-sm,#markdown-toc,.note{background:transparent;color:var(--body-color);font-size:smaller;border-left:1px solid var(--border-color);padding:1.2rem 1rem 0 1rem;margin:1rem -1rem;position:relative}.note-sm:before,#markdown-toc:before,.note:before{font-size:0.667rem;font-weight:bold;font-style:normal;letter-spacing:.025rem;text-transform:uppercase;color:var(--menu-text);position:absolute;top:0}.note-sm[title]:before,#markdown-toc[title]:before,.note[title]:before{content:attr(title) !important}.note{font-size:1rem}@media screen{body::before{content:'';width:.5rem;background:var(--gray-bg);position:fixed;left:0;top:0;bottom:0}}@media (min-width: 64em){body::before{width:21rem}}@media (min-width: 1664px){body::before{width:calc(50% - 31rem)}}@media screen and (min-width: 42em){html{font-size:var(--root-font-size-medium)}}@media screen and (min-width: 124em){html{font-size:var(--root-font-size-large)}}#breadcrumbs>ul{height:1rem;margin:-1.5rem 0 .5rem;padding:0;font-size:.667rem;color:var(--menu-text);text-transform:uppercase;width:100%;list-style:none}#breadcrumbs>ul>li{display:inline}#breadcrumbs>ul>li a{color:var(--gray);text-decoration:none;border-bottom:none}.fl{float:left}.fr{float:right}.mb4{margin-bottom:4rem}.mb6{margin-bottom:6rem}.mt0{margin-top:0}.mt1{margin-top:1rem}.mt2{margin-top:2rem}.mt3{margin-top:3rem}.mt4{margin-top:4rem}.pb0{padding-bottom:0}.ml1{margin-left:1rem}.mr1{margin-right:1rem}.sixteen-nine{position:relative}.sixteen-nine::before{display:block;content:"";width:100%;padding-top:56.25%}.sixteen-nine>*{position:absolute;top:0;left:0;right:0;bottom:0}.sixteen-ten{position:relative}.sixteen-ten::before{display:block;content:"";width:100%;padding-top:62.5%}.sixteen-ten>*{position:absolute;top:0;left:0;right:0;bottom:0}.four-three{position:relative}.four-three::before{display:block;content:"";width:100%;padding-top:75%}.four-three>*{position:absolute;top:0;left:0;right:0;bottom:0}.sr-only{display:none}.larger{font-size:larger}.smaller{font-size:smaller}.clearfix,.sidebar-social::after{content:"";display:table;clear:both}.ellipsis,#breadcrumbs>ul{white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.border{border:1px solid var(--border-color)}@media (min-width: 42em){.border-radius,.lead,.page .aspect-ratio.sixteen-nine.lead{border-radius:.5rem}}.fallback-img{background-position:center;background-repeat:no-repeat;background-image:url("data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4KPHN2ZyB3aWR0aD0iMTYwIiBoZWlnaHQ9IjkwIiB2aWV3Qm94PSIwIDAgMTYwIDkwIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPgogIDxnIHRyYW5zZm9ybT0ibWF0cml4KDAuMDQ4ODI4LCAwLCAwLCAwLjA0Nzk5MSwgNTQuOTk5OTczLCAyMC40MjgxNDgpIj4KICAgIDxwYXRoIHN0eWxlPSJmaWxsOnJnYmEoMTI4LDEyOCwxMjgsLjMzKSIgZD0iTTk1OS44ODQgMTI4YzAuMDQwIDAuMDM0IDAuMDgyIDAuMDc2IDAuMTE2IDAuMTE2djc2Ny43N2MtMC4wMzQgMC4wNDAtMC4wNzYgMC4wODItMC4xMTYgMC4xMTZoLTg5NS43N2MtMC4wNDAtMC4wMzQtMC4wODItMC4wNzYtMC4xMTQtMC4xMTZ2LTc2Ny43NzJjMC4wMzQtMC4wNDAgMC4wNzYtMC4wODIgMC4xMTQtMC4xMTRoODk1Ljc3ek05NjAgNjRoLTg5NmMtMzUuMiAwLTY0IDI4LjgtNjQgNjR2NzY4YzAgMzUuMiAyOC44IDY0IDY0IDY0aDg5NmMzNS4yIDAgNjQtMjguOCA2NC02NHYtNzY4YzAtMzUuMi0yOC44LTY0LTY0LTY0djB6Ii8+CiAgICA8cGF0aCBzdHlsZT0iZmlsbDpyZ2JhKDEyOCwxMjgsMTI4LC4zMykiIGQ9Ik04MzIgMjg4YzAgNTMuMDIwLTQyLjk4IDk2LTk2IDk2cy05Ni00Mi45OC05Ni05NiA0Mi45OC05NiA5Ni05NiA5NiA0Mi45OCA5NiA5NnoiLz4KICAgIDxwYXRoIHN0eWxlPSJmaWxsOnJnYmEoMTI4LDEyOCwxMjgsLjMzKSIgZD0iTTg5NiA4MzJoLTc2OHYtMTI4bDIyNC0zODQgMjU2IDMyMGg2NGwyMjQtMTkyeiIvPgogIDwvZz4KPC9zdmc+")}hy-push-state a{color:var(--body-color)}@supports not ((text-decoration-thickness: initial) and (text-underline-offset: initial)){hy-push-state a{text-decoration:none;border-bottom:2px solid}}@supports (text-decoration-thickness: initial) and (text-underline-offset: initial){hy-push-state a{text-decoration-style:solid;text-underline-offset:.35rem;text-decoration-thickness:2px}}hy-push-state a.no-hover{border-bottom:none;text-decoration-thickness:unset;text-underline-offset:unset}.content a:not(.btn):not(.no-hover){border-color:var(--accent-color-faded)}@supports (text-decoration-thickness: initial) and (text-underline-offset: initial){.content a:not(.btn):not(.no-hover){text-decoration-color:var(--accent-color-faded)}}.content .aspect-ratio{overflow:hidden}.content .aspect-ratio img{margin:0;width:100%;height:100%;background-color:var(--gray-bg)}hy-drawer{width:100%;position:relative;overflow:hidden;display:block;z-index:4}@media screen and (min-width: 64em){hy-drawer{position:fixed;width:21rem;top:0;left:0;bottom:0;margin-left:0}hy-drawer.cover{position:relative;width:100%}}@media screen and (min-width: 1664px){hy-drawer{width:calc(50% - 31rem)}}.sidebar{position:relative;display:flex;justify-content:center;align-items:center;color:rgba(255,255,255,0.75);text-align:center;min-height:100vh}.sidebar.invert{color:rgba(32,32,32,0.75)}.sidebar a{color:#fff;border-bottom-color:rgba(255,255,255,0.2);text-decoration-color:rgba(255,255,255,0.2)}.sidebar.invert a{color:#222;border-bottom-color:rgba(32,32,32,0.2);text-decoration-color:rgba(32,32,32,0.2)}.sidebar-bg{position:absolute;top:0;left:calc(50% - 50vw);width:100vw;height:100%;background:#202020 center / cover}.sidebar-bg::after{content:"";position:absolute;top:0;left:0;bottom:0;right:0;background:rgba(0,0,0,0.05)}.sidebar-bg.sidebar-overlay::after{background:linear-gradient(to bottom, rgba(32,32,32,0) 0%, rgba(32,32,32,0.5) 50%, rgba(32,32,32,0) 100%)}.sidebar-sticky{position:relative;z-index:3;max-width:21rem;padding:1.5rem;contain:content}.sidebar-about .avatar{margin-bottom:1.5rem}.sidebar-about>a.sidebar-title{text-decoration:none}.sidebar-about>a.sidebar-title>h2{margin:0;padding-bottom:.5rem}.sidebar-about>a.sidebar-title::after{content:'';display:block;border-bottom:2px solid;margin:0 auto .5rem;width:4rem;border-color:rgba(255,255,255,0.2);transition:border-color 250ms}.sidebar-about>a.sidebar-title:hover::after{border-color:#fff;transition:border-color 50ms}.sidebar.invert .sidebar-about>a.sidebar-title::after{border-color:rgba(32,32,32,0.2)}.sidebar.invert .sidebar-about>a.sidebar-title:hover::after{border-color:#222}.sidebar-nav>ul{list-style:none;padding-left:0}.sidebar-nav-item{display:inline-block;margin-bottom:.5rem}@media (min-width: 64em){#_main.no-drawer #_menu{display:none}#_main.no-drawer .nav-btn-bar>:nth-child(2){border:none}}.sidebar-social>ul{display:inline-block;list-style:none;padding-left:0;margin-bottom:0}.sidebar-social>ul>li{float:left}.sidebar-social>ul>li>a{display:inline-block;text-align:center;font-size:1.4rem;width:3rem;height:4rem;padding:.5rem 0;line-height:3rem;text-decoration:none;border-bottom-width:2px;border-bottom-style:solid}.sidebar-social>ul li+li{margin-top:0}.fixed-common,.fixed-bottom,.fixed-top{position:fixed;left:0;width:100%;z-index:2}.fixed-top{top:0}.fixed-bottom{bottom:0}.navbar>.content{position:relative;padding-top:0;padding-bottom:0;min-height:0;max-height:5rem}.nav-btn-bar{margin:0 -1rem;background-color:white;background-color:var(--body-bg);height:5rem;display:flex;align-items:center;position:relative}.nav-btn-bar>:first-child,.nav-btn-bar>:last-child{border:none}.nav-btn{background:none;border:none;text-decoration:none;display:flex;align-items:center;justify-content:center;width:3.25rem;height:5rem;color:var(--menu-text);border-right:1px solid var(--border-color);border-left:1px solid var(--border-color);margin-left:-1px}#markdown-toc{margin:2rem -1rem 2rem calc(-1rem + 1px);padding-left:2.5rem;padding-bottom:.5rem}#markdown-toc:before{left:1rem}@media screen and (min-width: 1664px){body:not(.no-toc) #markdown-toc{position:absolute;z-index:4;width:20.5rem;right:0;margin:auto;overflow:auto}}@media screen and (min-width: 1664px){body.no-break-layout:not(.no-toc) #markdown-toc{width:calc(50% - 31rem)}}.content{margin-left:auto;margin-right:auto;padding:8rem 1rem 12rem}@media screen{.content{padding-left:1.5rem;min-height:100vh}}@media screen and (min-width: 42em){.content{max-width:42rem}}@media screen and (min-width: 54em){.content{max-width:48rem}}@media screen and (min-width: 64em){.content{padding-left:1rem;margin-left:24rem;margin-right:3rem}}@media screen and (min-width: 86em){.content{padding-top:9rem;margin-left:25rem;margin-right:4rem;max-width:54rem}}@media screen and (min-width: 1664px){.content{margin:auto}}.large-only{display:none}@media screen and (min-width: 1664px){.large-only{display:block}}.avatar{width:7rem;height:7rem;border-radius:100%;overflow:hidden;display:inline-block}.avatar img{width:100%}.content .avatar{float:right;box-sizing:content-box;border:1rem solid var(--body-bg);transition:border-color 1s ease;margin-top:-1.5rem;margin-right:-1rem}.sidebar a{text-shadow:rgba(0,0,0,0.25) 0.1rem 0.1rem 0.15rem}.note:before{content:"Note"}.page>header>.note-sm:before,.page>header>.note:before,.page>header>#markdown-toc:before{content:"Description"}#markdown-toc:before{content:"Table of Contents"}.layout-resume .note-sm:before,.layout-resume .note:before,.layout-resume #markdown-toc:before{content:"Summary"} .clearfix,main:not(.layout-resume) .columns::after{content:"";display:table;clear:both}.color-transition,main:not(.layout-resume) .project-card{transition:none}main:not(.layout-resume) .columns{margin-left:-1rem;display:flex;flex-wrap:wrap;contain:content;padding-top:1rem;margin-top:1rem;padding-right:1rem;margin-right:-1rem}main:not(.layout-resume) .column{float:left;padding-left:1rem;margin-bottom:2rem;width:100%;display:flex}@media screen and (min-width: 42em){main:not(.layout-resume) .columns{margin-left:-2rem;margin-right:-2rem}main:not(.layout-resume) .column-1-2{width:50%}}@media screen and (min-width: 1664px){main:not(.layout-resume) .columns-break{width:calc(50vw + 25rem)}main:not(.layout-resume) .columns-break>.column-1-2,main:not(.layout-resume) .columns-break>.column-1{width:27.5rem}}@media print{main:not(.layout-resume) .columns{display:block}main:not(.layout-resume) .column{display:block;width:50%}}main:not(.layout-resume) .project-card{width:100%;color:var(--gray-text);background-color:var(--gray-bg);padding-bottom:1rem;position:relative;overflow:hidden;box-shadow:0.125rem 0.125rem 1rem rgba(0,0,0,0.2);contain:content;border-radius:.5rem;page-break-inside:avoid;transition:transform 500ms ease;will-change:transform}main:not(.layout-resume) .project-card:hover{transform:translateY(-0.25rem);transition:transform 250ms ease}main:not(.layout-resume) .project-card>a.flip-project{display:block}main:not(.layout-resume) .project-card>a.flip-project .project-card-img{margin-bottom:0}main:not(.layout-resume) .project-card>a.flip-project .project-card-img img{display:block;border-top-left-radius:.5rem;border-top-right-radius:.5rem}main:not(.layout-resume) .project-card a{position:relative;z-index:1}main:not(.layout-resume) .project-card a.fill-card{position:absolute;top:0;left:0;right:0;bottom:0;z-index:0}main:not(.layout-resume) .project-card>.project-card-title,main:not(.layout-resume) .project-card>.project-card-text{text-align:center;padding:0 1rem}main:not(.layout-resume) .project-card>.project-card-title{display:block;font-size:1.08rem;margin-top:.75rem;margin-bottom:.25rem;color:inherit}main:not(.layout-resume) .project-card>.project-card-text{margin:.25rem 0}main:not(.layout-resume) .column-1>.project-card>.project-card-title{font-size:1.2rem}main:not(.layout-resume) .column-1>.project-card>.project-card-text{font-size:1rem}</style><link rel="preload" as="style" href="/assets/css/hydejack-9.1.5.css" id="_stylePreload"><link rel="preload" as="style" href="/assets/icomoon/style.css" id="_iconsPreload"><link rel="preload" as="style" href="https://fonts.googleapis.com/css?family=Architects%20Daughter&display=swap" id="_fontsPreload"> <script> setRel('_stylePreload'); setRel('_iconsPreload'); /**/setRel('_fontsPreload');/**/ </script> <noscript><link rel="stylesheet" href="/assets/css/hydejack-9.1.5.css"><link rel="stylesheet" href="/assets/icomoon/style.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Architects%20Daughter&display=swap"> </noscript><style id="_pageStyle"> html{--accent-color: rgb(79,177,186);--accent-color-faded: rgba(79,177,186,0.5);--accent-color-highlight: rgba(79,177,186,0.1);--accent-color-darkened: #409ba3;--theme-color: rgb(8,46,57);--dark-mode-body-bg: #282f31;--dark-mode-border-color: #343c3f}</style><!--<![endif]--> <!-- robots --><meta name="NaverBot" content="All"/><meta name="NaverBot" content="index,follow"/><meta name="Yeti" content="All"/><meta name="Yeti" content="index,follow"/><meta name="naver-site-verification" content="82d4d6173147a0aba3bdf3afb612c7188e832cf1" /><meta name="google-site-verification" content="qGe3nTw8iiwhc_9vqrjuB8uB0AiMCGPzG8WNTHHC13I" /> <!-- Google AdSense --> <script data-ad-client="ca-pub-9270648935360607" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script> <!-- favicons --><link rel="apple-touch-icon" sizes="57x57" href="/assets/icons/apple-icon-57x57.png"><link rel="apple-touch-icon" sizes="60x60" href="/assets/icons/apple-icon-60x60.png"><link rel="apple-touch-icon" sizes="72x72" href="/assets/icons/apple-icon-72x72.png"><link rel="apple-touch-icon" sizes="76x76" href="/assets/icons/apple-icon-76x76.png"><link rel="apple-touch-icon" sizes="114x114" href="/assets/icons/apple-icon-114x114.png"><link rel="apple-touch-icon" sizes="120x120" href="/assets/icons/apple-icon-120x120.png"><link rel="apple-touch-icon" sizes="144x144" href="/assets/icons/apple-icon-144x144.png"><link rel="apple-touch-icon" sizes="152x152" href="/assets/icons/apple-icon-152x152.png"><link rel="apple-touch-icon" sizes="180x180" href="/assets/icons/apple-icon-180x180.png"><link rel="icon" type="image/png" sizes="192x192" href="/assets/icons/android-icon-192x192.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/icons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="96x96" href="/assets/icons/favicon-96x96.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/icons/favicon-16x16.png"><link rel="manifest" href="/manifest.json"><meta name="msapplication-TileColor" content="#ffffff"><meta name="msapplication-TileImage" content="/ms-icon-144x144.png"><meta name="theme-color" content="#ffffff"> <!-- Code used for embedding Gumroad on the Hydejack Site. Left here for reference, feel free to delete. --><link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet"> <script src="/assets/js/sidebar-folder.js"></script><link rel="stylesheet" href="https://unpkg.com/swiper/swiper-bundle.min.css"> <script src="https://unpkg.com/swiper/swiper-bundle.min.js"></script> <script src="/assets/js/swiper-control.js"></script> <script src="/assets/js/collapsible.js"></script> <script src="/assets/js/mouse-buble.js"></script><link rel="dns-prefetch" href="https://assets.gumroad.com"> <script type="module"> document.querySelector('hy-push-state').addEventListener('load', () => { let tocElement = document.getElementById("markdown-toc"); if(tocElement){ let affixedDiv = document.createElement("div"); affixedDiv.style.position = "relative"; affixedDiv.style.top = "-1rem"; tocElement.parentNode.insertBefore(affixedDiv, tocElement); let headerList = document.getElementsByClassName("permalink"); if(headerList){ let prevElement; window.addEventListener("scroll", () => { let hurdleTop = affixedDiv.getBoundingClientRect().top; if(hurdleTop <= 0) tocElement.classList.add("affix"); else tocElement.classList.remove("affix"); for(let i=0;i<headerList.length;i++){ if(headerList[i].getBoundingClientRect().top >= 0){ prevElement?.style.removeProperty("font-weight"); let tocId = "markdown-toc-" + headerList[i].parentNode.id; prevElement = document.getElementById(tocId); prevElement.style.fontWeight = "bold";; break; } } }); } } }); </script> <script type="module"> let p; const promisify = f => x => new Promise(r => f(x).addEventListener('load', r)); const loadJS = promisify(window.loadJS); document.querySelector('hy-push-state').addEventListener('load', () => { const io = new IntersectionObserver(async (entries) => { if (entries.some(x => x.isIntersecting)) { p = p || loadJS('https://gumroad.com/js/gumroad-embed.js'); await p; if (!window.GumroadEmbed) { await new Promise(function check1(res) { if ('createGumroadEmbed' in window) res(window.createGumroadEmbed()); else setTimeout(() => check1(res), 200); }); } await new Promise(function check2(res) { if ('GumroadEmbed' in window) res(GumroadEmbed.reload()); else setTimeout(() => check2(res), 200); }); } }, { rootMargin: '1440px' }); document.querySelectorAll('.gumroad-product-embed').forEach(el => io.observe(el)); }); </script> <script type="module"> let p; const promisify = f => x => new Promise(r => f(x).addEventListener('load', r)); const loadJS = promisify(window.loadJS); document.querySelector('hy-push-state').addEventListener('load', () => { const io = new IntersectionObserver(async (entries) => { if (entries.some(x => x.isIntersecting)) { p = p || loadJS('https://gumroad.com/js/gumroad.js'); await p; if (!window.GumroadOverlay) { await new Promise(function check(res) { if ('createGumroadOverlay' in window) res(window.createGumroadOverlay()); else setTimeout(() => check(res), 200); }); } } }, { rootMargin: '300px' }); document.querySelectorAll('.gumroad-button').forEach(el => io.observe(el)); }); </script><body class="no-break-layout"> <script> window._sunrise = 6; window._sunset = 18; !function(e,s){var d="light-mode",o="dark-mode",a=(new Date).getHours();"matchMedia"in e&&e.matchMedia("(prefers-color-scheme)")||(o=(e=a<=e._sunrise||a>=e._sunset?o:d)==o?d:o,s.body.classList.add(e),s.body.classList.remove(o))}(window,document); </script> <hy-push-state id="_pushState" replace-selector="#_main" link-selector="a[href]:not([href^='/assets/']):not(.external):not(.no-push-state)" script-selector="script" duration="500" hashchange ><div id="_navbar" class="navbar fixed-top"><div class="content"> <span class="sr-only">Jump to:</span><div class="nav-btn-bar"> <a id="_menu" class="nav-btn no-hover" href="#_drawer--opened"> <span class="sr-only">Navigation</span> <span class="icon-menu"></span> </a><div class="nav-span"></div></div></div></div><hr class="sr-only" hidden /><main id="_main" class="content layout-post" role="main" ><nav id="breadcrumbs" class="screen-only"><ul><li><a href="/">home</a><li> <span>/</span> <a href="/backend/">backend</a><li> <span>/</span> <a href="/backend/server-side/">server-side</a><li> <span>/</span> <span>2021-09-28-cors</span></ul></nav><script async src="https://www.googletagmanager.com/gtag/js?id=G-NKVY3834TW"></script> <script> window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-NKVY3834TW'); </script><article id="post-backend-server-side-cors" class="page post mb6" role="article"><header><h1 class="post-title flip-project-title"> CORS, HTTP Only</h1><div class="post-date"> <span class="ellipsis mr1"> <time datetime="2021-09-28T00:00:00+00:00">28 Sep 2021</time> &nbsp;in&nbsp;<a href="/backend/" class="flip-title"><u>BackEnd</u></a> / <span>Server-side</span> </span></div><div class="img-wrapper lead aspect-ratio sixteen-nine flip-project-img"> <img src="/assets/img/common/code1.png" alt="CORS, HTTP Only" width="864" height="486" loading="lazy" /></div><p class="note-sm" > HTTP, CORS 에 대한 이해 부족으로 발생한 문제</header><ul id="markdown-toc"><li><a href="#sopsame-origin-policy" id="markdown-toc-sopsame-origin-policy">SOP(Same-Origin Policy)</a><li><a href="#corscross-origin-resource-sharing" id="markdown-toc-corscross-origin-resource-sharing">CORS(Cross-Origin Resource Sharing)</a><ul><li><a href="#preflight" id="markdown-toc-preflight">Preflight</a><li><a href="#simple-request" id="markdown-toc-simple-request">Simple Request</a><li><a href="#credentialed-request" id="markdown-toc-credentialed-request">Credentialed Request</a><li><a href="#cors-해결" id="markdown-toc-cors-해결">CORS 해결</a></ul><li><a href="#httponly" id="markdown-toc-httponly">HttpOnly</a></ul><p><br /><p>스스로 <code class="language-plaintext highlighter-rouge">HTTP</code>와 <code class="language-plaintext highlighter-rouge">CORS</code>에 대해 어느정도 이해하고 있다고 생각하고 있었으나, 이번 사이드 프로젝트를 진행 중, 서버를 A to Z로 구축하며 여러번 몇번의 삽질을 하게 되어 삽질을 하게 만든 두 가지 문제와 이 문제의 원인 및 해결방안에 대해 기고합니다.<p><br /><h1 id="sopsame-origin-policy">SOP(Same-Origin Policy)</h1><hr /><p><code class="language-plaintext highlighter-rouge">웹(Web)</code>에는 다른 출처로의 리소스 요청을 제한하는 <code class="language-plaintext highlighter-rouge">SOP(Same-Origin Policy)</code>라는 보안정책이 있습니다.<p>SOP는 2011년에 <a href="https://datatracker.ietf.org/doc/html/rfc6454">RFC-6454</a> 에 제안되었으며, 말 그대로 같은 출처에 대해서만 리소스를 요청할 수 있어야 한다는 보안정책을 의미합니다.<p>이 정책이 나온 이유는 <code class="language-plaintext highlighter-rouge">XSS</code>, <code class="language-plaintext highlighter-rouge">CSRF</code> 등의 보안공격이 주 원인이며, <code class="language-plaintext highlighter-rouge">XSS</code>, <code class="language-plaintext highlighter-rouge">CSRF</code>는 매번 <a href="https://owasp.org/Top10/">OWASP Top 10</a>에 들 정도로 빈번하게 사용되는 위험한 공격방법입니다.<p>흔히 특정 사이트를 똑같이 베낀 페이크 사이트를 통해 민감정보를 탈취하거나 악의적인 스크립트를 내장한 이메일을 무차별로 살포해서 민감정보를 탈취하는 등의 수법들이 있으며, <code class="language-plaintext highlighter-rouge">출처를 모르는 이메일의 링크는 함부로 클릭하지 말라</code>는 말을 다들 어디선가 한번쯤은 들어보셨을 정도로 유명한 공격 방법입니다.<p><br /><blockquote><p>🔔 RFC: 간단하게 모든 인터넷 기술의 표준을 정의한 문서라고 생각해도 무방합니다.</blockquote><p><br /><p>이러한 SOP 정책으로 인해 기본적으로 다른 출처로의 요청은 금지돼있으나, 이렇게 FM으로 다 막아버리면 효율성이 너무 떨어집니다.<p><br /><p>비유가 좀 이상하긴 하지만, 원칙적으로 도로를 건널때는 횡단보도, 육교, 지하도를 통해 건너야 하는데 골목길이나 이면도로같은 곳에서는 현실적으로 무단횡단이 빈번하게 일어나고, 경찰이 이를 보더라도 제지하지는 않습니다.<p>도로가 좁거나 차가 많이 지나다니지 않는곳에선 사고가 발생할 가능성이 현저히 낮기 때문에, 횡단보도가 1km 앞에 있다면 대부분의 사람들은 횡단보도로 건너기 위해 1km를 걸어가느니 그냥 무단횡단하는것을 선택할 가능성이 높습니다.<p>이편이 훨씬 더 시간을 절약할 수 있으니까요. (물론 법적으로는 불법이긴 합니다. 무단횡단은 가급적 하지말고, 하더라도 조심조심 합시다…)<p><br /><p>비슷하게 웹 개발을 하다 보면 타 출처로의 리소스 요청은 빈번하게 있는 일이기 때문에 항상 동일 출처로만 리소스 요청을 하도록 강제하는 것은 위와 비슷한 비효율적인 상황을 빈번하게 조성할 수 있습니다.<p>따라서 타 출처로의 리소스 요청은 <code class="language-plaintext highlighter-rouge">SOP</code>를 근거로 원칙적으로 금지하되, 특정한 조건을 만족하면 타 출처로의 리소스 요청을 허용하는 <code class="language-plaintext highlighter-rouge">CORS</code>라는 이름의 일종의 <code class="language-plaintext highlighter-rouge">위법성 조각 사유</code>를 만들어 놓은 것입니다.<p>만약 CORS 정책마저 만족하지 못한다면 SOP를 근거로 타 출처로의 리소스 요청이 금지되고 웹 브라우저 콘솔창에는 CORS 관련 에러메시지가 표시되게 됩니다.<p><br /><blockquote><p>Access to fetch at ‘http://localhost:3000’ from origin ‘https://www.google.com/’ has been blocked by CORS policy: No ‘Access-Control-Allow-Origin’ header is present on the requested resource. If an opaque response serves your needs, set the request’s mode to ‘no-cors’ to fetch the resource with CORS disabled.</blockquote><p><br /><h1 id="corscross-origin-resource-sharing">CORS(Cross-Origin Resource Sharing)</h1><hr /><p>물론 완벽하게 정확하진 않겠지만, <code class="language-plaintext highlighter-rouge">CORS</code>를 아주 간단하게 요약해보자면 <code class="language-plaintext highlighter-rouge">현재 보고있는 페이지로 현재 페이지를 준 서버와는 다른 서버의 리소스를 가져오는 것</code>을 의미합니다.<p>우리가 웹 브라우저에서 <code class="language-plaintext highlighter-rouge">https://www.google.com/</code>에 접속한다면 다음과 같은 화면을 볼 수 있습니다.<p><br /><p><img src="https://user-images.githubusercontent.com/71188307/135004194-780498b0-2d2a-469c-87c8-ff690fabec22.png" alt="image" /><p><br /><p>위 페이지는 <code class="language-plaintext highlighter-rouge">html</code>, <code class="language-plaintext highlighter-rouge">css</code>, <code class="language-plaintext highlighter-rouge">javascript</code>로 이루어져 있는 <code class="language-plaintext highlighter-rouge">리소스</code>이며, 이러한 데이터들은 모두 <code class="language-plaintext highlighter-rouge">https://www.google.com/</code>라는 <code class="language-plaintext highlighter-rouge">도메인</code>을 사용하고있는 모종의 서버에서 나온 것입니다.<p>이때 위 <code class="language-plaintext highlighter-rouge">리소스</code>의 <code class="language-plaintext highlighter-rouge">출처(Origin)</code>는 <code class="language-plaintext highlighter-rouge">https://www.google.com/</code>가 되는 것이죠.<p><br /><p>그리고 이렇게 <code class="language-plaintext highlighter-rouge">https://www.google.com/</code>에서 받아온 리소스에서 내부적으로 자바스크립트를 통해 <code class="language-plaintext highlighter-rouge">https://www.naver.com/</code>로 임의의 데이터를 요청하는 상황을 <code class="language-plaintext highlighter-rouge">CORS</code>라고 부르게 됩니다.<p><code class="language-plaintext highlighter-rouge">https://www.google.com/</code>와 <code class="language-plaintext highlighter-rouge">https://www.naver.com/</code>는 서로 다른 <code class="language-plaintext highlighter-rouge">출처(Origin)</code>이기 때문이죠.<p><br /><p>여기서 <code class="language-plaintext highlighter-rouge">출처(Origin)</code>에 대해 조금 더 자세히 설명해보자면, <code class="language-plaintext highlighter-rouge">URL</code>과 관련이 있습니다.<p><code class="language-plaintext highlighter-rouge">URL</code>에는 정말 많은 요소가 존재하지만, 기본적으로 아래의 요소가 모두 같은 경우 <code class="language-plaintext highlighter-rouge">출처가 같다(Same-Origin)</code>고 말합니다.<p><br /><p><img src="https://user-images.githubusercontent.com/71188307/135007786-c8e14138-1ed4-489f-9263-f4900feaa55b.png" alt="image" /><p><br /><blockquote><p>위 이미지에서 <code class="language-plaintext highlighter-rouge">Protocol</code>은 <code class="language-plaintext highlighter-rouge">Scheme</code>이라고 부르기도 합니다.</blockquote><p><br /><p>한가지 짚고 넘어가자면 우리는 보통 브라우저에서 <code class="language-plaintext highlighter-rouge">https://www.google.com/</code> 라고 입력하여 구글에 접속하지, <code class="language-plaintext highlighter-rouge">https://www.google.com:443/</code> 이라고 입력해서 접속하진 않죠?<p>이렇게 생략할 수 있는 특별한 <code class="language-plaintext highlighter-rouge">포트(Port)</code>들이 존재하는데 이러한 포트들을 <code class="language-plaintext highlighter-rouge">Well Known Ports</code>라고 부르며, 이 특별한 포트들을 관리하는 범세계적인 기구가 <code class="language-plaintext highlighter-rouge">IANA</code>입니다.<p>위 포트들에 대한 내용은 <a href="https://www.iana.org/">https://www.iana.org/</a>의 <a href="https://www.iana.org/assignments/service-names-port-numbers/service-names-port-numbers.xhtml">Service Name and Transport Protocol Port Number Registry</a>문서에서 확인하실 수 있습니다.<p>위 URL에서 <code class="language-plaintext highlighter-rouge">스킴(Scheme)</code>은 <code class="language-plaintext highlighter-rouge">https</code>이므로 자연스레 <code class="language-plaintext highlighter-rouge">Well Known Port</code>인 <code class="language-plaintext highlighter-rouge">443</code>을 사용하게 되고, 이는 생략할 수 있게 되는것입니다.<p><br /><p>이에 대한 추가적인 레퍼런스는 <code class="language-plaintext highlighter-rouge">HTTP/1.1</code>이 정의된 <a href="https://datatracker.ietf.org/doc/html/rfc2616">RFC-2616</a>을 참고하시면 됩니다.<p><br /><blockquote><p>3.3.2 http URL<p>If the port is empty or not given, port 80 is assumed. The semantics are that the identified resource is located at the server listening for TCP connections on that port of that host, and the Request-URI for the resource is abs_path (section 5.1.2).</blockquote><p><br /><p>혹은 영문서라 부담스럽다 싶으시면 흔히 <code class="language-plaintext highlighter-rouge">다람쥐책</code>이라고 불리우는 <a href="http://www.kyobobook.co.kr/product/detailViewKor.laf?mallGb=KOR&amp;ejkGb=KOR&amp;barcode=9788966261208">HTTP 완벽 가이드</a>를 읽어보시는 것도 좋을 것 같습니다.<p><br /><p><code class="language-plaintext highlighter-rouge">CORS</code>는 세가지 방식을 통해 허용됩니다.<p>일단 명심해야 할 것은 아래의 모든 시나리오는 결국 서버에서 내려주는 응답 헤더에 <code class="language-plaintext highlighter-rouge">Access-Control-Allow-Origin</code>가 포함돼있는지를 알기 위함임을 잊지 말아야 하며, 아래의 모든 시나리오를 잘 이해해야 결과적으로 CORS로 인한 문제를 회피하거나 해결할 수 있습니다.<p><br /><h2 id="preflight">Preflight</h2><hr /><p><code class="language-plaintext highlighter-rouge">사전요청(Preflight)</code>은 타 출처로의 리소스 요청시 요청을 받는 서버에서 CORS 요청에 대한 메서드와 헤더에 대해 인식하고 있는지를 먼저 체크하는 것으로, 가장 일반적인 시나리오입니다.<p><br /><p><img src="https://user-images.githubusercontent.com/71188307/135010498-3dae9a20-3174-440e-a35c-e30f308e6ee4.png" alt="image" /><p><br /><p><code class="language-plaintext highlighter-rouge">사전요청(Preflight)</code>은 <code class="language-plaintext highlighter-rouge">Access-Control-Request-Method</code>, <code class="language-plaintext highlighter-rouge">Access-Control-Request-Headers</code>, <code class="language-plaintext highlighter-rouge">Origin</code> 총 3가지의 <code class="language-plaintext highlighter-rouge">HTTP 요청 헤더</code>를 사용하는 <code class="language-plaintext highlighter-rouge">OPTIONS</code> 요청입니다.<p><br /><blockquote><p><code class="language-plaintext highlighter-rouge">OPTIONS</code>는 <code class="language-plaintext highlighter-rouge">GET</code>, <code class="language-plaintext highlighter-rouge">POST</code>와 같이 자주사용되는 표준 <code class="language-plaintext highlighter-rouge">HTTP Methods</code>의 일종으로 서버가 해당 API에 대해 어떤 옵션들을 허용하고 있는지를 서버에 <code class="language-plaintext highlighter-rouge">질의(Query)</code>하는 요청입니다.</blockquote><p><br /><p>우리가 자바스크립트의 <code class="language-plaintext highlighter-rouge">fetch API</code> 같은 것을 사용하여 브라우저에게 타 서버의 특정 API를 통해 리소스를 받아오라는 명령을 내리면 브라우저는 해당 API로 사전요청을 먼저 보내고, 서버는 사전요청에 대한 응답으로 현재 자신의 특정 API에서 어떤 것들을 허용하고, 어떤 것들을 허용하지 않는지에 대한 정보를 응답 헤더에 담아서 브라우저에게 다시 보내주게 됩니다.<p><br /><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>OPTIONS /resource/foo
Access-Control-Request-Method: DELETE
Access-Control-Request-Headers: origin, x-requested-with
Origin: https://foo.bar.org
</code></pre></div></div><p><br /><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>HTTP/1.1 204 No Content
Connection: keep-alive
Access-Control-Allow-Origin: https://foo.bar.org
Access-Control-Allow-Methods: POST, GET, OPTIONS, DELETE
Access-Control-Max-Age: 86400
</code></pre></div></div><p><br /><p>이후 브라우저는 자신이 타 서버로 보낸 사전요청과 서버가 응답에 담아준 내용을 비교한 후, 이후 보낼 요청을 서버에서 허용하고 있음을 확인하면 다시 같은 API로 본래 보내려던 진짜 요청을 보내게 됩니다.<p>이후 서버가 본 요청에 대한 응답을 하면 브라우저는 최종적으로 이 응답 데이터를 자바스크립트에게 넘겨줍니다.<p>간단하게 <code class="language-plaintext highlighter-rouge">vue cli</code>를 통해 프로젝트를 하나 만들고, <code class="language-plaintext highlighter-rouge">axios</code>를 통해 사전요청 시나리오를 재현해봤습니다.<p><br /><div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">login</span><span class="p">()</span> <span class="p">{</span>
      <span class="kd">let</span> <span class="nx">uri</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">http://www.ark-inflearn.shop/api/v1/login</span><span class="dl">'</span><span class="p">;</span>
      <span class="kd">let</span> <span class="nx">data</span> <span class="o">=</span> <span class="p">{</span>
        <span class="na">email</span><span class="p">:</span> <span class="dl">"</span><span class="s2">test12551@email.com</span><span class="dl">"</span><span class="p">,</span>
        <span class="na">password</span><span class="p">:</span> <span class="dl">"</span><span class="s2">AASHFKHQWFQYW#qwhfgqwf123!</span><span class="dl">"</span><span class="p">,</span>
      <span class="p">}</span>
      <span class="nx">axios</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="nx">uri</span><span class="p">,</span> <span class="nx">data</span><span class="p">)</span>
          <span class="p">.</span><span class="nx">then</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
            <span class="nx">alert</span><span class="p">(</span><span class="dl">"</span><span class="s2">Successes login!</span><span class="dl">"</span><span class="p">);</span>
          <span class="p">})</span>
          <span class="p">.</span><span class="k">catch</span><span class="p">(</span><span class="nx">err</span> <span class="o">=&gt;</span> <span class="p">{</span>
            <span class="nx">alert</span><span class="p">(</span><span class="nx">err</span><span class="p">.</span><span class="nx">response</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">responseBody</span><span class="p">);</span>
          <span class="p">});</span>
    <span class="p">}</span>
</code></pre></div></div><p><br /><p><img src="https://user-images.githubusercontent.com/71188307/135010096-5649b31e-87cc-41ac-899e-f84f19e2ee8d.png" alt="image" /><p><br /><p><code class="language-plaintext highlighter-rouge">Login API</code>에 대해 사전요청이 먼저 발생 후 이에 <code class="language-plaintext highlighter-rouge">200</code> 응답을 받고, <code class="language-plaintext highlighter-rouge">Login API</code>로 본 요청이 전송됐음을 확인할 수 있었습니다.<p><br /><p>만약 서버에서 사전요청에 대한 알맞은 처리가 돼있지 않다면 사전요청 시 아래와 같은 에러 메시지가 발생하게 됩니다.<p><br /><blockquote><p>OPTIONS http://www.ark-inflearn.shop/api/v1/login 405 (Method Not Allowed) Failed to load http://www.ark-inflearn.shop/api/v1/login: Response to preflight request doesn’t pass access control check: No ‘Access-Control-Allow-Origin’ header is present on the requested resource. Origin ‘http://localhost:3000’ is therefore not allowed access. The response had HTTP status code 405. If an opaque response serves your needs, set the request’s mode to ‘no-cors’ to fetch the resource with CORS disabled.</blockquote><p><br /><h2 id="simple-request">Simple Request</h2><hr /><p><img src="https://user-images.githubusercontent.com/71188307/135011649-22134319-3e3e-41c3-9ae7-6c9a516b5d38.png" alt="image" /><p><br /><p><a href="https://developer.mozilla.org/ko/docs/Web/HTTP/CORS#%EC%A0%91%EA%B7%BC_%EC%A0%9C%EC%96%B4_%EC%8B%9C%EB%82%98%EB%A6%AC%EC%98%A4_%EC%98%88%EC%A0%9C">MDN 문서</a>를 보면 특정한 조건을 만족할때 사전요청이 배제된 <code class="language-plaintext highlighter-rouge">단순요청(Simple Request)</code>이 발생한다고 나와있습니다.<p><br /><p><img src="https://user-images.githubusercontent.com/71188307/135011758-fd5c26cf-941a-49e4-9f2b-8db1500bf134.png" alt="image" /><p><br /><p>첫번째 조건은 다른 Http Methods를 쓰면 되지만, 두번째와 세번째 조건을 보니 사실상 단순요청이 발생하는 상황을 만들기가 어려울 것 같다는 생각이 듭니다.<p>대체로 API 서버를 개발할때 <code class="language-plaintext highlighter-rouge">Content-Type</code>은 <code class="language-plaintext highlighter-rouge">application/json</code>이나 <code class="language-plaintext highlighter-rouge">text/xml</code>을 사용하고, 기본적인 HTTP 헤더를 제외한 다른 헤더를 사용하면 안된다는 것은 매우 지키기 어렵기 때문입니다.<p>이 시나리오로 진행할 수 있다면 사전 요청을 생략할 수 있으므로 하는게 좋을 것 같지만, 현실적으로 어려워보이니 그냥 이런것도 있구나 정도로 이해하고 넘기면 될만한 내용인 것 같습니다.<p><br /><h2 id="credentialed-request">Credentialed Request</h2><hr /><p>일반적인 HTTP 요청과 다르게 HTTP 요청에 <code class="language-plaintext highlighter-rouge">자격증명(Credential)</code>이 포함된 경우를 의미합니다.<p>여기서 <code class="language-plaintext highlighter-rouge">자격증명(Credential)</code> 이라는 것은, 인증과 관련된 헤더(JWT, 커스텀 인증키 등)와 쿠키같은 것들을 의미하는데, 기본적으로 브라우저가 제공하는 <code class="language-plaintext highlighter-rouge">XMLHttpRequest</code>나 <code class="language-plaintext highlighter-rouge">Fetch API</code>를 사용하게 되면 요청에 이러한 자격증명을 담지 않습니다.<p>이렇게 되면 만약 서버에서 인증정보를 요구하는 경우, 예를 들자면 <code class="language-plaintext highlighter-rouge">세션-쿠키 방식</code>의 인증체계를 사용하는데, 인증이 필요한 경우에 브라우저에서 절대 쿠키를 보내지 않게 되어 결과적으로 성공적으로 로그인이 됐음에도 서버는 계속해서 인증정보를 요구하는 상황이 발생할 수 있습니다.<p>사용자 입장에서 보면 분명 로그인을 했는데 뭐만하면 계속 로그인 페이지로 이동되는 상황이니 <strong>“무슨 이딴 웹페이지가 다 있냐? 안 써! 😡”</strong> 같은 대참사가 발생할 수도 있는것이죠.<p>따라서 브라우저는 서버에 임의의 요청을 보낼 경우 HTTP 헤더에 인증 정보를 담아야 하는데, 이때 사용할 수 있는 옵션이 <code class="language-plaintext highlighter-rouge">credentials</code> 옵션입니다.<p>이 부분은 코드로 보시는게 더 이해하기 쉬울 것 같습니다.<p><br /><div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">login</span><span class="p">()</span> <span class="p">{</span>
      <span class="kd">let</span> <span class="nx">uri</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">http://www.ark-inflearn.shop/api/v1/login</span><span class="dl">'</span><span class="p">;</span>
      <span class="kd">let</span> <span class="nx">data</span> <span class="o">=</span> <span class="p">{</span>
        <span class="na">email</span><span class="p">:</span> <span class="dl">"</span><span class="s2">test12551@email.com</span><span class="dl">"</span><span class="p">,</span>
        <span class="na">password</span><span class="p">:</span> <span class="dl">"</span><span class="s2">AASHFKHQWFQYW#qwhfgqwf123!</span><span class="dl">"</span><span class="p">,</span>
      <span class="p">}</span>
      <span class="nx">axios</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="nx">uri</span><span class="p">,</span> <span class="nx">data</span><span class="p">,</span> <span class="p">{</span> <span class="na">withCredentials</span><span class="p">:</span> <span class="kc">true</span> <span class="p">})</span>
          <span class="p">.</span><span class="nx">then</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
            <span class="nx">alert</span><span class="p">(</span><span class="dl">"</span><span class="s2">Successes login!</span><span class="dl">"</span><span class="p">);</span>
          <span class="p">})</span>
          <span class="p">.</span><span class="k">catch</span><span class="p">(</span><span class="nx">err</span> <span class="o">=&gt;</span> <span class="p">{</span>
            <span class="nx">alert</span><span class="p">(</span><span class="nx">err</span><span class="p">.</span><span class="nx">response</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">responseBody</span><span class="p">);</span>
          <span class="p">});</span>
    <span class="p">}</span>
</code></pre></div></div><p><br /><p><code class="language-plaintext highlighter-rouge">axios</code> 헤더에 <code class="language-plaintext highlighter-rouge">{ withCredentials: true }</code>라는 코드를 작성했습니다.<p><code class="language-plaintext highlighter-rouge">http://www.ark-inflearn.shop/api/v1/login</code>로 요청을 보낼 때 쿠키 등의 인증정보를 함께 보내겠다는 의미입니다.<p><br /><p>이렇게 보면 매우 간단하지만 이 경우 정말 생각지도 못한 골때리는 문제가 발생합니다. <strong>(제가 이번에 삽질을 하게 된 문제 중 하나가 이 문제였습니다. 😭)</strong><p><br /><p><img src="https://user-images.githubusercontent.com/71188307/135012824-6d09b235-25f6-4083-9d53-f50343cccd7e.png" alt="image" /><p>바로 <code class="language-plaintext highlighter-rouge">Access-Control-Allow-Origin</code>에 <code class="language-plaintext highlighter-rouge">와일드카드(*, asterisk)</code>를 사용할 수 없다는 것입니다.<p><br /><p><img src="https://user-images.githubusercontent.com/71188307/135025098-ce105d55-c60d-481e-bf86-8bc3f6a71151.png" alt="image" /><p><br /><p>와일드카드를 통해 어떤 경우에라도 CORS 헤더를 응답하는것을 허용하겠다고 했는데 되려 와일드카드를 사용했기 때문에 안된다니? 처음에 이 부분이 정말 이해가 안되서 삽질을 했던거죠.<p>바로 CORS 시나리오 중 HTTP 요청에 <code class="language-plaintext highlighter-rouge">자격증명(Credential)</code>이 포함됐을 경우에 대한 내용을 이해하지 못했기 때문이었습니다.<p>이 시나리오에서는 두가지 규칙을 반드시 지켜야만 합니다.<p><br /><ul><li><code class="language-plaintext highlighter-rouge">Access-Control-Allow-Origin</code>에는 <code class="language-plaintext highlighter-rouge">*</code>를 사용할 수 없으며, <code class="language-plaintext highlighter-rouge">반드시 명시적인 URL을 작성</code>해야 합니다.<li>응답 헤더에는 반드시 <code class="language-plaintext highlighter-rouge">Access-Control-Allow-Credentials: true</code>가 존재해야 합니다.</ul><p><br /><p>이 내용을 이해했음에도 약간 더 삽질을 하게 됐는데, 우리가 진행하는 사이드 프로젝트의 현 상황때문이었습니다.<p>백엔드 서버는 구축이 되어 특정한 도메인을 갖고 24시간 가동중인데, 프론트 서버가 아직 구축되지 않은 상태라 프론트 팀에서는 각자의 로컬에 프론트 서버를 띄우고 작업하고 있었기 때문에 명시할 URL이 마땅찮았습니다. <strong>(보안상 권장되지 않는 방법임에도 불구하고 <code class="language-plaintext highlighter-rouge">와일드카드</code>를 통해 CORS를 허용한 이유이기도 합니다)</strong><p>로컬에서 리액트 프로젝트를 <code class="language-plaintext highlighter-rouge">npm run dev</code>등의 명령어를 통해 띄울 경우 <code class="language-plaintext highlighter-rouge">http://localhost:3000</code>으로 서버가 뜨니 생각나는 URL이래봐야 <code class="language-plaintext highlighter-rouge">http://localhost:3000/</code>이라던가 <code class="language-plaintext highlighter-rouge">http://127.0.0.1:3000</code> 따위의 것들인데, 해봤자 안될게 뻔했기 때문이죠. (내부적으로 <code class="language-plaintext highlighter-rouge">hosts</code> 파일을 통해 라우팅되는 도메인이므로…😫)<p><strong>결국 생각나는 유효한 방법은 프론트 개발자들이 사용하는 로컬 서버의 공인 IP를 전달받아 모두 등록하는 방법</strong>뿐이었습니다.<p>그리고 이 방법은 일단 사용하고 싶지 않았습니다.<p><br /><h2 id="cors-해결">CORS 해결</h2><hr /><blockquote><p>여기부턴 자바, 스프링 부트와 스프링 시큐리티의 내용을 다룹니다.</blockquote><p><br /><p>CORS관련 문제의 원인은 알았는데, 마땅한 해결 방법을 찾지 못하던 중 다행히 <code class="language-plaintext highlighter-rouge">스프링 시큐리티(Spring Security)</code>의 문서에서 이러한 상황을 해결할 수 있는 방법을 찾아냈습니다.<p><br /><p><img src="https://user-images.githubusercontent.com/71188307/135013475-d3de96f2-d5fb-4f8f-ac67-4f00c3e7bc4b.png" alt="image" /><p><br /><p>스프링 부트에서는 스프링 MVC를 통해 CORS를 허용하는 방법과 스프링 시큐리티를 통해 CORS를 허용하는 두가지 방법이 있습니다.<p>스프링 MVC 공식 문서의 <a href="https://docs.spring.io/spring-framework/docs/current/reference/html/web.html#mvc-cors">CORS 섹션</a> 에서는 CORS를 허용하려면 다음과 같은 코드를 작성하라고 소개해주고 있습니다.<p><br /><div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Configuration</span>
<span class="nd">@EnableWebMvc</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">WebConfig</span> <span class="kd">implements</span> <span class="nc">WebMvcConfigurer</span> <span class="o">{</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">addCorsMappings</span><span class="o">(</span><span class="nc">CorsRegistry</span> <span class="n">registry</span><span class="o">)</span> <span class="o">{</span>

        <span class="n">registry</span><span class="o">.</span><span class="na">addMapping</span><span class="o">(</span><span class="s">"/api/**"</span><span class="o">)</span>
            <span class="o">.</span><span class="na">allowedOrigins</span><span class="o">(</span><span class="s">"https://domain2.com"</span><span class="o">)</span>
            <span class="o">.</span><span class="na">allowedMethods</span><span class="o">(</span><span class="s">"PUT"</span><span class="o">,</span> <span class="s">"DELETE"</span><span class="o">)</span>
            <span class="o">.</span><span class="na">allowedHeaders</span><span class="o">(</span><span class="s">"header1"</span><span class="o">,</span> <span class="s">"header2"</span><span class="o">,</span> <span class="s">"header3"</span><span class="o">)</span>
            <span class="o">.</span><span class="na">exposedHeaders</span><span class="o">(</span><span class="s">"header1"</span><span class="o">,</span> <span class="s">"header2"</span><span class="o">)</span>
            <span class="o">.</span><span class="na">allowCredentials</span><span class="o">(</span><span class="kc">true</span><span class="o">).</span><span class="na">maxAge</span><span class="o">(</span><span class="mi">3600</span><span class="o">);</span>

        <span class="c1">// Add more mappings...</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div><p><br /><p>반대로 스프링 시큐리티 공식문서의 <a href="https://docs.spring.io/spring-security/site/docs/4.2.x/reference/html/cors.html#cors">CORS 섹션</a>에서는 이렇게 서술합니다.<blockquote><p>Spring Framework provides first class support for CORS. CORS must be processed before Spring Security because the pre-flight request will not contain any cookies (i.e. the JSESSIONID). If the request does not contain any cookies and Spring Security is first, the request will determine the user is not authenticated (since there are no cookies in the request) and reject it.<p>The easiest way to ensure that CORS is handled first is to use the CorsFilter. Users can integrate the CorsFilter with Spring Security by providing a CorsConfigurationSource using the following:</blockquote><p><br /><blockquote><p>🤔 <code class="language-plaintext highlighter-rouge">JSESSIONID</code> ? :<p>자바 서블릿이 정의한 쿠키 이름 표준 스펙입니다.<p>자바 서블릿을 구현한 구현체로 <code class="language-plaintext highlighter-rouge">네티</code>, <code class="language-plaintext highlighter-rouge">언더토우</code>, <code class="language-plaintext highlighter-rouge">톰캣</code>, <code class="language-plaintext highlighter-rouge">아파치</code> 등등이 있는데, 이처럼 자바 서블릿을 구현한 웹 서버라면 기본적으로 자바 서블릿 표준 스펙을 따르기 때문에 쿠키 이름이 <code class="language-plaintext highlighter-rouge">JSESSIONID</code>으로 응답됩니다.<p>이는 서버 개발자가 임의로 변경할수도 있습니다.<p>편의상 자바 진영에서 톰캣을 가장 많이 사용하기 때문에 톰캣이 발급하는 쿠키 이름이라고도 많이 표현되는 편입니다.<p><code class="language-plaintext highlighter-rouge">📜 관련 레퍼런스</code>: https://javaee.github.io/servlet-spec/downloads/servlet-4.0/servlet-4_0_FINAL.pdf<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>7.1.1 Cookies

...

The container sends a cookie to the client. The client will then return the cookie on
each subsequent request to the server, unambiguously associating the request with a
session. The standard name of the session tracking cookie must be JSESSIONID.
Containers may allow the name of the session tracking cookie to be customized
through container specific configuration.

...
</code></pre></div></div></blockquote><p><br /><p>위 내용에 대해 설명드리자면, <code class="language-plaintext highlighter-rouge">사전요청(Preflight)</code>에는 쿠키가 없으므로 CORS는 반드시 스프링 시큐리티보다 먼저 체크되고 처리되어야 한다는 것입니다.<p>왜냐하면 쿠키가 없는 요청에 대해 스프링 시큐리티가 검증하려들면, 쿠키가 없기 때문에 인증되지 않은 사용자로 구분될 것이 분명하고 결과적으로 요청이 항상 튕겨져 나가게 되기 때문입니다.<p>이를 스프링 시큐리티에서 가장 간단하게 해결할 수 있는 방법으로 <code class="language-plaintext highlighter-rouge">CorsFilter</code>를 사용하는 방법을 소개하고 있습니다.<p><br /><blockquote><p>이러한 이유로 <code class="language-plaintext highlighter-rouge">CorsFilter</code>는 <code class="language-plaintext highlighter-rouge">Spring Security Filter Chain</code>의 선두에 위치하고 있습니다.</blockquote><p><br /><p>저는 스프링 시큐리티를 사용하므로 모든 인증 관련 처리를 스프링 시큐리티에서 통합해 관리하고 싶어 스프링 MVC를 사용한 방식이 아닌 스프링 시큐리티의 <code class="language-plaintext highlighter-rouge">CorsFilter</code>를 설정했고, 아래와 같은 코드를 추가했습니다.<p><br /><div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Override</span>
<span class="kd">protected</span> <span class="kt">void</span> <span class="nf">configure</span><span class="o">(</span><span class="kd">final</span> <span class="nc">HttpSecurity</span> <span class="n">http</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
    <span class="n">http</span>
        <span class="o">.</span><span class="na">cors</span><span class="o">()</span> <span class="c1">// Bean으로 등록된 CorsFilter를 사용. Bean이 없다면 스프링 시큐리티에서 제공하는 기본 CorsFilter 사용.</span>
    <span class="o">...</span>
<span class="o">}</span>

<span class="nd">@Bean</span> <span class="c1">// Bean으로 등록 필요</span>
<span class="kd">public</span> <span class="nc">CorsConfigurationSource</span> <span class="nf">corsConfigurationSource</span><span class="o">()</span> <span class="o">{</span>
    <span class="nc">CorsConfiguration</span> <span class="n">configuration</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">CorsConfiguration</span><span class="o">();</span>

    <span class="n">configuration</span><span class="o">.</span><span class="na">setAllowedOrigins</span><span class="o">(</span><span class="nc">Collections</span><span class="o">.</span><span class="na">singletonList</span><span class="o">(</span><span class="s">"*"</span><span class="o">));</span> <span class="c1">// 모든 Origin에서의 요청을 허용</span>
    <span class="n">configuration</span><span class="o">.</span><span class="na">setAllowedMethods</span><span class="o">(</span><span class="nc">List</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="s">"GET"</span><span class="o">,</span> <span class="s">"POST"</span><span class="o">,</span> <span class="s">"PUT"</span><span class="o">,</span> <span class="s">"PATCH"</span><span class="o">,</span> <span class="s">"DELETE"</span><span class="o">,</span> <span class="s">"OPTIONS"</span><span class="o">));</span> <span class="c1">// 해당 Http Methods를 사용하는 요청을 허용</span>
    <span class="n">configuration</span><span class="o">.</span><span class="na">setAllowedHeaders</span><span class="o">(</span><span class="nc">List</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="s">"authorization"</span><span class="o">,</span> <span class="s">"content-type"</span><span class="o">,</span> <span class="s">"x-auth-token"</span><span class="o">));</span> <span class="c1">// 해당 헤더를 사용하는 요청을 허용</span>
    <span class="n">configuration</span><span class="o">.</span><span class="na">setExposedHeaders</span><span class="o">(</span><span class="nc">Collections</span><span class="o">.</span><span class="na">singletonList</span><span class="o">(</span><span class="s">"x-auth-token"</span><span class="o">));</span> <span class="c1">// 헤더에 CSRF 토큰이 있는 요청에 대해 모든 응답 헤더를 노출</span>
    <span class="n">configuration</span><span class="o">.</span><span class="na">setAllowCredentials</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span> <span class="c1">// 사용자 자격 증명(쿠키, 인증키) 사용을 허용할 것</span>

    <span class="nc">UrlBasedCorsConfigurationSource</span> <span class="n">source</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">UrlBasedCorsConfigurationSource</span><span class="o">();</span>
    <span class="n">source</span><span class="o">.</span><span class="na">registerCorsConfiguration</span><span class="o">(</span><span class="s">"/**"</span><span class="o">,</span> <span class="n">configuration</span><span class="o">);</span> <span class="c1">// 모든 URL에 대해 위의 설정을 사용해 CORS 처리를 할 것</span>
    <span class="k">return</span> <span class="n">source</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></div></div><p><br /><div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">configuration</span><span class="o">.</span><span class="na">setAllowedOrigins</span><span class="o">(</span><span class="nc">Collections</span><span class="o">.</span><span class="na">singletonList</span><span class="o">(</span><span class="s">"*"</span><span class="o">));</span>
</code></pre></div></div><p><br /><p>위 코드가 문제였는데, 명시해야 할 URL이 없었기 때문입니다.<p>다행히 스프링 시큐리티 팀에서 해당 문제를 회피할 수 있는 <code class="language-plaintext highlighter-rouge">setAllowedOriginPatterns</code>라는 API를 하나 제공하고 있었습니다.<p><br /><div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">configuration</span><span class="o">.</span><span class="na">setAllowedOriginPatterns</span><span class="o">(</span><span class="nc">Collections</span><span class="o">.</span><span class="na">singletonList</span><span class="o">(</span><span class="s">"*"</span><span class="o">));</span>
</code></pre></div></div><p><br /><p>이 API에 대한 문서를 찾아보니 다음과 같은 내용이 있습니다.<p><br /><div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>public CorsConfiguration setAllowedOriginPatterns(@Nullable List&lt;String&gt; allowedOriginPatterns)

Alternative to setAllowedOrigins(java.util.List&lt;java.lang.String&gt;) that supports more flexible origins patterns with "*" anywhere in the host name in addition to port lists. Examples:

https://*.domain1.com -- domains ending with domain1.com
https://*.domain1.com:[8080,8081] -- domains ending with domain1.com on port 8080 or port 8081
https://*.domain1.com:[*] -- domains ending with domain1.com on any port, including the default port

In contrast to allowedOrigins which only supports "*" and cannot be used with allowCredentials, when an allowedOriginPattern is matched, the Access-Control-Allow-Origin response header is set to the matched origin and not to "*" nor to the pattern. 
Therefore allowedOriginPatterns can be used in combination with setAllowCredentials(java.lang.Boolean) set to true.

By default this is not set.

Since:
5.3
</code></pre></div></div><p><br /><p>즉, <code class="language-plaintext highlighter-rouge">Origin</code>을 명시해야 하는데, 명시해야 할 <code class="language-plaintext highlighter-rouge">Origin</code>이 마땅치 않으니 이를 패턴을 통해 보다 더 유연한 방법으로 요청을 구분하고 허용하는 것입니다.<p>간단히 말해 위와 아래의 차이는 <code class="language-plaintext highlighter-rouge">서버로 오는 모든 요청에 대해 허용</code>하느냐, <code class="language-plaintext highlighter-rouge">서버로 오는 모든 요청 중 특정한 패턴을 만족하는 요청만 허용</code>하느냐의 차이인 것이죠…<p>저는 근데 여기다가 와일카드를 사용했고, 이는 <code class="language-plaintext highlighter-rouge">서버로 오는 모든 요청 중 모든 패턴의 요청을 허용</code>이 되므로 결과적으로 말장난 같긴 합니다 ㅎㅎㅎ 🤣<p>아마 내부적으로는 모종의 복잡한 과정을 거쳐 결과적으로 <code class="language-plaintext highlighter-rouge">configuration.setAllowedOrigins(Collections.singletonList("*"));</code>를 사용한 것과 같은 효과를 내게 되겠죠?<p>아무튼 이렇게 CORS 문제를 해결할 수 있었습니다.<p>하지만 이게 끝이 아니었습니다… 😣<p><br /><h1 id="httponly">HttpOnly</h1><hr /><p>이건 뭔지 몰라서 실제로 문제가 없는데 문제가 있는 걸로 착각했던 내용이었습니다.<p>CORS 문제를 해결했음에도 불구하고 크롬 개발자도구에서 서버에서 응답한 쿠키를 찾을 수 없어서, 서버에서 인증요청에 대한 쿠키가 제대로 응답되지 않은 줄 알았습니다.<p>그래서 패킷을 까봤는데, HTTP 응답 헤더에는 쿠키가 제대로 들어있었죠. 🤔<p><br /><p><img src="https://user-images.githubusercontent.com/71188307/135028565-22ab60dd-8a1a-4dd4-8f35-23adaa44181b.png" alt="image" /><p><br /><p>근데 위 이미지에서 보시다시피 맨 끝에 <code class="language-plaintext highlighter-rouge">HttpOnly</code>라는 알수없는 태그가 <code class="language-plaintext highlighter-rouge">노란 느낌표</code>와 함께 달려있었고, 이게 원인인것 같아 찾아보다가 결국 <code class="language-plaintext highlighter-rouge">OWASP</code> 에서 <a href="https://owasp.org/www-community/HttpOnly">관련 내용</a>을 찾을 수 있었습니다.<p><br /><blockquote><p>If the HttpOnly flag (optional) is included in the HTTP response header, the cookie cannot be accessed through client side script (again if the browser supports this flag). As a result, even if a cross-site scripting (XSS) flaw exists, and a user accidentally accesses a link that exploits this flaw, the browser (primarily Internet Explorer) will not reveal the cookie to a third party.</blockquote><p><br /><p>원칙적으로 <code class="language-plaintext highlighter-rouge">SOP</code>에 의해 <code class="language-plaintext highlighter-rouge">출처(Origin)</code>가 다른 서버에서 리소스를 얻어올 수 없는데, 이를 <code class="language-plaintext highlighter-rouge">CORS</code> 정책을 통해 임의의 리소스를 얻어오게 되면 자연스럽게 <code class="language-plaintext highlighter-rouge">XSS</code>, <code class="language-plaintext highlighter-rouge">CSRF</code> 등의 공격에 취약해지게 됩니다.<p>따라서 이 문제를 보완하기 위한 추가적인 보안 기법이 적용됬는데, 이게 바로 <code class="language-plaintext highlighter-rouge">HttpOnly</code>라는 이름의 <code class="language-plaintext highlighter-rouge">세션 탈취 방어 기법</code>입니다.<p><code class="language-plaintext highlighter-rouge">HttpOnly</code>는 HttpOnly가 설정된 쿠키는 HTTP 통신 상에서만 사용되어야 한다는 것으로, HTTP 통신에서만 사용되는 데이터이기 때문에 자바스크립트 같은 외부 프로세스가 접근할 수 없게 됩니다.<p><br /><p>쉽게 말하자면 <strong>“이거 원래 안되는건데 니가 하도 달라고해서 준거니까, 여기다 이상한짓 하지말고 준대로 쓰기만 해 !”</strong> 라고 강제하는 것입니다.<p><br /><p>실제로 자바스크립트를 통해 해당 쿠키에 접근하려고 하니 <code class="language-plaintext highlighter-rouge">HttpOnly 설정이 되어 있어 액세스할 수 없다는 에러 메시지가 발생</code>하였습니다. (이미지 캡처를 깜빡했습니다…)<p><br /><p>하지만 <code class="language-plaintext highlighter-rouge">HttpOnly</code>는 세션 관련 공격들에 대해 최소한의 방어는 보장하지만, <code class="language-plaintext highlighter-rouge">XST(Cross-site Tracing)</code> 공격의 여지가 조금이나마 남아있어 결국 완벽한 방어는 보장하지 못하기 때문에, 고수준의 보안 정책을 고려한다면 결국 <code class="language-plaintext highlighter-rouge">XSS Filter</code>, <code class="language-plaintext highlighter-rouge">CSRF Filter</code>등의 추가적인 보안 시스템을 구축해야 합니다.<p><br /><p>정리하자면 CORS 문제를 해결했고 이후 정상적인 인증과정을 거쳐 서버에서는 인증 쿠키를 응답하였으나 해당 쿠키는 <code class="language-plaintext highlighter-rouge">HttpOnly</code>가 적용된 보안 쿠키였기 때문에, 클라이언트 환경에서 해당 쿠키가 노출되지 않는 상태였습니다.<p>저는 쿠키가 넘어오지 않는 <strong>(실제론 넘어왔으나 보이지만 않은 😅)</strong> 이 상황이 이해되지 않아 HTTP 패킷을 뜯어 HTTP 헤더를 분석했고, 거기서 숨겨져있는 쿠키와 함께 HttpOnly라는 키워드를 얻어 이 문제의 전말을 깨닫게 된 것이죠. 🤣<p><br /><p>원래 정상인걸 문제있다고 오판한 것이니 해결방법이랄건 딱히 없었고 좋은 것 하나 배웠다고 생각합니다.<p><br /></article><hr class="dingbat related mb6" /><aside class="about related mt4 mb4" role="complementary"><div class="author mt4"> <img src="/assets/img/me.gif" srcset="/assets/img/me.gif 1x,/assets/img/me.gif 2x" alt="shirohoo" class="avatar" width="120" height="120" loading="lazy" /><h2 class="page-title hr-bottom"> About Me</h2><div class="sidebar-social"> <span class="sr-only">Social:</span><ul><li> <a href="https://github.com/shirohoo" title="GitHub" class="no-mark-external"> <span class="icon-github"></span> <span class="sr-only">GitHub</span> </a><li> <a href="mailto:shirohoo4102@gmail.com" title="Email" class="no-mark-external"> <span class="icon-mail"></span> <span class="sr-only">Email</span> </a><li> <a href="https://shirohoo.github.io/feed.xml" title="RSS" class="no-mark-external"> <span class="icon-rss2"></span> <span class="sr-only">RSS</span> </a></ul></div></div></aside><aside class="other-projects related mb0" role="complementary"><h2>Related Posts</h2><div class="columns"><div class="column column-1-2"><article class="project-card"> <a href="/financial/2023-09-17-financial-1/" class="no-hover no-print-link flip-project" tabindex="-1"><div class="project-card-img aspect-ratio sixteen-nine flip-project-img"> <img src="/assets/img/debugging/debugging.jpg" alt="전자지급결제서비스" width="864" height="486" loading="lazy"/></div></a><h3 class="project-card-title flip-project-title"> <a href="/financial/2023-09-17-financial-1/" class="flip-title">전자지급결제서비스</a></h3><p class="project-card-text fine" property="disambiguatingDescription"> 전자지급결제서비스를 이해해봅시다 <a class="fill-card no-hover" href="/financial/2023-09-17-financial-1/" tabindex="-1"><span class="sr-only">Continue reading 전자지급결제서비스</span></a></article></div><div class="column column-1-2"><article class="project-card"> <a href="/diary/2023-09-14-diary-51/" class="no-hover no-print-link flip-project" tabindex="-1"><div class="project-card-img aspect-ratio sixteen-nine flip-project-img"> <img src="/assets/img/debugging/debugging.jpg" alt="C 레벨의 경이로운 결정과 어이없고 화나는 장애" width="864" height="486" loading="lazy"/></div></a><h3 class="project-card-title flip-project-title"> <a href="/diary/2023-09-14-diary-51/" class="flip-title">C 레벨의 경이로운 결정과 어이없고 화나는 장애</a></h3><p class="project-card-text fine" property="disambiguatingDescription"> 속풀이 <a class="fill-card no-hover" href="/diary/2023-09-14-diary-51/" tabindex="-1"><span class="sr-only">Continue reading C 레벨의 경이로운 결정과 어이없고 화나는 장애</span></a></article></div></div></aside><aside class="related mb4" role="complementary"><h2 class="hr-bottom">Random Posts</h2><ul class="related-posts"><li class="h6"><div> <time style="display: inline-block; margin-right: 1rem;" class="faded fine" datetime="2021-12-23T00:00:00+00:00">23 Dec 2021</time> <a href="/diary/2021-12-23-diary-30/" class="flip-title"><span>결제 서비스 개발기</span></a></div><li class="h6"><div> <time style="display: inline-block; margin-right: 1rem;" class="faded fine" datetime="2022-02-19T00:00:00+00:00">19 Feb 2022</time> <a href="/cs/operating-system/2022-02-19-cpu-scheduling/" class="flip-title"><span>운영체제(Operating System) 4강</span></a></div><li class="h6"><div> <time style="display: inline-block; margin-right: 1rem;" class="faded fine" datetime="2022-07-21T00:00:00+00:00">21 Jul 2022</time> <a href="/cs/software-design/2022-07-21-git-objects/" class="flip-title"><span>Git의 구조 - Objects</span></a></div></ul></aside><aside class="comments related" role="complementary"><h2 class="hr-bottom">Comments</h2><script src="https://utteranc.es/client.js" repo= shirohoo/shirohoo.github.io.comments issue-term= pathname theme= github-light crossorigin= "anonymous" async> </script></aside><footer class="content" role="contentinfo"><hr/><p><small class="copyright">© 2022. All rights reserved. </small><nav class="legal"><small> <a class="heading flip-title" href="/LICENSE/">LICENSE</a> </small></nav><hr class="sr-only"/></footer></main><hy-drawer id="_drawer" class="" side="left" threshold="10" noscroll ><header id="_sidebar" class="sidebar" role="banner"><div class="sidebar-bg " style="background:url('/assets/img/common/code1.png') center/cover"></div><div class="sidebar-sticky"><div class="sidebar-about"> <a class="no-hover" href="/" tabindex="-1"> <img src="/assets/img/me.gif" class="avatar" alt="돈 받고 일하면 프로" width="120" height="120" loading="lazy" /> </a> <a class="sidebar-title" href="/"><h2 class="h1">돈 받고 일하면 프로</h2></a><p class=""> 우리는 직장에서 훈련을 하기 때문에 매번 실수를 반복한다</div><nav class="sidebar-nav heading" role="navigation"> <span class="sr-only">Navigation:</span><ul><li><div class="menu-wrapper" onmouseover="javascript:spread(9)" onmouseout="javascript:spread(9)"> <a id="_drawer--opened" href="/about/" class="sidebar-nav-item " > About Me </a></div><li><div class="menu-wrapper" onmouseover="javascript:spread(10)" onmouseout="javascript:spread(10)"> <a href="/diary/" class="sidebar-nav-item " > Diary </a></div><li><div class="menu-wrapper" onmouseover="javascript:spread(11)" onmouseout="javascript:spread(11)"> <a href="/financial/" class="sidebar-nav-item " > Financial </a></div><li><div class="menu-wrapper" onmouseover="javascript:spread(12)" onmouseout="javascript:spread(12)"> <a href="/debugging/" class="sidebar-nav-item " > Debugging </a></div><li><div class="menu-wrapper" onmouseover="javascript:spread(13)" onmouseout="javascript:spread(13)"> <button class="spread-btn"> <span id="spread-icon-13" class="material-icons">arrow_right</span> </button> <a href="/cs/" class="sidebar-nav-item " > Computer Science </a><div id="submenu-13" class="menu-wrapper submenu hide"><ul style="list-style: none;"><li> <a class="sidebar-nav-item " href="/cs/operating-system/" > 운영체제 </a><li> <a class="sidebar-nav-item " href="/cs/software-design/" > 소프트웨어 설계 </a><li> <a class="sidebar-nav-item " href="/cs/database-construct/" > 데이터베이스 구축 </a><li> <a class="sidebar-nav-item " href="/cs/leverage-programming/" > 프로그래밍 활용 </a><li> <a class="sidebar-nav-item " href="/cs/information-system/" > 정보시스템 구축 </a><li> <a class="sidebar-nav-item " href="/cs/data-structure-algorithm/" > 자료구조 & 알고리즘 </a></ul></div></div><li><div class="menu-wrapper" onmouseover="javascript:spread(14)" onmouseout="javascript:spread(14)"> <button class="spread-btn"> <span id="spread-icon-14" class="material-icons">arrow_right</span> </button> <a href="/backend/" class="sidebar-nav-item " > BackEnd </a><div id="submenu-14" class="menu-wrapper submenu hide"><ul style="list-style: none;"><li> <a class="sidebar-nav-item " href="/backend/test/" > Test </a><li> <a class="sidebar-nav-item " href="/backend/java/" > Java </a><li> <a class="sidebar-nav-item " href="/backend/python/" > Python </a><li> <a class="sidebar-nav-item " href="/backend/groovy/" > Groovy </a><li> <a class="sidebar-nav-item " href="/backend/gradle/" > Gradle </a><li> <a class="sidebar-nav-item " href="/backend/database/" > Database </a><li> <a class="sidebar-nav-item " href="/backend/server-side/" > Server Side </a></ul></div></div><li><div class="menu-wrapper" onmouseover="javascript:spread(15)" onmouseout="javascript:spread(15)"> <button class="spread-btn"> <span id="spread-icon-15" class="material-icons">arrow_right</span> </button> <a href="/spring/" class="sidebar-nav-item " > Spring </a><div id="submenu-15" class="menu-wrapper submenu hide"><ul style="list-style: none;"><li> <a class="sidebar-nav-item " href="/spring/spring-boot/" > Spring Boot </a><li> <a class="sidebar-nav-item " href="/spring/spring-mvc/" > Spring MVC </a><li> <a class="sidebar-nav-item " href="/spring/spring-security/" > Spring Security </a><li> <a class="sidebar-nav-item " href="/spring/spring-data-jpa/" > Spring Data Jpa </a><li> <a class="sidebar-nav-item " href="/spring/spring-batch/" > Spring Batch </a><li> <a class="sidebar-nav-item " href="/spring/spring-webflux/" > Spring WebFlux </a><li> <a class="sidebar-nav-item " href="/spring/spring-cloud/" > Spring Cloud </a></ul></div></div><li><div class="menu-wrapper" onmouseover="javascript:spread(16)" onmouseout="javascript:spread(16)"> <button class="spread-btn"> <span id="spread-icon-16" class="material-icons">arrow_right</span> </button> <a href="/frontend/" class="sidebar-nav-item " > FrontEnd </a><div id="submenu-16" class="menu-wrapper submenu hide"><ul style="list-style: none;"><li> <a class="sidebar-nav-item " href="/frontend/javascript/" > Javascript </a><li> <a class="sidebar-nav-item " href="/frontend/vue/" > Vue.js </a></ul></div></div><li><div class="menu-wrapper" onmouseover="javascript:spread(17)" onmouseout="javascript:spread(17)"> <button class="spread-btn"> <span id="spread-icon-17" class="material-icons">arrow_right</span> </button> <a href="/ide/" class="sidebar-nav-item " > IDE </a><div id="submenu-17" class="menu-wrapper submenu hide"><ul style="list-style: none;"><li> <a class="sidebar-nav-item " href="/ide/intellij/" > IntelliJ </a></ul></div></div></ul></nav><div style="text-align:center;"> <a href="https://hits.seeyoufarm.com"> <img src="https://hits.seeyoufarm.com/api/count/incr/badge.svg?url=https%3A%2F%2Fshirohoo.github.io&count_bg=%23A30AC9&title_bg=%23686262&icon=electron.svg&icon_color=%23FFFFFF&title=hits&edge_flat=false"/> </a></div><div class="sidebar-social"> <span class="sr-only">Social:</span><ul><li> <a href="https://github.com/shirohoo" title="GitHub" class="no-mark-external"> <span class="icon-github"></span> <span class="sr-only">GitHub</span> </a><li> <a href="mailto:shirohoo4102@gmail.com" title="Email" class="no-mark-external"> <span class="icon-mail"></span> <span class="sr-only">Email</span> </a><li> <a href="https://shirohoo.github.io/feed.xml" title="RSS" class="no-mark-external"> <span class="icon-rss2"></span> <span class="sr-only">RSS</span> </a></ul></div></div></header></hy-drawer><hr class="sr-only" hidden /> </hy-push-state> <!--[if gt IE 10]><!----> <script nomodule>!function(){var t,n=document.createElement("script");!("noModule"in n)&&"onbeforeload"in n&&(t=!1,document.addEventListener("beforeload",function(e){if(e.target===n)t=!0;else if(!e.target.hasAttribute("nomodule")||!t)return;e.preventDefault()},!0),n.type="module",n.src=".",document.head.appendChild(n),n.remove())}(); </script> <script src="/assets/js/hydejack-9.1.5.js" type="module"></script> <script src="/assets/js/LEGACY-hydejack-9.1.5.js" nomodule defer></script> <!-- mouse event cancel --> <script> document.oncontextmenu = function (e) { return false; }; document.onselectstart = function (e) { return false; }; </script> <script>!function(w, d) { w.ga=w.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date; /**/ ga('create', 'G-NKVY3834TW', 'auto'); /**/ var pushStateEl = d.getElementById('_pushState'); var timeoutId; pushStateEl.addEventListener('hy-push-state-load', function() { w.clearTimeout(timeoutId); timeoutId = w.setTimeout(function() { ga('set', 'page', w.location.pathname); ga('send', 'pageview'); }, 500); }); d.addEventListener('hy--cookies-ok', function () { w.ga(function(tracker) { w.ga("set", "anonymizeIp", undefined); localStorage && localStorage.setItem("ga--client-id", tracker.get("clientId")); }); }); w.loadJSDeferred('https://www.google-analytics.com/analytics.js'); }(window, document);</script> <!--<![endif]--><div hidden><h2 class="sr-only">Templates (for web app):</h2><clap-config> <clap-text at="1">Keep going!</clap-text> <clap-text at="2">Keep going ×2!</clap-text> <clap-text at="3">Give me more!</clap-text> <clap-text at="5">Thank you, thank you</clap-text> <clap-text at="7">Far too kind!</clap-text> <clap-text at="10">Never gonna give me up?</clap-text> <clap-text at="14">Never gonna let me down?</clap-text> <clap-text at="20">Turn around and desert me!</clap-text> <clap-text at="30">You're an addict!</clap-text> <clap-text at="40">Son of a clapper!</clap-text> <clap-text at="50">No way</clap-text> <clap-text at="60">Go back to work!</clap-text> <clap-text at="70">This is getting out of <em>hand</em></clap-text> <clap-text at="80">Unbelievable</clap-text> <clap-text at="90">PREPOSTEROUS</clap-text> <clap-text at="100">I N S A N I T Y</clap-text> <clap-text at="185"><span style="font-family:monospace">FEED ME A STRAY CAT</span></clap-text> </clap-config> <template id="_animation-template"><div class="animation-main fixed-top"><nav id="breadcrumbs" class="screen-only"><ul></ul></nav><div class="content"><div class="page"></div></div></div></template> <template id="_loading-template"><div class="loading nav-btn fr"> <span class="sr-only">Loading…</span> <span class="icon-cog"></span></div></template> <template id="_error-template"><div class="page"><h1 class="page-title">Error</h1><p class="lead"> Sorry, an error occurred while loading <a class="this-link" href=""></a>.</div></template> <template id="_permalink-template"> <a href="#" class="permalink"> <span class="sr-only">Permalink</span> <span class="content-hash"></span> </a> </template> <template id="_dark-mode-template"> <button id="_dark-mode" class="nav-btn no-hover" > <span class="sr-only">Dark Mode</span> <span class="icon-brightness-contrast"></span> </button> </template> <template id="_search-template"> <button id="_search" class="nav-btn no-hover"> <label class="sr-only" for="_search-input">Search</label> <span class="icon-search"></span> </button><div id="_search-box"> <input id="_search-input" type="search" class="form-control form-control-lg nav-btn" placeholder="Type something…" /> <button type="reset" class="nav-btn no-hover"> <span class="sr-only">Close</span> <span class="icon-cross"></span> </button></div><div id="_hits"></div></template></div></html>
