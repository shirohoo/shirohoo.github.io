<!DOCTYPE html>
<html lang="ko"><head><title>Remember-Me | 돈 받고 일하면 프로</title><meta name="generator" content="Jekyll v4.2.1" /><meta property="og:title" content="Remember-Me" /><meta name="author" content="shirohoo" /><meta property="og:locale" content="ko_KR, en_US" /><meta name="description" content="주로 자동로그인 등에 사용되는 Remember-Me 기능에 대해 알아봅시다." /><meta property="og:description" content="주로 자동로그인 등에 사용되는 Remember-Me 기능에 대해 알아봅시다." /><meta property="og:site_name" content="돈 받고 일하면 프로" /><meta property="og:image" content="/assets/img/spring/spring-security/security-logo.png" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2021-10-08T00:00:00+00:00" /><meta name="twitter:card" content="summary_large_image" /><meta property="twitter:image" content="/assets/img/spring/spring-security/security-logo.png" /><meta property="twitter:title" content="Remember-Me" /><meta name="google-site-verification" content="google-site-verification=QP6xbvFbQ-RK1rEeDlge0lpDYvcCG0FdC5crTSd-aDs" /> <script type="application/ld+json"> {"author":{"@type":"Person","name":"shirohoo"},"description":"주로 자동로그인 등에 사용되는 Remember-Me 기능에 대해 알아봅시다.","url":"/spring/spring-security/2021-10-08-remember-me/","@type":"BlogPosting","image":"/assets/img/spring/spring-security/security-logo.png","headline":"Remember-Me","dateModified":"2024-03-24T17:42:01+00:00","datePublished":"2021-10-08T00:00:00+00:00","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"/assets/img/me.gif"},"name":"shirohoo"},"mainEntityOfPage":{"@type":"WebPage","@id":"/spring/spring-security/2021-10-08-remember-me/"},"@context":"https://schema.org"}</script><meta name="keywords" content="java,kotlin,python,spring,backend"><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"><meta http-equiv="x-ua-compatible" content="ie=edge"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="돈 받고 일하면 프로"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta name="application-name" content="돈 받고 일하면 프로"><meta name="theme-color" content="rgb(8,46,57)"><meta name="generator" content="Hydejack v9.1.5" /><link rel="alternate" href="/spring/spring-security/2021-10-08-remember-me/" hreflang="ko-kr, en-us"><link type="application/atom+xml" rel="alternate" href="/feed.xml" title="돈 받고 일하면 프로" /><link rel="shortcut icon" href="/assets/icons/favicon.ico"><link rel="apple-touch-icon" href="/assets/icons/icon-192x192.png"><link rel="manifest" href="/assets/site.webmanifest"><link rel="dns-prefetch" href="https://fonts.googleapis.com"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preload" href="/assets/img/swipe.svg" as="image" id="_hrefSwipeSVG"><link rel="dns-prefetch" href="/assets/js/search-worker-9.1.5.js" as="worker" id="_hrefSearch"><link rel="dns-prefetch" href="/assets/bower_components/katex/dist/katex.min.css" id="_katexPreload"> <noscript><link rel="stylesheet" href="/assets/bower_components/katex/dist/katex.min.css"></noscript> <script>!function(r,c){"use strict";function a(e,t,n,o){e.addEventListener?e.addEventListener(t,n,o):e.attachEvent?e.attachEvent("on"+t,n):e["on"+t]=n}r.loadJS=function(e,t){var n=c.createElement("script");n.src=e,t&&a(n,"load",t,{once:!0});t=c.scripts[0];return t.parentNode.insertBefore(n,t),n},r._loaded=!1,r.loadJSDeferred=function(e,t){var n=c.createElement("script");function o(){r._loaded=!0,t&&a(n,"load",t,{once:!0});var e=c.scripts[0];e.parentNode.insertBefore(n,e)}return n.src=e,r._loaded?o():a(r,"load",o,{once:!0}),n},r.setRel=r.setRelStylesheet=function(e){a(c.getElementById(e),"load",function(){this.rel="stylesheet"},{once:!0})}}(window,document); !function(a){"use strict";var b=function(b,c,d){function e(a){return h.body?a():void setTimeout(function(){e(a)})}function f(){i.addEventListener&&i.removeEventListener("load",f),i.media=d||"all"}var g,h=a.document,i=h.createElement("link");if(c)g=c;else{var j=(h.body||h.getElementsByTagName("head")[0]).childNodes;g=j[j.length-1]}var k=h.styleSheets;i.rel="stylesheet",i.href=b,i.media="only x",e(function(){g.parentNode.insertBefore(i,c?g:g.nextSibling)});var l=function(a){for(var b=i.href,c=k.length;c--;)if(k[c].href===b)return a();setTimeout(function(){l(a)})};return i.addEventListener&&i.addEventListener("load",f),i.onloadcssdefined=l,l(f),i};"undefined"!=typeof exports?exports.loadCSS=b:a.loadCSS=b}("undefined"!=typeof global?global:this); !function(a){if(a.loadCSS){var b=loadCSS.relpreload={};if(b.support=function(){try{return a.document.createElement("link").relList.supports("preload")}catch(b){return!1}},b.poly=function(){for(var b=a.document.getElementsByTagName("link"),c=0;c<b.length;c++){var d=b[c];"preload"===d.rel&&"style"===d.getAttribute("as")&&(a.loadCSS(d.href,d,d.getAttribute("media")),d.rel=null)}},!b.support()){b.poly();var c=a.setInterval(b.poly,300);a.addEventListener&&a.addEventListener("load",function(){b.poly(),a.clearInterval(c)}),a.attachEvent&&a.attachEvent("onload",function(){a.clearInterval(c)})}}}(this); !function(w) { w._baseURL = '/'; w._publicPath = '/assets/js/'; w._noPushState = false; w._noDrawer = false; w._noNavbar = false; w._noToc = false; w._noSearch = false; w._advertise = false; w._search = { DATA_URL: '/assets/sitedata.json?no-cache', STORAGE_KEY: 'mini-search/', INDEX_KEY: 'index--2024-03-24T17:42:53+00:00', }; w._clapButton = false; }(window);</script> <!--[if gt IE 8]><!----><style id="_styleInline"> .clearfix,.sidebar-social::after{content:"";display:table;clear:both}.color-transition,.content .avatar,.nav-btn,.nav-btn-bar,.navbar,.message,.note-sm,#markdown-toc,.note,.hr-bottom,.hr-after::after,hr,.hr,p,body{transition:none}#_dark-mode{font-size:1.25rem}@media screen{body.light-mode{--body-color: #333;--body-bg: #fff;--border-color: #ebebeb;--gray: #777;--gray-bg: rgba(0,0,0,0.025);--gray-text: #666;--menu-text: #bbb;--inv-body-color: #ccc;--inv-body-bg: var(--dark-mode-body-bg)}body.light-mode .content{-webkit-font-smoothing:initial;-moz-osx-font-smoothing:initial}body.dark-mode{--body-color: #ccc;--body-bg: var(--dark-mode-body-bg);--border-color: var(--dark-mode-border-color);--gray: rgba(255,255,255,.5);--gray-bg: rgba(255,255,255,.033);--gray-text: rgba(255,255,255,.625);--menu-text: rgba(255,255,255,.25);--inv-body-color: #333;--inv-body-bg: #fff}body.dark-mode .content{-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}body.dark-mode p>code,body.dark-mode li>code,body.dark-mode table code{background-color:white;color:black;border-radius:5px;font-weight:bold}}@media screen and (prefers-color-scheme: dark){body{--body-color: #ccc;--body-bg: var(--dark-mode-body-bg);--border-color: var(--dark-mode-border-color);--gray: rgba(255,255,255,.5);--gray-bg: rgba(255,255,255,.033);--gray-text: rgba(255,255,255,.625);--menu-text: rgba(255,255,255,.25);--inv-body-color: #333;--inv-body-bg: #fff}body .content{-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}body p>code,body li>code,body table code{background-color:white;color:black;border-radius:5px;font-weight:bold}.tippy-content{-webkit-font-smoothing:initial;-moz-osx-font-smoothing:initial}}html{--font-family: Architects Daughter;--font-family-heading: Architects Daughter;--code-font-family: ui-monospace,Menlo,Monaco,Ligamonacop,Cascadia Mono,Segoe UI Mono,Roboto Mono,Oxygen Mono,Ubuntu Monospace,Source Code Pro,Fira Mono,Droid Sans Mono,Courier New,monospace;--body-color: #333;--body-bg: #fff;--border-color: #ebebeb;--gray: #777;--gray-bg: rgba(0,0,0,0.025);--gray-text: #666;--menu-text: #bbb;--inv-body-color: #ccc;--inv-body-bg: var(--dark-mode-body-bg);--root-font-size: 15px;--root-font-size-medium: 16px;--root-font-size-large: 17px;--root-font-size-print: 8pt;--root-line-height: 1.75;--font-weight: 400;--font-weight-bold: 700;--font-weight-heading: 700;--content-width-5: 54rem;--content-margin-5: 4rem;--sidebar-width: 21rem;--half-content: 31rem;--break-point-3: 64em;--break-point-5: 86em;--break-point-dynamic: 1664px}html .content{-webkit-font-smoothing:initial;-moz-osx-font-smoothing:initial}*{box-sizing:border-box}html,body{margin:0;padding:0}html{font-family:var(--font-family);font-size:var(--root-font-size);line-height:var(--root-line-height)}body{color:var(--body-color);background-color:var(--body-bg);font-weight:var(--font-weight);overflow-y:scroll}.content img,.img,.content video,.video{max-width:100%;height:auto}.lead{margin-left:-1rem;margin-right:-1rem;margin-bottom:1.5rem}img.lead,video.lead{display:block;max-width:calc(100% + 2rem);width:calc(100% + 2rem);height:auto}.heading,.f6,h6,.h6,.f5,h5,.h5,.f4,.sidebar-nav-item,h4,.h4,.post-date,.f3,h3,.h3,.f2,h2,.h2,.f1,h1,.h1{font-family:var(--font-family-heading);font-weight:var(--font-weight-heading)}.f1,h1,.h1{font-size:2rem;line-height:1.3}.f2,h2,.h2{font-size:1.5rem;line-height:1.4}.f3,h3,.h3{font-size:1.2em;line-height:1.5}.f4,.sidebar-nav-item,h4,.h4,.post-date{font-size:1.08rem;line-height:1.6}.f5,h5,.h5{font-size:1.04rem;line-height:1.7}.f6,h6,.h6{font-size:1rem}.content h1>a,.content .h1>a{text-decoration:none;border-bottom:none}@media screen and (max-width: 42em){.content h1,.content .h1{font-size:1.7rem;line-height:1.35}}@media screen and (min-width: 86em){.content h1,.content .h1{font-size:2.4rem;line-height:1.25}}@media screen and (min-width: 1664px){body:not(.no-large-headings) .content h1,body:not(.no-large-headings) .content .h1{width:calc(100% + 50vw - 32rem);font-size:3rem;line-height:1.2}}@media screen and (min-width: 124em){body:not(.no-large-headings) .content h1,body:not(.no-large-headings) .content .h1{font-size:3rem;line-height:1.1}}h1,h2,h3,.h1,.h2,.h3{margin:4rem 0 1rem}h4,h5,h6,.h4,.post-date,.h5,.h6{margin:3rem 0 .5rem}p{margin-top:0;margin-bottom:1rem}p.lead{font-size:1.2em;margin-top:1.5rem;margin-bottom:1.5rem;padding:0 1rem}ul,ol{padding-left:1.25rem}hr,.hr{border:0;margin:1rem 0;border-top:1px solid var(--border-color)}.hr-after::after{content:"";display:block;margin:1rem 0;border-top:1px solid var(--border-color)}.hr-bottom{border-bottom:1px solid var(--border-color);padding-bottom:.75rem;margin-bottom:1rem}.page{margin-bottom:3em}.page li+li{margin-top:.25rem}.page>header{position:relative;margin-bottom:1.5rem}@media screen and (min-width: 1664px){body:not(.no-third-column) .page>header>.lead+.note-sm,body:not(.no-third-column) .page>header>.lead+#markdown-toc,body:not(.no-third-column) .page>header>.lead+.note,body:not(.no-third-column) .page>header>a.no-hover+.note-sm,body:not(.no-third-column) .page>header>a.no-hover+#markdown-toc,body:not(.no-third-column) .page>header>a.no-hover+.note{position:absolute;right:-25rem;width:21rem;bottom:0;margin-bottom:0}}.page-title,.post-title{margin-top:0}.post-date{display:flex;justify-content:space-between;margin-top:-.6rem;height:2rem;margin-bottom:.85rem;color:var(--gray)}.post-date>.ellipsis,#breadcrumbs.post-date>ul{cursor:pointer}.post-date [class^="icon-"]{display:inline-block;font-size:smaller;margin-right:.25rem}.related-posts{padding-left:0;list-style:none;margin-bottom:2rem}.related-posts>li,.related-posts>li+li{margin-top:1rem}.message,.note-sm,#markdown-toc,.note{margin-bottom:1rem;padding:1rem;color:var(--gray-text);background-color:var(--gray-bg);margin-left:-1rem;margin-right:-1rem}.note-sm,#markdown-toc,.note{background:transparent;color:var(--body-color);font-size:smaller;border-left:1px solid var(--border-color);padding:1.2rem 1rem 0 1rem;margin:1rem -1rem;position:relative}.note-sm:before,#markdown-toc:before,.note:before{font-size:0.667rem;font-weight:bold;font-style:normal;letter-spacing:.025rem;text-transform:uppercase;color:var(--menu-text);position:absolute;top:0}.note-sm[title]:before,#markdown-toc[title]:before,.note[title]:before{content:attr(title) !important}.note{font-size:1rem}@media screen{body::before{content:'';width:.5rem;background:var(--gray-bg);position:fixed;left:0;top:0;bottom:0}}@media (min-width: 64em){body::before{width:21rem}}@media (min-width: 1664px){body::before{width:calc(50% - 31rem)}}@media screen and (min-width: 42em){html{font-size:var(--root-font-size-medium)}}@media screen and (min-width: 124em){html{font-size:var(--root-font-size-large)}}#breadcrumbs>ul{height:1rem;margin:-1.5rem 0 .5rem;padding:0;font-size:.667rem;color:var(--menu-text);text-transform:uppercase;width:100%;list-style:none}#breadcrumbs>ul>li{display:inline}#breadcrumbs>ul>li a{color:var(--gray);text-decoration:none;border-bottom:none}.fl{float:left}.fr{float:right}.mb4{margin-bottom:4rem}.mb6{margin-bottom:6rem}.mt0{margin-top:0}.mt1{margin-top:1rem}.mt2{margin-top:2rem}.mt3{margin-top:3rem}.mt4{margin-top:4rem}.pb0{padding-bottom:0}.ml1{margin-left:1rem}.mr1{margin-right:1rem}.sixteen-nine{position:relative}.sixteen-nine::before{display:block;content:"";width:100%;padding-top:56.25%}.sixteen-nine>*{position:absolute;top:0;left:0;right:0;bottom:0}.sixteen-ten{position:relative}.sixteen-ten::before{display:block;content:"";width:100%;padding-top:62.5%}.sixteen-ten>*{position:absolute;top:0;left:0;right:0;bottom:0}.four-three{position:relative}.four-three::before{display:block;content:"";width:100%;padding-top:75%}.four-three>*{position:absolute;top:0;left:0;right:0;bottom:0}.sr-only{display:none}.larger{font-size:larger}.smaller{font-size:smaller}.clearfix,.sidebar-social::after{content:"";display:table;clear:both}.ellipsis,#breadcrumbs>ul{white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.border{border:1px solid var(--border-color)}@media (min-width: 42em){.border-radius,.lead,.page .aspect-ratio.sixteen-nine.lead{border-radius:.5rem}}.fallback-img{background-position:center;background-repeat:no-repeat;background-image:url("data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4KPHN2ZyB3aWR0aD0iMTYwIiBoZWlnaHQ9IjkwIiB2aWV3Qm94PSIwIDAgMTYwIDkwIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPgogIDxnIHRyYW5zZm9ybT0ibWF0cml4KDAuMDQ4ODI4LCAwLCAwLCAwLjA0Nzk5MSwgNTQuOTk5OTczLCAyMC40MjgxNDgpIj4KICAgIDxwYXRoIHN0eWxlPSJmaWxsOnJnYmEoMTI4LDEyOCwxMjgsLjMzKSIgZD0iTTk1OS44ODQgMTI4YzAuMDQwIDAuMDM0IDAuMDgyIDAuMDc2IDAuMTE2IDAuMTE2djc2Ny43N2MtMC4wMzQgMC4wNDAtMC4wNzYgMC4wODItMC4xMTYgMC4xMTZoLTg5NS43N2MtMC4wNDAtMC4wMzQtMC4wODItMC4wNzYtMC4xMTQtMC4xMTZ2LTc2Ny43NzJjMC4wMzQtMC4wNDAgMC4wNzYtMC4wODIgMC4xMTQtMC4xMTRoODk1Ljc3ek05NjAgNjRoLTg5NmMtMzUuMiAwLTY0IDI4LjgtNjQgNjR2NzY4YzAgMzUuMiAyOC44IDY0IDY0IDY0aDg5NmMzNS4yIDAgNjQtMjguOCA2NC02NHYtNzY4YzAtMzUuMi0yOC44LTY0LTY0LTY0djB6Ii8+CiAgICA8cGF0aCBzdHlsZT0iZmlsbDpyZ2JhKDEyOCwxMjgsMTI4LC4zMykiIGQ9Ik04MzIgMjg4YzAgNTMuMDIwLTQyLjk4IDk2LTk2IDk2cy05Ni00Mi45OC05Ni05NiA0Mi45OC05NiA5Ni05NiA5NiA0Mi45OCA5NiA5NnoiLz4KICAgIDxwYXRoIHN0eWxlPSJmaWxsOnJnYmEoMTI4LDEyOCwxMjgsLjMzKSIgZD0iTTg5NiA4MzJoLTc2OHYtMTI4bDIyNC0zODQgMjU2IDMyMGg2NGwyMjQtMTkyeiIvPgogIDwvZz4KPC9zdmc+")}hy-push-state a{color:var(--body-color)}@supports not ((text-decoration-thickness: initial) and (text-underline-offset: initial)){hy-push-state a{text-decoration:none;border-bottom:2px solid}}@supports (text-decoration-thickness: initial) and (text-underline-offset: initial){hy-push-state a{text-decoration-style:solid;text-underline-offset:.35rem;text-decoration-thickness:2px}}hy-push-state a.no-hover{border-bottom:none;text-decoration-thickness:unset;text-underline-offset:unset}.content a:not(.btn):not(.no-hover){border-color:var(--accent-color-faded)}@supports (text-decoration-thickness: initial) and (text-underline-offset: initial){.content a:not(.btn):not(.no-hover){text-decoration-color:var(--accent-color-faded)}}.content .aspect-ratio{overflow:hidden}.content .aspect-ratio img{margin:0;width:100%;height:100%;background-color:var(--gray-bg)}hy-drawer{width:100%;position:relative;overflow:hidden;display:block;z-index:4}@media screen and (min-width: 64em){hy-drawer{position:fixed;width:21rem;top:0;left:0;bottom:0;margin-left:0}hy-drawer.cover{position:relative;width:100%}}@media screen and (min-width: 1664px){hy-drawer{width:calc(50% - 31rem)}}.sidebar{position:relative;display:flex;justify-content:center;align-items:center;color:rgba(255,255,255,0.75);text-align:center;min-height:100vh}.sidebar.invert{color:rgba(32,32,32,0.75)}.sidebar a{color:#fff;border-bottom-color:rgba(255,255,255,0.2);text-decoration-color:rgba(255,255,255,0.2)}.sidebar.invert a{color:#222;border-bottom-color:rgba(32,32,32,0.2);text-decoration-color:rgba(32,32,32,0.2)}.sidebar-bg{position:absolute;top:0;left:calc(50% - 50vw);width:100vw;height:100%;background:#202020 center / cover}.sidebar-bg::after{content:"";position:absolute;top:0;left:0;bottom:0;right:0;background:rgba(0,0,0,0.05)}.sidebar-bg.sidebar-overlay::after{background:linear-gradient(to bottom, rgba(32,32,32,0) 0%, rgba(32,32,32,0.5) 50%, rgba(32,32,32,0) 100%)}.sidebar-sticky{position:relative;z-index:3;max-width:21rem;padding:1.5rem;contain:content}.sidebar-about .avatar{margin-bottom:1.5rem}.sidebar-about>a.sidebar-title{text-decoration:none}.sidebar-about>a.sidebar-title>h2{margin:0;padding-bottom:.5rem}.sidebar-about>a.sidebar-title::after{content:'';display:block;border-bottom:2px solid;margin:0 auto .5rem;width:4rem;border-color:rgba(255,255,255,0.2);transition:border-color 250ms}.sidebar-about>a.sidebar-title:hover::after{border-color:#fff;transition:border-color 50ms}.sidebar.invert .sidebar-about>a.sidebar-title::after{border-color:rgba(32,32,32,0.2)}.sidebar.invert .sidebar-about>a.sidebar-title:hover::after{border-color:#222}.sidebar-nav>ul{list-style:none;padding-left:0}.sidebar-nav-item{display:inline-block;margin-bottom:.5rem}@media (min-width: 64em){#_main.no-drawer #_menu{display:none}#_main.no-drawer .nav-btn-bar>:nth-child(2){border:none}}.sidebar-social>ul{display:inline-block;list-style:none;padding-left:0;margin-bottom:0}.sidebar-social>ul>li{float:left}.sidebar-social>ul>li>a{display:inline-block;text-align:center;font-size:1.4rem;width:3rem;height:4rem;padding:.5rem 0;line-height:3rem;text-decoration:none;border-bottom-width:2px;border-bottom-style:solid}.sidebar-social>ul li+li{margin-top:0}.fixed-common,.fixed-bottom,.fixed-top{position:fixed;left:0;width:100%;z-index:2}.fixed-top{top:0}.fixed-bottom{bottom:0}.navbar>.content{position:relative;padding-top:0;padding-bottom:0;min-height:0;max-height:5rem}.nav-btn-bar{margin:0 -1rem;background-color:white;background-color:var(--body-bg);height:5rem;display:flex;align-items:center;position:relative}.nav-btn-bar>:first-child,.nav-btn-bar>:last-child{border:none}.nav-btn{background:none;border:none;text-decoration:none;display:flex;align-items:center;justify-content:center;width:3.25rem;height:5rem;color:var(--menu-text);border-right:1px solid var(--border-color);border-left:1px solid var(--border-color);margin-left:-1px}#markdown-toc{margin:2rem -1rem 2rem calc(-1rem + 1px);padding-left:2.5rem;padding-bottom:.5rem}#markdown-toc:before{left:1rem}@media screen and (min-width: 1664px){body:not(.no-toc) #markdown-toc{position:absolute;z-index:4;width:20.5rem;right:0;margin:auto;overflow:auto}}@media screen and (min-width: 1664px){body.no-break-layout:not(.no-toc) #markdown-toc{width:calc(50% - 31rem)}}.content{margin-left:auto;margin-right:auto;padding:8rem 1rem 12rem}@media screen{.content{padding-left:1.5rem;min-height:100vh}}@media screen and (min-width: 42em){.content{max-width:42rem}}@media screen and (min-width: 54em){.content{max-width:48rem}}@media screen and (min-width: 64em){.content{padding-left:1rem;margin-left:24rem;margin-right:3rem}}@media screen and (min-width: 86em){.content{padding-top:9rem;margin-left:25rem;margin-right:4rem;max-width:54rem}}@media screen and (min-width: 1664px){.content{margin:auto}}.large-only{display:none}@media screen and (min-width: 1664px){.large-only{display:block}}.avatar{width:7rem;height:7rem;border-radius:100%;overflow:hidden;display:inline-block}.avatar img{width:100%}.content .avatar{float:right;box-sizing:content-box;border:1rem solid var(--body-bg);transition:border-color 1s ease;margin-top:-1.5rem;margin-right:-1rem}.sidebar a{text-shadow:rgba(0,0,0,0.25) 0.1rem 0.1rem 0.15rem}.note:before{content:"Note"}.page>header>.note-sm:before,.page>header>.note:before,.page>header>#markdown-toc:before{content:"Description"}#markdown-toc:before{content:"Table of Contents"}.layout-resume .note-sm:before,.layout-resume .note:before,.layout-resume #markdown-toc:before{content:"Summary"} .clearfix,main:not(.layout-resume) .columns::after{content:"";display:table;clear:both}.color-transition,main:not(.layout-resume) .project-card{transition:none}main:not(.layout-resume) .columns{margin-left:-1rem;display:flex;flex-wrap:wrap;contain:content;padding-top:1rem;margin-top:1rem;padding-right:1rem;margin-right:-1rem}main:not(.layout-resume) .column{float:left;padding-left:1rem;margin-bottom:2rem;width:100%;display:flex}@media screen and (min-width: 42em){main:not(.layout-resume) .columns{margin-left:-2rem;margin-right:-2rem}main:not(.layout-resume) .column-1-2{width:50%}}@media screen and (min-width: 1664px){main:not(.layout-resume) .columns-break{width:calc(50vw + 25rem)}main:not(.layout-resume) .columns-break>.column-1-2,main:not(.layout-resume) .columns-break>.column-1{width:27.5rem}}@media print{main:not(.layout-resume) .columns{display:block}main:not(.layout-resume) .column{display:block;width:50%}}main:not(.layout-resume) .project-card{width:100%;color:var(--gray-text);background-color:var(--gray-bg);padding-bottom:1rem;position:relative;overflow:hidden;box-shadow:0.125rem 0.125rem 1rem rgba(0,0,0,0.2);contain:content;border-radius:.5rem;page-break-inside:avoid;transition:transform 500ms ease;will-change:transform}main:not(.layout-resume) .project-card:hover{transform:translateY(-0.25rem);transition:transform 250ms ease}main:not(.layout-resume) .project-card>a.flip-project{display:block}main:not(.layout-resume) .project-card>a.flip-project .project-card-img{margin-bottom:0}main:not(.layout-resume) .project-card>a.flip-project .project-card-img img{display:block;border-top-left-radius:.5rem;border-top-right-radius:.5rem}main:not(.layout-resume) .project-card a{position:relative;z-index:1}main:not(.layout-resume) .project-card a.fill-card{position:absolute;top:0;left:0;right:0;bottom:0;z-index:0}main:not(.layout-resume) .project-card>.project-card-title,main:not(.layout-resume) .project-card>.project-card-text{text-align:center;padding:0 1rem}main:not(.layout-resume) .project-card>.project-card-title{display:block;font-size:1.08rem;margin-top:.75rem;margin-bottom:.25rem;color:inherit}main:not(.layout-resume) .project-card>.project-card-text{margin:.25rem 0}main:not(.layout-resume) .column-1>.project-card>.project-card-title{font-size:1.2rem}main:not(.layout-resume) .column-1>.project-card>.project-card-text{font-size:1rem}</style><link rel="preload" as="style" href="/assets/css/hydejack-9.1.5.css" id="_stylePreload"><link rel="preload" as="style" href="/assets/icomoon/style.css" id="_iconsPreload"><link rel="preload" as="style" href="https://fonts.googleapis.com/css?family=Architects%20Daughter&display=swap" id="_fontsPreload"> <script> setRel('_stylePreload'); setRel('_iconsPreload'); /**/setRel('_fontsPreload');/**/ </script> <noscript><link rel="stylesheet" href="/assets/css/hydejack-9.1.5.css"><link rel="stylesheet" href="/assets/icomoon/style.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Architects%20Daughter&display=swap"> </noscript><style id="_pageStyle"> html{--accent-color: rgb(79,177,186);--accent-color-faded: rgba(79,177,186,0.5);--accent-color-highlight: rgba(79,177,186,0.1);--accent-color-darkened: #409ba3;--theme-color: rgb(8,46,57);--dark-mode-body-bg: #282f31;--dark-mode-border-color: #343c3f}</style><!--<![endif]--> <!-- robots --><meta name="NaverBot" content="All"/><meta name="NaverBot" content="index,follow"/><meta name="Yeti" content="All"/><meta name="Yeti" content="index,follow"/><meta name="naver-site-verification" content="82d4d6173147a0aba3bdf3afb612c7188e832cf1" /><meta name="google-site-verification" content="qGe3nTw8iiwhc_9vqrjuB8uB0AiMCGPzG8WNTHHC13I" /> <!-- Google AdSense --> <script data-ad-client="ca-pub-9270648935360607" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script> <!-- favicons --><link rel="apple-touch-icon" sizes="57x57" href="/assets/icons/apple-icon-57x57.png"><link rel="apple-touch-icon" sizes="60x60" href="/assets/icons/apple-icon-60x60.png"><link rel="apple-touch-icon" sizes="72x72" href="/assets/icons/apple-icon-72x72.png"><link rel="apple-touch-icon" sizes="76x76" href="/assets/icons/apple-icon-76x76.png"><link rel="apple-touch-icon" sizes="114x114" href="/assets/icons/apple-icon-114x114.png"><link rel="apple-touch-icon" sizes="120x120" href="/assets/icons/apple-icon-120x120.png"><link rel="apple-touch-icon" sizes="144x144" href="/assets/icons/apple-icon-144x144.png"><link rel="apple-touch-icon" sizes="152x152" href="/assets/icons/apple-icon-152x152.png"><link rel="apple-touch-icon" sizes="180x180" href="/assets/icons/apple-icon-180x180.png"><link rel="icon" type="image/png" sizes="192x192" href="/assets/icons/android-icon-192x192.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/icons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="96x96" href="/assets/icons/favicon-96x96.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/icons/favicon-16x16.png"><link rel="manifest" href="/manifest.json"><meta name="msapplication-TileColor" content="#ffffff"><meta name="msapplication-TileImage" content="/ms-icon-144x144.png"><meta name="theme-color" content="#ffffff"> <!-- Code used for embedding Gumroad on the Hydejack Site. Left here for reference, feel free to delete. --><link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet"> <script src="/assets/js/sidebar-folder.js"></script><link rel="stylesheet" href="https://unpkg.com/swiper/swiper-bundle.min.css"> <script src="https://unpkg.com/swiper/swiper-bundle.min.js"></script> <script src="/assets/js/swiper-control.js"></script> <script src="/assets/js/collapsible.js"></script> <script src="/assets/js/mouse-buble.js"></script><link rel="dns-prefetch" href="https://assets.gumroad.com"> <script type="module"> document.querySelector('hy-push-state').addEventListener('load', () => { let tocElement = document.getElementById("markdown-toc"); if(tocElement){ let affixedDiv = document.createElement("div"); affixedDiv.style.position = "relative"; affixedDiv.style.top = "-1rem"; tocElement.parentNode.insertBefore(affixedDiv, tocElement); let headerList = document.getElementsByClassName("permalink"); if(headerList){ let prevElement; window.addEventListener("scroll", () => { let hurdleTop = affixedDiv.getBoundingClientRect().top; if(hurdleTop <= 0) tocElement.classList.add("affix"); else tocElement.classList.remove("affix"); for(let i=0;i<headerList.length;i++){ if(headerList[i].getBoundingClientRect().top >= 0){ prevElement?.style.removeProperty("font-weight"); let tocId = "markdown-toc-" + headerList[i].parentNode.id; prevElement = document.getElementById(tocId); prevElement.style.fontWeight = "bold";; break; } } }); } } }); </script> <script type="module"> let p; const promisify = f => x => new Promise(r => f(x).addEventListener('load', r)); const loadJS = promisify(window.loadJS); document.querySelector('hy-push-state').addEventListener('load', () => { const io = new IntersectionObserver(async (entries) => { if (entries.some(x => x.isIntersecting)) { p = p || loadJS('https://gumroad.com/js/gumroad-embed.js'); await p; if (!window.GumroadEmbed) { await new Promise(function check1(res) { if ('createGumroadEmbed' in window) res(window.createGumroadEmbed()); else setTimeout(() => check1(res), 200); }); } await new Promise(function check2(res) { if ('GumroadEmbed' in window) res(GumroadEmbed.reload()); else setTimeout(() => check2(res), 200); }); } }, { rootMargin: '1440px' }); document.querySelectorAll('.gumroad-product-embed').forEach(el => io.observe(el)); }); </script> <script type="module"> let p; const promisify = f => x => new Promise(r => f(x).addEventListener('load', r)); const loadJS = promisify(window.loadJS); document.querySelector('hy-push-state').addEventListener('load', () => { const io = new IntersectionObserver(async (entries) => { if (entries.some(x => x.isIntersecting)) { p = p || loadJS('https://gumroad.com/js/gumroad.js'); await p; if (!window.GumroadOverlay) { await new Promise(function check(res) { if ('createGumroadOverlay' in window) res(window.createGumroadOverlay()); else setTimeout(() => check(res), 200); }); } } }, { rootMargin: '300px' }); document.querySelectorAll('.gumroad-button').forEach(el => io.observe(el)); }); </script><body class="no-break-layout"> <script> window._sunrise = 6; window._sunset = 18; !function(e,s){var d="light-mode",o="dark-mode",a=(new Date).getHours();"matchMedia"in e&&e.matchMedia("(prefers-color-scheme)")||(o=(e=a<=e._sunrise||a>=e._sunset?o:d)==o?d:o,s.body.classList.add(e),s.body.classList.remove(o))}(window,document); </script> <hy-push-state id="_pushState" replace-selector="#_main" link-selector="a[href]:not([href^='/assets/']):not(.external):not(.no-push-state)" script-selector="script" duration="500" hashchange ><div id="_navbar" class="navbar fixed-top"><div class="content"> <span class="sr-only">Jump to:</span><div class="nav-btn-bar"> <a id="_menu" class="nav-btn no-hover" href="#_drawer--opened"> <span class="sr-only">Navigation</span> <span class="icon-menu"></span> </a><div class="nav-span"></div></div></div></div><hr class="sr-only" hidden /><main id="_main" class="content layout-post" role="main" ><nav id="breadcrumbs" class="screen-only"><ul><li><a href="/">home</a><li> <span>/</span> <a href="/spring/">spring</a><li> <span>/</span> <a href="/spring/spring-security/">spring-security</a><li> <span>/</span> <span>2021-10-08-remember-me</span></ul></nav><script async src="https://www.googletagmanager.com/gtag/js?id=G-NKVY3834TW"></script> <script> window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-NKVY3834TW'); </script><article id="post-spring-spring-security-remember-me" class="page post mb6" role="article"><header><h1 class="post-title flip-project-title"> Remember-Me</h1><div class="post-date"> <span class="ellipsis mr1"> <time datetime="2021-10-08T00:00:00+00:00">08 Oct 2021</time> &nbsp;in&nbsp;<a href="/spring/" class="flip-title"><u>Spring</u></a> / <span>Spring-security</span> </span></div><div class="img-wrapper lead aspect-ratio sixteen-nine flip-project-img"> <img src="/assets/img/spring/spring-security/security-logo.png" alt="Remember-Me" width="864" height="486" loading="lazy" /></div><p class="note-sm" > 주로 자동로그인 등에 사용되는 <code class="language-plaintext highlighter-rouge">Remember-Me</code> 기능에 대해 알아봅시다.</header><ul id="markdown-toc"><li><a href="#dependencies" id="markdown-toc-dependencies">Dependencies</a><li><a href="#-remember-me" id="markdown-toc--remember-me">✅ Remember-Me</a><ul><li><a href="#암호화-시그니처를-사용한-토큰-기반" id="markdown-toc-암호화-시그니처를-사용한-토큰-기반">암호화 시그니처를 사용한 토큰 기반</a><ul><li><a href="#토큰-기반-remember-me-기능의-원리" id="markdown-toc-토큰-기반-remember-me-기능의-원리">토큰 기반 Remember-Me 기능의 원리</a><li><a href="#속성" id="markdown-toc-속성">속성</a></ul><li><a href="#데이터베이스를-사용한-영구-토큰-기반" id="markdown-toc-데이터베이스를-사용한-영구-토큰-기반">데이터베이스를 사용한 영구 토큰 기반</a><ul><li><a href="#구현" id="markdown-toc-구현">구현</a><li><a href="#확장" id="markdown-toc-확장">확장</a></ul></ul><li><a href="#참고" id="markdown-toc-참고">참고</a></ul><p><br /><h1 id="dependencies">Dependencies</h1><hr /><p>이 글의 예제 코드를 적용하기 위해서는 다음과 같은 의존성을 빌드 스크립트에 추가해야만 합니다.<p>빌드툴은 <code class="language-plaintext highlighter-rouge">Gradle</code>을 기준으로 작성하며, <code class="language-plaintext highlighter-rouge">Spring Boot 2.5.5</code> 기반입니다.<p>웹 브라우저는 <code class="language-plaintext highlighter-rouge">크롬</code>을 사용하였습니다.<p><br /><div class="language-groovy highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// file: 'build.gradle'</span>
<span class="n">dependencies</span> <span class="o">{</span>
    <span class="n">implementation</span> <span class="s1">'org.springframework.boot:spring-boot-starter-security'</span>
    <span class="n">implementation</span> <span class="s1">'org.springframework.boot:spring-boot-starter-data-jpa'</span>
    
    <span class="o">...</span>

    <span class="n">runtimeOnly</span> <span class="s1">'com.h2database:h2'</span>
<span class="o">}</span>
</code></pre></div></div><p><br /><h1 id="-remember-me">✅ Remember-Me</h1><hr /><p><code class="language-plaintext highlighter-rouge">Java Servlet</code> 기반의 <code class="language-plaintext highlighter-rouge">WAS</code>를 사용 할 경우 인증 요청 대한 인증 성공 시 발급되는 쿠키의 기본 이름은 <code class="language-plaintext highlighter-rouge">JSESSIONID</code> 입니다.<p>이것은 <code class="language-plaintext highlighter-rouge">Java Servlet</code> 표준 스펙에 정의된 부분이기 때문에 <code class="language-plaintext highlighter-rouge">Java Servlet</code>을 구현하는 모든 WAS가 동일합니다.<p><code class="language-plaintext highlighter-rouge">Spring MVC</code>를 사용 할 경우 기본적으로 톰캣을 사용하기 때문에 위의 내용이 적용됩니다.<p>따라서 <code class="language-plaintext highlighter-rouge">Spring Security</code> 적용 후 발급되는 인증 쿠키의 이름은 <code class="language-plaintext highlighter-rouge">JSESSIONID</code>가 됩니다.<p><br /><blockquote><p>이 이름은 물론 개발자가 커스터마이징할 수 있습니다.</blockquote><p><br /><p><code class="language-plaintext highlighter-rouge">Remember-Me</code> 기능은 사용자에게 매우 큰 편리성을 제공하는 기능입니다.<p>사용자가 서버에 인증한 순간 웹 브라우저에 <code class="language-plaintext highlighter-rouge">remember-me</code> 쿠키를 저장해 놓음으로써 이후 사용자의 세션이 만료되거나, 불특정한 사유로 <code class="language-plaintext highlighter-rouge">JSESSIONID</code>가 없어졌을 경우에도 해당 사용자를 기억할 수 있게 됩니다.<p><br /><p><img src="https://user-images.githubusercontent.com/71188307/136895281-41bddc06-554a-43ea-b659-4b66f54d7cd4.png" alt="image" /><p><br /><p>즉, <code class="language-plaintext highlighter-rouge">Spring Security Filter Chain</code>에서 유효한 <code class="language-plaintext highlighter-rouge">remember-me</code> 쿠키를 인식하면 해당 사용자가 현재 인증되지 않은 사용자라고 할지라도 즉시 자동으로 재 인증을 시켜주므로, 사용자는 이 기능을 통해 로그인 시 쿠키가 유효한 시점까지 아이디/패스워드 등의 정보를 다시 입력하지 않아도 되게 됩니다.<p>단, 사용자에게 편의성을 제공하면 할수록 보안 수준은 반비례하여 점점 떨어질 수 밖에 없기 때문에, 이 부분은 항상 주의해야 합니다.<p><br /><p>스프링 시큐리티는 <code class="language-plaintext highlighter-rouge">Remember-Me</code> 기능에 대해 기본적으로 두 가지 구현체를 제공합니다.<ul><li>암호화 시그니처를 사용한 <code class="language-plaintext highlighter-rouge">토큰 기반</code>의 <code class="language-plaintext highlighter-rouge">Remember-Me</code>, 구현체의 이름은 <code class="language-plaintext highlighter-rouge">TokenBasedRememberMeServices</code><li>데이터베이스를 사용한 <code class="language-plaintext highlighter-rouge">영구 토큰</code> 기반의 <code class="language-plaintext highlighter-rouge">Remember-Me</code>, 구현체의 이름은 <code class="language-plaintext highlighter-rouge">PersistentTokenBasedRememberMeServices</code></ul><p>그리고 위의 두 구현체는 모두 <code class="language-plaintext highlighter-rouge">UserDetailsService</code>를 의존하기 때문에 <code class="language-plaintext highlighter-rouge">Remember-Me</code> 기능을 구현하기 위해서는 <code class="language-plaintext highlighter-rouge">UserDetailsService</code>를 반드시 설정해주어야만 합니다.<p><br /><h2 id="암호화-시그니처를-사용한-토큰-기반">암호화 시그니처를 사용한 토큰 기반</h2><hr /><p>기본적인 적용은 아주 심플합니다.<p><br /><div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// file: 'SecurityConfiguration.java'</span>

<span class="nd">@EnableWebSecurity</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">SecurityConfig</span> <span class="kd">extends</span> <span class="nc">WebSecurityConfigurerAdapter</span> <span class="o">{</span>

    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">configure</span><span class="o">(</span><span class="kd">final</span> <span class="nc">AuthenticationManagerBuilder</span> <span class="n">auth</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
        <span class="n">auth</span>
            <span class="o">.</span><span class="na">inMemoryAuthentication</span><span class="o">()</span>
            <span class="o">.</span><span class="na">withUser</span><span class="o">(</span><span class="s">"test"</span><span class="o">).</span><span class="na">password</span><span class="o">(</span><span class="s">"{noop}test"</span><span class="o">).</span><span class="na">authorities</span><span class="o">(</span><span class="s">"ROLE_USER"</span><span class="o">);</span> <span class="c1">// 개발 편의성을 위한 인메모리 유저를 설정합니다.</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">configure</span><span class="o">(</span><span class="kd">final</span> <span class="nc">HttpSecurity</span> <span class="n">http</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
        <span class="n">http</span>
            <span class="o">.</span><span class="na">authorizeRequests</span><span class="o">()</span> <span class="c1">// 서버로 오는 요청들에 대한 보안 정책</span>
            <span class="o">.</span><span class="na">anyRequest</span><span class="o">().</span><span class="na">authenticated</span><span class="o">()</span> <span class="c1">// 모든 요청에 대해 인증이 필요합니다.</span>

            <span class="o">.</span><span class="na">and</span><span class="o">()</span>

            <span class="o">.</span><span class="na">rememberMe</span><span class="o">().</span><span class="na">key</span><span class="o">(</span><span class="s">"key"</span><span class="o">)</span> <span class="c1">// remember-me 토큰 암호화에 사용할 키를 설정합니다. 기본값은 무작위로 설정된 문자열입니다.</span>
            <span class="o">.</span><span class="na">userDetailsService</span><span class="o">(</span><span class="n">userDetailsService</span><span class="o">())</span> <span class="c1">// Remember-Me 기능 설정에 필요한 필수 옵션</span>

            <span class="o">.</span><span class="na">and</span><span class="o">()</span>

            <span class="o">.</span><span class="na">formLogin</span><span class="o">()</span>
        <span class="o">;</span>
    <span class="o">}</span>

<span class="o">}</span>
</code></pre></div></div><p><br /><p>이후 프로젝트를 실행하고 <code class="language-plaintext highlighter-rouge">/login</code> 으로 접근하면 다음과 같은 웹 페이지가 뜹니다.<p>저는 <code class="language-plaintext highlighter-rouge">localhost:8080/login</code>으로 접근했습니다.<p><br /><p><img src="https://user-images.githubusercontent.com/78329064/136495489-82edda9e-e5d7-4924-9117-f9f68788da57.PNG" alt="기억하기미사용" /><p><br /><p>여기에 위에서 설정한 인메모리 유저정보를 입력하고 로그인을 하면 성공적으로 로그인이 되며, 웹 브라우저의 개발자 도구를 열어 쿠키 정보를 보면 아래와 같은 정보가 뜰 것입니다.<p>이 때, <code class="language-plaintext highlighter-rouge">Value</code>는 이미지와 다를 수 있으며, 쿠키 이름이 <code class="language-plaintext highlighter-rouge">JSESSIONID</code>이기만 하면 됩니다.<p>위 정보는 서버에서 <code class="language-plaintext highlighter-rouge">로그인 요청(=인증 요청)</code>을 성공적으로 받아 처리하였으며, 이에 대한 인증 쿠키를 웹 브라우저에 내려주었음을 의미합니다.<p><br /><p><img src="https://user-images.githubusercontent.com/78329064/136495483-764fff57-36c7-4ac3-baf4-b925115dbab8.PNG" alt="기억하기미사용2" /><p><br /><p>이제 <code class="language-plaintext highlighter-rouge">Remember-Me</code> 기능을 사용할 것임을 의미하는 아래의 체크박스에 체크를 하고, 동일하게 로그인을 시도해봅니다.<p>아래의 과정을 진행하기 전 <code class="language-plaintext highlighter-rouge">/logout</code>으로 접근하여 서버에 로그아웃 요청을 보내 세션을 지워주어야 합니다.<p>저는 <code class="language-plaintext highlighter-rouge">localhost:8080/logout</code>으로 접근하였습니다.<p><br /><p><img src="https://user-images.githubusercontent.com/78329064/136495487-e6747e09-73bc-4022-8a66-a76eecf9dbce.PNG" alt="기억하기사용" /><p><br /><p><img src="https://user-images.githubusercontent.com/78329064/136495488-acb5ca81-1e86-4f55-8f9f-042badf124a9.PNG" alt="기억하기사용2" /><p><br /><p>역시 성공적으로 로그인이 되며 아까와 다르게 <code class="language-plaintext highlighter-rouge">remember-me</code> 라는 이름의 새로운 쿠키가 하나 더 생겨있음을 알 수 있습니다.<p>여기서 한가지 짚고 넘어갈 것이 있는데, 로그인 페이지의 HTML을 살펴보면,<p><br /><div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html</span> <span class="na">lang=</span><span class="s">"en"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;meta</span> <span class="na">charset=</span><span class="s">"utf-8"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;meta</span> <span class="na">name=</span><span class="s">"viewport"</span> <span class="na">content=</span><span class="s">"width=device-width, initial-scale=1, shrink-to-fit=no"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;meta</span> <span class="na">name=</span><span class="s">"description"</span> <span class="na">content=</span><span class="s">""</span><span class="nt">&gt;</span>
    <span class="nt">&lt;meta</span> <span class="na">name=</span><span class="s">"author"</span> <span class="na">content=</span><span class="s">""</span><span class="nt">&gt;</span>
    <span class="nt">&lt;title&gt;</span>Please sign in<span class="nt">&lt;/title&gt;</span>
    <span class="nt">&lt;link</span> <span class="na">href=</span><span class="s">"https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta/css/bootstrap.min.css"</span> <span class="na">rel=</span><span class="s">"stylesheet"</span> <span class="na">integrity=</span><span class="s">"sha384-/Y6pD6FV/Vv2HJnA6t+vslU6fwYXjCFtcEpHbNJ0lyAFsXTsjBbfaDjzALeQsN6M"</span> <span class="na">crossorigin=</span><span class="s">"anonymous"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;link</span> <span class="na">href=</span><span class="s">"https://getbootstrap.com/docs/4.0/examples/signin/signin.css"</span> <span class="na">rel=</span><span class="s">"stylesheet"</span> <span class="na">crossorigin=</span><span class="s">"anonymous"</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;/head&gt;</span>
  <span class="nt">&lt;body&gt;</span>
     <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"container"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;form</span> <span class="na">class=</span><span class="s">"form-signin"</span> <span class="na">method=</span><span class="s">"post"</span> <span class="na">action=</span><span class="s">"/login"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;h2</span> <span class="na">class=</span><span class="s">"form-signin-heading"</span><span class="nt">&gt;</span>Please sign in<span class="nt">&lt;/h2&gt;</span>
        <span class="nt">&lt;p&gt;</span>
          <span class="nt">&lt;label</span> <span class="na">for=</span><span class="s">"username"</span> <span class="na">class=</span><span class="s">"sr-only"</span><span class="nt">&gt;</span>Username<span class="nt">&lt;/label&gt;</span>
          <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">id=</span><span class="s">"username"</span> <span class="na">name=</span><span class="s">"username"</span> <span class="na">class=</span><span class="s">"form-control"</span> <span class="na">placeholder=</span><span class="s">"Username"</span> <span class="na">required</span> <span class="na">autofocus</span><span class="nt">&gt;</span>
        <span class="nt">&lt;/p&gt;</span>
        <span class="nt">&lt;p&gt;</span>
          <span class="nt">&lt;label</span> <span class="na">for=</span><span class="s">"password"</span> <span class="na">class=</span><span class="s">"sr-only"</span><span class="nt">&gt;</span>Password<span class="nt">&lt;/label&gt;</span>
          <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"password"</span> <span class="na">id=</span><span class="s">"password"</span> <span class="na">name=</span><span class="s">"password"</span> <span class="na">class=</span><span class="s">"form-control"</span> <span class="na">placeholder=</span><span class="s">"Password"</span> <span class="na">required</span><span class="nt">&gt;</span>
        <span class="nt">&lt;/p&gt;</span>
        <span class="nt">&lt;p&gt;</span>
          <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">'checkbox'</span> <span class="na">name=</span><span class="s">'remember-me'</span><span class="nt">/&gt;</span> Remember me on this computer.
        <span class="nt">&lt;/p&gt;</span>
          <span class="nt">&lt;input</span> <span class="na">name=</span><span class="s">"_csrf"</span> <span class="na">type=</span><span class="s">"hidden"</span> <span class="na">value=</span><span class="s">"facf4bbf-4c91-455f-8ee2-ac777f8e901c"</span> <span class="nt">/&gt;</span>
          <span class="nt">&lt;button</span> <span class="na">class=</span><span class="s">"btn btn-lg btn-primary btn-block"</span> <span class="na">type=</span><span class="s">"submit"</span><span class="nt">&gt;</span>Sign in<span class="nt">&lt;/button&gt;</span>
      <span class="nt">&lt;/form&gt;</span>
     <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</code></pre></div></div><p><br /><p>체크박스 관련 HTML에 <code class="language-plaintext highlighter-rouge">name</code>이 <code class="language-plaintext highlighter-rouge">remember-me</code>로 돼있음을 볼 수 있습니다.<p>만약 서버에서 <code class="language-plaintext highlighter-rouge">Remember-Me</code> 파라미터 이름을 변경한다면, HTML도 함께 변경되어야만 합니다.<p>스프링 시큐리티의 기본 설정 파라미터명은 <code class="language-plaintext highlighter-rouge">remember-me</code>이며, 이 이름은 기본 쿠키 이름과도 동일합니다.<p><br /><div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">final</span> <span class="kd">class</span> <span class="nc">RememberMeConfigurer</span><span class="o">&lt;</span><span class="no">H</span> <span class="kd">extends</span> <span class="nc">HttpSecurityBuilder</span><span class="o">&lt;</span><span class="no">H</span><span class="o">&gt;&gt;</span> <span class="kd">extends</span> <span class="nc">AbstractHttpConfigurer</span><span class="o">&lt;</span><span class="nc">RememberMeConfigurer</span><span class="o">&lt;</span><span class="no">H</span><span class="o">&gt;,</span> <span class="no">H</span><span class="o">&gt;</span> <span class="o">{</span>

    <span class="cm">/**
     * The default name for remember me parameter name and remember me cookie name
     */</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="nc">String</span> <span class="no">DEFAULT_REMEMBER_ME_NAME</span> <span class="o">=</span> <span class="s">"remember-me"</span><span class="o">;</span>
  
    <span class="o">...</span>
<span class="o">}</span>
</code></pre></div></div><p><br /><p>이제 웹 브라우저 개발자 모드에서 <code class="language-plaintext highlighter-rouge">JSESSIONID</code> 쿠키를 강제로 제거한다면 웹 브라우저에서는 인증 쿠키가 사라지는 것이므로, 서버는 당연히 이후 요청에 대해 인증 요청을 강제할 것입니다.<p>하지만 웹 브라우저에는 아직 <code class="language-plaintext highlighter-rouge">remember-me</code> 쿠키가 남아있으므로, 추가적인 로그인과정 없이도 다시 로그인이 될 것임을 예상해볼 수 있습니다.<p><br /><p><img src="https://user-images.githubusercontent.com/78329064/136500362-059eaa64-64af-4470-ae95-f52b93619a16.PNG" alt="제거전" /><p><br /><p><code class="language-plaintext highlighter-rouge">JSESSIONID</code> 쿠키를 클릭하여 키보드의 <code class="language-plaintext highlighter-rouge">delete</code>키를 입력하면 쿠키가 강제로 제거됩니다.<p><br /><p><img src="https://user-images.githubusercontent.com/78329064/136500364-ff0da379-69b1-42fb-96d9-a5c92b4c68b8.PNG" alt="제거후" /><p><br /><p>그리고 다시 서버에 임의의 요청을 보낸다면, 자동적으로 로그인처리가 될 것이므로 <code class="language-plaintext highlighter-rouge">JSESSIONID</code> 쿠키가 다시 생겨야만 합니다.<p>크롬의 <code class="language-plaintext highlighter-rouge">강력 새로고침(SHIFT + CTRL + R)</code>기능을 이용하여 서버에 임의의 요청을 보내면…<p><br /><p><img src="https://user-images.githubusercontent.com/78329064/136500550-ea78a920-bf9a-4265-b56d-754cf517c819.png" alt="image" /><p><br /><p>다시 인증 처리가 되어 새로운 쿠키가 생성돼있음을 확인할 수 있습니다.<p>이전에 한 설정으로 인해 서버로 오는 모든 요청은 인증이 필요하므로 원래라면 인증 쿠키가 없어 로그인 페이지로 리다이렉트 됐어야 했으나, <code class="language-plaintext highlighter-rouge">remember-me</code> 쿠키로 인해 그러한 과정 없이 재 인증이 된 것입니다.<p><br /><h3 id="토큰-기반-remember-me-기능의-원리">토큰 기반 Remember-Me 기능의 원리</h3><hr /><p><code class="language-plaintext highlighter-rouge">remember-me</code>는 인증된 사용자에 대한 여러 정보를 담아 <code class="language-plaintext highlighter-rouge">MD5</code> 방식으로 암호화한 토큰입니다.<p>최초 인증시 인증에 성공할 경우 해당 사용자의 여러 정보를 모아 설정한 <code class="language-plaintext highlighter-rouge">키(Key)</code>를 사용해 암호화 하고 해당 값을 사용자에게 돌려주는 것이죠.<p>사용자가 받는 쿠키는 아래의 정보들을 담고 있습니다.<p><br /><p><img src="https://user-images.githubusercontent.com/78329064/136502100-82d3d60b-aa14-4205-b3e4-44188241231b.png" alt="image" /><p><br /><p>사용자는 인증 성공 시 인증 성공에 대한 <code class="language-plaintext highlighter-rouge">JSESSIONID</code>라는 쿠키와, 자동로그인을 위한 <code class="language-plaintext highlighter-rouge">remember-me</code> 라는 이름의 쿠키를 받는 것입니다. (2개)<p>또한, <code class="language-plaintext highlighter-rouge">remember-me</code> 쿠키가 갖고있는 토큰값은 만료날짜, 사용자의 정보등을 추가적으로 집어넣어 암호화함으로써 레인보우 테이블 공격에 대비합니다.<blockquote><p>레인보우 테이블<p>해커들이 수백만개 이상의 임의의 데이터를 단방향 암호화하여 기록한 테이블이 레인보우 테이블입니다. 보통 사용자의 민감정보를 안전하게 보관하기 위해 데이터를 단방향으로 암호화 하는데, 암호화를 하였더라도 해당 정보가 탈취된다면, 이후 레인보우 테이블에서 해당 정보를 검색해보고 일치하는 값이 있을 경우 보안 공격에 노출되게 됩니다.</blockquote><p><br /><p>이후 임의의 사용자로부터 <code class="language-plaintext highlighter-rouge">remember-me</code> 쿠키를 이용한 요청이 들어 올 경우, 기본적으로 쿠키는 신뢰할 수 없는 데이터이기 때문에 검증에 들어갑니다.<p><br /><p><img src="https://user-images.githubusercontent.com/78329064/136502370-58d95b72-ae59-458c-804e-ddf4640b62c9.png" alt="image" /><p><br /><p><code class="language-plaintext highlighter-rouge">유효한 시그니처</code>를 만들어내기 위해서는 <code class="language-plaintext highlighter-rouge">4가지의 정보</code>가 필요합니다.<ul><li>사용자명<li>패스워드<li>만료일<li>키</ul><p><br /><p>위의 네가지 정보가 모두 올바른 값이라면, 유효한 시그니처가 생성되게 되고, 이 시그니처를 토대로 <code class="language-plaintext highlighter-rouge">체크섬</code>하여 유효성을 검증합니다.<p><br /><p>웹 브라우저에서 보내는 <code class="language-plaintext highlighter-rouge">remember-me</code> 쿠키에는 세가지의 정보가 들어있습니다.<ul><li>사용자명<li>만료일<li>시그니처</ul><p><br /><p>웹 브라우저에서 보내오는 쿠키에서 시그니처를 만드는데 필요한 <code class="language-plaintext highlighter-rouge">사용자명</code>, <code class="language-plaintext highlighter-rouge">만료일</code>을 얻을 수 있습니다.<p>그리고 서버는 시그니처를 만들 때 사용한 <code class="language-plaintext highlighter-rouge">키(Key)</code>를 이미 알고있죠.<p>따라서 네가지의 정보 중 패스워드만 더 얻으면 시그니처를 만들어낼 수 있으며, 사용자명을 토대로 데이터베이스를 조회하여 패스워드를 얻어올 수 있습니다.<p>이렇게 <code class="language-plaintext highlighter-rouge">remember-me</code> 쿠키로 인증 요청이 들어오면 위의 과정을 거쳐 유효한 시그니처를 만들어내며, 생성된 유효한 시그니처와 <code class="language-plaintext highlighter-rouge">remember-me</code> 쿠키에 들어있는 시그니처를 비교합니다.<p>만약 두 시그니처가 같다면, 해당 쿠키는 신뢰할 수 있는 쿠키이기 때문에 인증 처리 합니다.<p><br /><h3 id="속성">속성</h3><hr /><div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// file: 'SecurityConfiguration.java'</span>
<span class="nd">@EnableWebSecurity</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">SecurityConfiguration</span> <span class="kd">extends</span> <span class="nc">WebSecurityConfigurerAdapter</span> <span class="o">{</span>

    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">configure</span><span class="o">(</span><span class="kd">final</span> <span class="nc">HttpSecurity</span> <span class="n">http</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
        <span class="n">http</span>
            <span class="o">.</span><span class="na">rememberMe</span><span class="o">().</span><span class="na">key</span><span class="o">(</span><span class="s">"key"</span><span class="o">)</span> <span class="c1">// remember-me 토큰 암호화에 사용할 키를 설정합니다. 기본값은 무작위로 설정된 문자열입니다.</span>
            <span class="o">.</span><span class="na">userDetailsService</span><span class="o">(</span><span class="n">userDetailsService</span><span class="o">())</span> <span class="c1">// Remember-Me 기능 설정에 필요한 필수 옵션입니다.</span>

<span class="c1">//            .rememberMeParameter("remember-me") // 클라이언트 뷰에서 설정한 파라미터명과 동일해야 합니다. 기본값은 remember-me</span>
<span class="c1">//            .tokenValiditySeconds(86400) // 토큰 유효기간을 설정합니다. 기본값은 14일이며 단위는 초입니다. -1로 설정 할 경우 브라우저가 종료되면 함께 사라집니다.</span>
<span class="c1">//            .alwaysRemember(true) // Remember-Me 기능이 활성화 되지 않아도(체크박스에 체크하지 않아도, 혹은 체크박스가 아예 없더라도) 항상 적용하도록 합니다.</span>
<span class="c1">//            .rememberMeCookieName("remember-me") // Remember-Me 응답 쿠키이름입니다.. 기본값은 remember-me</span>

            <span class="o">.</span><span class="na">and</span><span class="o">()</span>

            <span class="o">.</span><span class="na">formLogin</span><span class="o">()</span>
        <span class="o">;</span>
    <span class="o">}</span>

<span class="o">}</span>
</code></pre></div></div><p><br /><h2 id="데이터베이스를-사용한-영구-토큰-기반">데이터베이스를 사용한 영구 토큰 기반</h2><hr /><p><br /><p><img src="https://user-images.githubusercontent.com/78329064/136879483-48e3d5de-a441-4e65-83ad-4f021eb1b0ed.png" alt="image" /><p><br /><p>이 방식은 세션-쿠키 방식과 유사하며, 이 방식을 사용하기 위해서는 먼저 두가지 속성을 이해해야 합니다.<ul><li><p>시리즈(Series): <code class="language-plaintext highlighter-rouge">사용자가 처음 로그인할 때 생성되는 랜덤한 고유 값</code>이며 <code class="language-plaintext highlighter-rouge">불변</code>합니다. 즉, 이후 사용자가 <code class="language-plaintext highlighter-rouge">Remember-Me</code> 기능을 이용해 인증을 시도할 때마다 항상 동일한 값을 가집니다. 데이터베이스의 <code class="language-plaintext highlighter-rouge">PK(Primary Key)</code>가 됩니다.<li><p>토큰(Token): 사용자가 <code class="language-plaintext highlighter-rouge">Remember-Me</code> 기능을 이용해 인증을 시도할 때마다 <code class="language-plaintext highlighter-rouge">계속해서 변경되는 고유 값</code>입니다.</ul><p><br /><p>처음 인증 시 인증 토큰을 데이터베이스에 저장해두고, 이후 사용자가 보내오는 쿠키와 데이터베이스의 쿠키를 비교합니다.<p>따라서 remember-me 쿠키가 탈취당했는지의 여부를 알 수 있고, 만약 쿠키가 탈취당했다면 해당 토큰을 강제로 정지시켜버리거나, 사용자에게 쿠키가 탈취당했음을 경고하는 등의 작업도 할 수 있게 됩니다.<p><br /><h3 id="구현">구현</h3><hr /><p><code class="language-plaintext highlighter-rouge">데이터베이스</code>는 <code class="language-plaintext highlighter-rouge">H2</code>를 사용할것이며, <code class="language-plaintext highlighter-rouge">데이터베이스 접속 방식</code>은 <code class="language-plaintext highlighter-rouge">JPA(Hibernate)</code>를 이용할 것입니다.<p>먼저, 스프링 시큐리티 팀에서 제공하는 <code class="language-plaintext highlighter-rouge">DDL</code>을 적용해야 하는데, 이 포스팅에서는 JPA를 이용 할 것이므로 해당 DDL을 참고하여 엔티티를 설계 및 구현합니다.<p><br /><div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">create</span> <span class="k">table</span> <span class="n">persistent_logins</span>
<span class="p">(</span>
    <span class="n">username</span>  <span class="nb">varchar</span><span class="p">(</span><span class="mi">64</span><span class="p">)</span> <span class="k">not</span> <span class="k">null</span><span class="p">,</span>
    <span class="n">series</span>    <span class="nb">varchar</span><span class="p">(</span><span class="mi">64</span><span class="p">)</span> <span class="k">primary</span> <span class="k">key</span><span class="p">,</span>
    <span class="n">token</span>     <span class="nb">varchar</span><span class="p">(</span><span class="mi">64</span><span class="p">)</span> <span class="k">not</span> <span class="k">null</span><span class="p">,</span>
    <span class="n">last_used</span> <span class="nb">timestamp</span>   <span class="k">not</span> <span class="k">null</span>
<span class="p">)</span>
</code></pre></div></div><p><br /><p>이를 엔티티로 구현하면 대략 다음과 같습니다. 그리고 나중에 사용하게 될 몇가지 메서드를 함께 추가하였습니다.<p><br /><div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Entity</span>
<span class="nd">@Table</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"persistent_logins"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">PersistentLogin</span> <span class="kd">implements</span> <span class="nc">Serializable</span> <span class="o">{</span>

    <span class="nd">@Id</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">series</span><span class="o">;</span>

    <span class="kd">private</span> <span class="nc">String</span> <span class="n">username</span><span class="o">;</span>

    <span class="kd">private</span> <span class="nc">String</span> <span class="n">token</span><span class="o">;</span>

    <span class="kd">private</span> <span class="nc">Date</span> <span class="n">lastUsed</span><span class="o">;</span>

    <span class="c1">// JPA의 한계로 기본생성자가 반드시 필요하지만 private으로는 설정할 수 없다.</span>
    <span class="kd">protected</span> <span class="nf">PersistentLogin</span><span class="o">()</span> <span class="o">{</span>
    <span class="o">}</span>

    <span class="c1">// 생성자를 외부에 노출하지 않습니다.</span>
    <span class="kd">private</span> <span class="nf">PersistentLogin</span><span class="o">(</span><span class="kd">final</span> <span class="nc">PersistentRememberMeToken</span> <span class="n">token</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">series</span> <span class="o">=</span> <span class="n">token</span><span class="o">.</span><span class="na">getSeries</span><span class="o">();</span>
        <span class="k">this</span><span class="o">.</span><span class="na">username</span> <span class="o">=</span> <span class="n">token</span><span class="o">.</span><span class="na">getUsername</span><span class="o">();</span>
        <span class="k">this</span><span class="o">.</span><span class="na">token</span> <span class="o">=</span> <span class="n">token</span><span class="o">.</span><span class="na">getTokenValue</span><span class="o">();</span>
        <span class="k">this</span><span class="o">.</span><span class="na">lastUsed</span> <span class="o">=</span> <span class="n">token</span><span class="o">.</span><span class="na">getDate</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="c1">// 정적 팩토리 메서드</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="nc">PersistentLogin</span> <span class="nf">from</span><span class="o">(</span><span class="kd">final</span> <span class="nc">PersistentRememberMeToken</span> <span class="n">token</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nf">PersistentLogin</span><span class="o">(</span><span class="n">token</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="nc">String</span> <span class="nf">getSeries</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">series</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="nc">String</span> <span class="nf">getUsername</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">username</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="nc">String</span> <span class="nf">getToken</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">token</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="nc">Date</span> <span class="nf">getLastUsed</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">lastUsed</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">updateToken</span><span class="o">(</span><span class="kd">final</span> <span class="nc">String</span> <span class="n">tokenValue</span><span class="o">,</span> <span class="kd">final</span> <span class="nc">Date</span> <span class="n">lastUsed</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">token</span> <span class="o">=</span> <span class="n">tokenValue</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">lastUsed</span> <span class="o">=</span> <span class="n">lastUsed</span><span class="o">;</span>
    <span class="o">}</span>

<span class="o">}</span>
</code></pre></div></div><p><br /><p>이후 위 엔티티를 데이터베이스와 결합하게 도와줄 JPA Repository를 작성합니다.<p><br /><div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">PersistentLoginRepository</span> <span class="kd">extends</span> <span class="nc">JpaRepository</span><span class="o">&lt;</span><span class="nc">PersistentLogin</span><span class="o">,</span> <span class="nc">String</span><span class="o">&gt;</span> <span class="o">{</span>

    <span class="nc">Optional</span><span class="o">&lt;</span><span class="nc">PersistentLogin</span><span class="o">&gt;</span> <span class="nf">findBySeries</span><span class="o">(</span><span class="kd">final</span> <span class="nc">String</span> <span class="n">series</span><span class="o">);</span>

    <span class="nc">List</span><span class="o">&lt;</span><span class="nc">PersistentLogin</span><span class="o">&gt;</span> <span class="nf">findByUsername</span><span class="o">(</span><span class="kd">final</span> <span class="nc">String</span> <span class="n">username</span><span class="o">);</span>

<span class="o">}</span>
</code></pre></div></div><p><br /><p>그리고 위에서 작성한 구현체들을 스프링 시큐리티에서 제공하는 <code class="language-plaintext highlighter-rouge">PersistentTokenRepository</code>로 확장해줘야 합니다.<p>이렇게 하는 이유는, <code class="language-plaintext highlighter-rouge">SecurityConfiguration</code>에서 <code class="language-plaintext highlighter-rouge">Remember-Me</code> 기능을 <code class="language-plaintext highlighter-rouge">데이터베이스 기반 토큰 방식</code>으로 구현 할 경우 데이터베이스에 접근 할 때 사용할 <code class="language-plaintext highlighter-rouge">Repository</code> 구현체를 요구하게 되는데, 기본적으로 스프링 시큐리티에서 JPA를 이용한 구현체가 제공되지 않기 때문에 이 구현체를 직접 구현해 확장하는 것입니다.<p><br /><div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// PersistentTokenRepository에서 요구하는 네가지 메서드를 재정의(Override)하도록 합니다.</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">JpaPersistentTokenRepository</span> <span class="kd">implements</span> <span class="nc">PersistentTokenRepository</span> <span class="o">{</span>

    <span class="c1">// 스프링 팀에서 권장하는 생성자 DI를 이용합니다</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="nc">PersistentLoginRepository</span> <span class="n">repository</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nf">JpaPersistentTokenRepository</span><span class="o">(</span><span class="kd">final</span> <span class="nc">PersistentLoginRepository</span> <span class="n">repository</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">repository</span> <span class="o">=</span> <span class="n">repository</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="c1">// 새로운 remember-me 쿠키를 발급할 때 담을 토큰을 생성하기 위한 메서드입니다.</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">createNewToken</span><span class="o">(</span><span class="kd">final</span> <span class="nc">PersistentRememberMeToken</span> <span class="n">token</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">repository</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="nc">PersistentLogin</span><span class="o">.</span><span class="na">from</span><span class="o">(</span><span class="n">token</span><span class="o">));</span>
    <span class="o">}</span>

    <span class="c1">// 토큰을 변경할때 호출될 메서드입니다.</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">updateToken</span><span class="o">(</span><span class="kd">final</span> <span class="nc">String</span> <span class="n">series</span><span class="o">,</span> <span class="kd">final</span> <span class="nc">String</span> <span class="n">tokenValue</span><span class="o">,</span> <span class="kd">final</span> <span class="nc">Date</span> <span class="n">lastUsed</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">repository</span><span class="o">.</span><span class="na">findBySeries</span><span class="o">(</span><span class="n">series</span><span class="o">)</span>
            <span class="o">.</span><span class="na">ifPresent</span><span class="o">(</span><span class="n">persistentLogin</span> <span class="o">-&gt;</span> <span class="o">{</span>
                <span class="n">persistentLogin</span><span class="o">.</span><span class="na">updateToken</span><span class="o">(</span><span class="n">tokenValue</span><span class="o">,</span> <span class="n">lastUsed</span><span class="o">);</span>
                <span class="n">repository</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="n">persistentLogin</span><span class="o">);</span>
            <span class="o">});</span>
    <span class="o">}</span>

    <span class="c1">// 사용자에게서 remember-me 쿠키를 이용한 인증 요청이 들어올 경우 호출될 메서드입니다.</span>
    <span class="c1">// 사용자가 보내온 쿠키에 담긴 시리즈로 데이터베이스를 검색해 토큰을 찾습니다.</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="nc">PersistentRememberMeToken</span> <span class="nf">getTokenForSeries</span><span class="o">(</span><span class="kd">final</span> <span class="nc">String</span> <span class="n">seriesId</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">repository</span><span class="o">.</span><span class="na">findBySeries</span><span class="o">(</span><span class="n">seriesId</span><span class="o">)</span>
            <span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="n">persistentLogin</span> <span class="o">-&gt;</span>
                <span class="k">new</span> <span class="nf">PersistentRememberMeToken</span><span class="o">(</span>
                    <span class="n">persistentLogin</span><span class="o">.</span><span class="na">getUsername</span><span class="o">(),</span>
                    <span class="n">persistentLogin</span><span class="o">.</span><span class="na">getSeries</span><span class="o">(),</span>
                    <span class="n">persistentLogin</span><span class="o">.</span><span class="na">getToken</span><span class="o">(),</span>
                    <span class="n">persistentLogin</span><span class="o">.</span><span class="na">getLastUsed</span><span class="o">()</span>
                <span class="o">))</span>
            <span class="o">.</span><span class="na">orElseThrow</span><span class="o">(</span><span class="nl">IllegalArgumentException:</span><span class="o">:</span><span class="k">new</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="c1">// 세션이 종료될 경우 데이터베이스에서 영구 토큰을 제거합니다.</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">removeUserTokens</span><span class="o">(</span><span class="kd">final</span> <span class="nc">String</span> <span class="n">username</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">repository</span><span class="o">.</span><span class="na">deleteAllInBatch</span><span class="o">(</span><span class="n">repository</span><span class="o">.</span><span class="na">findByUsername</span><span class="o">(</span><span class="n">username</span><span class="o">));</span>
    <span class="o">}</span>

<span class="o">}</span>
</code></pre></div></div><p><br /><p>그리고 위의 커스텀 구현체들을 <code class="language-plaintext highlighter-rouge">SecurityConfiguration</code>에 추가해줍니다.<p>테스트를 위해 몇가지 설정을 더 추가하였으나, 이 포스팅의 상단에서 설정한 것과 크게 달라진 것은 없을 것입니다.<p><br /><div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@EnableWebSecurity</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">SecurityConfiguration</span> <span class="kd">extends</span> <span class="nc">WebSecurityConfigurerAdapter</span> <span class="o">{</span>

    <span class="nd">@Autowired</span>
    <span class="kd">private</span> <span class="nc">PersistentTokenRepository</span> <span class="n">tokenRepository</span><span class="o">;</span>


    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">configure</span><span class="o">(</span><span class="kd">final</span> <span class="nc">AuthenticationManagerBuilder</span> <span class="n">auth</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
        <span class="n">auth</span>
            <span class="o">.</span><span class="na">inMemoryAuthentication</span><span class="o">()</span>
            <span class="o">.</span><span class="na">withUser</span><span class="o">(</span><span class="s">"test"</span><span class="o">).</span><span class="na">password</span><span class="o">(</span><span class="s">"{noop}test"</span><span class="o">).</span><span class="na">authorities</span><span class="o">(</span><span class="s">"ROLE_USER"</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">configure</span><span class="o">(</span><span class="kd">final</span> <span class="nc">HttpSecurity</span> <span class="n">http</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
        <span class="n">http</span>
            <span class="o">.</span><span class="na">csrf</span><span class="o">().</span><span class="na">disable</span><span class="o">()</span> <span class="c1">// 테스트 편의성을 위해 CSRF 비활성화</span>
            <span class="o">.</span><span class="na">headers</span><span class="o">().</span><span class="na">frameOptions</span><span class="o">().</span><span class="na">sameOrigin</span><span class="o">()</span> <span class="c1">// H2-Console에 접속해 영구 토큰을 확인하기 위해 설정</span>

            <span class="o">.</span><span class="na">and</span><span class="o">()</span>

            <span class="o">.</span><span class="na">authorizeRequests</span><span class="o">()</span> <span class="c1">// 서버로 오는 요청들에 대한 보안 정책</span>
            <span class="o">.</span><span class="na">antMatchers</span><span class="o">(</span><span class="s">"/h2-console/**"</span><span class="o">).</span><span class="na">permitAll</span><span class="o">()</span> <span class="c1">// H2-Console에 접속해 영구 토큰을 확인하기 위해 설정</span>
            <span class="o">.</span><span class="na">anyRequest</span><span class="o">().</span><span class="na">authenticated</span><span class="o">()</span> <span class="c1">// 모든 요청에 대해 인증이 필요합니다.</span>

            <span class="o">.</span><span class="na">and</span><span class="o">()</span>

            <span class="o">.</span><span class="na">rememberMe</span><span class="o">().</span><span class="na">key</span><span class="o">(</span><span class="s">"key"</span><span class="o">)</span> <span class="c1">// remember-me 토큰 암호화에 사용할 키를 설정합니다. 기본값은 무작위로 설정된 문자열입니다.</span>
            <span class="o">.</span><span class="na">userDetailsService</span><span class="o">(</span><span class="n">userDetailsService</span><span class="o">())</span> <span class="c1">// Remember-Me 기능 설정에 필요한 필수 옵션</span>
            <span class="o">.</span><span class="na">tokenRepository</span><span class="o">(</span><span class="n">tokenRepository</span><span class="o">)</span>

<span class="c1">//            .rememberMeParameter("remember-me") // 클라이언트 뷰에서 설정한 파라미터명과 동일해야 한다. 기본값은 remember-me</span>
<span class="c1">//            .tokenValiditySeconds(86400) // 토큰 유효기간을 설정한다. 기본값은 14일이며 초단위이다. -1로 설정 할 경우 브라우저가 종료되면 함께 사라진다.</span>
<span class="c1">//            .alwaysRemember(true) // Remember-Me 기능이 활성화 되지 않아도(체크박스에 체크하지 않아도, 혹은 체크박스가 아예 없더라도) 항상 적용하도록 한다.</span>
<span class="c1">//            .rememberMeCookieName("remember-me") // Remember-Me 응답 쿠키이름. 기본값은 remember-me</span>

            <span class="o">.</span><span class="na">and</span><span class="o">()</span>

            <span class="o">.</span><span class="na">formLogin</span><span class="o">()</span>
        <span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Bean</span>
    <span class="kd">public</span> <span class="nc">PersistentTokenRepository</span> <span class="nf">persistentTokenRepository</span><span class="o">(</span><span class="kd">final</span> <span class="nc">PersistentLoginRepository</span> <span class="n">repository</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nf">JpaPersistentTokenRepository</span><span class="o">(</span><span class="n">repository</span><span class="o">);</span>
    <span class="o">}</span>

<span class="o">}</span>
</code></pre></div></div><p><br /><p>그리고 간단한 테스트를 위해 프로젝트 설정을 조금 추가해줍니다.<p><br /><div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># file: 'resources/application.yaml'</span>
<span class="na">spring</span><span class="pi">:</span>
  <span class="na">h2</span><span class="pi">:</span>
    <span class="na">console</span><span class="pi">:</span>
      <span class="na">enabled</span><span class="pi">:</span> <span class="no">true</span>
  <span class="na">jpa</span><span class="pi">:</span>
    <span class="na">show-sql</span><span class="pi">:</span> <span class="no">true</span>
    <span class="na">properties</span><span class="pi">:</span>
      <span class="na">hibernate</span><span class="pi">:</span>
        <span class="na">format_sql</span><span class="pi">:</span> <span class="no">true</span>
    <span class="na">hibernate</span><span class="pi">:</span>
      <span class="na">ddl-auto</span><span class="pi">:</span> <span class="s">create</span>
</code></pre></div></div><p><br /><p>이후 서버를 기동하면 서버 콘솔에 로그가 쭉 뜨는데, 그중 다음과 같은 로그를 찾습니다.<p><br /><div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>2021-10-12 11:37:38.744  INFO 10844 <span class="nt">---</span> <span class="o">[</span>  restartedMain] o.s.b.a.h2.H2ConsoleAutoConfiguration    : H2 console available at <span class="s1">'/h2-console'</span><span class="nb">.</span> Database available at <span class="s1">'jdbc:h2:mem:b1152f26-a567-4c05-9bf4-4f4260366b44'</span>
</code></pre></div></div><p><br /><p>스프링 설정에 <code class="language-plaintext highlighter-rouge">H2 콘솔</code>을 사용할 것이라고 설정했기 때문에 스프링에서 인메모리 데이터베이스 콘솔에 접속할 수 있는 수단을 제공해줍니다.<p>서버가 기동된 후 <code class="language-plaintext highlighter-rouge">http://localhost:8080/h2-console/</code> 로 접속하면 다음과 같은 화면에 들어갈 수 있는데, 위에서 찾은 <code class="language-plaintext highlighter-rouge">JDBC URL</code>을 입력합니다.<p><br /><p><img src="https://user-images.githubusercontent.com/78329064/136882012-522f74a0-bc2e-44cb-89f0-dd5cfd51924a.png" alt="image" /><p><br /><p>이후 접속하면 다음과 같은 화면이 뜹니다.<p><br /><p><img src="https://user-images.githubusercontent.com/78329064/136882234-cb33e88c-bdf1-487b-92de-50eb35a9e81b.png" alt="image" /><p><br /><ol><li>화면 좌측 메뉴의 <code class="language-plaintext highlighter-rouge">PERSISTENT_LOGINS</code> 를 클릭하면 우측 콘솔에 <code class="language-plaintext highlighter-rouge">SELECT 쿼리</code>가 생성됩니다.<li>바로 위의 <code class="language-plaintext highlighter-rouge">RUN</code>을 누르면 생성된 쿼리가 실행됩니다.<li>화면 하단에 쿼리의 결과가 노출됩니다.</ol><p><br /><p>현재는 로그인을 단 한번도 하지 않았으므로 데이터베이스에 토큰이 없는것이 당연합니다.<p><code class="language-plaintext highlighter-rouge">localhost:8080/login</code>으로 접속해 아이디와 비밀번호(test/test)를 입력하고, <code class="language-plaintext highlighter-rouge">Remember-Me</code> 기능을 사용할 것임을 체크하고 로그인한 뒤 다시 H2 콘솔을 확인하도록 합니다.<p><br /><p><img src="https://user-images.githubusercontent.com/78329064/136882495-cf9579d0-6a28-454d-9544-93a1e4560cf0.png" alt="image" /><p><br /><p>우선 로그인 후 역시 <code class="language-plaintext highlighter-rouge">remember-me</code> 쿠키가 잘 응답된 것을 확인할 수 있습니다.<p><br /><p><img src="https://user-images.githubusercontent.com/78329064/136882508-35cbb5ff-a343-455d-b2d4-d67ac11202f2.png" alt="image" /><p><br /><p>H2 콘솔에 접속 후 동일한 쿼리를 실행하면 위와 같이 새로운 영구토큰이 데이터베이스에 저장됐음도 확인할 수 있습니다.<p><br /><p>이후 로그아웃이 될 경우 세션 종료를 의미하기 때문에, <code class="language-plaintext highlighter-rouge">클라이언트에 설정된 remember-me 쿠키</code>와 <code class="language-plaintext highlighter-rouge">데이터베이스에 저장된 영구 토큰</code>이 모두 제거되어야만 합니다.<p><code class="language-plaintext highlighter-rouge">localhost:8080/logout</code>으로 접속하여 로그아웃한 후 다시 한번 더 확인해봅니다.<p><br /><p><img src="https://user-images.githubusercontent.com/78329064/136882673-e0529f7d-55af-4f16-9ef1-914ab8f48c0b.png" alt="image" /><p><br /><p><img src="https://user-images.githubusercontent.com/78329064/136882690-c4d225b7-09a6-4551-82b6-84a64c1f812f.png" alt="image" /><p><br /><p>모두 성공적으로 제거된 것을 확인할 수 있습니다.<p><br /><h3 id="확장">확장</h3><hr /><p>여기까지는 <code class="language-plaintext highlighter-rouge">remember-me 쿠키</code>를 <code class="language-plaintext highlighter-rouge">영속성 레이어(Persistent Layer)</code>에 저장하고 관리하는 기본적인 방법들에 대해 알아봤습니다.<p><br /><p>만약 쿠키에 대한 추가적인 제어가 필요하다면 스프링 시큐리티에서 제공하는 <code class="language-plaintext highlighter-rouge">PersistentTokenBasedRememberMeServices</code>를 통해 다음과 같이 간단하게 몇가지 제어를 더 추가할 수 있으며, 더욱 복잡한 구성이 필요 할 경우 <code class="language-plaintext highlighter-rouge">PersistentTokenBasedRememberMeServices</code>를 확장하면 되겠습니다.<p><br /><div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// file: 'SecurityConfiguration.java'</span>
<span class="nd">@Bean</span>
<span class="kd">public</span> <span class="nc">PersistentTokenBasedRememberMeServices</span> <span class="nf">rememberMeServices</span><span class="o">(</span><span class="kd">final</span> <span class="nc">PersistentTokenRepository</span> <span class="n">repository</span><span class="o">)</span> <span class="o">{</span>
  <span class="nc">PersistentTokenBasedRememberMeServices</span> <span class="n">services</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">PersistentTokenBasedRememberMeServices</span><span class="o">(</span><span class="s">"key"</span><span class="o">,</span> <span class="n">userDetailsService</span><span class="o">(),</span> <span class="n">repository</span><span class="o">);</span>

  <span class="n">services</span><span class="o">.</span><span class="na">setAlwaysRemember</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
  <span class="n">services</span><span class="o">.</span><span class="na">setParameter</span><span class="o">(</span><span class="s">"remember-me-param-name"</span><span class="o">);</span>

  <span class="k">return</span> <span class="n">services</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></div></div><p><br /><p>위 방식의 경우 만료된 토큰들에 대한 상세한 제어가 없습니다.<p>따라서 만료된 토큰들을 주기적으로 데이터베이스에서 제거하는 코드를 추가로 작성합니다.<p><br /><div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Runnable을 구현하여 별도의 스레드로 동작시키도록 합니다.</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ExpiredTokenJpaRepositoryCleaner</span> <span class="kd">implements</span> <span class="nc">Runnable</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="kd">final</span> <span class="nc">PersistentLoginRepository</span> <span class="n">repository</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="kt">long</span> <span class="n">tokenValidityInMs</span><span class="o">;</span>

    <span class="kd">private</span> <span class="nf">ExpiredTokenJpaRepositoryCleaner</span><span class="o">(</span><span class="kd">final</span> <span class="nc">PersistentLoginRepository</span> <span class="n">repository</span><span class="o">,</span> <span class="kd">final</span> <span class="kt">long</span> <span class="n">tokenValidityInMs</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">isNull</span><span class="o">(</span><span class="n">repository</span><span class="o">))</span> <span class="o">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nf">IllegalArgumentException</span><span class="o">(</span><span class="s">"PersistentTokenRepository cannot be null."</span><span class="o">);</span>
        <span class="o">}</span>

        <span class="k">if</span> <span class="o">(</span><span class="n">tokenValidityInMs</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nf">IllegalArgumentException</span><span class="o">(</span><span class="s">"tokenValidityInMs must be greater than 0. Got "</span> <span class="o">+</span> <span class="n">tokenValidityInMs</span><span class="o">);</span>
        <span class="o">}</span>

        <span class="k">this</span><span class="o">.</span><span class="na">repository</span> <span class="o">=</span> <span class="n">repository</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">tokenValidityInMs</span> <span class="o">=</span> <span class="n">tokenValidityInMs</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="nc">ExpiredTokenJpaRepositoryCleaner</span> <span class="nf">of</span><span class="o">(</span><span class="kd">final</span> <span class="nc">PersistentLoginRepository</span> <span class="n">repository</span><span class="o">,</span> <span class="kd">final</span> <span class="kt">long</span> <span class="n">tokenValidityInMs</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nf">ExpiredTokenJpaRepositoryCleaner</span><span class="o">(</span><span class="n">repository</span><span class="o">,</span> <span class="n">tokenValidityInMs</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
        <span class="kd">final</span> <span class="kt">long</span> <span class="n">expiredInMs</span> <span class="o">=</span> <span class="nc">System</span><span class="o">.</span><span class="na">currentTimeMillis</span><span class="o">()</span> <span class="o">-</span> <span class="n">tokenValidityInMs</span><span class="o">;</span>
        <span class="n">repository</span><span class="o">.</span><span class="na">deleteAllInBatch</span><span class="o">(</span><span class="n">repository</span><span class="o">.</span><span class="na">findByLastUsedAfter</span><span class="o">(</span><span class="k">new</span> <span class="nc">Date</span><span class="o">(</span><span class="n">expiredInMs</span><span class="o">)));</span>
    <span class="o">}</span>

<span class="o">}</span>
</code></pre></div></div><p><br /><p>이제 위의 설정을 스프링에서 제공하는 스케쥴러를 이용해 주기적으로 실행시키도록 하면 됩니다.<p><br /><div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Configuration</span>
<span class="nd">@EnableScheduling</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ScheduleConfigurer</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="kd">final</span> <span class="nc">PersistentLoginRepository</span> <span class="n">persistentLoginRepository</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nf">ScheduleConfigurer</span><span class="o">(</span><span class="kd">final</span> <span class="nc">PersistentLoginRepository</span> <span class="n">persistentLoginRepository</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">persistentLoginRepository</span> <span class="o">=</span> <span class="n">persistentLoginRepository</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Scheduled</span><span class="o">(</span><span class="n">fixedDelay</span> <span class="o">=</span> <span class="mi">10_000</span><span class="o">)</span> <span class="c1">// 단위는 ms. 따라서 1,000=1초. 10초에 한번 실행됨을 의미함.</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">cleanExpiredTokens</span><span class="o">()</span> <span class="o">{</span>
        <span class="c1">// 토큰의 유효시간이 10초</span>
        <span class="k">new</span> <span class="nf">Thread</span><span class="o">(</span><span class="nc">ExpiredTokenJpaRepositoryCleaner</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="n">persistentLoginRepository</span><span class="o">,</span> <span class="mi">10_000L</span><span class="o">))</span>
            <span class="o">.</span><span class="na">start</span><span class="o">();</span>
    <span class="o">}</span>

<span class="o">}</span>
</code></pre></div></div><p><br /><p>이후 서버를 기동하고 로그인을 하면 remember-me 쿠키가 발급되고, 토큰의 유효기간을 10초로 설정하였으므로 약 10초 후에 다음과 같은 쿼리가 발생합니다.<p><br /><div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Hibernate: 
    <span class="k">select
        </span>persistent0_.series as series1_0_,
        persistent0_.last_used as last_use2_0_,
        persistent0_.token as token3_0_,
        persistent0_.username as username4_0_ 
    from
        persistent_logins persistent0_ 
    where
        persistent0_.last_used&gt;?
Hibernate: 
    delete 
    from
        persistent_logins 
    where
        <span class="nv">series</span><span class="o">=</span>?
</code></pre></div></div><p><br /><h1 id="참고">참고</h1><hr /><ul><li>Spring Security - Third Edition: Secure your web applications, RESTful services, and microservice architectures (ISBN 9781787129511)</ul></article><hr class="dingbat related mb6" /><aside class="about related mt4 mb4" role="complementary"><div class="author mt4"> <img src="/assets/img/me.gif" srcset="/assets/img/me.gif 1x,/assets/img/me.gif 2x" alt="shirohoo" class="avatar" width="120" height="120" loading="lazy" /><h2 class="page-title hr-bottom"> About Me</h2><div class="sidebar-social"> <span class="sr-only">Social:</span><ul><li> <a href="https://github.com/shirohoo" title="GitHub" class="no-mark-external"> <span class="icon-github"></span> <span class="sr-only">GitHub</span> </a><li> <a href="mailto:shirohoo4102@gmail.com" title="Email" class="no-mark-external"> <span class="icon-mail"></span> <span class="sr-only">Email</span> </a><li> <a href="https://shirohoo.github.io/feed.xml" title="RSS" class="no-mark-external"> <span class="icon-rss2"></span> <span class="sr-only">RSS</span> </a></ul></div></div></aside><aside class="other-projects related mb0" role="complementary"><h2>Related Posts</h2><div class="columns"><div class="column column-1-2"><article class="project-card"> <a href="/spring/spring-security/2021-08-30-http-login/" class="no-hover no-print-link flip-project" tabindex="-1"><div class="project-card-img aspect-ratio sixteen-nine flip-project-img"> <img src="/assets/img/spring/spring-security/security-logo.png" alt="Spring Security - HTTP API 기반의 인증 아키텍처" width="864" height="486" loading="lazy"/></div></a><h3 class="project-card-title flip-project-title"> <a href="/spring/spring-security/2021-08-30-http-login/" class="flip-title">Spring Security - HTTP API 기반의 인증 아키텍처</a></h3><p class="project-card-text fine" property="disambiguatingDescription"> Spring Security - HTTP API 기반의 인증 아키텍처 <a class="fill-card no-hover" href="/spring/spring-security/2021-08-30-http-login/" tabindex="-1"><span class="sr-only">Continue reading Spring Security - HTTP API 기반의 인증 아키텍처</span></a></article></div><div class="column column-1-2"><article class="project-card"> <a href="/spring/spring-security/2021-05-02-authentication/" class="no-hover no-print-link flip-project" tabindex="-1"><div class="project-card-img aspect-ratio sixteen-nine flip-project-img"> <img src="/assets/img/spring/spring-security/security-logo.png" alt="Spring Security - 인증(Authentication)" width="864" height="486" loading="lazy"/></div></a><h3 class="project-card-title flip-project-title"> <a href="/spring/spring-security/2021-05-02-authentication/" class="flip-title">Spring Security - 인증(Authentication)</a></h3><p class="project-card-text fine" property="disambiguatingDescription"> 스프링 시큐리티의 핵심인 <code class="language-plaintext highlighter-rouge">인증(Authentication)</code>에 대해 정리합니다 <a class="fill-card no-hover" href="/spring/spring-security/2021-05-02-authentication/" tabindex="-1"><span class="sr-only">Continue reading Spring Security - 인증(Authentication)</span></a></article></div></div></aside><aside class="related mb4" role="complementary"><h2 class="hr-bottom">Random Posts</h2><ul class="related-posts"><li class="h6"><div> <time style="display: inline-block; margin-right: 1rem;" class="faded fine" datetime="2021-05-24T20:59:00+00:00">24 May 2021</time> <a href="/diary/2021-05-24-diary-19/" class="flip-title"><span>백오피스 튜닝기 2</span></a></div><li class="h6"><div> <time style="display: inline-block; margin-right: 1rem;" class="faded fine" datetime="2021-09-15T00:00:00+00:00">15 Sep 2021</time> <a href="/backend/server-side/2021-09-15-webserver-was/" class="flip-title"><span>웹 서버와 웹 애플리케이션 서버의 차이?</span></a></div><li class="h6"><div> <time style="display: inline-block; margin-right: 1rem;" class="faded fine" datetime="2022-03-18T00:00:00+00:00">18 Mar 2022</time> <a href="/cs/operating-system/2022-03-18-file-system/" class="flip-title"><span>운영체제(Operating System) 9강</span></a></div></ul></aside><aside class="comments related" role="complementary"><h2 class="hr-bottom">Comments</h2><script src="https://utteranc.es/client.js" repo= shirohoo/shirohoo.github.io.comments issue-term= pathname theme= github-light crossorigin= "anonymous" async> </script></aside><footer class="content" role="contentinfo"><hr/><p><small class="copyright">© 2022. All rights reserved. </small><nav class="legal"><small> <a class="heading flip-title" href="/LICENSE/">LICENSE</a> </small></nav><hr class="sr-only"/></footer></main><hy-drawer id="_drawer" class="" side="left" threshold="10" noscroll ><header id="_sidebar" class="sidebar" role="banner"><div class="sidebar-bg sidebar-overlay" style="background-color:rgb(8,46,57);background-image:url(/assets/img/sidebar-bg.gif)"></div><div class="sidebar-sticky"><div class="sidebar-about"> <a class="no-hover" href="/" tabindex="-1"> <img src="/assets/img/me.gif" class="avatar" alt="돈 받고 일하면 프로" width="120" height="120" loading="lazy" /> </a> <a class="sidebar-title" href="/"><h2 class="h1">돈 받고 일하면 프로</h2></a><p class=""> 우리는 직장에서 훈련을 하기 때문에 매번 실수를 반복한다</div><nav class="sidebar-nav heading" role="navigation"> <span class="sr-only">Navigation:</span><ul><li><div class="menu-wrapper" onmouseover="javascript:spread(9)" onmouseout="javascript:spread(9)"> <a id="_drawer--opened" href="/about/" class="sidebar-nav-item " > About Me </a></div><li><div class="menu-wrapper" onmouseover="javascript:spread(10)" onmouseout="javascript:spread(10)"> <a href="/diary/" class="sidebar-nav-item " > Diary </a></div><li><div class="menu-wrapper" onmouseover="javascript:spread(11)" onmouseout="javascript:spread(11)"> <a href="/financial/" class="sidebar-nav-item " > Financial </a></div><li><div class="menu-wrapper" onmouseover="javascript:spread(12)" onmouseout="javascript:spread(12)"> <a href="/debugging/" class="sidebar-nav-item " > Debugging </a></div><li><div class="menu-wrapper" onmouseover="javascript:spread(13)" onmouseout="javascript:spread(13)"> <button class="spread-btn"> <span id="spread-icon-13" class="material-icons">arrow_right</span> </button> <a href="/cs/" class="sidebar-nav-item " > Computer Science </a><div id="submenu-13" class="menu-wrapper submenu hide"><ul style="list-style: none;"><li> <a class="sidebar-nav-item " href="/cs/operating-system/" > 운영체제 </a><li> <a class="sidebar-nav-item " href="/cs/software-design/" > 소프트웨어 설계 </a><li> <a class="sidebar-nav-item " href="/cs/database-construct/" > 데이터베이스 구축 </a><li> <a class="sidebar-nav-item " href="/cs/leverage-programming/" > 프로그래밍 활용 </a><li> <a class="sidebar-nav-item " href="/cs/information-system/" > 정보시스템 구축 </a><li> <a class="sidebar-nav-item " href="/cs/data-structure-algorithm/" > 자료구조 & 알고리즘 </a></ul></div></div><li><div class="menu-wrapper" onmouseover="javascript:spread(14)" onmouseout="javascript:spread(14)"> <button class="spread-btn"> <span id="spread-icon-14" class="material-icons">arrow_right</span> </button> <a href="/backend/" class="sidebar-nav-item " > BackEnd </a><div id="submenu-14" class="menu-wrapper submenu hide"><ul style="list-style: none;"><li> <a class="sidebar-nav-item " href="/backend/test/" > Test </a><li> <a class="sidebar-nav-item " href="/backend/java/" > Java </a><li> <a class="sidebar-nav-item " href="/backend/python/" > Python </a><li> <a class="sidebar-nav-item " href="/backend/groovy/" > Groovy </a><li> <a class="sidebar-nav-item " href="/backend/gradle/" > Gradle </a><li> <a class="sidebar-nav-item " href="/backend/database/" > Database </a><li> <a class="sidebar-nav-item " href="/backend/server-side/" > Server Side </a></ul></div></div><li><div class="menu-wrapper" onmouseover="javascript:spread(15)" onmouseout="javascript:spread(15)"> <button class="spread-btn"> <span id="spread-icon-15" class="material-icons">arrow_right</span> </button> <a href="/spring/" class="sidebar-nav-item " > Spring </a><div id="submenu-15" class="menu-wrapper submenu hide"><ul style="list-style: none;"><li> <a class="sidebar-nav-item " href="/spring/spring-boot/" > Spring Boot </a><li> <a class="sidebar-nav-item " href="/spring/spring-mvc/" > Spring MVC </a><li> <a class="sidebar-nav-item " href="/spring/spring-security/" > Spring Security </a><li> <a class="sidebar-nav-item " href="/spring/spring-data-jpa/" > Spring Data Jpa </a><li> <a class="sidebar-nav-item " href="/spring/spring-batch/" > Spring Batch </a><li> <a class="sidebar-nav-item " href="/spring/spring-webflux/" > Spring WebFlux </a><li> <a class="sidebar-nav-item " href="/spring/spring-cloud/" > Spring Cloud </a></ul></div></div><li><div class="menu-wrapper" onmouseover="javascript:spread(16)" onmouseout="javascript:spread(16)"> <button class="spread-btn"> <span id="spread-icon-16" class="material-icons">arrow_right</span> </button> <a href="/frontend/" class="sidebar-nav-item " > FrontEnd </a><div id="submenu-16" class="menu-wrapper submenu hide"><ul style="list-style: none;"><li> <a class="sidebar-nav-item " href="/frontend/javascript/" > Javascript </a><li> <a class="sidebar-nav-item " href="/frontend/vue/" > Vue.js </a></ul></div></div><li><div class="menu-wrapper" onmouseover="javascript:spread(17)" onmouseout="javascript:spread(17)"> <button class="spread-btn"> <span id="spread-icon-17" class="material-icons">arrow_right</span> </button> <a href="/ide/" class="sidebar-nav-item " > IDE </a><div id="submenu-17" class="menu-wrapper submenu hide"><ul style="list-style: none;"><li> <a class="sidebar-nav-item " href="/ide/intellij/" > IntelliJ </a></ul></div></div></ul></nav><div style="text-align:center;"> <a href="https://hits.seeyoufarm.com"> <img src="https://hits.seeyoufarm.com/api/count/incr/badge.svg?url=https%3A%2F%2Fshirohoo.github.io&count_bg=%23A30AC9&title_bg=%23686262&icon=electron.svg&icon_color=%23FFFFFF&title=hits&edge_flat=false"/> </a></div><div class="sidebar-social"> <span class="sr-only">Social:</span><ul><li> <a href="https://github.com/shirohoo" title="GitHub" class="no-mark-external"> <span class="icon-github"></span> <span class="sr-only">GitHub</span> </a><li> <a href="mailto:shirohoo4102@gmail.com" title="Email" class="no-mark-external"> <span class="icon-mail"></span> <span class="sr-only">Email</span> </a><li> <a href="https://shirohoo.github.io/feed.xml" title="RSS" class="no-mark-external"> <span class="icon-rss2"></span> <span class="sr-only">RSS</span> </a></ul></div></div></header></hy-drawer><hr class="sr-only" hidden /> </hy-push-state> <!--[if gt IE 10]><!----> <script nomodule>!function(){var t,n=document.createElement("script");!("noModule"in n)&&"onbeforeload"in n&&(t=!1,document.addEventListener("beforeload",function(e){if(e.target===n)t=!0;else if(!e.target.hasAttribute("nomodule")||!t)return;e.preventDefault()},!0),n.type="module",n.src=".",document.head.appendChild(n),n.remove())}(); </script> <script src="/assets/js/hydejack-9.1.5.js" type="module"></script> <script src="/assets/js/LEGACY-hydejack-9.1.5.js" nomodule defer></script> <!-- mouse event cancel --> <script> document.oncontextmenu = function (e) { return false; }; document.onselectstart = function (e) { return false; }; </script> <script>!function(w, d) { w.ga=w.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date; /**/ ga('create', 'G-NKVY3834TW', 'auto'); /**/ var pushStateEl = d.getElementById('_pushState'); var timeoutId; pushStateEl.addEventListener('hy-push-state-load', function() { w.clearTimeout(timeoutId); timeoutId = w.setTimeout(function() { ga('set', 'page', w.location.pathname); ga('send', 'pageview'); }, 500); }); d.addEventListener('hy--cookies-ok', function () { w.ga(function(tracker) { w.ga("set", "anonymizeIp", undefined); localStorage && localStorage.setItem("ga--client-id", tracker.get("clientId")); }); }); w.loadJSDeferred('https://www.google-analytics.com/analytics.js'); }(window, document);</script> <!--<![endif]--><div hidden><h2 class="sr-only">Templates (for web app):</h2><clap-config> <clap-text at="1">Keep going!</clap-text> <clap-text at="2">Keep going ×2!</clap-text> <clap-text at="3">Give me more!</clap-text> <clap-text at="5">Thank you, thank you</clap-text> <clap-text at="7">Far too kind!</clap-text> <clap-text at="10">Never gonna give me up?</clap-text> <clap-text at="14">Never gonna let me down?</clap-text> <clap-text at="20">Turn around and desert me!</clap-text> <clap-text at="30">You're an addict!</clap-text> <clap-text at="40">Son of a clapper!</clap-text> <clap-text at="50">No way</clap-text> <clap-text at="60">Go back to work!</clap-text> <clap-text at="70">This is getting out of <em>hand</em></clap-text> <clap-text at="80">Unbelievable</clap-text> <clap-text at="90">PREPOSTEROUS</clap-text> <clap-text at="100">I N S A N I T Y</clap-text> <clap-text at="185"><span style="font-family:monospace">FEED ME A STRAY CAT</span></clap-text> </clap-config> <template id="_animation-template"><div class="animation-main fixed-top"><nav id="breadcrumbs" class="screen-only"><ul></ul></nav><div class="content"><div class="page"></div></div></div></template> <template id="_loading-template"><div class="loading nav-btn fr"> <span class="sr-only">Loading…</span> <span class="icon-cog"></span></div></template> <template id="_error-template"><div class="page"><h1 class="page-title">Error</h1><p class="lead"> Sorry, an error occurred while loading <a class="this-link" href=""></a>.</div></template> <template id="_permalink-template"> <a href="#" class="permalink"> <span class="sr-only">Permalink</span> <span class="content-hash"></span> </a> </template> <template id="_dark-mode-template"> <button id="_dark-mode" class="nav-btn no-hover" > <span class="sr-only">Dark Mode</span> <span class="icon-brightness-contrast"></span> </button> </template> <template id="_search-template"> <button id="_search" class="nav-btn no-hover"> <label class="sr-only" for="_search-input">Search</label> <span class="icon-search"></span> </button><div id="_search-box"> <input id="_search-input" type="search" class="form-control form-control-lg nav-btn" placeholder="Type something…" /> <button type="reset" class="nav-btn no-hover"> <span class="sr-only">Close</span> <span class="icon-cross"></span> </button></div><div id="_hits"></div></template></div></html>
